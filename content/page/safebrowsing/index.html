---
title: ç«™å¤–è·³è½¬é“¾æ¥æ£€æŸ¥
date: 2025-12-07
slug: safebrowsing
---

<div>
    <h2 id="status">â³å‡†å¤‡æ£€æŸ¥...</h2>
    <p id="result"></p>
    <p id="same-origin"></p>
    <div class="highlight">
        <div class="chroma">
            <table class="lntable">
                <tr>
                    <td class="lntd">
                        <pre
                            tabindex="0"
                            class="chroma"
                        ><code><span class="lnt" id="1-1"><a class="lnlinks">1</a></span></code></pre>
                    </td>
                    <td class="lntd">
                        <pre
                            tabindex="0"
                            class="chroma"
                        ><code class="language-plain" data-lang="plain"><span class="line"><span class="cl" id="url">â³è¯·ç¨å€™...</span></span></code></pre>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <p>
        <a
            id="jump-to"
            href="/"
            style="display: none;"
            rel="noopener noreferrer"
            class="link"
            >â¡ï¸ç‚¹å‡»æ­¤å¤„ç»§ç»­å‰å¾€ (Continue)</a
        >
    </p>
    <p>
        URL å®‰å…¨æ£€æµ‹ç”±
        <a
            href="https://developers.google.com/safe-browsing/v4/usage-limits?hl=zh-cn"
            class="link"
            target="_blank"
            >Google Safe Browsing API</a
        >
        æä¾›æ”¯æŒã€‚Google
        è‡´åŠ›äºæä¾›æœ‰å…³ä¸å®‰å…¨ç½‘ç»œèµ„æºçš„æœ€å‡†ç¡®å’Œæœ€æ–°ä¿¡æ¯ã€‚ä¸è¿‡ï¼ŒGoogle
        æ— æ³•ä¿è¯å…¶ä¿¡æ¯å…¨é¢ä¸”æ²¡æœ‰é”™è¯¯ï¼šä¸€äº›æœ‰é£é™©çš„ç½‘ç«™å¯èƒ½æœªè¢«è¯†åˆ«å‡ºæ¥ï¼Œè€Œä¸€äº›å®‰å…¨ç½‘ç«™ä¹Ÿå¯èƒ½ä¼šè¢«é”™è¯¯åœ°è¯†åˆ«ã€‚
        æ— è®ºæ£€æŸ¥ç»“æœå¦‚ä½•ï¼Œæ‚¨ä»å¯<a class="link" id="copy-url">å¤åˆ¶æ­¤ URL</a
        >ï¼Œç„¶åå‰å¾€è¯¥ç½‘ç«™ã€‚
    </p>
    <p>
        äº†è§£æ›´å¤šï¼š<a
            href="https://support.google.com/webmasters/answer/6350487?hl=zh-cn"
            class="link"
            target="_blank"
            >ç¤¾ä¼šå·¥ç¨‹å­¦ï¼ˆé’“é±¼å¼æ”»å‡»å’Œæ¬ºéª—æ€§ç½‘ç«™ï¼‰</a
        >ã€<a
            href="https://developers.google.com/search/docs/monitor-debug/security/malware?hl=zh-cn"
            class="link"
            target="_blank"
            >æ¶æ„è½¯ä»¶å’Œåƒåœ¾è½¯ä»¶</a
        >å’Œ<a
            href="https://developers.google.com/safe-browsing/v4/advisory?hl=zh-cn"
            class="link"
            target="_blank"
            >Google æä¾›çš„å®‰å…¨å»ºè®®</a
        >ã€‚
    </p>
</div>

<style>
    /* Safe Browsing Warning Styles */
    .safebrowsing-warning {
        color: #cc3300;
        font-weight: bold;
    }

    .safebrowsing-safe {
        color: #336600;
        font-weight: bold;
    }

    .safebrowsing-unknown {
        color: #888888;
    }

    html[data-scheme="dark"] .safebrowsing-warning {
        color: #ff6644;
    }

    html[data-scheme="dark"] .safebrowsing-safe {
        color: #88cc66;
    }

    html[data-scheme="dark"] .safebrowsing-unknown {
        color: #bbbbbb;
    }

    #jump-to {
        font-size: 2em;
    }
</style>

<script>
    const threatMessages = {
        MALWARE:
            "ğŸš¨è­¦å‘Š - è®¿é—®æ­¤ç½‘ç«™å¯èƒ½ä¼šæŸå®³æ‚¨çš„è®¡ç®—æœºã€‚æ­¤ç½‘é¡µä¼¼ä¹åŒ…å«æ¶æ„ä»£ç ï¼Œè¿™äº›ä»£ç å¯èƒ½ä¼šåœ¨æœªç»æ‚¨åŒæ„çš„æƒ…å†µä¸‹ä¸‹è½½åˆ°æ‚¨çš„è®¡ç®—æœºã€‚",
        SOCIAL_ENGINEERING:
            "ğŸ¥¸è­¦å‘Š - æ‚¨è¦è®¿é—®çš„æ˜¯è¯ˆéª—ç½‘ç«™ã€‚ç½‘ç«™ä¸Šçš„æ”»å‡»è€…å¯èƒ½ä¼šè¯±ä½¿æ‚¨æ‰§è¡Œä¸€äº›å±é™©çš„æ“ä½œï¼Œä¾‹å¦‚å®‰è£…è½¯ä»¶æˆ–æ³„éœ²æ‚¨çš„ä¸ªäººä¿¡æ¯ï¼ˆä¾‹å¦‚å¯†ç ã€ç”µè¯å·ç æˆ–ä¿¡ç”¨å¡ä¿¡æ¯ï¼‰ã€‚",
        UNWANTED_SOFTWARE:
            "ğŸ—‘ï¸è­¦å‘Š - æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½åŒ…å«æœ‰å®³ç¨‹åºã€‚æ”»å‡»è€…å¯èƒ½ä¼šè¯•å›¾è¯±ä½¿æ‚¨å®‰è£…ä¼šæŸå®³æµè§ˆä½“éªŒçš„ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ›´æ”¹æ‚¨çš„ä¸»é¡µæˆ–åœ¨æ‚¨è®¿é—®çš„ç½‘ç«™ä¸Šå±•ç¤ºé¢å¤–çš„å¹¿å‘Šï¼‰ã€‚",
        POTENTIALLY_HARMFUL_APPLICATION:
            "âš ï¸è­¦å‘Š - æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½åŒ…å«æ¶æ„è½¯ä»¶ã€‚æ”»å‡»è€…å¯èƒ½ä¼šè¯•å›¾åœ¨æ‚¨çš„è®¾å¤‡ä¸Šå®‰è£…å±é™©åº”ç”¨ï¼Œä»¥çªƒå–æˆ–åˆ é™¤æ‚¨çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚ç…§ç‰‡ã€å¯†ç ã€æ¶ˆæ¯å’Œä¿¡ç”¨å¡ä¿¡æ¯ï¼‰ã€‚",
        SAFE: "âœ…æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½æ˜¯å®‰å…¨çš„ã€‚ä¸è¿‡ï¼ŒGoogle æ— æ³•ä¿è¯å…¶ä¿¡æ¯å…¨é¢ä¸”æ²¡æœ‰é”™è¯¯ï¼šä¸€äº›æœ‰é£é™©çš„ç½‘ç«™å¯èƒ½æœªè¢«è¯†åˆ«å‡ºæ¥ï¼Œè€Œä¸€äº›å®‰å…¨ç½‘ç«™ä¹Ÿå¯èƒ½ä¼šè¢«é”™è¯¯åœ°è¯†åˆ«ã€‚",
        UNKNOWN: "â“æˆ‘ä»¬æ— æ³•è¯†åˆ«æ­¤ç½‘ç«™çš„å®‰å…¨æ€§ã€‚",
        THREAT_TYPE_UNSPECIFIED: "ğŸš¨è­¦å‘Š - æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½æœ‰å®³ã€‚",
        INSECURE_HTTP: "éœ€è¦æ³¨æ„ï¼Œæ­¤ç½‘ç«™ä½¿ç”¨ä¸å®‰å…¨çš„ HTTP è¿æ¥ã€‚",
    };

    function base64UrlEncode(str) {
        const u = new TextEncoder().encode(str); // UTF-8 bytes
        const bin = Array.from(u)
            .map((b) => String.fromCharCode(b))
            .join("");
        return btoa(bin)
            .replace(/\+/g, "-")
            .replace(/\//g, "_")
            .replace(/=+$/, "");
    }

    function base64UrlDecode(b64url) {
        try {
            b64url = b64url.replace(/-/g, "+").replace(/_/g, "/");
            while (b64url.length % 4) b64url += "=";
            const bin = atob(b64url);
            const bytes = Uint8Array.from(
                [...bin].map((ch) => ch.charCodeAt(0)),
            );
            return new TextDecoder().decode(bytes);
        } catch (e) {
            return null;
        }
    }

    // æ— å¨èƒ: { "matches": [] } æˆ– æ—  matches å­—æ®µ
    // æœ‰å¨èƒ: { "matches": [ {...}, ... ] }
    function isThreat(json) {
        if (!json) return false;
        if (Array.isArray(json.matches) && json.matches.length > 0) return true;
        return false;
    }

    function getThreatType(json) {
        if (!json) return false;
        if (Array.isArray(json.matches) && json.matches.length > 0) {
            return json.matches[0].threatType;
        }
        return false;
    }

    async function runCheck() {
        const statusEl = document.getElementById("status");
        const resultEl = document.getElementById("result");
        const urlEl = document.getElementById("url");
        const sameOriginEl = document.getElementById("same-origin");
        const jumpToEl = document.getElementById("jump-to");
        const copyUrlEl = document.getElementById("copy-url");

        statusEl.textContent = "â³æ£€æŸ¥ä¸­...";
        resultEl.textContent = "";
        resultEl.className = "safebrowsing-unknown";
        urlEl.textContent = "";
        jumpToEl.href = "/";
        jumpToEl.style.display = "none";
        copyUrlEl.onclick = null;

        const referrer = document.referrer;
        if (referrer) {
            const currentOrigin = new URL(document.location.href).origin;
            const referrerOrigin = new URL(referrer).origin;
            const referrerPath = new URL(referrer).pathname;
            if (currentOrigin !== referrerOrigin) {
                sameOriginEl.className = "safebrowsing-warning";
                sameOriginEl.textContent = `â“è­¦å‘Šï¼šæ‚¨ä»éæœ¬ç«™å¼•ç”¨æ¥æº ${referrer} è®¿é—®æ­¤è·³è½¬é“¾æ¥æ£€æŸ¥é¡µé¢ï¼Œè¯·ç¡®ä¿è®¿é—®æ¥æºå®‰å…¨ã€‚`;
            } else {
                sameOriginEl.className = "safebrowsing-unknown";
                sameOriginEl.textContent = `â„¹ï¸æ‚¨ä»æœ¬ç«™çš„ ${referrerPath} è®¿é—®æ­¤è·³è½¬é“¾æ¥æ£€æŸ¥é¡µé¢ã€‚`;
            }
        } else {
            sameOriginEl.className = "safebrowsing-warning";
            sameOriginEl.textContent =
                "â“è­¦å‘Šï¼šæ‚¨ä¼¼ä¹ç›´æ¥è®¿é—®äº†æ­¤è·³è½¬é“¾æ¥æ£€æŸ¥é¡µé¢ï¼Œè¯·ç¡®ä¿è®¿é—®æ¥æºå®‰å…¨ã€‚";
        }

        const hash = (location.hash || "").replace(/^#/, "");
        if (!hash) {
            statusEl.textContent = "â“é”™è¯¯ï¼šURL Hash ä¸ºç©º";
            return;
        }

        const decoded = base64UrlDecode(hash);
        if (!decoded) {
            statusEl.textContent = "â“é”™è¯¯ï¼šURL Hash è§£ç å¤±è´¥";
            return;
        }

        console.info("[SafeBrowsing]", decoded);

        let targetUrl = decoded.trim();
        if (!/^[a-zA-Z][a-zA-Z0-9+.-]*:\/\//.test(targetUrl)) {
            targetUrl = "https://" + targetUrl;
        }
        const originalUrl = targetUrl;
        let isHttp = false;
        try {
            const u = new URL(targetUrl);
            isHttp = u.protocol === "http:";
            targetUrl = u.toString();
        } catch (e) {
            statusEl.textContent = "â“é”™è¯¯ï¼šURL Hash è§£ç åä¸æ˜¯æœ‰æ•ˆ URL";
            return;
        }

        urlEl.textContent = originalUrl;
        copyUrlEl.onclick = function () {
            navigator.clipboard.writeText(originalUrl);
        };
        statusEl.textContent = "â³è¯·æ±‚ Google Safe Browsing æ£€æŸ¥...";

        try {
            const resp = await fetch(
                "/api/safebrowsing?url=" + encodeURIComponent(targetUrl),
                {
                    method: "GET",
                    headers: { Accept: "application/json" },
                },
            );

            console.info("[SafeBrowsing]", resp);

            if (!resp.ok) {
                statusEl.textContent = "â“é”™è¯¯ï¼šGoogle Safe Browsing API é”™è¯¯";
                // urlEl.textContent = originalUrl;
                resultEl.textContent = threatMessages.UNKNOWN;
                return;
            }

            const json = await resp.json().catch(() => null);
            const threat = isThreat(json);
            const threatType = getThreatType(json);

            console.info("[SafeBrowsing]", json, threat, threatType);

            if (threat) {
                statusEl.textContent = "âŒè­¦å‘Š - æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½æœ‰é£é™©";
                // urlEl.textContent = originalUrl;
                const message = threatMessages[threatType];
                if (message) {
                    resultEl.textContent = message;
                    resultEl.className = "safebrowsing-warning";
                }
            } else {
                statusEl.textContent = "âœ…æ‚¨è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½æ˜¯å®‰å…¨çš„";
                // urlEl.textContent = originalUrl;
                resultEl.textContent = threatMessages.SAFE;
                // if isHttp, append threatMessages.INSECURE_HTTP
                if (isHttp) {
                    resultEl.textContent += threatMessages.INSECURE_HTTP;
                }
                resultEl.className = "safebrowsing-safe";
                jumpToEl.href = originalUrl;
                jumpToEl.style.display = "inline";
            }
        } catch (e) {
            statusEl.textContent = "â“é”™è¯¯ï¼šå‘ç”Ÿå†…éƒ¨é”™è¯¯";
            console.error("[SafeBrowsing]", e);
            // urlEl.textContent = originalUrl;
            resultEl.textContent = threatMessages.UNKNOWN;
        }
    }

    // if (document.readyState === "loading") {
    //     document.addEventListener("DOMContentLoaded", runCheck);
    // } else runCheck();

    runCheck();

    window.addEventListener("hashchange", runCheck);
</script>
