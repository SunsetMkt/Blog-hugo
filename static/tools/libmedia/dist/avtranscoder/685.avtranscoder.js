"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[685],{50848:(e,t,a)=>{a.d(t,{A:()=>M});var r=a(49859),s=a(18979),i=a.n(s),n=a(63939),o=a(50932),d=a(77162),c=a(29170),h=a(64436),l=a(14686),f=a(4624),u=a(9705),p=a(77231),m=a(95832),g=a(44328),A=a(37837),I=a(71517),b=a(67672),y=a(92647);class M extends h.A{constructor(...e){super(...e),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"pendingItem",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.streamMuxConfig={profile:p.N_,sampleRate:p.N_,channels:p.N_},0}sendAVPacket(e){var t;let a=0,r=n.f[17](e+16)!==p.Dh?n.f[17](e+16):n.f[17](e+8),s=i()(t=(0,l.s3)(n.f[20](e+24),n.f[15](e+28))).call(t);for(this.pendingItem&&(this.pendingItem.buffer=(0,y.A)(Uint8Array,[this.pendingItem.buffer,s.subarray(0,this.pendingItem.miss)]),s=s.subarray(this.pendingItem.miss),this.caches.push(this.pendingItem),this.pendingItem=null);a<s.length;){const t=m.Bq(s.subarray(a));if(b.ai(t)){let e=a+1;for(;e<s.length-1;e++)if(4095==(s[e]<<4|s[e+1]>>4)){a=e;break}if(e<s.length-1)continue;return f.z3("AACADTSParser parse failed","src/avformat/bsf/aac/ADTS2RawFilter.ts",109),u.LR}const i={dts:r,buffer:null,extradata:null,duration:p.N_,pos:n.f[17](e+56)};i.buffer=s.subarray(a+t.headerLength,a+t.headerLength+t.framePayloadLength),this.streamMuxConfig.profile=t.profile,this.streamMuxConfig.sampleRate=t.sampleRate,this.streamMuxConfig.channels=t.channels;const h=n.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||n.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||n.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels,I=(0,g.k)(BigInt(Math.floor(1024*(t.numberOfRawDataBlocksInFrame+1)/this.streamMuxConfig.sampleRate*p.SF)),p.KR,this.inTimeBase);if(i.duration=Number(I),h){o.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),o.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),o.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const e=(0,m.Ij)((0,c.A)(this.inCodecpar,d.A));n.f[20](this.inCodecpar+12)&&(0,A.Eb)(n.f[20](this.inCodecpar+12)),o.M[20](this.inCodecpar+12,(0,A.sY)(e.length)),(0,l.lW)(n.f[20](this.inCodecpar+12),e.length,e),o.M[15](this.inCodecpar+16,e.length),i.extradata=e}i.buffer.length<t.framePayloadLength?this.pendingItem={...i,miss:t.framePayloadLength-i.buffer.length}:this.caches.push(i),a+=t.aacFrameLength,r+=I}return 0}receiveAVPacket(e){if(this.caches.length){(0,I.Up)(e);const t=this.caches.shift(),a=(0,A.sY)(t.buffer.length);if((0,l.lW)(a,t.buffer.length,t.buffer),(0,I.NX)(e,a,t.buffer.length),o.M[17](e+16,t.dts),o.M[17](e+8,t.dts),o.M[17](e+56,t.pos),o.M[17](e+48,BigInt(Math.floor(t.duration))),o.M[15](e+36,1|n.f[15](e+36)),t.extradata){const a=(0,A.sY)(t.extradata.length);(0,l.lW)(a,t.extradata.length,t.extradata),(0,I.Ow)(e,1,a,t.extradata.length)}return 0}return u.LT}reset(){return this.pendingItem=null,this.caches.length=0,0}}},85947:(e,t,a)=>{a.d(t,{A:()=>s});var r=a(49859);class s{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},29279:(e,t,a)=>{a.d(t,{A:()=>o});var r=a(77231),s=a(4624),i=a(9705);const n="src/avformat/formats/mpegts/function/parsePES.ts";function o(e){const t=e.data,a=t[3],o=t[4]<<8|t[5];let d=0,c=0,h=0;if(188!==a&&190!==a&&191!==a&&240!==a&&241!==a&&255!==a&&242!==a&&248!==a){let a=r.Dh,l=r.Dh;for(;;){if(6+c>=t.length)return i.LR;if(h=t[6+c],255!==h)break;c++}if(64==(192&h)&&(c+=2,h=t[6+c]),32==(224&h))d+=5,a=a=BigInt(Math.floor(536870912*(14&t[6+c])+4194304*(255&t[7+c])+16384*(254&t[8+c])+128*(255&t[9+c])+(254&t[10+c])/2)),16&h?(l=BigInt(Math.floor(536870912*(14&t[11+c])+4194304*(255&t[12+c])+16384*(254&t[13+c])+128*(255&t[14+c])+(254&t[15+c])/2)),d+=5):l=a;else if(128==(192&h)){const e=(192&t[7+c])>>>6;d=3+t[8+c],2!==e&&3!==e||(a=BigInt(Math.floor(536870912*(14&t[9+c])+4194304*(255&t[10+c])+16384*(254&t[11+c])+128*(255&t[12+c])+(254&t[13+c])/2)),l=3===e?BigInt(Math.floor(536870912*(14&t[14+c])+4194304*(255&t[15+c])+16384*(254&t[16+c])+128*(255&t[17+c])+(254&t[18+c])/2)):a)}else{if(15!==h)return s.z3("invalid data",n,122),i.LR;d=1}e.dts=l,e.pts=a;const f=6+c+d;let u=0;if(0!==o){if(o<c+d)return s.z3("Malformed PES: PES_packet_length < 3 + PES_header_data_length",n,134),i.LR;u=o-(c+d),f+(t.byteLength-f)!=o+6&&(s.R8("PES packet size mismatch",n,139),e.flags|=2)}else u=t.byteLength-f;e.payload=t.subarray(f,f+u)}else if((188===a||191===a||240===a||241===a||255===a||242===a||248===a)&&6===e.streamId){const a=6;let r=0;r=0!==o?o:t.byteLength-a,e.payload=t.subarray(a,a+r)}return 0}},6403:(e,t,a)=>{a.d(t,{Cd:()=>h,I4:()=>u,am:()=>d,kJ:()=>f,pi:()=>c,xf:()=>p,yU:()=>l});var r=a(49859),s=a(74707),i=a.n(s),n=a(77231);class o{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class d{constructor(){(0,r.A)(this,"pos",n.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",n.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new o),(0,r.A)(this,"payload",null)}}class c{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",n.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",n.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",n.Dh)}}class h{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",n.N_),(0,r.A)(this,"program2PmtPid",new(i()))}}class l extends d{}class f{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class u{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new(i())),(0,r.A)(this,"pid2ESDescriptor",new(i()))}}class p{constructor(){(0,r.A)(this,"pid",n.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",n.N_),(0,r.A)(this,"dts",n.Dh),(0,r.A)(this,"pts",n.Dh),(0,r.A)(this,"pos",n.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"flags",void 0)}}},2187:(e,t,a)=>{a.d(t,{d:()=>n});var r=a(72739),s=a(44328),i=a(77231);function n(e,t,a){let n=BigInt(0);return r.__(e,(e=>{n+=e.codecpar.bitrate*(0,s.k)(t,a,i.i0)/BigInt(8e3)})),n}},52071:(e,t,a)=>{a.d(t,{A:()=>u});var r=a(52730),s=a.n(r),i=a(63939),n=(a(9599),a(77231)),o=a(44328),d=a(2187),c=a(71517),h=a(9705),l=a(4624);const f="src/avformat/function/seekInBytes.ts";async function u(e,t,a,r,u,p){const m=e.ioReader.getPos(),g=await e.ioReader.fileSize();let A=n.Dh,I=a;t.startTime!==n.Dh?I-=t.startTime:I-=t.firstDTS;const b=(0,o.k)(a,t.timeBase,n.i0);if(b<BigInt(1e4))return l.Yz(`seek pts is earlier then 10s, seek to first packet pos(${r}) directly`,f,64),await e.ioReader.seek(r),m;let y=(0,d.d)(e.streams,I,t.timeBase);const M=g-(0,d.d)(e.streams,BigInt(1e4),n.i0),C=(0,d.d)(e.streams,BigInt(1e4),n.i0);if(y>M&&(y=M),y<r)return await e.ioReader.seek(r),m;const x=(0,c._5)();let B=g,k=BigInt(0);e:for(;B-k<C&&(y=k),await e.ioReader.seek(y),await p(e),!(8&s()(e.ioReader));){let a=await u(e,x),r=i.f[17](x+56);if(!(a>=0)){A=n.Dh;break}{const s=(0,o.Mr)(i.f[17](x+8),x+72,n.i0);let d=s-b;if(l.Yz(`try to seek to pos: ${y}, got packet pts: ${i.f[17](x+8)}(${s}ms), diff: ${d}ms`,f,101),d<=BigInt(0)&&-d<BigInt(1e4)||B-k<C){const s=[r];for(;d<=0;){if(i.f[15](x+32)===t.index&&1&i.f[15](x+36)&&s.push(r),(0,c.Up)(x),a=await u(e,x),a<0){if(-1048576===a)break;if(-1048575===a)continue;A=n.Dh;break e}r=i.f[17](x+56),d=(0,o.Mr)(i.f[17](x+8),x+72,n.i0)-b}A=s.pop();break}d>BigInt(0)?(B=y,y=k+B>>BigInt(1)):(k=y,y=k+B>>BigInt(1))}if(8&s()(e.ioReader))break}return(0,c.Qe)(x),A!==n.Dh?(l.Yz(`finally seek to pos ${A}`,f,156),await e.ioReader.seek(A),await p(e),m):(await e.ioReader.seek(m),8&s()(e.ioReader)?BigInt(h.LT):BigInt(h.E$))}},87518:(e,t,a)=>{a.d(t,{R:()=>u,j:()=>s});var r=a(37246);const s=[3,4,3,7,259,263,1539,1543],i=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],h=[2,1,2,3,3,4,4,5],l=[1,2,3,6],f=7;function u(e){const t=new r.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=o[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=d[a.srCode]>>a.srShift,a.bitrate=1e3*c[a.ac3BitrateCode]>>a.srShift,a.channels=h[a.channelMode]+a.lfeOn,a.frameSize=2*i[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<f)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=d[e]/2,a.srShift=1}else a.numBlocks=l[t.readU(2)],a.sampleRate=d[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=h[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(s[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},43290:(e,t,a)=>{a.d(t,{R:()=>c,u:()=>d});var r=a(37246),s=a(95073);const i=[1,2,2,2,2,3,3,4,4,5,6,6,6,7,8,8],n=[0,8e3,16e3,32e3,0,0,11025,22050,44100,0,0,12e3,24e3,48e3,96e3,192e3],o=[32e3,56e3,64e3,96e3,112e3,128e3,192e3,224e3,256e3,32e4,384e3,448e3,512e3,576e3,64e4,768e3,96e4,1024e3,1152e3,128e4,1344e3,1408e3,1411200,1472e3,1536e3,192e4,2048e3,3072e3,384e4,0,0,0],d=32;function c(e){const t=new r.A(e.length);t.appendBuffer(e);const a={syncWord:0,frameType:0,deficitSamples:0,crcFlag:0,sampleBlock:0,frameSize:0,channelIndex:0,sampleRateIndex:0,bitrateIndex:0,channels:0,sampleRate:0,bitrate:0};return a.syncWord=t.readU(32),2147385345!==a.syncWord&&4269736320!==a.syncWord?-1:(a.frameType=t.readU1(),a.deficitSamples=t.readU(5)+1,a.crcFlag=t.readU1(),a.sampleBlock=t.readU(7)+1,a.frameSize=(0,s.A)(t.readU(14)+1,4),a.channelIndex=t.readU(6),a.sampleRateIndex=t.readU(4),a.bitrateIndex=t.readU(5),a.channels=i[a.channelIndex],a.sampleRate=n[a.sampleRateIndex],a.bitrate=o[a.bitrateIndex],a)}}}]);