(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[113],{64436:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(49859),n=r(63939),i=(r(77162),r(37837)),s=r(71766);class l{constructor(){(0,a.A)(this,"inCodecpar",void 0),(0,a.A)(this,"inTimeBase",void 0),(0,a.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,i.Gy)(168),(0,s.Yi)(this.inCodecpar,e),this.inTimeBase={den:n.f[15](t+4),num:n.f[15](t)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},52251:(e,t,r)=>{"use strict";r.d(t,{A:()=>U});var a=r(49859),n=r(63939),i=r(50932),s=r(64436),l=r(71517),c=r(62815),o=r(67659),d=r(59166),h=r(9705),u=r(60264),f=r(4624),p=r(14686);class U extends s.A{constructor(...e){super(...e),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0),(0,a.A)(this,"naluLengthSizeMinusOne",void 0)}init(e,t){if(super.init(e,t),this.cache=(0,l._5)(),this.cached=!1,n.f[20](e+12)){const t=(0,p.s3)(n.f[20](e+12),n.f[15](e+16));(0,u.Bs)(t)||(27===n.f[15](e+4)?this.naluLengthSizeMinusOne=3&t[4]:173===n.f[15](e+4)?this.naluLengthSizeMinusOne=3&t[21]:196===n.f[15](e+4)&&(this.naluLengthSizeMinusOne=t[0]>>>1&3))}return 0}destroy(){super.destroy(),(0,l.Qe)(this.cache),this.cache=0}sendAVPacket(e){if(64&n.f[15](e+36))(0,l.rN)(this.cache,e);else{let t;(0,l.zu)(this.cache,e);const r=(0,l.rU)(e,1);let a=null;r&&(a=(0,p.JW)(n.f[20](r),n.f[25](r+4)),(0,u.Bs)(a)||(27===n.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&a[4]:173===n.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&a[21]:196===n.f[15](this.inCodecpar+4)&&(this.naluLengthSizeMinusOne=a[0]>>>1&3)));const s=(0,p.JW)(n.f[20](e+24),n.f[15](e+28));27===n.f[15](this.inCodecpar+4)?t=c.OD(s,a,this.naluLengthSizeMinusOne):173===n.f[15](this.inCodecpar+4)?t=o.OD(s,a,this.naluLengthSizeMinusOne):196===n.f[15](this.inCodecpar+4)?t=d.OD(s,a,this.naluLengthSizeMinusOne):f.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Avcc2AnnexbFilter.ts",121),i.M[15](this.cache+36,64|n.f[15](this.cache+36)),(0,l.NX)(this.cache,t.bufferPointer,t.length),t.key&&i.M[15](this.cache+36,1|n.f[15](this.cache+36))}return this.cached=!0,0}receiveAVPacket(e){return this.cached?((0,l.Up)(e),(0,l.rN)(e,this.cache),this.cached=!1,0):h.LR}reset(){return 0}}},51597:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(49859);class n{constructor(){(0,a.A)(this,"type",-1)}async destroy(e){}}(0,a.A)(n,"Capabilities",[])},7113:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>S});var a=r(49859),n=r(96319),i=r.n(n),s=r(71426),l=r.n(s),c=r(52730),o=r.n(c),d=r(18979),h=r.n(d),u=r(61499),f=r(63939),p=r(51597),U=r(4624),g=r(52251),w=r(9705),b=r(71517),y=r(62815),x=r(67659),v=r(59166),m=r(14686),M=r(37837);const A="src/avformat/formats/OH26XFormat.ts";class S extends p.A{constructor(){super(),(0,a.A)(this,"type",11),(0,a.A)(this,"filter",void 0),(0,a.A)(this,"muxStream",void 0),(0,a.A)(this,"extradata",void 0)}init(e){return 0}async destroy(e){i()(this)&&i()(this).destroy()}writeHeader(e){var t;const r=l()(t=e.streams).call(t,(e=>27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId));return r?(this.muxStream=r,1&o()(r.codecpar)||(this.filter=new g.A,i()(this).init(r.codecpar[u.o9],r.timeBase[u.o9])),r.codecpar.extradataSize&&(this.extradata=h()(a=(0,m.s3)(r.codecpar.extradata,r.codecpar.extradataSize)).call(a)),0):(U.z3("can not found stream with h264, hevc, vvc codec",A,78),w.UY);var a}writeAVPacket(e,t){if(!f.f[15](t+28))return void U.R8(`packet's size is 0: ${f.f[15](t+32)}, ignore it`,A,98);const r=e.getStreamByIndex(f.f[15](t+32));if(r&&!(1024&r.disposition)&&r===this.muxStream){if(i()(this)){if(this.extradata){if(!(0,b.rU)(t,1)){const e=(0,M.sY)(this.extradata.length);(0,m.lW)(e,this.extradata.length,this.extradata),(0,b.Ow)(t,1,e,this.extradata.length)}this.extradata=null}i()(this).sendAVPacket(t),i()(this).receiveAVPacket(t)}else this.extradata&&((27===r.codecpar.codecId&&!y.sL((0,b.iI)(t))||173===r.codecpar.codecId&&!x.sL((0,b.iI)(t))||196===r.codecpar.codecId&&!v.sL((0,b.iI)(t)))&&e.ioWriter.writeBuffer(this.extradata),this.extradata=null);return e.ioWriter.writeBuffer((0,b.iI)(t)),0}U.R8(`can not found the stream width the packet's streamIndex: ${f.f[15](t+32)}, ignore it`,A,105)}writeTrailer(e){return e.ioWriter.flush(),0}flush(e){return e.ioWriter.flush(),0}getCapabilities(){return S.Capabilities}}(0,a.A)(S,"Capabilities",[27,173,196])},59166:(e,t,r)=>{"use strict";r.d(t,{HL:()=>P,KD:()=>N,OD:()=>T,S1:()=>k,Ui:()=>Y,XC:()=>V,kM:()=>W,oT:()=>z,sL:()=>O,wA:()=>D,wf:()=>R});var a=r(5496),n=r.n(a),i=r(73363),s=r.n(i),l=r(86226),c=r.n(l),o=r(96319),d=r.n(o),h=r(11393),u=r.n(h),f=r(31721),p=r.n(f),U=r(54810),g=r.n(U),w=r(63939),b=r(72739),y=r(729),x=r(31865),v=r(37246),m=r(14686),M=r(60264),A=r(37837),S=r(23991),_=r(83314),I=r(39381),L=r(82774);const C=3;function F(e){const t=e.readU(9),r=e.readU(3),a=e.readU(2),n=e.readU(2),i=e.readU(3);e.readU(5),e.readU(2);const s=e.readU(6),l=e.readU(7),c=e.readU(1),o=e.readU(8),d=e.readU(1),h=e.readU(1),u=[],f=[];if(s){for(let t=0;t<s-1;t++)u[t]=e.readU(8);u[s-1]=e.readU(6)}else e.readU(6);if(r>1){let t=0;for(let a=r-2;a>=0;--a)t|=e.readU(1)<<a;for(let t=r;t<=8&&r>1;++t)e.readU(1);for(let a=r-2;a>=0;--a)t&1<<a&&(f[a]=e.readU(8))}const p=e.readU(8),U=[];if(p)for(let t=0;t<p;t++)U.push(e.readU(8));return{olsIdx:t,numSublayers:r,bitDepthMinus8:i,chromaFormatIdc:n,constantFrameRate:a,generalProfileIdc:l,generalTierFlag:c,generalLevelIdc:o,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:h,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:U,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function P(e){const t=new x.A(e,!0);if(1&t.readUint8()){const r=new v.A;r.appendBuffer(e.subarray(1)),F(r),t.skip(r.getPointer())}let r=[],a=[],n=[];const i=t.readUint8();for(let e=0;e<i;e++){const e=31&t.readUint8();let i=1;13!==e&&12!==e&&(i=t.readUint16());const s=[];for(let e=0;e<i;e++){const e=t.readUint16();s.push(t.readBuffer(e))}14===e?r=s:15===e?a=s:16===e&&(n=s)}return{vpss:r,spss:a,ppss:n}}function B(e,t,r){const a=t[0];let i;if(a){const e=R(a);let t=e.generalConstraintInfo;var l;t.length||(t=n()(l=new Array(12)).call(l,0));const r=new _.A;if(r.writeU(9,0),r.writeU(3,e.spsMaxSublayersMinus1+1),r.writeU(2,1),r.writeU(2,e.chromaFormatIdc),r.writeU(3,e.bitDepthMinus8),r.writeU(5,31),r.writeU(2,0),r.writeU(6,t.length),r.writeU(7,e.profile),r.writeU1(e.tierFlag),r.writeU(8,e.level),r.writeU1(e.ptlFrameOnlyConstraintFlag),r.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)r.writeU(8,t[e]);r.writeU(6,t[t.length-1])}else r.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let r=e.spsMaxSublayersMinus1-1;r>=0;r--)t=t<<1|e.ptlSublayerLevelPresentFlag[r];r.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)r.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&r.writeU(8,e.sublayerLevelIdc[t])}r.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)r.writeU(8,e.sublayerLevelIdc[t]);r.writeU(16,e.width),r.writeU(16,e.height),r.writeU(16,0),r.padding(),i=r.getBuffer().subarray(0,r.getPointer())}let c=2+(i?i.length:0);e.length&&(c+=3,c=s()(e).call(e,((e,t)=>e+2+t.length),c)),t.length&&(c+=3,c=s()(t).call(t,((e,t)=>e+2+t.length),c)),r.length&&(c+=3,c=s()(r).call(r,((e,t)=>e+2+t.length),c));const o=new Uint8Array(c),d=new y.A(o,!0);d.writeUint8(C<<1|(i?1:0)|248),i&&d.writeBuffer(i);let h=0;return e.length&&h++,t.length&&h++,r.length&&h++,d.writeUint8(h),e.length&&(d.writeUint8(142),d.writeUint16(e.length),b.__(e,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),t.length&&(d.writeUint8(143),d.writeUint16(t.length),b.__(t,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),r.length&&(d.writeUint8(144),d.writeUint16(r.length),b.__(r,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),o}function k(e){let t=M.py(e);if(t.length>=2){const e=[],r=[],a=[];if(c()(t).call(t,(t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?r.push(t):16===n&&a.push(t)})),r.length&&a.length)return B(e,r,a)}}function O(e){let t=M.py(e);if(t.length>=2){const e=[],r=[],a=[];if(c()(t).call(t,(t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?r.push(t):16===n&&a.push(t)})),r.length&&a.length){const t=[r[0],a[0]];return e.length&&t.unshift(e[0]),M.nW(t,0)}}}function z(e,t=!1){let r,a=!1,n=M.py(e);if(n.length){const e=[],i=[],s=[];c()(n).call(n,(t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&s.push(t),8!==r&&7!==r&&9!==r&&10!==r||(a=!0)})),i.length&&s.length?(r=B(e,i,s),n=d()(n).call(n,(e=>{const r=e[1]>>>3&31;return(t||14!==r&&15!==r&&16!==r)&&20!==r}))):n=d()(n).call(n,(e=>20!=(e[1]>>>3&31)))}const i=s()(n).call(n,((e,t)=>e+C+1+t.length),0),l=(0,A.sY)(i),o=(0,m.s3)(l,i);return M.S9(n,C,o),{bufferPointer:l,length:i,extradata:r,key:a}}function D(e,t,r,a,n){const i=[M.Le(e,0),M.Le(t,0),M.Le(r,0),M.Le(a,2)];let l=s()(i).call(i,((e,t)=>e+t),0);const c=(0,A.sY)(l+7);let o=c;return L.w8((o+=1,o-1),0),L.w8((o+=1,o-1),0),L.w8((o+=1,o-1),0),L.w8((o+=1,o-1),1),L.w8((o+=1,o-1),0),L.w8((o+=1,o-1),161),L.w8((o+=1,o-1),(n?1:0)<<7|40),e.length&&(M.nW(e,0,(0,m.s3)(o,i[0])),o+=i[0]),t.length&&(M.nW(t,0,(0,m.s3)(o,i[1])),o+=i[1]),r.length&&(M.nW(r,0,(0,m.s3)(o,i[2])),o+=i[2]),a.length&&M.nW(a,2,(0,m.s3)(o,i[3])),{bufferPointer:c,length:l+7}}function W(e,t){var r;let a=u()(r=M.py(e)).call(r,M.py(t));if(a.length){let e=[],t=[],r=[],n=[];return c()(a).call(a,(a=>{const i=a[1]>>>3&31;14===i?e.push(a):15===i?t.push(a):16===i?r.push(a):20!==i&&n.push(a)})),D(e,t,r,n,!0)}}function T(e,t,r=C){var a;t&&(r=t[0]>>>1&3);let n=[],i=[],s=[],l=!1;if(t){const e=P(t);n=e.vpss,i=e.spss,s=e.ppss,l=!0}const o=d()(a=M.wN(e,r)).call(a,(e=>20!=(e[1]>>>3&31))),h=[];return c()(o).call(o,(e=>{const t=e[1]>>>3&31;15!==t||i.length?16!==t||s.length?20!==t&&h.push(e):s.push(e):i.push(e),8!==t&&7!==t||(l=!0)})),{...D(n,i,s,h,l),key:l}}function V(e,t){let r;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&M.Bs(t))b.__(M.py(t),(e=>{if(15==(e[1]>>>3&31))return r=e,!1}));else if(t&&t.length>=6){const{spss:e}=P(t);e.length&&(r=e[0])}r&&function(e,t){const{profile:r,level:a,width:n,height:i,videoDelay:s,chromaFormatIdc:l,bitDepthMinus8:c}=R(t);switch(e.codecpar.profile=r,e.codecpar.level=a,e.codecpar.width=n,e.codecpar.height=i,e.codecpar.videoDelay=s,c){case 0:e.codecpar.format=3===l?5:2===l?4:0;break;case 2:e.codecpar.format=3===l?68:2===l?64:62}}(e,r)}function N(e,t=4){if(64&w.f[15](e+36)){let t=M.py((0,m.s3)(w.f[20](e+24),w.f[15](e+28)));return p()(t).call(t,(e=>{const t=e[1]>>>3&31;return 8===t||7===t}))}{const r=w.f[15](e+28);let a=0;for(;a<r-t;){const r=I.r8(w.f[20](e+24)+(a+t+1))>>>3&31;if(8===r||7===r)return!0;a+=4===t?I.Sg(w.f[20](e+24)+a):3===t?I.ht(w.f[20](e+24)+a):2===t?I.yd(w.f[20](e+24)+a):I.r8(w.f[20](e+24)+a),a+=t}return!1}}function R(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let r=0,a=0,n=0,i=0,s=0,l=1,c=0,o=0,d=0;const h=[],u=[],f=[],p=[],U=M.BN(e.subarray(t)),w=new v.A(U.length);w.appendBuffer(U),w.readU1(),w.readU1(),w.readU(6),w.readU(5),w.readU(3),w.readU(8);const b=w.readU(3);l=w.readU(2);const y=w.readU(2);if(w.readU(1)){if(r=w.readU(7),c=w.readU(1),a=w.readU(8),o=w.readU(1),d=w.readU(1),w.readU(1)){for(let e=0;e<8;e++)h[e]=w.readU(8);h[8]=w.readU(7);const e=w.readU(8);w.readU(e)}w.skipPadding();for(let e=b-1;e>=0;e--)u[e]=w.readU(1);w.skipPadding();for(let e=b-1;e>=0;e--)u[e]&&(f[e]=w.readU(8));const e=w.readU(8);if(e)for(let t=0;t<e;t++)p[t]=w.readU(32)}w.readU1(),w.readU1()&&w.readU1();const x=n=S.xb(w),m=i=S.xb(w);if(w.readU1()&&(S.xb(w),S.xb(w),S.xb(w),S.xb(w)),w.readU1()){const e=S.xb(w),t=y+5,r=1<<t,a=x/(1<<t),n=m/(1<<t),i=Math.ceil(g()(a)),s=Math.ceil(g()(n));let l=0,c=0,o=0;e>0&&(o=w.readU1(),c=w.readU1());for(let t=0;e>0&&t<=e;t++)c&&0!=t||(t>0&&x>r&&w.readU(i),t>0&&m>r&&w.readU(s),t<e&&x>r&&w.readU(i),t<e&&m>r&&w.readU(s)),o||w.readU(2);if(l=S.xb(w)+1,w.readU(1)&&w.readU(1))for(let t=0;t<=e;t++)w.readU(l)}s=S.xb(w),w.readU(1),w.readU(1);const A=w.readU(4),_=w.readU(1);let I=0;_&&(I=S.xb(w));const L=[],C=w.readU(2);for(let e=0;e<8*C;e++)L[e]=w.readU(1);return{profile:r,level:a,width:n,height:i,videoDelay:b+1>2?2:b,chromaFormatIdc:l,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:c,generalConstraintInfo:h,generalSubProfileIdc:p,ptlFrameOnlyConstraintFlag:o,ptlMultilayerEnabledFlag:d,spsMaxSublayersMinus1:b,ptlSublayerLevelPresentFlag:u,sublayerLevelIdc:f,sps_log2_max_pic_order_cnt_lsb_minus4:A,sps_poc_msb_cycle_flag:_,sps_poc_msb_cycle_len_minus1:I,sps_num_extra_ph_bytes:C,sps_extra_ph_bit_present_flag:L}}function Y(e){M.Bs(e)&&(e=k(e));const t=new v.A;return t.appendBuffer(e),1&t.readU(8)?F(t):{}}},52730:(e,t,r)=>{e.exports=r(64055)},60974:(e,t,r)=>{"use strict";var a=r(88280),n=r(48804),i=RegExp.prototype;e.exports=function(e){return e===i||a(i,e)?n(e):e.flags}},48804:(e,t,r)=>{"use strict";r(9164);var a=r(40663);e.exports=a},9164:()=>{},64055:(e,t,r)=>{"use strict";var a=r(60974);e.exports=a}}]);