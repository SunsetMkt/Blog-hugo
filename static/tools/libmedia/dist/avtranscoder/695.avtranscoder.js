(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[695],{64436:(t,e,r)=>{"use strict";r.d(e,{A:()=>c});var i=r(49859),n=r(63939),s=(r(77162),r(37837)),a=r(71766);class c{constructor(){(0,i.A)(this,"inCodecpar",void 0),(0,i.A)(this,"inTimeBase",void 0),(0,i.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,s.Gy)(168),(0,a.Yi)(this.inCodecpar,t),this.inTimeBase={den:n.f[15](e+4),num:n.f[15](e)},0}destroy(){this.inCodecpar&&((0,a.dn)(this.inCodecpar),this.inCodecpar=0)}}},26173:(t,e,r)=>{"use strict";r.d(e,{A:()=>h});var i=r(49859),n=r(63939),s=r(50932),a=r(64436),c=r(71517),o=r(62815),d=r(67659),l=r(59166),p=r(14686),u=r(9705),f=r(37837),m=r(4624);class h extends a.A{constructor(t=!1){super(),(0,i.A)(this,"cache",void 0),(0,i.A)(this,"cached",void 0),(0,i.A)(this,"reverseSps",void 0),this.reverseSps=t}init(t,e){return super.init(t,e),this.cache=(0,c._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,c.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(64&n.f[15](t+36)){let e;(0,c.zu)(this.cache,t);const r=(0,p.JW)(n.f[20](t+24),n.f[15](t+28));if(27===n.f[15](this.inCodecpar+4)?e=o.oT(r,this.reverseSps):173===n.f[15](this.inCodecpar+4)?e=d.oT(r,this.reverseSps):196===n.f[15](this.inCodecpar+4)?e=l.oT(r,this.reverseSps):m.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Annexb2AvccFilter.ts",97),s.M[15](this.cache+36,-65&n.f[15](this.cache+36)),(0,c.NX)(this.cache,e.bufferPointer,e.length),e.key&&s.M[15](this.cache+36,1|n.f[15](this.cache+36)),e.extradata){const t=(0,f.sY)(e.extradata.length);(0,p.lW)(t,e.extradata.length,e.extradata),(0,c.Ow)(this.cache,1,t,e.extradata.length)}}else(0,c.rN)(this.cache,t);return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,c.Up)(t),(0,c.rN)(t,this.cache),this.cached=!1,0):u.LR}reset(){return 0}}},51597:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(49859);class n{constructor(){(0,i.A)(this,"type",-1)}async destroy(t){}}(0,i.A)(n,"Capabilities",[])},92695:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>L});var i=r(49859),n=r(86226),s=r.n(n),a=r(71426),c=r.n(a),o=r(18979),d=r.n(o),l=r(48079),p=r.n(l),u=r(61499),f=r(63939),m=(r(9599),r(51597)),h=r(49922),w=r(65977),g=r(64061),U=r(16978),y=r(93194),I=r(35336),b=r(72739),S=r(4624),v=r(92647),x=r(52150),A=r(77231),k=r(95335),D=r(20841),P=r(59989),B=r(44328),C=r(71517),z=r(26173),M=r(67672),F=r(43607),_=r(87518),T=r(14686),N=r(331),W=r(50315);const O="src/avformat/formats/OIsobmffFormat.ts",R={fragmentMode:0,mp4Mode:0,fragment:!1,fastOpen:!1,defaultBaseIsMoof:!1,reverseSpsInAvcc:!1,ignoreEncryption:!1,minFragmentLength:5e3,minFragmentIndexLength:5e3,hasTfra:!0,useMetadataTags:!1};class L extends m.A{constructor(t={}){super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"annexb2AvccFilter",void 0),(0,i.A)(this,"avpacket",void 0),this.options=k.X$({},R,t),this.context=(0,h.A)()}init(t){var e;return t.ioWriter.setEndian(!0),s()(e=t.streams).call(e,(t=>{this.annexb2AvccFilter||27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||(this.annexb2AvccFilter=new z.A(this.options.reverseSpsInAvcc),this.annexb2AvccFilter.init(t.codecpar[u.o9],t.timeBase[u.o9]))})),this.avpacket=(0,C._5)(),this.context.metadata=t.metadata,this.context.chapters=t.chapters,0}async destroy(t){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null),this.avpacket&&((0,C.Qe)(this.avpacket),this.avpacket=0)}enableStreams(t){const e=[],r=[];for(let t=0;t<5;t++)e[t]=0,r[t]=-1;b.__(t.streams,((t,i)=>{if(-1===t.codecpar.codecType||t.codecpar.codecType>=5||1024&t.disposition)return!0;r[t.codecpar.codecType]<0&&(r[t.codecpar.codecType]=i),1&t.disposition&&(e[t.codecpar.codecType]++,t.privData.flags|=1)}));for(let i=0;i<5;i++)switch(i){case 0:case 1:case 3:e[i]>1&&(t.streams[e[i]].privData.perStreamGrouping=!0),!e[i]&&r[i]>=0&&(t.streams[r[i]].privData.flags|=1)}}writeHeader(t){var e;this.context.majorBrand=(0,w.A)("isom"),this.context.minorVersion=512,this.context.compatibleBrand=[(0,w.A)("isom")],this.context.timescale=1e3,this.context.ignoreEncryption=this.options.ignoreEncryption,this.context.useMetadataTags=this.options.useMetadataTags;const r=c()(e=t.streams).call(e,(t=>1024&t.disposition&&(7===t.codecpar.codecId||61===t.codecpar.codecId||78===t.codecpar.codecId)));if(r&&r.attachedPic&&(this.context.covr={type:27,data:(0,C.iI)(r.attachedPic)},61===r.codecpar.codecId?this.context.covr.type=14:7===r.codecpar.codecId&&(this.context.covr.type=13)),this.options.fragment&&(this.context.compatibleBrand.push((0,w.A)("iso6")),this.context.fragment=!0),1===this.options.mp4Mode&&(this.context.isom=!0,this.context.majorBrand=(0,w.A)("qt  "),this.context.compatibleBrand=[this.context.majorBrand]),1!==this.options.mp4Mode){this.context.compatibleBrand.push((0,w.A)("iso2"));const e=t.getStreamByMediaType(0);e&&27===e.codecpar.codecId&&this.context.compatibleBrand.push((0,w.A)("avc1")),this.context.compatibleBrand.push((0,w.A)("mp41"))}if(g.l7(t.ioWriter,this.context),this.context.holdMoovPos=t.ioWriter.getPos(),this.options.fragment)this.context.currentFragment={pos:BigInt(0),currentTrack:null,sequence:1,tracks:[],size:0,firstWrote:!1},b.__(t.streams,((t,e)=>{const r=(0,U.A)();if(t.privData=r,r.chunkOffsets=[],r.cttsSampleCounts=[],r.cttsSampleOffsets=[],r.stscFirstChunk=[],r.stscSamplesPerChunk=[],r.stscSampleDescriptionIndex=[],r.stssSampleNumbers=[],r.sampleSizes=[],r.sttsSampleCounts=[],r.sttsSampleDeltas=[],r.alternateGroup=e,!(1024&t.disposition)){const e=(0,y.A)();e.baseIsMoof=this.options.defaultBaseIsMoof,e.streamIndex=t.index,e.trackId=this.context.nextTrackId++,r.trackId=e.trackId;const i=this.options.encryption||t.metadata.encryption;if(i){const t=this.context.cencs||{};t[e.trackId]={schemeType:i.schemeType,schemeVersion:i.schemeVersion,cryptByteBlock:i.cryptByteBlock,skipByteBlock:i.skipByteBlock,defaultConstantIV:i.constantIV,isProtected:1,defaultPerSampleIVSize:i.perSampleIVSize,defaultKeyId:i.kid,pattern:!!i.pattern},this.context.cencs=t}e.ioWriter=new I.A,e.ioWriter.onFlush=t=>(e.buffers.push(d()(t).call(t)),0),this.context.currentFragment.tracks.push(e)}})),this.enableStreams(t),g.dI(t.ioWriter,t,this.context),t.ioWriter.flush();else{b.__(t.streams,((t,e)=>{const r=(0,U.A)();t.privData=r,r.trackId=this.context.nextTrackId++,r.chunkOffsets=[],r.cttsSampleCounts=[],r.cttsSampleOffsets=[],r.stscFirstChunk=[],r.stscSamplesPerChunk=[],r.stscSampleDescriptionIndex=[],r.stssSampleNumbers=[],r.sampleSizes=[],r.sttsSampleCounts=[],r.sttsSampleDeltas=[],r.alternateGroup=e})),this.enableStreams(t);const e=t.ioWriter.getPos();t.ioWriter.writeUint32(0),t.ioWriter.writeUint32((0,w.A)("mdat")),this.context.boxsPositionInfo.push({pos:e,type:"mdat",size:0})}return t.getStreamByMediaType(0)||(this.context.audioOnly=!0),0}updateCurrentChunk(t){var e;let r=this.context.currentChunk;if(!r||!r.sampleCount)return;const i=c()(e=t.streams).call(e,(t=>t.index===r.streamIndex)).privData;i.chunkCount++,i.chunkOffsets.push(r.pos),i.stscFirstChunk.length?i.lastStscCount!==r.sampleCount&&(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(r.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=r.sampleCount):(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(r.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=r.sampleCount)}updateCurrentFragment(t,e){if(this.context.currentFragment.firstWrote){b.__(this.context.currentFragment.tracks,(r=>{var i;const n=c()(i=t.streams).call(i,(t=>t.index===r.streamIndex));if(!r.sampleCount||!n)return!0;const s=n.privData;var a,o;r.baseDataOffset=t.ioWriter.getPos(),this.context.currentFragment.pos=t.ioWriter.getPos(),r.sampleDurations.length?e&&r.sampleDurations.length===r.sampleSizes.length-1&&r.sampleDurations.push(Number(e-s.lastDts)):1===n.codecpar.codecType?e?r.sampleDurations.push(Number(e-s.lastDts)):n.codecpar.frameSize>0?r.sampleDurations.push(Number((0,B.k)(BigInt(Math.floor(n.codecpar.frameSize/n.codecpar.sampleRate*A.SF)),A.KR,n.timeBase))):(n.codecpar.codecId,r.sampleDurations.push(Number((0,B.k)(BigInt(Math.floor(1024/n.codecpar.sampleRate*A.SF)),A.KR,n.timeBase)))):0===n.codecpar.codecType?e?r.sampleDurations.push(Number(e-s.lastDts)):(0,B.lb)(n.codecpar.framerate)>0?r.sampleDurations.push(Number((0,B.k)(BigInt(Math.floor(1/(0,B.lb)(n.codecpar.framerate)*A.SF)),A.KR,n.timeBase))):r.sampleDurations.push(n.timeBase.den/(30*n.timeBase.num)>>>0):r.sampleDurations.push(0),s.lastDuration=r.sampleDurations[r.sampleSizes.length-1],(1===r.sampleFlags.length||(0,P.A)(r.sampleFlags,1))&&(r.firstSampleFlags=r.sampleFlags[0],r.defaultSampleFlags=null!==(a=r.sampleFlags[1])&&void 0!==a?a:r.firstSampleFlags,r.sampleFlags=[]),(1===r.sampleSizes.length||(0,P.A)(r.sampleSizes))&&(r.defaultSampleSize=r.sampleSizes[0],r.sampleSizes=[]),(1===r.sampleDurations.length||(0,P.A)(r.sampleDurations))&&(r.defaultSampleDuration=r.sampleDurations[0],r.sampleDurations=[]),r.cenc&&(1===r.cenc.sampleSizes.length||(0,P.A)(r.cenc.sampleSizes))&&(r.cenc.defaultSampleInfoSize=r.cenc.sampleSizes[0],r.cenc.sampleSizes=[]),1===n.codecpar.codecType?r.defaultSampleFlags=33554432:r.sampleFlags.length&&(r.defaultSampleFlags=r.sampleFlags[0]),r.sampleSizes.length&&(r.defaultSampleSize=r.sampleSizes[0]),r.sampleDurations.length&&(r.defaultSampleDuration=r.sampleDurations[0]),this.options.hasTfra&&(!s.fragIndexes.length||0===this.options.fragmentMode||(0,B.k)(r.baseDataOffset-r.lastFragIndexDts,n.timeBase,A.i0)>=this.options.minFragmentIndexLength)&&(s.fragIndexes.push({pos:r.baseDataOffset,time:r.baseMediaDecodeTime+BigInt(Math.floor(null!==(o=r.sampleCompositionTimeOffset[0])&&void 0!==o?o:0))}),r.lastFragIndexDts=s.lastDts)})),t.ioWriter.flush(),this.options.onFragmentStart&&this.options.onFragmentStart(),g.Ro(t.ioWriter,t,this.context);let r=this.context.currentFragment.size+8;const i=[];let n=8;b.__(this.context.currentFragment.tracks,(e=>{if(!e.sampleCount)return!0;e.ioWriter.flush();const s=(0,v.A)(Uint8Array,e.buffers);e.dataOffset=r,r+=s.length,n+=s.length,i.push(s),(0,D.A)(t.ioWriter,e.dataOffsetPos,e.dataOffset,"int32"),e.cenc&&e.cenc.offsetPos&&(0,D.A)(t.ioWriter,e.cenc.offsetPos,e.cenc.offset,"int32"),e.buffers=[],e.sampleFlags=[],e.sampleSizes=[],e.sampleDurations=[],e.sampleCompositionTimeOffset=[],e.sampleCount=0,e.firstSampleFlags=0,e.cenc=null})),t.ioWriter.writeUint32(n),t.ioWriter.writeUint32((0,w.A)("mdat")),b.__(i,(e=>{t.ioWriter.writeBuffer(e)})),(0,x.A)(t.ioWriter,this.context),t.ioWriter.flush(),this.context.currentFragment.firstWrote=!1,this.context.currentFragment.sequence++}}handleEAC3(t,e){this.context.ac3Info||(this.context.ac3Info={done:!1,numBlocks:0,dataRate:0,ac3BitrateCode:-1,numIndSub:0,substream:[]});const r=this.context.ac3Info,i=_.R((0,T.s3)(f.f[20](t+24),f.f[15](t+28)));if(M.ai(i))r.done=!0;else if(r.dataRate=Math.max(r.dataRate,i.bitrate/1e3),r.ac3BitrateCode=Math.max(r.ac3BitrateCode,i.ac3BitrateCode),!r.done){if(i.bitstreamId<=10&&0!=i.substreamId)return;if(0===i.frameType||2==i.frameType){var n;if(i.substreamId>r.numIndSub+1)return;if(i.substreamId==r.numIndSub+1)return;if(i.substreamId<r.numIndSub||0==i.substreamId&&null!==(n=r.substream[0])&&void 0!==n&&n.bsid)return void(r.done=!0)}else if(0!=i.substreamId)return;if(r.substream[i.substreamId]||(r.substream[i.substreamId]={fscod:0,bsid:0,bsmod:0,acmod:0,lfeon:0,numDepSub:0,chanLoc:0}),r.substream[i.substreamId].fscod=i.srCode,r.substream[i.substreamId].bsid=i.bitstreamId,r.substream[i.substreamId].bsmod=i.bitstreamMode,r.substream[i.substreamId].acmod=i.channelMode,r.substream[i.substreamId].lfeon=i.lfeOn,86019===e.codecpar.codecId)return void(r.done=!0)}}writeTrackData(t,e,r,i){if(94226===i.codecpar.codecId){const s=i.privData;if(s.lastDuration>0){const a=s.lastDts+BigInt(Math.floor(s.lastDuration));if(a<r&&(0,B.k)(r-a,i.timeBase,A.i0)>200){t.writeUint32(8),t.writeString("vtte");const i=Number(r-a);if(this.context.fragment){var n;const t=c()(n=this.context.currentFragment.tracks).call(n,(t=>t.streamIndex===f.f[15](e+32)));t.sampleCount++,t.sampleSizes.length||(t.baseMediaDecodeTime=a),t.sampleDurations.push(i),t.sampleSizes.push(8)}else{const t=Number(a-s.lastDts);this.context.currentChunk.sampleCount++,s.sampleSizes.push(8),s.sttsSampleDeltas[s.sttsSampleDeltas.length-1]===t?s.sttsSampleCounts[s.sttsSampleCounts.length-1]++:(s.sttsSampleCounts.push(1),s.sttsSampleDeltas.push(t))}s.lastPts=a,s.lastDts=a,s.lastDuration=i}}const a=(0,C.rU)(e,16),o=(0,C.rU)(e,17);let d=f.f[15](e+28)+8;return a&&(d+=8+(0|f.f[25](a+4))),o&&(d+=8+(0|f.f[25](o+4))),t.writeUint32(8+d),t.writeString("vttc"),a&&(t.writeUint32(8+f.f[25](a+4)),t.writeString("iden"),t.writeBuffer((0,T.s3)(f.f[20](a),f.f[25](a+4)))),o&&(t.writeUint32(8+f.f[25](o+4)),t.writeString("sttg"),t.writeBuffer((0,T.s3)(f.f[20](o),f.f[25](o+4)))),t.writeUint32(8+f.f[15](e+28)),t.writeString("payl"),t.writeBuffer((0,C.iI)(e)),8+d}return t.writeBuffer((0,C.iI)(e)),f.f[15](e+28)}writeAVPacket(t,e){if(!f.f[15](e+28))return S.R8(`packet's size is 0: ${f.f[15](e+32)}, ignore it`,O,755),0;const r=t.getStreamByIndex(f.f[15](e+32));if(!r||1024&r.disposition)return void S.R8(`can not found the stream width the avpacket's streamIndex: ${f.f[15](e+32)}, ignore it`,O,762);const i=r.privData;let n=(0,B.Mr)(f.f[17](e+16),e+72,r.timeBase),s=(0,B.Mr)(f.f[17](e+8)!==A.Dh?f.f[17](e+8):f.f[17](e+16),e+72,r.timeBase);const a=f.f[17](e+48)!==A.Dh?(0,B.Mr)(f.f[17](e+48),e+72,r.timeBase):A.Dh;if((27===r.codecpar.codecId||173===r.codecpar.codecId||196===r.codecpar.codecId)&&64&f.f[15](e+36)?(this.annexb2AvccFilter.sendAVPacket(e),this.annexb2AvccFilter.receiveAVPacket(this.avpacket),e=this.avpacket):86019!==r.codecpar.codecId&&86056!==r.codecpar.codecId||this.context.ac3Info&&this.context.ac3Info.done||this.handleEAC3(e,r),this.context.fragment){var o;const l=c()(o=this.context.currentFragment.tracks).call(o,(t=>t.streamIndex===f.f[15](e+32)));if(l){l.tfdtDelay===A.Dh&&(l.tfdtDelay=n<0?-n:BigInt(0),s<0&&(l.trunPtsDelay=l.tfdtDelay)),n+=l.tfdtDelay,s+=l.trunPtsDelay,(0===this.options.fragmentMode&&(0===r.codecpar.codecType&&1&f.f[15](e+36)||this.context.audioOnly&&(0,B.k)(n-l.baseMediaDecodeTime,r.timeBase,A.i0)>=this.options.minFragmentLength)||1===this.options.fragmentMode)&&(1===this.context.currentFragment.tracks.length?this.updateCurrentFragment(t,n):this.updateCurrentFragment(t));const c=this.writeTrackData(l.ioWriter,e,n,r);if(l.sampleSizes.length||(l.baseMediaDecodeTime=n),l.sampleSizes.length&&(!l.sampleDurations[l.sampleSizes.length-1]||l.sampleDurations[l.sampleSizes.length-1]<=0)&&(l.sampleDurations[l.sampleSizes.length-1]=Number(n-i.lastDts)),a>0&&l.sampleDurations.push(Number(a)),l.sampleSizes.push(c),0===r.codecpar.codecType){let t=0;1&f.f[15](e+36)?t|=33554432:t|=16842752,l.sampleCompositionTimeOffset.push(Number((s!==A.Dh?s:n)-n)),l.sampleFlags.push(t)}const o=(0,C.Un)(e+40,e+44,25),u=this.context.cencs&&this.context.cencs[i.trackId];if(o&&u){const t=(0,W.p$)((0,T.s3)(f.f[20](o),f.f[25](o+4)));var d;if(l.cenc||(l.cenc={sampleCount:0,defaultSampleInfoSize:0,sampleSizes:[],offset:0,useSubsamples:!1,sampleInfoOffset:[],sampleEncryption:[]}),t.subsamples.length)!l.cenc.useSubsamples&&l.cenc.sampleSizes.length&&(l.cenc.sampleSizes=p()(d=l.cenc.sampleSizes).call(d,(t=>t+2))),l.cenc.useSubsamples=!0;l.cenc.sampleCount++,l.cenc.sampleSizes.push(u.defaultPerSampleIVSize+(l.cenc.useSubsamples?2+6*t.subsamples.length:0)),l.cenc.sampleEncryption.push({iv:t.iv,subsamples:t.subsamples})}l.sampleCount++,i.lastPts=F.T9(i.lastPts,s+(a!==A.Dh?a:BigInt(0))),i.lastDts=n,a>0&&(i.lastDuration=Number(a)),this.context.currentFragment.firstWrote=!0}else S.R8(`can not found track width streamIndex ${f.f[15](e+32)}, ignore it`,O,900)}else{const c=t.ioWriter.getPos();let o=this.context.currentChunk;if(o?o.streamIndex!==f.f[15](e+32)?(this.updateCurrentChunk(t),o.streamIndex=f.f[15](e+32),o.sampleCount=1,o.pos=c):o.sampleCount++:o=this.context.currentChunk={pos:c,streamIndex:f.f[15](e+32),sampleCount:1},i.sampleSizes.push(this.writeTrackData(t.ioWriter,e,n,r)),0===r.codecpar.codecType&&1&f.f[15](e+36)&&i.stssSampleNumbers.push(i.sampleSizes.length),i.firstWrote){const t=Number(n-i.lastDts);i.sttsSampleDeltas[i.sttsSampleDeltas.length-1]===t?i.sttsSampleCounts[i.sttsSampleCounts.length-1]++:(i.sttsSampleCounts.push(1),i.sttsSampleDeltas.push(t))}else i.startDts=n,i.startCT=Number((s!==A.Dh?s:n)-n),i.firstWrote=!0;if(s>=0&&(i.startPts===A.Dh?i.startPts=s:i.startPts=F.jk(i.startPts,s)),0===r.codecpar.codecType){const t=Number((s!==A.Dh?s:n)-n);i.cttsSampleCounts.length&&i.cttsSampleOffsets[i.cttsSampleOffsets.length-1]===t?i.cttsSampleCounts[i.cttsSampleCounts.length-1]++:(i.cttsSampleCounts.push(1),i.cttsSampleOffsets.push(t))}i.lastPts=F.T9(i.lastPts,s+(a!==A.Dh?a:BigInt(0))),i.lastDts=n,i.lastDuration=Number(a)}return 0}writeTrailer(t){if(this.context.fragment)b.__(this.context.currentFragment.tracks,(e=>{var r;const i=c()(r=t.streams).call(r,(t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t),this.options.hasTfra?g.yT(t.ioWriter,t,this.context):(t.ioWriter.writeUint32(8),t.ioWriter.writeString("mfra")),t.ioWriter.flush();else{this.updateCurrentChunk(t);let e=BigInt(0);b.__(t.streams,(t=>{if(1024&t.disposition)return!0;const r=t.privData;r.sampleSizes.length&&(r.sttsSampleDeltas.length?r.lastDuration>0&&r.lastDuration!==r.sttsSampleDeltas[r.sttsSampleDeltas.length-1]?(r.sttsSampleCounts.push(1),r.sttsSampleDeltas.push(r.lastDuration)):r.sttsSampleCounts[r.sttsSampleCounts.length-1]++:(r.sttsSampleCounts=[1],r.sttsSampleDeltas=[0]));const i=(0,B.k)((0,N.A)(r),t.timeBase,{den:1e3,num:1});i>e&&(e=i)})),this.context.duration=e;const r=this.context.boxsPositionInfo[this.context.boxsPositionInfo.length-1];if("mdat"!==r.type&&S.z3("last box is not mdat",O,1027),r.size=Number(t.ioWriter.getPos()-r.pos),r.size>A.f7){const e=t.ioWriter.getPos();t.ioWriter.seek(r.pos-BigInt(8)),t.ioWriter.writeUint32(1),t.ioWriter.writeUint32((0,w.A)("mdat")),t.ioWriter.writeUint64(BigInt(r.size)+BigInt(8)),t.ioWriter.seek(e),this.context.boxsPositionInfo.pop(),this.context.use64Mdat=!0}if((0,x.A)(t.ioWriter,this.context),this.options.fastOpen){t.ioWriter.flush();let e=[];const r=t.ioWriter.onFlush;t.ioWriter.onFlush=t=>(e.push(d()(t).call(t)),0),g.dI(t.ioWriter,t,this.context),t.ioWriter.flush();let i=(0,v.A)(Uint8Array,e);b.__(t.streams,(t=>{const e=t.privData;if(e.chunkOffsets.length)for(let t=0;t<e.chunkOffsets.length;t++)e.chunkOffsets[t]+=BigInt(Math.floor(i.length))})),e=[],g.dI(t.ioWriter,t,this.context),t.ioWriter.flush(),i=(0,v.A)(Uint8Array,e),r&&r(i,this.context.holdMoovPos),t.ioWriter.onFlush=r}else g.dI(t.ioWriter,t,this.context),t.ioWriter.flush()}return 0}flush(t){return this.options.fragment&&(b.__(this.context.currentFragment.tracks,(e=>{var r;const i=c()(r=t.streams).call(r,(t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t)),t.ioWriter.flush(),0}getCapabilities(){return L.Capabilities}}(0,i.A)(L,"Capabilities",[86021,86076,86018,86017,86028,86051,86019,86056,167,225,27,173,196,12,94226,94213])},91153:(t,e,r)=>{"use strict";r.d(e,{_l:()=>i,gQ:()=>n});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],n=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco","encv","enca","sinf","schi","udta","iprp"]},93194:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(77231);function n(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,remainDataOffsets:[],remainDataOffsetIndex:[],dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[],lastFragIndexDts:BigInt(0),tfdtDelay:i.Dh,trunPtsDelay:BigInt(0)}}},49922:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(77231);function n(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,foundHEIF:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},16978:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(77231);function n(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],samplesEncryption:[],fragIndexes:[],lastPts:i.Dh,lastDts:i.Dh,startDts:i.Dh,startCT:i.N_,startPts:i.Dh,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},331:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(77231);function n(t){return t.startPts!==i.Dh?t.lastPts-t.startPts:t.startDts===i.Dh?t.lastPts:t.lastPts-(t.startDts+BigInt(0|t.startCT))}},52150:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(72739);function n(t,e){const r=t.getPos(),n=t.getPointer(),s=r-BigInt(Math.floor(n)),a=[];i.__(e.boxsPositionInfo,(e=>{e.pos<r&&e.pos>=s?(t.seekInline(n+Number(e.pos-r)),t.writeUint32(e.size)):a.push(e)})),t.seekInline(n),a.length&&(i.__(a,(e=>{t.seek(e.pos),t.writeUint32(e.size)})),t.seek(r)),e.boxsPositionInfo=[]}},96108:(t,e,r)=>{"use strict";r.d(e,{c:()=>i});const i={"@PRM":"premiere_version","@PRQ":"quicktime_version",XMP_:"xmp",aART:"albumArtist",akID:"account_type",apID:"account_id",catg:"category",cpil:"compilation",cprt:"copyright",desc:"description",disk:"disc",egid:"episode_uid",FIRM:"firmware",gnre:"genre",hdvd:"hd_video",HMMT:"hmmt",keyw:"keywords",ldes:"synopsis",loci:"loci",manu:"make",modl:"model",pcst:"podcast",pgap:"gapless_playback",purd:"purchase_date",rtng:"rating",soaa:"albumArtistSort",soal:"albumSort",soar:"artistSort",soco:"composerSort",sonm:"nameSort",sosn:"showSort",stik:"media_type",trkn:"track",tven:"episode_id",tves:"episode_sort",tvnn:"network",tvsh:"show",tvsn:"season_number","©ART":"albumArtist","©PRD":"producer","©alb":"album","©aut":"artist","©chp":"chapter","©cmt":"comment","©com":"composer","©cpy":"copyright","©day":"date","©dir":"director","©dis":"disclaimer","©ed1":"edit_date","©enc":"encoder","©fmt":"original_format","©gen":"genre","©grp":"grouping","©hst":"host_computer","©inf":"comment","©lyr":"lyrics","©mak":"make","©mod":"mod","©nam":"title","©ope":"original_artist","©prd":"producer","©prf":"performer","©req":"playback_requirements","©src":"original_source","©st3":"subtitle","©swr":"encoder","©too":"encoder","©trk":"track","©url":"url","©wrn":"warning","©wrt":"composer","©xyz":"location"}},54916:(t,e,r)=>{"use strict";r.d(e,{Q9:()=>s,f3:()=>a,uf:()=>c,zs:()=>n});var i=r(65977);const n={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},s={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},a={vide:0,pict:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},c={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("avc3")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213,[(0,i.A)("png ")]:61,[(0,i.A)("MNG ")]:61,[(0,i.A)("gif ")]:97,[(0,i.A)("tiff")]:96,[(0,i.A)("H263")]:4,[(0,i.A)("3IVD")]:16}},74244:(t,e,r)=>{"use strict";r.d(e,{BB:()=>a,Ip:()=>c,Jl:()=>s});var i=r(52730),n=r.n(i);const s={1:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},0:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},3:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:94232===e.codecpar.codecId?"sthd":"nmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]}},a={1:function(t,e){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]},0:function(t,e){let r=!0;if(27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId){const t=e.privData;2&n()(e.codecpar)&&(!t.cttsSampleCounts||!t.cttsSampleCounts.length||1===t.cttsSampleCounts.length&&0===t.cttsSampleOffsets[0])&&(r=!1)}return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stss"},r?{type:"ctts"}:null,{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]},3:function(t,e){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:94232===e.codecpar.codecId?"sthd":"nmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]}},c=function(t){return[{type:"tfhd"},{type:"tfdt"},{type:"trun"},t.cenc&&(t.cenc.defaultSampleInfoSize||t.cenc.sampleSizes.length)?{type:"saiz"}:null,t.cenc&&(t.cenc.defaultSampleInfoSize||t.cenc.sampleSizes.length)?{type:"saio"}:null,t.cenc?{type:"senc"}:null]}},64061:(t,e,r)=>{"use strict";r.d(e,{Ro:()=>S,dI:()=>b,l7:()=>y,yT:()=>v});var i=r(86226),n=r.n(i),s=r(71426),a=r.n(s),c=r(61499),o=r(63939),d=r(65977),l=r(91153),p=r(72739),u=r(7543),f=r(74244),m=r(52150),h=r(71517),w=r(50315),g=r(14686),U=r(50011);function y(t,e){t.flush();const r=t.getPointer(),i=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("ftyp")),t.writeUint32(e.majorBrand||(0,d.A)("isom")),t.writeUint32(e.minorVersion||512),p.__(e.compatibleBrand,(e=>{t.writeUint32(e)})),function(t,e,r){const i=t.getPointer();t.seekInline(e),t.writeUint32(r),t.seekInline(i)}(t,r,Number(t.getPos()-i)),e.isom?(t.writeUint32(8),t.writeUint32((0,d.A)("wide"))):e.fragment||(t.writeUint32(8),t.writeUint32((0,d.A)("free")))}function I(t,e,r,i){p.__(e,(e=>{if(!e)return!0;if(u.A[e.type])u.A[e.type](t,r,i);else if(e.children){const n=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)(e.type)),I(t,e.children,r,i),i.boxsPositionInfo.push({pos:n,type:e.type,size:Number(t.getPos()-n)})}else!function(t,e){const r=p.zy(l._l,e);t.writeUint32(r?12:8),t.writeUint32((0,d.A)(e)),r&&t.writeUint32(0)}(t,e.type)}))}function b(t,e,r){var i;const s=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("moov")),u.A.mvhd(t,null,r),p.__(e.streams,(e=>{if(1024&e.disposition||1!==e.codecpar.codecType&&0!==e.codecpar.codecType&&3!==e.codecpar.codecType)return!0;const i=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("trak")),I(t,r.fragment?f.Jl[e.codecpar.codecType](r,e):f.BB[e.codecpar.codecType](r,e),e,r);const n=e.metadata.title;if(n){const e=U.encode(n);t.writeUint32(16+e.length),t.writeUint32((0,d.A)("udta")),t.writeUint32(8+e.length),t.writeUint32((0,d.A)("name")),t.writeBuffer(e)}r.boxsPositionInfo.push({pos:i,type:"trak",size:Number(t.getPos()-i)})}));let a=t.getPos();if(t.writeUint32(0),t.writeUint32((0,d.A)("udta")),u.A.meta(t,null,r),null!==(i=r.chapters)&&void 0!==i&&i.length&&u.A.chpl(t,null,r),r.boxsPositionInfo.push({pos:a,type:"udta",size:Number(t.getPos()-a)}),r.fragment){const i=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("mvex")),p.__(e.streams,(e=>{if(1024&e.disposition||1!==e.codecpar.codecType&&0!==e.codecpar.codecType&&3!==e.codecpar.codecType)return!0;u.A.trex(t,e,r)})),r.boxsPositionInfo.push({pos:i,type:"mvex",size:Number(t.getPos()-i)}),r.ignoreEncryption||function(t,e,r){const i=[];p.__(e.streams,(t=>{const e=(0,h.Un)(t.codecpar[c.o9]+20,t.codecpar[c.o9]+24,24);if(e){const t=(0,w.ZK)((0,g.s3)(o.f[20](e),o.f[25](e+4)));n()(t).call(t,(t=>{(function(t){if(!i.length)return!1;for(let e=0;e<i.length;e++){const r=i[e];if(!p.FB(r.systemId,t.systemId))return!1;if(!r.keyIds||!t.keyIds)return!1;if(r.keyIds.length!==t.keyIds.length)return!1;for(let e=0;e<r.keyIds.length;e++)if(!p.FB(r.keyIds[e],t.keyIds[e]))return!1;if(!p.FB(r.data,t.data))return!1}return!0})(t)||i.push(t)}))}})),i.length&&n()(i).call(i,(e=>{var i;const s=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("pssh")),t.writeUint8(1),t.writeUint24(0),t.writeBuffer(e.systemId),t.writeUint32(e.keyIds.length),n()(i=e.keyIds).call(i,(e=>{t.writeBuffer(e)})),t.writeUint32(e.data.length),t.writeBuffer(e.data),r.boxsPositionInfo.push({pos:s,type:"pssh",size:Number(t.getPos()-s)})}))}(t,e,r)}r.boxsPositionInfo.push({pos:s,type:"moov",size:Number(t.getPos()-s)}),(0,m.A)(t,r)}function S(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("moof")),u.A.mfhd(t,null,r),p.__(r.currentFragment.tracks,(i=>{var n;if(!i.sampleCount)return!0;const s=t.getPos();t.writeUint32(0),t.writeUint32((0,d.A)("traf"));const c=a()(n=e.streams).call(n,(t=>t.privData.trackId===i.trackId));I(t,(0,f.Ip)(i),c,r),r.boxsPositionInfo.push({pos:s,type:"traf",size:Number(t.getPos()-s)})}));const n=Number(t.getPos()-i);r.boxsPositionInfo.push({pos:i,type:"moof",size:n}),r.currentFragment.size=n}function v(t,e,r){let i=24;p.__(r.currentFragment.tracks,(t=>{var r;const n=a()(r=e.streams).call(r,(e=>e.index===t.streamIndex)).privData;n.fragIndexes.length&&(i+=24+19*n.fragIndexes.length)})),t.writeUint32(i),t.writeString("mfra"),p.__(r.currentFragment.tracks,(r=>{var i;const s=a()(i=e.streams).call(i,(t=>t.index===r.streamIndex)).privData;var c;s.fragIndexes.length&&(t.writeUint32(24+19*s.fragIndexes.length),t.writeString("tfra"),t.writeUint8(1),t.writeUint24(0),t.writeUint32(r.trackId),t.writeUint32(0),t.writeUint32(s.fragIndexes.length),n()(c=s.fragIndexes).call(c,(e=>{t.writeUint64(e.time),t.writeUint64(e.pos),t.writeUint8(1),t.writeUint8(1),t.writeUint8(1)})))})),t.writeUint32(16),t.writeString("mfro"),t.writeUint32(0),t.writeUint32(i)}},61368:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(14686);function n(t,e,r){var n;t.writeUint32(8+(null!==(n=e.codecpar.extradataSize)&&void 0!==n?n:0)),t.writeString("av1C"),r.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},17630:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(14686),n=r(60264),s=r(62815);function a(t,e,r){let a;r.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&n.Bs(a)&&(a=s.S1(a)),t.writeUint32(8+(a?a.length:0)),t.writeString("avcC"),a&&t.writeBuffer(a)}},90935:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(20),t.writeString("btrt"),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)}r.d(e,{A:()=>i})},62336:(t,e,r)=>{"use strict";r.d(e,{A:()=>l});var i=r(86226),n=r.n(i),s=r(18979),a=r.n(s),c=r(67672),o=r(44328),d=r(50011);function l(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("chpl"),t.writeUint32(16777216),t.writeUint32(0);const s=r.chapters;t.writeUint8(s.length),n()(s).call(s,(e=>{t.writeUint64((0,o.k)(e.start,e.timeBase,{num:1,den:1e7}));let r=e.metadata.title;if(r&&c.Yj(r)){let e=d.encode(r);e.length>255&&(e=a()(e).call(e,0,255)),t.writeUint8(e.length),t.writeBuffer(e)}else t.writeUint8(0)})),r.boxsPositionInfo.push({pos:i,type:"chpl",size:Number(t.getPos()-i)})}},78427:(t,e,r)=>{"use strict";function i(t,e,r){const i=e.privData.chunkOffsets||[];t.writeUint32(16+8*i.length),t.writeString("co64"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(i.length);for(let e=0;e<i.length;e++)t.writeUint64(i[e])}r.d(e,{A:()=>i})},55707:(t,e,r)=>{"use strict";function i(t,e,r){const i=e.sideData[28];if(i)t.writeUint32(12+i.length),t.writeString("colr"),t.writeString("prof"),t.writeBuffer(i);else{const r=2===e.codecpar.colorRange;t.writeUint32(19),t.writeString("colr"),t.writeString("nclx"),t.writeUint16(e.codecpar.colorPrimaries),t.writeUint16(e.codecpar.colorTrc),t.writeUint16(e.codecpar.colorSpace),t.writeUint8(r?128:0)}}r.d(e,{A:()=>i})},613:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(4624);const n="src/avformat/formats/isobmff/writing/ctts.ts";function s(t,e,r){const s=e.privData,a=s.cttsSampleCounts||[],c=s.cttsSampleOffsets||[];a.length!==c.length&&i.R8("ctts sampleCounts's length is not match sampleOffsets's length",n,39);const o=Math.min(a.length,c.length);t.writeUint32(16+8*o),t.writeString("ctts"),t.writeUint8(1),t.writeUint24(0),t.writeUint32(o);for(let e=0;e<o;e++)t.writeUint32(a[e]),t.writeInt32(c[e])}},98522:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(83314);function n(t,e,r){t.writeUint32(11),t.writeString("dac3");const n=new i.A(3),s=r.ac3Info;n.writeU(2,s.substream[0].fscod),n.writeU(5,s.substream[0].bsid),n.writeU(3,s.substream[0].bsmod),n.writeU(3,s.substream[0].acmod),n.writeU(1,s.substream[0].lfeon),n.writeU(5,s.ac3BitrateCode),n.writeU(5,0),t.writeBuffer(n.getBuffer())}},47038:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(83314);function n(t,e,r){const n=r.ac3Info,s=new i.A(2+(34*(n.numIndSub+1)+7>>3));s.writeU(13,n.dataRate),s.writeU(3,n.numIndSub);for(let t=0;t<n.numIndSub;t++)s.writeU(2,n.substream[t].fscod),s.writeU(5,n.substream[t].bsid),s.writeU(1,0),s.writeU(1,0),s.writeU(3,n.substream[t].bsmod),s.writeU(3,n.substream[t].acmod),s.writeU(1,n.substream[t].lfeon),s.writeU(5,0),s.writeU(4,n.substream[t].numDepSub),n.substream[t].numDepSub?s.writeU(9,n.substream[t].chanLoc):s.writeU(1,0);s.padding();const a=s.getPointer();t.writeUint32(8+a),t.writeString("dec3"),t.writeBuffer(s.getBuffer().subarray(0,a))}},79142:(t,e,r)=>{"use strict";r.d(e,{A:()=>c});var i=r(14686),n=r(4624),s=r(14769);const a="src/avformat/formats/isobmff/writing/dfla.ts";function c(t,e,r){let c;r.fragment&&e.sideData[1]?(c=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(c=(0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),c&&c.length===s.ob?(t.writeUint32(c.length+16),t.writeString("dfLa"),t.writeUint8(0),t.writeUint24(0),t.writeUint8(128),t.writeUint24(c.length),t.writeBuffer(c)):n.z3("invalid extradata",a,57)}},6799:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(14686),n=r(31865);function s(t,e,r){let s;if(r.fragment&&e.sideData[1]?(s=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(s=(0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),!s||s.length<19)t.writeUint32(19),t.writeString("dOps"),t.writeUint8(0),t.writeUint8(e.codecpar.chLayout.nbChannels),t.writeUint16(e.codecpar.initialPadding),t.writeUint32(e.codecpar.sampleRate),t.writeUint16(0),t.writeUint8(0);else{const e=new n.A(s,!1);t.writeUint32(s.length),t.writeString("dOps"),t.writeUint8(0),e.seek(9),t.writeUint8(e.readUint8()),t.writeUint16(e.readUint16()),t.writeUint32(e.readUint32()),t.writeUint16(e.readUint16()),t.writeBuffer(s.subarray(18))}}},40222:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(28),t.writeString("dref"),t.writeUint32(0),t.writeUint32(1),t.writeUint32(12),t.writeString("url "),t.writeUint32(1)}r.d(e,{A:()=>i})},567:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(77231),n=r(44328),s=r(331);function a(t,e,r){const a=e.privData;let c=(0,n.k)((0,s.A)(a),e.timeBase,{den:r.timescale,num:1}),o=a.startCT;const d=(0,n.k)(a.startDts+BigInt(Math.floor(o)),e.timeBase,{den:r.timescale,num:1});let l=c<i.go?0:1;l|=d<i.go?0:1;const p=1+(d>0?1:0),u=24+p*(1===l?20:12);t.writeUint32(u),t.writeString("edts"),t.writeUint32(u-8),t.writeString("elst"),t.writeUint8(l),t.writeUint24(0),t.writeUint32(p),d>0?(1===l?(t.writeUint64(d),t.writeInt64(i.Dh)):(t.writeUint32(Number(d)),t.writeInt32(-1)),t.writeUint32(65536)):(o=-Math.min(Number(a.startDts),0),c+=d),r.fragment&&(c=BigInt(0)),1===l?(t.writeUint64(c),t.writeInt64(BigInt(Math.floor(o)))):(t.writeUint32(Number(c)),t.writeInt32(o)),t.writeUint32(65536)}},45086:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(54916),n=r(14686);function s(t,e,r){t.writeUint8(e);for(let e=3;e>0;e--)t.writeUint8(r>>7*e|128);t.writeUint8(127&r)}function a(t,e,r){const a=e.privData,c=e.codecpar.extradata?5+e.codecpar.extradataSize:0,o=t.getPos();t.writeUint32(0),t.writeString("esds"),t.writeUint32(0),s(t,3,21+c+5+1),t.writeUint16(a.trackId),t.writeUint8(0),s(t,4,13+c),(86016===e.codecpar.codecId||86017===e.codecpar.codecId)&&e.codecpar.sampleRate>24e3?t.writeUint8(107):t.writeUint8(i.zs[e.codecpar.codecId]),94208===e.codecpar.codecId?t.writeUint8(225):1===e.codecpar.codecType?t.writeUint8(21):t.writeUint8(17),t.writeUint24(0),t.writeUint32(0),t.writeUint32(0),e.codecpar.extradata&&(s(t,5,e.codecpar.extradataSize),t.writeBuffer((0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize))),s(t,6,1),t.writeUint8(2),r.boxsPositionInfo.push({pos:o,type:"esds",size:Number(t.getPos()-o)})}},75526:(t,e,r)=>{"use strict";function i(t,e,r,i,n,s,a){t.writeInt32(Math.floor(65536*e)),t.writeInt32(Math.floor(65536*r)),t.writeInt32(0),t.writeInt32(Math.floor(65536*i)),t.writeInt32(Math.floor(65536*n)),t.writeInt32(0),t.writeInt32(Math.floor(65536*s)),t.writeInt32(Math.floor(65536*a)),t.writeInt32(1073741824)}r.d(e,{A:()=>i})},95297:(t,e,r)=>{"use strict";function i(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("hdlr"),t.writeUint8(0),t.writeUint24(0);let n="dhlr",s="url ",a="DataHandler";e&&(n="mhlr",1===e.codecpar.codecType?(s="soun",a="SoundHandler"):0===e.codecpar.codecType?(s="vide",a="VideoHandler"):3===e.codecpar.codecType?(s="text",a="SubtitleHandler"):(e.metadata.handlerName&&(a=e.metadata.handlerName),e.metadata.hdlrType&&(s=e.metadata.hdlrType))),t.writeString(n),t.writeString(s),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),e&&!r.isom||t.writeUint8(a.length),t.writeString(a),e&&!r.isom&&t.writeUint8(0),r.boxsPositionInfo.push({pos:i,type:"hdlr",size:Number(t.getPos()-i)})}r.d(e,{A:()=>i})},54219:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(14686),n=r(60264),s=r(67659);function a(t,e,r){let a;r.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&n.Bs(a)&&(a=s.S1(a)),t.writeUint32(8+(a?a.length:0)),t.writeString("hvcC"),a&&t.writeBuffer(a)}},49562:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(77231),n=r(331),s=r(67672);function a(t,e,r){const a=e.privData,c=(0,n.A)(a),o=e.metadata.creationTime||0,d=e.metadata.modificationTime||0;let l=21956,p=e.metadata.language;p&&s.Yj(p)&&p.length>=3&&(l=(p.charCodeAt(0)-96&31)<<10|(p.charCodeAt(1)-96&31)<<5|p.charCodeAt(2)-96&31);let u=c<BigInt(i.f7)?0:1;u=o<i.f7?0:1,u=d<i.f7?0:1,t.writeUint32(1===u?44:32),t.writeString("mdhd"),t.writeUint8(u),t.writeUint24(0),1===u?(t.writeUint64(o),t.writeUint64(d)):(t.writeUint32(Number(o)),t.writeUint32(Number(d))),t.writeUint32(e.timeBase.den),1===u?t.writeUint64(c):t.writeUint32(Number(c)),t.writeUint16(l),t.writeUint16(0)}},73746:(t,e,r)=>{"use strict";r.d(e,{A:()=>m});var i=r(73363),n=r.n(i),s=r(86226),a=r.n(s),c=r(18182),o=r.n(c),d=r(67672),l=r(96108),p=r(95335),u=r(65977),f=r(50011);function m(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("meta"),t.writeUint32(0),t.writeUint32(33),t.writeString("hdlr"),t.writeUint32(0),t.writeString("dhlr"),t.writeString(r.useMetadataTags?"mdta":"mdir"),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint8(0);let s=[],c=[];const m=p.BE(l.c);function h(t){return r.useMetadataTags?(s.push(t),s.length):m[t]||4===t.length?(0,u.A)(m[t]||t):void 0}if(c.push({key:h("encoder"),value:"libmedia-v0.6.1-355-g72ba4aa7"}),r.covr&&c.push({key:h("covr"),value:r.covr.data,type:r.covr.type}),r.metadata&&p.__(r.metadata,((t,e)=>{if((d.Yj(t)||d.ai(t)||t instanceof Uint8Array)&&"encoder"!==e.toLocaleLowerCase()){let r=h(e);r&&c.push({key:r,value:t})}})),s.length&&(t.writeUint32(16+n()(s).call(s,((t,e)=>t+(8+e.length)),0)),t.writeString("keys"),t.writeUint32(0),t.writeUint32(s.length),a()(s).call(s,(e=>{t.writeUint32(e.length+8),t.writeString("mdta"),t.writeString(e)}))),c.length){const e=t.getPos();t.writeUint32(0),t.writeString("ilst"),a()(c).call(c,(e=>{let r,i=0,n=0;if(d.ai(e.value))i=o()(e.value)===e.value?e.value<0?21:22:23,n=4;else if(e.value instanceof Uint8Array){var s;i=null!==(s=e.type)&&void 0!==s?s:0,n=e.value.length}else{if(!d.Yj(e.value))return;i=1,r=f.encode(e.value),n=r.length}t.writeUint32(24+n),t.writeUint32(e.key),t.writeUint32(16+n),t.writeString("data"),t.writeUint32(i),t.writeUint32(0),0===i||e.value instanceof Uint8Array?t.writeBuffer(e.value):1===i?t.writeBuffer(r):21===i?t.writeInt32(e.value):22===i?t.writeUint32(e.value):23===i&&t.writeFloat(e.value)})),r.boxsPositionInfo.push({pos:e,type:"ilst",size:Number(t.getPos()-e)})}r.boxsPositionInfo.push({pos:i,type:"meta",size:Number(t.getPos()-i)})}},24432:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(16),t.writeString("mfhd"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.currentFragment.sequence)}r.d(e,{A:()=>i})},42259:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(95297);function n(t,e,r){(0,i.A)(t,null,r)}},75456:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(77231),n=r(75526);function s(t,e,r){const s=r.duration,a=r.creationTime||0,c=r.modificationTime||0,o=r.timescale||0;let d=r.nextTrackId||1;r.fragment&&(d=2);let l=s<BigInt(i.f7)?0:1;l=a<i.f7?0:1,l=c<i.f7?0:1,t.writeUint32(1===l?120:108),t.writeString("mvhd"),t.writeUint8(l),t.writeUint24(0),1===l?(t.writeUint64(a),t.writeUint64(c)):(t.writeUint32(Number(a)),t.writeUint32(Number(c))),t.writeUint32(o),1===l?t.writeUint64(s):t.writeUint32(Number(s)),t.writeUint32(65536),t.writeUint16(256),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),(0,n.A)(t,1,0,0,1,0,0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(d)}},97882:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(12),t.writeString("nmhd"),t.writeUint32(0)}r.d(e,{A:()=>i})},10211:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(16),t.writeString("pasp"),t.writeUint32(1),t.writeUint32(1)}r.d(e,{A:()=>i})},19755:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(71426),n=r.n(i);function s(t,e,r){var i;const s=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId));t.writeUint32(20),t.writeString("saio"),t.writeUint32(0),t.writeUint32(1),s.cenc.offsetPos=t.getPos(),t.writeUint32(0)}},2192:(t,e,r)=>{"use strict";r.d(e,{A:()=>c});var i=r(71426),n=r.n(i),s=r(86226),a=r.n(s);function c(t,e,r){var i;const s=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId)),c=t.getPos();var o;t.writeUint32(0),t.writeString("saiz"),t.writeUint32(0),t.writeUint8(s.cenc.sampleSizes.length?0:s.cenc.defaultSampleInfoSize),t.writeUint32(s.cenc.sampleCount),s.cenc.sampleSizes.length&&a()(o=s.cenc.sampleSizes).call(o,(e=>{t.writeUint8(e)})),r.boxsPositionInfo.push({pos:c,type:"saiz",size:Number(t.getPos()-c)})}},69856:(t,e,r)=>{"use strict";r.d(e,{A:()=>c});var i=r(71426),n=r.n(i),s=r(86226),a=r.n(s);function c(t,e,r){var i,s;const c=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId)),o=r.cencs?r.cencs[c.trackId]:null,d=t.getPos();t.writeUint32(0),t.writeString("senc"),t.writeUint32(c.cenc.useSubsamples?2:0),t.writeUint32(c.cenc.sampleEncryption.length),c.cenc.offset=Number(t.getPos()-r.currentFragment.pos),a()(s=c.cenc.sampleEncryption).call(s,(e=>{var r;o.defaultPerSampleIVSize&&t.writeBuffer(e.iv),c.cenc.useSubsamples&&(t.writeUint16(e.subsamples.length),a()(r=e.subsamples).call(r,(e=>{t.writeUint16(e.bytesOfClearData),t.writeUint32(e.bytesOfProtectedData)})))})),r.boxsPositionInfo.push({pos:d,type:"senc",size:Number(t.getPos()-d)})}},96451:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(16),t.writeString("smhd"),t.writeUint32(0),t.writeUint16(0),t.writeUint16(0)}r.d(e,{A:()=>i})},51554:(t,e,r)=>{"use strict";function i(t,e,r){const i=e.privData.chunkOffsets||[];t.writeUint32(16+4*i.length),t.writeString("stco"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(i.length);for(let e=0;e<i.length;e++)t.writeUint32(Number(i[e]))}r.d(e,{A:()=>i})},48068:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(12),t.writeString("sthd"),t.writeUint32(0)}r.d(e,{A:()=>i})},96598:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(4624);const n="src/avformat/formats/isobmff/writing/stsc.ts";function s(t,e,r){const s=e.privData,a=s.stscFirstChunk,c=s.stscSamplesPerChunk,o=s.stscSampleDescriptionIndex;a.length===c.length&&a.length===o.length||i.R8("ctts firstChunk's length is not match samplesPerChunk's length or sampleDescriptionIndex's length",n,42);const d=Math.min(a.length,c.length,o.length);t.writeUint32(16+12*d),t.writeString("stsc"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(d);for(let e=0;e<d;e++)t.writeUint32(a[e]),t.writeUint32(c[e]),t.writeUint32(o[e])}},14159:(t,e,r)=>{"use strict";r.d(e,{A:()=>B});var i=r(18979),n=r.n(i),s=r(17630),a=r(54219),c=r(85121),o=r(40695),d=r(61368),l=r(79142),p=r(6799),u=r(45086),f=r(55707),m=r(10211),h=r(90935),w=r(63030),g=r(98522),U=r(47038),y=r(14686),I=r(61619),b=r(65977);const S={27:"avc1",173:"hvc1",196:"vvc1",225:"av01",167:"vp09",86019:"ac-3",86056:"ec-3",94226:"wvtt",94232:"stpp",94213:"tx3g"};function v(t){if(t.codecTag)return(0,I.A)(t.codecTag);let e=S[t.codecId];return e||(e=0===t.codecType?"mp4v":1===t.codecType?86076===t.codecId?"Opus":86028===t.codecId?"fLaC":"mp4a":3===t.codecType?"text":"none"),e}function x(t,e,r){const i=e.privData,n=r.cencs[i.trackId],s=t.getPos();t.writeUint32(0),t.writeString("sinf"),t.writeUint32(12),t.writeString("frma"),t.writeString(v(e.codecpar)),t.writeUint32(20),t.writeString("schm"),t.writeUint32(0),t.writeUint32(n.schemeType||(0,b.A)("cenc")),t.writeUint32(n.schemeVersion||65536),t.writeUint32(16+n.defaultKeyId.length+8+(n.defaultConstantIV?1+n.defaultConstantIV.length:0)),t.writeString("schi"),t.writeUint32(16+n.defaultKeyId.length+(n.defaultConstantIV?1+n.defaultConstantIV.length:0)),t.writeString("tenc"),n.cryptByteBlock||n.skipByteBlock||n.pattern?t.writeUint8(1):t.writeUint8(0),t.writeUint24(0),t.writeUint8(0),t.writeUint8((15&(n.cryptByteBlock||0))<<4|15&(n.skipByteBlock||0)),t.writeUint8(1),t.writeUint8(n.defaultPerSampleIVSize),t.writeBuffer(n.defaultKeyId),n.defaultConstantIV&&(t.writeUint8(n.defaultConstantIV.length),t.writeBuffer(n.defaultConstantIV)),r.boxsPositionInfo.push({pos:s,type:"sinf",size:Number(t.getPos()-s)})}function A(t,e,r){const i=r.isom?1:0;t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(i),t.writeUint16(0),t.writeUint32(0),r.isom?(t.writeUint16(e.codecpar.chLayout.nbChannels),65541===e.codecpar.codecId||65540===e.codecpar.codecId?t.writeUint16(8):69643===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(16),t.writeUint16(-2)):(86028===e.codecpar.codecId||86032===e.codecpar.codecId||86076===e.codecpar.codecId?t.writeUint16(e.codecpar.chLayout.nbChannels):t.writeUint16(2),86028===e.codecpar.codecId||86032===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerRawSample):t.writeUint16(16),t.writeUint16(0)),t.writeUint16(0),86076===e.codecpar.codecId?t.writeUint16(48e3):86060===e.codecpar.codecId?t.writeUint32(e.codecpar.sampleRate):t.writeUint16(e.codecpar.sampleRate),86060!==e.codecpar.codecId&&t.writeUint16(0),1===i&&(t.writeUint32(e.codecpar.frameSize),t.writeUint32(0),t.writeUint32(0),t.writeUint32(2))}function k(t,e,r){const i=v(e.codecpar);!r.isom||86018!==e.codecpar.codecId&&86019!==e.codecpar.codecId&&86056!==e.codecpar.codecId&&73728!==e.codecpar.codecId&&86032!==e.codecpar.codecId&&69638!==e.codecpar.codecId&&69633!==e.codecpar.codecId&&86035!==e.codecpar.codecId?86028===e.codecpar.codecId?(0,l.A)(t,e,r):86076===e.codecpar.codecId?(0,p.A)(t,e,r):86019===e.codecpar.codecId?(0,g.A)(t,e,r):86056===e.codecpar.codecId?(0,U.A)(t,e,r):"mp4a"==i&&(0,u.A)(t,e,r):(0,w.A)(t,e,r)}function D(t,e,r){const i=13==e.codecpar.codecId&&15==e.codecpar.format||13==e.codecpar.codecId&&1==e.codecpar.format||202==e.codecpar.codecId||203==e.codecpar.codecId||156==e.codecpar.codecId||127==e.codecpar.codecId;t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(i?2:0),t.writeUint16(0),r.isom?(t.writeString("FFMP"),13===e.codecpar.codecId||i?(t.writeUint32(0),t.writeUint32(1024)):(t.writeUint32(512),t.writeUint32(512))):(t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)),t.writeUint16(e.codecpar.width),t.writeUint16(e.codecpar.height),t.writeUint32(4718592),t.writeUint32(4718592),t.writeUint32(0),t.writeUint16(1);let s=e.metadata.compressorName||"";if(s=n()(s).call(s,0,31),t.writeUint8(s.length),t.writeString(s),s.length<31){let e=31-s.length;for(;e>0;)t.writeUint8(0),e--}r.isom&&e.codecpar.bitsPerCodedSample?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(24),t.writeUint16(65535)}function P(t,e,r){"mp4v"===v(e.codecpar)?(0,u.A)(t,e,r):27===e.codecpar.codecId?(0,s.A)(t,e,r):173===e.codecpar.codecId?(0,a.A)(t,e,r):196===e.codecpar.codecId?(0,c.A)(t,e,r):167===e.codecpar.codecId?(0,o.A)(t,e,r):225===e.codecpar.codecId&&(0,d.A)(t,e,r)}function B(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("stsd");const n=e.privData,s=r.cencs&&r.cencs[n.trackId]&&(1===e.codecpar.codecType||0===e.codecpar.codecType)&&!r.ignoreEncryption;t.writeUint8(0),t.writeUint24(0),t.writeUint32(s?2:1),1===e.codecpar.codecType?(s&&function(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("enca"),A(t,e,r),x(t,e,r),k(t,e,r),r.boxsPositionInfo.push({pos:i,type:"enca",size:Number(t.getPos()-i)})}(t,e,r),function(t,e,r){const i=t.getPos(),n=v(e.codecpar);t.writeUint32(0),t.writeString(n),A(t,e,r),k(t,e,r),r.isom||(0,h.A)(t,e,r),r.boxsPositionInfo.push({pos:i,type:n,size:Number(t.getPos()-i)})}(t,e,r)):0===e.codecpar.codecType?(s&&function(t,e,r){const i=t.getPos();t.writeUint32(0),t.writeString("encv"),D(t,e,r),x(t,e,r),P(t,e,r),r.boxsPositionInfo.push({pos:i,type:"encv",size:Number(t.getPos()-i)})}(t,e,r),function(t,e,r){const i=t.getPos(),n=v(e.codecpar);t.writeUint32(0),t.writeString(n),D(t,e,r),P(t,e,r),(0,f.A)(t,e,r),(0,m.A)(t,e,r),r.isom||(0,h.A)(t,e,r),r.boxsPositionInfo.push({pos:i,type:n,size:Number(t.getPos()-i)})}(t,e,r)):3===e.codecpar.codecType&&function(t,e,r){const i=t.getPos(),n=v(e.codecpar);t.writeUint32(0),t.writeString(n),t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),94208===e.codecpar.codecId?(0,u.A)(t,e,r):e.codecpar.extradata&&t.writeBuffer((0,y.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),r.isom||(0,h.A)(t,e,r),r.boxsPositionInfo.push({pos:i,type:n,size:Number(t.getPos()-i)})}(t,e,r),r.boxsPositionInfo.push({pos:i,type:"esds",size:Number(t.getPos()-i)})}},32422:(t,e,r)=>{"use strict";function i(t,e,r){const i=e.privData.stssSampleNumbers;t.writeUint32(16+4*i.length),t.writeString("stss"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(i.length);for(let e=0;e<i.length;e++)t.writeUint32(i[e])}r.d(e,{A:()=>i})},44485:(t,e,r)=>{"use strict";function i(t,e,r){const i=e.privData.sampleSizes;t.writeUint32(20+4*i.length),t.writeString("stsz"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(0),t.writeUint32(i.length);for(let e=0;e<i.length;e++)t.writeUint32(i[e])}r.d(e,{A:()=>i})},16181:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(4624);const n="src/avformat/formats/isobmff/writing/stts.ts";function s(t,e,r){const s=e.privData,a=s.sttsSampleCounts||[],c=s.sttsSampleDeltas||[];a.length!==c.length&&i.R8("stts sampleCounts's length is not match sampleDeltas's length",n,39);const o=Math.min(a.length,c.length);t.writeUint32(16+8*o),t.writeString("stts"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(o);for(let e=0;e<o;e++)t.writeUint32(a[e]),t.writeInt32(c[e])}},92777:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(71426),n=r.n(i);function s(t,e,r){var i;const s=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId)),a=s?s.baseMediaDecodeTime:BigInt(0);t.writeUint32(20),t.writeString("tfdt"),t.writeUint8(1),t.writeUint24(0),t.writeUint64(a)}},48933:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(71426),n=r.n(i);function s(t,e,r){var i;const s=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId));let a=57;s.baseIsMoof&&(a&=-2,a|=131072);const c=t.getPos();t.writeUint32(0),t.writeString("tfhd"),t.writeUint8(0),t.writeUint24(a),t.writeUint32(s.trackId),1&a&&t.writeUint64(s.baseDataOffset),8&a&&t.writeUint32(s.defaultSampleDuration),16&a&&t.writeUint32(s.defaultSampleSize),32&a&&t.writeUint32(s.defaultSampleFlags),r.boxsPositionInfo.push({pos:c,type:"tfhd",size:Number(t.getPos()-c)})}},95314:(t,e,r)=>{"use strict";r.d(e,{A:()=>d});var i=r(52730),n=r.n(i),s=r(77231),a=r(75526),c=r(44328),o=r(331);function d(t,e,r){const i=e.privData,d=(0,c.k)((0,o.A)(i),e.timeBase,{den:r.timescale,num:1}),l=e.metadata.creationTime||0,p=e.metadata.modificationTime||0,u=i.layer||0,f=i.alternateGroup||0;let m=e.codecpar.width>0?e.codecpar.width:0,h=e.codecpar.height>0?e.codecpar.height:0;const w=(0,c.lb)(e.codecpar.sampleAspectRatio);0!==w&&w!==1/0&&(m=Math.floor(m*w)),m<s.zg&&(m<<=16),h<s.zg&&(h<<=16);let g=d<BigInt(s.f7)?0:1;g=l<s.f7?0:1,g=p<s.f7?0:1;let U=2;1&n()(i)&&(U|=1),t.writeUint32(1===g?100:92),t.writeString("tkhd"),t.writeUint8(g),t.writeUint24(U),1===g?(t.writeUint64(l),t.writeUint64(p)):(t.writeUint32(Number(l)),t.writeUint32(Number(p))),t.writeUint32(i.trackId),t.writeUint32(0),1===g?t.writeUint64(d):t.writeUint32(Number(d)),t.writeUint32(0),t.writeUint32(0),t.writeInt16(u),t.writeInt16(i.perStreamGrouping?f:e.codecpar.codecType),1===e.codecpar.codecType?t.writeInt16(256):t.writeInt16(0),t.writeInt16(0);const y=e.metadata.matrix;y?(0,a.A)(t,y[0],y[1],y[3],y[4],y[6],y[7]):(0,a.A)(t,1,0,0,1,0,0),t.writeUint32(m),t.writeUint32(h)}},79232:(t,e,r)=>{"use strict";r.d(e,{A:()=>c});var i=r(71426),n=r.n(i),s=r(52730),a=r.n(s);function c(t,e,r){var i,s,c,o,d,l;const p=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===e.privData.trackId)),u=n()(s=r.trexs).call(s,(t=>{t.trackId,e.privData.trackId})),f=null!==(c=null==u?void 0:u.duration)&&void 0!==c?c:0,m=null!==(o=null==u?void 0:u.size)&&void 0!==o?o:0,h=null!==(d=null==(l=u)?void 0:a()(l))&&void 0!==d?d:0;t.writeUint32(32),t.writeString("trex"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(p.trackId),t.writeUint32(1),t.writeUint32(f),t.writeUint32(m),t.writeUint32(h)}},81206:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(71426),n=r.n(i);function s(t,e,r){var i;const s=e.privData,a=n()(i=r.currentFragment.tracks).call(i,(t=>t.trackId===s.trackId)),c=a.firstSampleFlags||0,o=a.dataOffset||0,d=a.sampleDurations,l=a.sampleSizes,p=a.sampleFlags,u=a.sampleCompositionTimeOffset,f=a.sampleCount,m=d.length>0,h=l.length>0,w=p.length>0,g=u.length>0,U=0!==c;let y=1;U&&(y|=4),m&&(y|=256),h&&(y|=512),w&&(y|=1024),g&&(y|=2048);const I=t.getPos();t.writeUint32(0),t.writeString("trun"),t.writeUint8(1),t.writeUint24(y),t.writeUint32(f),a.dataOffsetPos=t.getPos(),t.writeInt32(o),U&&t.writeUint32(c);for(let e=0;e<f;e++)m&&t.writeUint32(d[e]||0),h&&t.writeUint32(l[e]||0),w&&t.writeUint32(p[e]||0),g&&t.writeInt32(u[e]||0);r.boxsPositionInfo.push({pos:I,type:"trun",size:Number(t.getPos()-I)})}},25362:(t,e,r)=>{"use strict";function i(t,e,r){t.writeUint32(20),t.writeString("vmhd"),t.writeUint8(0),t.writeUint24(1),t.writeUint64(BigInt(0))}r.d(e,{A:()=>i})},40695:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(14686);function n(t,e,r){var n;t.writeUint32(12+(null!==(n=e.codecpar.extradataSize)&&void 0!==n?n:0)),t.writeString("vpcC"),t.writeUint8(1),t.writeUint24(0),r.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},85121:(t,e,r)=>{"use strict";r.d(e,{A:()=>a});var i=r(14686),n=r(60264),s=r(59166);function a(t,e,r){let a;r.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&n.Bs(a)&&(a=s.S1(a)),t.writeUint32(12+(a?a.length:0)),t.writeString("vvcC"),t.writeUint8(0),t.writeUint24(0),a&&t.writeBuffer(a)}},63030:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(14686),n=r(45086);function s(t,e,r){const s=t.getPos();t.writeUint32(0),t.writeString("wave"),86035!==e.codecpar.codecId&&(t.writeUint32(12),t.writeString("frma"),t.writeUint32(e.codecpar.codecTag)),86018===e.codecpar.codecId?(t.writeUint32(12),t.writeString("mp4a"),t.writeUint32(0),(0,n.A)(t,e,r)):r.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,i.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),t.writeUint32(8),t.writeUint32(0),r.boxsPositionInfo.push({pos:s,type:"wave",size:Number(t.getPos()-s)})}},7543:(t,e,r)=>{"use strict";r.d(e,{A:()=>M});var i=r(16181),n=r(613),s=r(32422),a=r(44485),c=r(96598),o=r(51554),d=r(78427),l=r(49562),p=r(75456),u=r(95314),f=r(95297),m=r(14159),h=r(25362),w=r(567),g=r(96451),U=r(97882),y=r(48068),I=r(40222),b=r(79232),S=r(24432),v=r(48933),x=r(92777),A=r(81206),k=r(42259),D=r(2192),P=r(19755),B=r(69856),C=r(73746),z=r(62336);const M={stts:i.A,ctts:n.A,stss:s.A,stsz:a.A,stsc:c.A,stco:o.A,co64:d.A,mdhd:l.A,mvhd:p.A,tkhd:u.A,hdlr:f.A,stsd:m.A,vmhd:h.A,edts:w.A,smhd:g.A,nmhd:U.A,sthd:y.A,dref:I.A,trex:b.A,mfhd:S.A,tfhd:v.A,tfdt:x.A,trun:A.A,minf_hdlr:k.A,saio:P.A,saiz:D.A,senc:B.A,meta:C.A,chpl:z.A}},59989:(t,e,r)=>{"use strict";function i(t,e=0){if(!t)return!1;if(t.length<2)return!0;let r=t[e],i=e+1;for(;i<t.length&&r===t[i];i++);return i===t.length}r.d(e,{A:()=>i})},61619:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});var i=r(67672);function n(t,e=4){let r="";for(let n=0;n<e;n++)i.ai(t)?(r=String.fromCharCode(255&t)+r,t>>>=8):(r=String.fromCharCode(Number(t&BigInt(255)))+r,t>>=BigInt(8));return r}},65977:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var i=r(4624);const n="src/avformat/function/mktag.ts";function s(t){4!==t.length&&i.R8(`tag length is not 4, tag: ${t}`,n,30);let e=0;for(let r=0;r<4;r++)e=e<<8|t.charCodeAt(r);return e}},20841:(t,e,r)=>{"use strict";function i(t,e,r,i){const n=t.getPos(),s=t.getPointer(),a=n-BigInt(Math.floor(s));let c=!1;switch(e<n&&e>=a?(t.seekInline(s+Number(e-n)),c=!0):t.seek(e),i){case"uint8":t.writeUint8(255&r);break;case"int8":t.writeInt8(r);break;case"uint16":t.writeUint16(65535&r);break;case"int16":t.writeInt16(r);break;case"uint32":t.writeUint32(r>>>0);break;case"int32":t.writeInt32(r);break;case"uint64":t.writeUint64(BigInt.asUintN(64,r));break;case"int64":t.writeInt64(r);break;case"float":t.writeFloat(r);break;case"double":t.writeDouble(r)}c?t.seekInline(s):t.seek(n)}r.d(e,{A:()=>i})},87518:(t,e,r)=>{"use strict";r.d(e,{R:()=>f,j:()=>n});var i=r(37246);const n=[3,4,3,7,259,263,1539,1543],s=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],a=[4,5,6,5],c=[4,6,7,6],o=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],p=[1,2,3,6],u=7;function f(t){const e=new i.A(t.length);e.appendBuffer(t);const r={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(r.syncWord=e.readU(16),2935!==r.syncWord)return-1;if(r.bitstreamId=31&e.peekU(29),r.bitstreamId>16)return-2;if(r.numBlocks=6,r.ac3BitrateCode=-1,r.centerMixLevel=5,r.surroundMixLevel=6,r.dolbySurroundMode=0,r.bitstreamId<=10){if(r.crc1=e.readU(16),r.srCode=e.readU(2),3===r.srCode)return-3;const t=e.readU(6);if(t>37)return-4;r.ac3BitrateCode=t>>1,e.readU(5),r.bitstreamMode=e.readU(3),r.channelMode=e.readU(3),2==r.channelMode?r.dolbySurroundMode=e.readU(2):(1&r.channelMode&&1!=r.channelMode&&(r.centerMixLevel=a[e.readU(2)]),4&r.channelMode&&(r.surroundMixLevel=c[e.readU(2)])),r.lfeOn=e.readU(1),r.srShift=Math.max(r.bitstreamId,8)-8,r.sampleRate=o[r.srCode]>>r.srShift,r.bitrate=1e3*d[r.ac3BitrateCode]>>r.srShift,r.channels=l[r.channelMode]+r.lfeOn,r.frameSize=2*s[t][r.srCode],r.frameType=2,r.substreamId=0}else{if(r.crc1=0,r.frameType=e.readU(2),3==r.frameType)return-5;if(r.substreamId=e.readU(3),r.frameSize=e.readU(11)+1<<1,r.frameSize<u)return-6;if(r.srCode=e.readU(2),3==r.srCode){const t=e.readU(2);if(3==t)return-7;r.sampleRate=o[t]/2,r.srShift=1}else r.numBlocks=p[e.readU(2)],r.sampleRate=o[r.srCode],r.srShift=0;r.channelMode=e.readU(3),r.lfeOn=e.readU(1),r.bitrate=8*r.frameSize*r.sampleRate/(256*r.numBlocks),r.channels=l[r.channelMode]+r.lfeOn}return r.channelLayout=BigInt(n[r.channelMode]),r.lfeOn&&(r.channelLayout|=BigInt(8)),r}},14769:(t,e,r)=>{"use strict";r.d(e,{DK:()=>c,XC:()=>d,Xr:()=>o,jA:()=>s,ob:()=>n,oe:()=>a});var i=r(31865);const n=34,s=8,a=[0,8,12,0,16,20,24,32],c=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],o=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function d(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length===n){const{bitsPerRawSample:r,sampleRate:n,channels:s}=function(t){const e=new i.A(t);e.skip(10);const r=e.readUint24();return{sampleRate:r>>4,channels:1+((15&r)>>>1),bitsPerRawSample:1+((1&r)<<4|(240&e.readUint8())>>>4)}}(e);t.codecpar.bitsPerRawSample=r,t.codecpar.sampleRate=n,t.codecpar.chLayout.nbChannels=s}}},59166:(t,e,r)=>{"use strict";r.d(e,{HL:()=>z,KD:()=>L,OD:()=>O,S1:()=>F,Ui:()=>E,XC:()=>R,kM:()=>W,oT:()=>T,sL:()=>_,wA:()=>N,wf:()=>V});var i=r(5496),n=r.n(i),s=r(73363),a=r.n(s),c=r(86226),o=r.n(c),d=r(96319),l=r.n(d),p=r(11393),u=r.n(p),f=r(31721),m=r.n(f),h=r(54810),w=r.n(h),g=r(63939),U=r(72739),y=r(729),I=r(31865),b=r(37246),S=r(14686),v=r(60264),x=r(37837),A=r(23991),k=r(83314),D=r(39381),P=r(82774);const B=3;function C(t){const e=t.readU(9),r=t.readU(3),i=t.readU(2),n=t.readU(2),s=t.readU(3);t.readU(5),t.readU(2);const a=t.readU(6),c=t.readU(7),o=t.readU(1),d=t.readU(8),l=t.readU(1),p=t.readU(1),u=[],f=[];if(a){for(let e=0;e<a-1;e++)u[e]=t.readU(8);u[a-1]=t.readU(6)}else t.readU(6);if(r>1){let e=0;for(let i=r-2;i>=0;--i)e|=t.readU(1)<<i;for(let e=r;e<=8&&r>1;++e)t.readU(1);for(let i=r-2;i>=0;--i)e&1<<i&&(f[i]=t.readU(8))}const m=t.readU(8),h=[];if(m)for(let e=0;e<m;e++)h.push(t.readU(8));return{olsIdx:e,numSublayers:r,bitDepthMinus8:s,chromaFormatIdc:n,constantFrameRate:i,generalProfileIdc:c,generalTierFlag:o,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:p,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:h,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function z(t){const e=new I.A(t,!0);if(1&e.readUint8()){const r=new b.A;r.appendBuffer(t.subarray(1)),C(r),e.skip(r.getPointer())}let r=[],i=[],n=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=31&e.readUint8();let s=1;13!==t&&12!==t&&(s=e.readUint16());const a=[];for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}14===t?r=a:15===t?i=a:16===t&&(n=a)}return{vpss:r,spss:i,ppss:n}}function M(t,e,r){const i=e[0];let s;if(i){const t=V(i);let e=t.generalConstraintInfo;var c;e.length||(e=n()(c=new Array(12)).call(c,0));const r=new k.A;if(r.writeU(9,0),r.writeU(3,t.spsMaxSublayersMinus1+1),r.writeU(2,1),r.writeU(2,t.chromaFormatIdc),r.writeU(3,t.bitDepthMinus8),r.writeU(5,31),r.writeU(2,0),r.writeU(6,e.length),r.writeU(7,t.profile),r.writeU1(t.tierFlag),r.writeU(8,t.level),r.writeU1(t.ptlFrameOnlyConstraintFlag),r.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)r.writeU(8,e[t]);r.writeU(6,e[e.length-1])}else r.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let r=t.spsMaxSublayersMinus1-1;r>=0;r--)e=e<<1|t.ptlSublayerLevelPresentFlag[r];r.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)r.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&r.writeU(8,t.sublayerLevelIdc[e])}r.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)r.writeU(8,t.sublayerLevelIdc[e]);r.writeU(16,t.width),r.writeU(16,t.height),r.writeU(16,0),r.padding(),s=r.getBuffer().subarray(0,r.getPointer())}let o=2+(s?s.length:0);t.length&&(o+=3,o=a()(t).call(t,((t,e)=>t+2+e.length),o)),e.length&&(o+=3,o=a()(e).call(e,((t,e)=>t+2+e.length),o)),r.length&&(o+=3,o=a()(r).call(r,((t,e)=>t+2+e.length),o));const d=new Uint8Array(o),l=new y.A(d,!0);l.writeUint8(B<<1|(s?1:0)|248),s&&l.writeBuffer(s);let p=0;return t.length&&p++,e.length&&p++,r.length&&p++,l.writeUint8(p),t.length&&(l.writeUint8(142),l.writeUint16(t.length),U.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),e.length&&(l.writeUint8(143),l.writeUint16(e.length),U.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),r.length&&(l.writeUint8(144),l.writeUint16(r.length),U.__(r,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),d}function F(t){let e=v.py(t);if(e.length>=2){const t=[],r=[],i=[];if(o()(e).call(e,(e=>{const n=e[1]>>>3&31;14===n?t.push(e):15===n?r.push(e):16===n&&i.push(e)})),r.length&&i.length)return M(t,r,i)}}function _(t){let e=v.py(t);if(e.length>=2){const t=[],r=[],i=[];if(o()(e).call(e,(e=>{const n=e[1]>>>3&31;14===n?t.push(e):15===n?r.push(e):16===n&&i.push(e)})),r.length&&i.length){const e=[r[0],i[0]];return t.length&&e.unshift(t[0]),v.nW(e,0)}}}function T(t,e=!1){let r,i=!1,n=v.py(t);if(n.length){const t=[],s=[],a=[];o()(n).call(n,(e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?s.push(e):16===r&&a.push(e),8!==r&&7!==r&&9!==r&&10!==r||(i=!0)})),s.length&&a.length?(r=M(t,s,a),n=l()(n).call(n,(t=>{const r=t[1]>>>3&31;return(e||14!==r&&15!==r&&16!==r)&&20!==r}))):n=l()(n).call(n,(t=>20!=(t[1]>>>3&31)))}const s=a()(n).call(n,((t,e)=>t+B+1+e.length),0),c=(0,x.sY)(s),d=(0,S.s3)(c,s);return v.S9(n,B,d),{bufferPointer:c,length:s,extradata:r,key:i}}function N(t,e,r,i,n){const s=[v.Le(t,0),v.Le(e,0),v.Le(r,0),v.Le(i,2)];let c=a()(s).call(s,((t,e)=>t+e),0);const o=(0,x.sY)(c+7);let d=o;return P.w8((d+=1,d-1),0),P.w8((d+=1,d-1),0),P.w8((d+=1,d-1),0),P.w8((d+=1,d-1),1),P.w8((d+=1,d-1),0),P.w8((d+=1,d-1),161),P.w8((d+=1,d-1),(n?1:0)<<7|40),t.length&&(v.nW(t,0,(0,S.s3)(d,s[0])),d+=s[0]),e.length&&(v.nW(e,0,(0,S.s3)(d,s[1])),d+=s[1]),r.length&&(v.nW(r,0,(0,S.s3)(d,s[2])),d+=s[2]),i.length&&v.nW(i,2,(0,S.s3)(d,s[3])),{bufferPointer:o,length:c+7}}function W(t,e){var r;let i=u()(r=v.py(t)).call(r,v.py(e));if(i.length){let t=[],e=[],r=[],n=[];return o()(i).call(i,(i=>{const s=i[1]>>>3&31;14===s?t.push(i):15===s?e.push(i):16===s?r.push(i):20!==s&&n.push(i)})),N(t,e,r,n,!0)}}function O(t,e,r=B){var i;e&&(r=e[0]>>>1&3);let n=[],s=[],a=[],c=!1;if(e){const t=z(e);n=t.vpss,s=t.spss,a=t.ppss,c=!0}const d=l()(i=v.wN(t,r)).call(i,(t=>20!=(t[1]>>>3&31))),p=[];return o()(d).call(d,(t=>{const e=t[1]>>>3&31;15!==e||s.length?16!==e||a.length?20!==e&&p.push(t):a.push(t):s.push(t),8!==e&&7!==e||(c=!0)})),{...N(n,s,a,p,c),key:c}}function R(t,e){let r;if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&v.Bs(e))U.__(v.py(e),(t=>{if(15==(t[1]>>>3&31))return r=t,!1}));else if(e&&e.length>=6){const{spss:t}=z(e);t.length&&(r=t[0])}r&&function(t,e){const{profile:r,level:i,width:n,height:s,videoDelay:a,chromaFormatIdc:c,bitDepthMinus8:o}=V(e);switch(t.codecpar.profile=r,t.codecpar.level=i,t.codecpar.width=n,t.codecpar.height=s,t.codecpar.videoDelay=a,o){case 0:t.codecpar.format=3===c?5:2===c?4:0;break;case 2:t.codecpar.format=3===c?68:2===c?64:62}}(t,r)}function L(t,e=4){if(64&g.f[15](t+36)){let e=v.py((0,S.s3)(g.f[20](t+24),g.f[15](t+28)));return m()(e).call(e,(t=>{const e=t[1]>>>3&31;return 8===e||7===e}))}{const r=g.f[15](t+28);let i=0;for(;i<r-e;){const r=D.r8(g.f[20](t+24)+(i+e+1))>>>3&31;if(8===r||7===r)return!0;i+=4===e?D.Sg(g.f[20](t+24)+i):3===e?D.ht(g.f[20](t+24)+i):2===e?D.yd(g.f[20](t+24)+i):D.r8(g.f[20](t+24)+i),i+=e}return!1}}function V(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let r=0,i=0,n=0,s=0,a=0,c=1,o=0,d=0,l=0;const p=[],u=[],f=[],m=[],h=v.BN(t.subarray(e)),g=new b.A(h.length);g.appendBuffer(h),g.readU1(),g.readU1(),g.readU(6),g.readU(5),g.readU(3),g.readU(8);const U=g.readU(3);c=g.readU(2);const y=g.readU(2);if(g.readU(1)){if(r=g.readU(7),o=g.readU(1),i=g.readU(8),d=g.readU(1),l=g.readU(1),g.readU(1)){for(let t=0;t<8;t++)p[t]=g.readU(8);p[8]=g.readU(7);const t=g.readU(8);g.readU(t)}g.skipPadding();for(let t=U-1;t>=0;t--)u[t]=g.readU(1);g.skipPadding();for(let t=U-1;t>=0;t--)u[t]&&(f[t]=g.readU(8));const t=g.readU(8);if(t)for(let e=0;e<t;e++)m[e]=g.readU(32)}g.readU1(),g.readU1()&&g.readU1();const I=n=A.xb(g),S=s=A.xb(g);if(g.readU1()&&(A.xb(g),A.xb(g),A.xb(g),A.xb(g)),g.readU1()){const t=A.xb(g),e=y+5,r=1<<e,i=I/(1<<e),n=S/(1<<e),s=Math.ceil(w()(i)),a=Math.ceil(w()(n));let c=0,o=0,d=0;t>0&&(d=g.readU1(),o=g.readU1());for(let e=0;t>0&&e<=t;e++)o&&0!=e||(e>0&&I>r&&g.readU(s),e>0&&S>r&&g.readU(a),e<t&&I>r&&g.readU(s),e<t&&S>r&&g.readU(a)),d||g.readU(2);if(c=A.xb(g)+1,g.readU(1)&&g.readU(1))for(let e=0;e<=t;e++)g.readU(c)}a=A.xb(g),g.readU(1),g.readU(1);const x=g.readU(4),k=g.readU(1);let D=0;k&&(D=A.xb(g));const P=[],B=g.readU(2);for(let t=0;t<8*B;t++)P[t]=g.readU(1);return{profile:r,level:i,width:n,height:s,videoDelay:U+1>2?2:U,chromaFormatIdc:c,bitDepthMinus8:a,generalProfileSpace:0,tierFlag:o,generalConstraintInfo:p,generalSubProfileIdc:m,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:l,spsMaxSublayersMinus1:U,ptlSublayerLevelPresentFlag:u,sublayerLevelIdc:f,sps_log2_max_pic_order_cnt_lsb_minus4:x,sps_poc_msb_cycle_flag:k,sps_poc_msb_cycle_len_minus1:D,sps_num_extra_ph_bytes:B,sps_extra_ph_bit_present_flag:P}}function E(t){v.Bs(t)&&(t=F(t));const e=new b.A;return e.appendBuffer(t),1&e.readU(8)?C(e):{}}},50315:(t,e,r)=>{"use strict";r.d(e,{ZK:()=>d,bE:()=>l,p$:()=>c,zz:()=>o});var i=r(86226),n=r.n(i),s=r(31865),a=r(729);function c(t){const e=new s.A(t,!0),r=e.readUint32(),i=e.readUint32(),n=e.readUint32(),a=e.readUint32(),c=e.readUint32(),o=e.readUint32(),d={scheme:r,cryptByteBlock:i,skipByteBlock:n,keyId:e.readBuffer(a),iv:e.readBuffer(c),subsamples:[]};if(o)for(let t=0;t<o;t++)d.subsamples.push({bytesOfClearData:e.readUint32(),bytesOfProtectedData:e.readUint32()});return d}function o(t){var e;const r=new Uint8Array(24+t.keyId.length+t.iv.length+8*t.subsamples.length),i=new a.A(r,!0);return i.writeUint32(t.scheme),i.writeUint32(t.cryptByteBlock),i.writeUint32(t.skipByteBlock),i.writeUint32(t.keyId.length),i.writeUint32(t.iv.length),i.writeUint32(t.subsamples.length),i.writeBuffer(t.keyId),i.writeBuffer(t.iv),n()(e=t.subsamples).call(e,(t=>{i.writeUint32(t.bytesOfClearData),i.writeUint32(t.bytesOfProtectedData)})),r}function d(t){const e=new s.A(t,!0),r=e.readUint32(),i=[];for(let t=0;t<r;t++){const t=e.readUint32(),r=e.readUint32(),n=e.readUint32(),s=e.readUint32(),a={systemId:e.readBuffer(t),keyIds:[],data:null};if(r)for(let t=0;t<r;t++)a.keyIds.push(e.readBuffer(n));a.data=e.readBuffer(s),i.push(a)}return i}function l(t){let e=4;n()(t).call(t,(t=>{e+=16+t.systemId.length+t.keyIds.length*(t.keyIds.length?t.keyIds[0].length:0)+t.data.length}));const r=new Uint8Array(e),i=new a.A(r,!0);return i.writeUint32(t.length),n()(t).call(t,(t=>{var e;i.writeUint32(t.systemId.length),i.writeUint32(t.keyIds.length),i.writeUint32(t.keyIds.length?t.keyIds[0].length:0),i.writeUint32(t.data.length),i.writeBuffer(t.systemId),n()(e=t.keyIds).call(e,(t=>{i.writeBuffer(t)})),i.writeBuffer(t.data)})),r}},52730:(t,e,r)=>{t.exports=r(64055)},18182:(t,e,r)=>{t.exports=r(69727)},60974:(t,e,r)=>{"use strict";var i=r(88280),n=r(48804),s=RegExp.prototype;t.exports=function(t){return t===s||i(s,t)?n(t):t.flags}},77034:(t,e,r)=>{"use strict";r(47382);var i=r(92046);t.exports=i.Math.trunc},48804:(t,e,r)=>{"use strict";r(9164);var i=r(40663);t.exports=i},47382:(t,e,r)=>{"use strict";r(11091)({target:"Math",stat:!0},{trunc:r(41176)})},9164:()=>{},64055:(t,e,r)=>{"use strict";var i=r(60974);t.exports=i},69727:(t,e,r)=>{"use strict";var i=r(77034);t.exports=i}}]);