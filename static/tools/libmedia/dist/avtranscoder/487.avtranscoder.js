"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[487],{85947:(t,e,s)=>{s.d(e,{A:()=>h});var i=s(49859);class h{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},85487:(t,e,s)=>{s.r(e),s.d(e,{default:()=>P});var i=s(49859),h=s(71426),r=s.n(h),a=s(86226),n=s.n(a),u=s(54810),o=s.n(u),c=s(129),d=s.n(c),l=s(63939),p=s(50932),f=s(9705),g=s(85947),b=s(14686),A=s(37837),y=s(71517),v=s(95335),m=s(92647),_=s(67659),q=s(77231),k=s(37246),M=s(23991),R=s(37805);const B={framerate:{num:30,den:1}};class P extends g.A{constructor(t={}){super(),(0,i.A)(this,"type",12),(0,i.A)(this,"options",void 0),(0,i.A)(this,"currentDts",void 0),(0,i.A)(this,"currentPts",void 0),(0,i.A)(this,"step",void 0),(0,i.A)(this,"slices",void 0),(0,i.A)(this,"naluPos",void 0),(0,i.A)(this,"queue",void 0),(0,i.A)(this,"bitReader",void 0),(0,i.A)(this,"sliceType",void 0),(0,i.A)(this,"poc",void 0),(0,i.A)(this,"pocTid0",void 0),(0,i.A)(this,"sps",void 0),(0,i.A)(this,"pps",void 0),(0,i.A)(this,"naluReader",void 0),this.options=v.X$({},B,t)}init(t){t.ioReader&&t.ioReader.setEndian(!1),this.slices=[],this.queue=[],this.bitReader=new k.A(50),this.naluReader=new R.A}async destroy(t){if(this.queue.length){for(let t=0;t<this.queue.length;t++)(0,y.Qe)(this.queue[t].avpacket);this.queue.length=0}}isFrameNalu(t){return(t[1===t[2]?3:4]>>>1&63)<32}async readNaluFrame(t){let e=!1;const s=this.slices;for(this.slices=[],s.length&&(e=this.isFrameNalu(s[0]));;){const i=await this.naluReader.read(t.ioReader);if(!i)return s;const h=i[1===i[2]?3:4]>>>1&63;if(this.isFrameNalu(i))if(e){if(i[1===i[2]?5:6]>>>7)return this.slices.push(i),s;s.push(i)}else s.push(i),e=!0;else{if(e&&(35===h||33===h||34===h||32===h))return this.slices.push(i),s;s.push(i)}}}async readHeader(t){const e=t.createStream();for(e.codecpar.codecType=0,e.codecpar.codecId=173,e.timeBase.den=q.SF,e.timeBase.num=1,e.codecpar.flags|=1,this.currentDts=BigInt(0),this.currentPts=BigInt(0),this.naluPos=BigInt(0),this.poc=0,this.pocTid0=0,this.step=BigInt(Math.floor(q.SF/this.options.framerate.num*this.options.framerate.den));;){const s=await this.readNaluFrame(t);if(!s.length)return-1048576;const i=(0,m.A)(Uint8Array,s),h=_.sL(i);if(h){e.codecpar.extradata=(0,A.sY)(h.length),(0,b.lW)(e.codecpar.extradata,h.length,h),e.codecpar.extradataSize=h.length,_.XC(e,h);const a=r()(s).call(s,(t=>33==(t[1===t[2]?3:4]>>>1&63))),n=r()(s).call(s,(t=>34==(t[1===t[2]?3:4]>>>1&63)));this.sps=_.wf(1===a[2]?a.subarray(3):a.subarray(4)),this.pps=_.ZU(1===n[2]?n.subarray(3):n.subarray(4));const u=(0,y._5)(),o=(0,A.sY)(i.length);(0,b.lW)(o,i.length,i),(0,y.NX)(u,o,i.length),p.M[17](u+56,this.naluPos),this.naluPos+=BigInt(Math.floor(i.length)),p.M[17](u+16,this.currentDts),this.currentDts+=this.step,p.M[17](u+8,this.currentPts),this.currentPts+=this.step,p.M[15](u+32,e.index),p.M[15](u+36,1|l.f[15](u+36)),p.M[15](u+72,e.timeBase.num),p.M[15](u+76,e.timeBase.den),p.M[15](u+36,64|l.f[15](u+36)),t.interval.packetBuffer.push(u);break}this.naluPos+=BigInt(Math.floor(i.length))}return 0}async readAVPacket_(t,e){const s=t.getStreamByMediaType(0),i=await this.readNaluFrame(t);if(!i.length)return-1048576;this.sliceType=-1;let h=!1,r=!0;n()(i).call(i,(t=>{const e=(1===t[2]?t[3]:t[4])>>>1&63,s=(7&(1===t[2]?t[4]:t[5]))-1;if(33===e&&(this.sps=_.wf(1===t[2]?t.subarray(3):t.subarray(4))),34===e&&(this.pps=_.ZU(1===t[2]?t.subarray(3):t.subarray(4))),19!==e&&20!==e||(h=!0),e<32&&r){r=!1,this.bitReader.reset(),this.bitReader.appendBuffer(t.subarray(1===t[2]?5:6,50));const i=this.bitReader.readU1();if(e>=16&&e<=23&&(h=!0,this.bitReader.readU1()),M.xb(this.bitReader),!i){this.pps.dependent_slice_segment_flag&&this.bitReader.readU1();const t=Math.ceil(o()(this.sps.ctb_width*this.sps.ctb_height));this.bitReader.readU(t)}for(let t=0;t<this.pps.num_extra_slice_header_bits;t++)this.bitReader.readU1();if(this.sliceType=M.xb(this.bitReader),this.pps.output_flag_present_flag&&this.bitReader.readU1(),this.sps.separate_colour_plane_flag&&this.bitReader.readU(2),19===e||20===e)this.poc=0;else{const t=this.bitReader.readU(this.sps.log2_max_poc_lsb);let s=1<<this.sps.log2_max_poc_lsb,i=this.pocTid0%s,h=this.pocTid0-i,r=0;r=t<i&&i-t>=s/2?h+s:t>i&&t-i>s/2?h-s:h,16!=e&&17!=e&&18!=e||(r=0),this.poc=r+t}0==s&&0!=e&&2!=e&&4!=e&&6!=e&&8!=e&&7!=e&&9!=e&&(this.pocTid0=this.poc)}}));const a=(0,m.A)(Uint8Array,i),u=(0,A.sY)(a.length);return(0,b.lW)(u,a.length,a),(0,y.NX)(e,u,a.length),p.M[17](e+56,this.naluPos),this.naluPos+=BigInt(Math.floor(a.length)),p.M[17](e+16,this.currentDts),this.currentDts+=this.step,p.M[15](e+32,s.index),p.M[15](e+72,s.timeBase.num),p.M[15](e+76,s.timeBase.den),p.M[15](e+36,64|l.f[15](e+36)),h&&p.M[15](e+36,1|l.f[15](e+36)),0}async readAVPacket(t,e){let s=this.queue.length;const i=()=>{var s,i;this.queue.length>1&&d()(s=this.queue).call(s,((t,e)=>t.poc-e.poc>0?1:-1));for(let t=0;t<this.queue.length;t++)p.M[17](this.queue[t].avpacket+8,this.currentPts),this.currentPts+=this.step;this.queue.length>1&&d()(i=this.queue).call(i,((t,e)=>l.f[17](t.avpacket+16)-l.f[17](e.avpacket+16)>BigInt(0)?1:-1)),this.queue.length&&((0,y.rN)(e,this.queue[0].avpacket),(0,y.Qe)(this.queue[0].avpacket));for(let e=1;e<this.queue.length;e++)t.interval.packetBuffer.push(this.queue[e].avpacket);this.queue.length=0};for(;;){const e=(0,y._5)();let h=await this.readAVPacket_(t,e);if(h<0)return(0,y.Qe)(e),this.queue.length?(i(),0):h;if(1&l.f[15](e+36)||1===this.sliceType||2===this.sliceType){if(1===s||1&l.f[15](e+36)&&this.queue.length)return i(),this.queue.push({avpacket:e,poc:this.poc}),0;this.queue.push({avpacket:e,poc:this.poc}),s++}else this.queue.push({avpacket:e,poc:this.poc})}}async seek(t,e,s,i){const h=t.ioReader.getPos();return 2&i?(await t.ioReader.seek(s),h):BigInt(f.E$)}getAnalyzeStreamsCount(){return 1}}},37805:(t,e,s)=>{s.d(e,{A:()=>c});var i=s(49859),h=s(18979),r=s.n(h),a=s(50314),n=s.n(a),u=s(60264),o=s(92647);class c{constructor(){(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"end",void 0),(0,i.A)(this,"ended",void 0),this.buffer=new Uint8Array(102400),this.pos=0,this.end=0,this.ended=!1}async read(t){if(this.ended&&this.pos>=this.end)return;const e=[];if(this.pos<this.end-4){let t=u.Ky(this.buffer.subarray(this.pos,this.end-4),3);if(t.offset>-1){var s;const e=r()(s=this.buffer).call(s,this.pos,this.pos+t.offset);return this.pos+=t.offset,e}var i,h;e.push(r()(i=this.buffer).call(i,this.pos,this.end-4)),n()(h=this.buffer).call(h,0,this.end-4,this.end),this.pos=0,this.end=4}for(;;){if(!this.ended&&this.end<this.buffer.length)try{const e=await t.readToBuffer(this.buffer.length-this.end,this.buffer.subarray(this.end));this.end+=e}catch(t){if(this.ended=!0,this.pos>=this.end)return e.length?(0,o.A)(Uint8Array,e):null}let s=u.Ky(this.buffer.subarray(this.pos,this.end-4),e.length?0:3);var a,c,d,l;if(s.offset>-1)return e.push(r()(a=this.buffer).call(a,this.pos,this.pos+s.offset)),this.pos+=s.offset,(0,o.A)(Uint8Array,e);if(this.ended)return e.push(r()(c=this.buffer).call(c,this.pos,this.end)),this.pos=this.end=0,(0,o.A)(Uint8Array,e);e.push(r()(d=this.buffer).call(d,this.pos,this.end-4)),n()(l=this.buffer).call(l,0,this.end-4,this.end),this.pos=0,this.end=4}}reset(){this.pos=0,this.end=0,this.ended=!1}}}}]);