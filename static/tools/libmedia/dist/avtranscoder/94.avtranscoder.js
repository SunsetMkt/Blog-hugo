"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[94],{64436:(e,t,i)=>{i.d(t,{A:()=>o});var r=i(49859),a=i(63939),s=(i(77162),i(37837)),n=i(71766);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,s.Gy)(168),(0,n.Yi)(this.inCodecpar,e),this.inTimeBase={den:a.f[15](t+4),num:a.f[15](t)},0}destroy(){this.inCodecpar&&((0,n.dn)(this.inCodecpar),this.inCodecpar=0)}}},36488:(e,t,i)=>{i.d(t,{A:()=>k});var r=i(49859),a=i(63939),s=i(50932),n=i(77162),o=i(29170),h=i(64436),c=i(14686),d=i(4624),f=i(9705),l=i(77231),p=i(95832),u=i(44328),g=i(37837),m=i(71517),w=i(37246),b=i(67672);class k extends h.A{constructor(...e){super(...e),(0,r.A)(this,"bitReader",void 0),(0,r.A)(this,"streamMuxConfig",void 0),(0,r.A)(this,"caches",void 0),(0,r.A)(this,"refSampleDuration",void 0)}init(e,t){return super.init(e,t),this.caches=[],this.refSampleDuration=BigInt(0),this.bitReader=new w.A,this.streamMuxConfig={profile:l.N_,sampleRate:l.N_,channels:l.N_},0}sendAVPacket(e){const t=(0,c.s3)(a.f[20](e+24),a.f[15](e+28));this.bitReader.appendBuffer(t);let i=a.f[17](e+16)!==l.Dh?a.f[17](e+16):a.f[17](e+8);for(;this.bitReader.remainingLength()>=20;){const t=this.bitReader.getPointer(),r=p.f7(null,this.bitReader);if(b.ai(r)){let e=!1;for(;this.bitReader.remainingLength()>=20;){if(695===this.bitReader.peekU(11)){e=!0;break}this.bitReader.readU1()}if(e)continue;return d.z3("AACLATMParser parse failed","src/avformat/bsf/aac/LATM2RawFilter.ts",108),this.bitReader.reset(),f.LR}if(r.framePayloadLength>=this.bitReader.remainingLength()){this.bitReader.skipPadding(),this.bitReader.setPointer(t);break}r.useSameStreamMux||(this.streamMuxConfig.profile=r.profile,this.streamMuxConfig.sampleRate=r.sampleRate,this.streamMuxConfig.channels=r.channels);const h=r.framePayloadLength,m=new Uint8Array(h);for(let e=0;e<h;e++)m[e]=this.bitReader.readU(8);const w={dts:i,buffer:m,extradata:null,pos:a.f[17](e+56)};if(a.f[15](this.inCodecpar+48)!==this.streamMuxConfig.profile||a.f[15](this.inCodecpar+136)!==this.streamMuxConfig.sampleRate||a.f[15](this.inCodecpar+116)!==this.streamMuxConfig.channels){this.refSampleDuration=(0,u.k)(BigInt(Math.floor(1024/this.streamMuxConfig.sampleRate*l.SF)),l.KR,this.inTimeBase),s.M[15](this.inCodecpar+48,this.streamMuxConfig.profile),s.M[15](this.inCodecpar+136,this.streamMuxConfig.sampleRate),s.M[15](this.inCodecpar+116,this.streamMuxConfig.channels);const e=(0,p.Ij)((0,o.A)(this.inCodecpar,n.A));a.f[20](this.inCodecpar+12)&&(0,g.Eb)(a.f[20](this.inCodecpar+12)),s.M[20](this.inCodecpar+12,(0,g.sY)(e.length)),(0,c.lW)(a.f[20](this.inCodecpar+12),e.length,e),s.M[15](this.inCodecpar+16,e.length),w.extradata=e}this.caches.push(w),i+=this.refSampleDuration,this.bitReader.skipPadding()}return 0}receiveAVPacket(e){if(this.caches.length){(0,m.Up)(e);const t=this.caches.shift(),i=(0,g.sY)(t.buffer.length);if((0,c.lW)(i,t.buffer.length,t.buffer),(0,m.NX)(e,i,t.buffer.length),s.M[17](e+16,t.dts),s.M[17](e+8,t.dts),s.M[17](e+56,t.pos),s.M[15](e+36,1|a.f[15](e+36)),s.M[17](e+48,this.refSampleDuration),t.extradata){const i=(0,g.sY)(t.extradata.length);(0,c.lW)(i,t.extradata.length,t.extradata),(0,m.Ow)(e,1,i,t.extradata.length)}return 0}return f.LT}reset(){return this.bitReader.reset(),this.caches.length=0,0}}},47094:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var r=i(49859),a=i(52730),s=i.n(a),n=i(18979),o=i.n(n),h=i(71426),c=i.n(h),d=i(61499),f=i(63939),l=i(50932),p=i(4624),u=i(9705),g=i(85947),m=i(14686),w=i(37837),b=i(71517),k=i(44328),B=i(77231),R=i(72739),I=i(95832),U=i(67672),P=i(36488),T=i(19028),S=i(37246),y=i(92647);const A="src/avformat/formats/IAacFormat.ts",C=1024;class M extends g.A{constructor(){super(),(0,r.A)(this,"type",15),(0,r.A)(this,"frameType",void 0),(0,r.A)(this,"fileSize",void 0),(0,r.A)(this,"currentPts",void 0),(0,r.A)(this,"latmFilter",void 0),(0,r.A)(this,"encodeSampleRate",void 0),(0,r.A)(this,"currentPos",void 0),(0,r.A)(this,"pendingData",void 0),(0,r.A)(this,"firstFramePos",void 0),(0,r.A)(this,"pendingPos",void 0),(0,r.A)(this,"streamMuxConfig",void 0)}init(e){this.currentPts=BigInt(0),this.currentPos=BigInt(0),this.firstFramePos=BigInt(0),this.streamMuxConfig={profile:B.N_,sampleRate:B.N_,channels:B.N_}}async destroy(e){this.latmFilter&&(this.latmFilter.destroy(),this.latmFilter=null)}async estimateTotalBlock(e){let t=0;const i=e.ioReader.getPos();for(;;)try{const i=await e.ioReader.peekBuffer(7),r=(3&i[3])<<11|i[4]<<3|(224&i[5])>>>5;t+=1+(3&i[6]),await e.ioReader.skip(r)}catch(e){break}return await e.ioReader.seek(i),t}async parseTransportStreamTimestamp(e){if("ID3"===await e.ioReader.peekString(3)){await e.ioReader.skip(3);const t={version:await e.ioReader.readUint8(),revision:await e.ioReader.readUint8(),flags:await e.ioReader.readUint8()},i={},r=(127&await e.ioReader.readUint8())<<21|(127&await e.ioReader.readUint8())<<14|(127&await e.ioReader.readUint8())<<7|127&await e.ioReader.readUint8();if(await T.qg(e.ioReader,r,t,i),U.o(i["com.apple.streaming.transportStreamTimestamp"]))return i["com.apple.streaming.transportStreamTimestamp"]}}async readHeader(e){let t;2&s()(e.ioReader)&&(t=await this.parseTransportStreamTimestamp(e));const i=await e.ioReader.peekBuffer(4);if(this.fileSize=await e.ioReader.fileSize(),65===i[0]&&68===i[1]&&73===i[2]&&70===i[3]){const t=e.createStream();t.codecpar.codecId=86018,t.codecpar.codecType=1,this.frameType=0,t.duration=this.fileSize;const i=new S.A;i.appendBuffer(await e.ioReader.readBuffer(Math.min(20,Number(this.fileSize)))),i.skip(32),i.readU1()&&i.skip(72),i.skip(1),i.skip(1),i.skip(1);const a=i.readU(23);t.timeBase.den=16384,t.timeBase.num=1,a&&(t.timeBase.den=a);const s=i.readU(4);e.ioReader.getPos()<this.fileSize&&i.appendBuffer(await e.ioReader.readBuffer(Math.min(312*s,Number(this.fileSize-e.ioReader.getPos()))));for(let e=0;e<s;e++){i.readU(4);const r=i.readU(2),a=i.readU(4),s=i.readU(4),n=i.readU(4),o=i.readU(4),h=i.readU(2),c=i.readU(3),d=i.readU(4);i.readU1()&&i.skip(4),i.readU1()&&i.skip(4),i.readU1()&&i.skip(3);let f=h;for(e=0;e<s;e++)f+=i.readU1()?2:1,i.skip(4);for(e=0;e<n;e++)f+=i.readU1()?2:1,i.skip(4);for(e=0;e<o;e++)f+=i.readU1()?2:1,i.skip(4);for(e=0;e<h;e++)i.skip(4);for(e=0;e<c;e++)i.skip(4);for(e=0;e<d;e++)i.skip(5);i.skipPadding();const l=i.readU(8);if(l&&i.skip(8*l),!e){t.codecpar.profile=r,t.codecpar.chLayout.nbChannels=f,t.codecpar.sampleRate=I.hY[a];const e=(0,I.Ij)(t.codecpar);t.codecpar.extradata=(0,w.sY)(e.length),(0,m.lW)(t.codecpar.extradata,e.length,e),t.codecpar.extradataSize=e.length}}var r;i.skipPadding(),this.firstFramePos=i.getPos(),i.remainingLength()&&(this.pendingData=o()(r=i.getBuffer()).call(r,i.getPointer()),this.pendingPos=this.firstFramePos)}else if(255!==i[0]||240&~i[1]){if(86!==i[0]||224&~i[1])return u.LR;{this.frameType=2;const t=e.createStream();t.codecpar.codecId=86018,t.codecpar.codecType=1;const i=(0,I.f7)(await e.ioReader.peekBuffer(20));if(U.ai(i))return u.LR;t.codecpar.profile=i.profile,t.codecpar.sampleRate=i.sampleRate,t.codecpar.chLayout.nbChannels=i.channels;const r=(0,I.Ij)(t.codecpar);t.codecpar.extradata=(0,w.sY)(r.length),(0,m.lW)(t.codecpar.extradata,r.length,r),t.codecpar.extradataSize=r.length,t.duration=B.Dh,t.timeBase.den=i.sampleRate,t.timeBase.num=1,this.latmFilter=new P.A,this.latmFilter.init(t.codecpar[d.o9],t.timeBase[d.o9])}}else{this.frameType=1;const i=e.createStream();i.codecpar.codecId=86018,i.codecpar.codecType=1;const r=(0,I.Bq)(await e.ioReader.peekBuffer(20));if(U.ai(r))return u.LR;this.encodeSampleRate=r.sampleRate,i.codecpar.profile=r.profile,i.codecpar.sampleRate=r.sampleRate,i.codecpar.chLayout.nbChannels=r.channels;const a=(0,I.Ij)(i.codecpar);i.codecpar.extradata=(0,w.sY)(a.length),(0,m.lW)(i.codecpar.extradata,a.length,a),i.codecpar.extradataSize=a.length,i.timeBase.den=i.codecpar.sampleRate,i.timeBase.num=1,this.streamMuxConfig.profile=r.profile,this.streamMuxConfig.sampleRate=r.sampleRate,this.streamMuxConfig.channels=r.channels,2&s()(e.ioReader)?U.o(t)&&(this.currentPts=(0,k.k)(t,{num:1,den:9e4},i.timeBase)):i.duration=(0,k.k)(BigInt(Math.floor(1024*await this.estimateTotalBlock(e)/this.encodeSampleRate*B.SF)),B.KR,i.timeBase)}return 0}async readAVPacket(e,t){var i;const r=c()(i=e.streams).call(i,(e=>e.codecpar.codecType=1));try{if(2&s()(e.ioReader)){let t=await this.parseTransportStreamTimestamp(e);U.o(t)&&(this.currentPts=(0,k.k)(t,{num:1,den:9e4},r.timeBase))}let i,a=e.ioReader.getPos();if(0===this.frameType){let r=C;if(this.pendingData&&(a=this.pendingPos,i=this.pendingData.subarray(0,r),r-=i.length,i.length<this.pendingData.length?(this.pendingData=this.pendingData.subarray(i.length),this.pendingPos+=BigInt(i.length)):this.pendingData=null),r){const t=Math.min(r,Number(BigInt.asIntN(32,this.fileSize-a))),s=t?await e.ioReader.readBuffer(t):void 0;i&&s?i=(0,y.A)(Uint8Array,[i,s]):s&&(i=s)}if(!i)return-1048576;const s=(0,w.sY)(i.length);(0,m.lW)(s,i.length,i),(0,b.NX)(t,s,i.length),l.M[17](t+48,BigInt(C)),l.M[17](t+56,a)}else if(1===this.frameType){const s=await e.ioReader.readBuffer(7),n=1&s[1],o=1+((192&s[2])>>>6),h=(60&s[2])>>>2,c=(1&s[2])<<2|(192&s[3])>>>6,d=I.hY[h],f=I.En[c];if(this.streamMuxConfig.profile!==o||this.streamMuxConfig.sampleRate!==d||this.streamMuxConfig.channels!==f){this.streamMuxConfig.profile=o,this.streamMuxConfig.sampleRate=d,this.streamMuxConfig.channels=f;const e=(0,I.Ij)({profile:o,sampleRate:d,chLayout:{nbChannels:f}}),i=(0,w.sY)(e.length);(0,m.lW)(i,e.length,e),(0,b.Ow)(t,1,i,e.length)}const p=(3&s[3])<<11|s[4]<<3|(224&s[5])>>>5,u=3&s[6];let g=1===n?7:9,R=p-g;9===g&&await e.ioReader.skip(2);const U=(0,k.k)(BigInt(Math.floor(1024*(u+1)/this.encodeSampleRate*B.SF)),B.KR,r.timeBase);l.M[17](t+48,U),i=await e.ioReader.readBuffer(R);const P=(0,w.sY)(i.length);(0,m.lW)(P,i.length,i),(0,b.NX)(t,P,i.length),l.M[17](t+56,a)}else if(2===this.frameType){if(a===this.fileSize)return-1048576;for(;;){let r=this.latmFilter.receiveAVPacket(t);if(r!==u.LT){if(r<0)return r;l.M[17](t+48,BigInt(1024)),l.M[17](t+56,this.currentPos),this.currentPos+=BigInt(0|f.f[15](t+28));break}{if(e.ioReader.getPos()===this.fileSize)return-1048576;l.M[17](t+56,e.ioReader.getPos()),i=await e.ioReader.readBuffer(Math.min(C,Number(BigInt.asIntN(32,this.fileSize-a))));const r=(0,w.sY)(i.length);(0,m.lW)(r,i.length,i),(0,b.NX)(t,r,i.length),this.latmFilter.sendAVPacket(t)}}}return l.M[15](t+32,r.index),l.M[15](t+76,r.timeBase.den),l.M[15](t+72,r.timeBase.num),l.M[17](t+16,this.currentPts),l.M[17](t+8,this.currentPts),l.M[15](t+36,1|f.f[15](t+36)),this.currentPts+=f.f[17](t+48),0}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(p.z3(`read packet error, ${t}`,A,505),u.LR):e.ioReader.error}}async syncFrame(e){if(0===this.frameType)return;let t=B.Dh;const i=1===this.frameType?4095:695,r=1===this.frameType?4:5;for(;;)try{let a=0;for(t=e.ioReader.getPos();3!==a&&await e.ioReader.peekUint16()>>>r===i;){const t=1===this.frameType?(0,I.Bq)(await e.ioReader.peekBuffer(9)):(0,I.f7)(await e.ioReader.peekBuffer(20));if(U.ai(t))break;a++,await e.ioReader.skip(t.headerLength+t.framePayloadLength)}if(3===a)break;await e.ioReader.skip(1)}catch(e){break}t!==B.Dh&&await e.ioReader.seek(t)}async seek(e,t,i,r){if(16&r&&2&s()(e.ioReader)){const r=(0,k.k)(i,t.timeBase,B.i0);return await e.ioReader.seek(r,!0),this.currentPts=i,BigInt(0)}if(1===this.frameType||2===this.frameType){const a=e.ioReader.getPos();if(2&r){const s=await e.ioReader.fileSize();return s<=BigInt(0)?BigInt(u.E$):(i<BigInt(0)?i=BigInt(0):i>s&&(i=s),await e.ioReader.seek(i),4&r||(await this.syncFrame(e),t.duration&&this.fileSize&&(this.currentPts=i/this.fileSize*t.duration)),a)}if(t&&t.sampleIndexes.length){let r=R.El(t.sampleIndexes,(e=>e.pts>i?-1:1));if(r>0&&(0,k.k)(i-t.sampleIndexes[r-1].pts,t.timeBase,B.i0)<BigInt(5e3))return p.Yz(`seek in sampleIndexes, found index: ${r}, pts: ${t.sampleIndexes[r-1].pts}, pos: ${t.sampleIndexes[r-1].pos}`,A,613),await e.ioReader.seek(t.sampleIndexes[r-1].pos),this.currentPts=i,a}if(2===this.frameType)return BigInt(u.E$);if(p.Yz("not found any keyframe index, try to seek in bytes",A,624),!t.duration)return BigInt(u.E$);{await e.ioReader.seek(BigInt(0));let r=BigInt(0);for(;;)try{if(r>=i)return this.currentPts=r,a;const s=await e.ioReader.peekBuffer(7),n=(3&s[3])<<11|s[4]<<3|(224&s[5])>>>5,o=3&s[6];r+=(0,k.k)(BigInt(Math.floor(1024*(o+1)/this.encodeSampleRate*B.SF)),B.KR,t.timeBase),await e.ioReader.skip(n)}catch(e){return BigInt(u.E$)}}}else if(0===this.frameType){this.latmFilter&&this.latmFilter.reset();const t=e.ioReader.getPos();return i<=BigInt(0)?i=this.firstFramePos:i>this.fileSize&&(i=this.fileSize),await e.ioReader.seek(i),this.currentPts=i,t}return BigInt(u.E$)}getAnalyzeStreamsCount(){return 1}}},85947:(e,t,i)=>{i.d(t,{A:()=>a});var r=i(49859);class a{constructor(){(0,r.A)(this,"type",-1),(0,r.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},19028:(e,t,i)=>{i.d(t,{In:()=>S,M9:()=>E,VO:()=>N,fz:()=>y,hm:()=>L,qg:()=>x});var r=i(52730),a=i.n(r),s=i(86226),n=i.n(s),o=i(18979),h=i.n(o),c=i(5496),d=i.n(c),f=i(64007),l=i.n(f),p=i(63939),u=i(50932),g=i(4624),m=i(50011),w=i(35336),b=i(31865),k=i(71517),B=i(37837),R=i(14686),I=i(72739),U=i(95335),P=i(92647);const T="src/avformat/formats/mp3/id3v2.ts",S={JPG:7,PNG:61,"image/gif":97,"image/jpeg":7,"image/jpg":7,"image/png":61,"image/tiff":96,"image/bmp":78,"image/webp":171},y=["Other","32x32 pixels 'file icon'","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];function A(e,t){e.writeUint8(t>>21&127),e.writeUint8(t>>14&127),e.writeUint8(t>>7&127),e.writeUint8(127&t)}function C(e,t){let i="utf-8";return 0===e?i="iso-8859-1":1===e?i="utf-16":2===e&&(i="utf-16be"),new TextDecoder(i).decode(t)}function M(e){return(127&e)+((32512&e)>>1)+((8323072&e)>>2)+((2130706432&e)>>3)}async function v(e,t){await e.seek(t);const i=await e.readString(4);return/^[A-Z0-9]+$/.test(i)}async function x(e,t,i,r){const s=2!==i.version,n=s?10:6;let o=e.getPos()+BigInt(0|t);async function h(){await e.skip(Number(BigInt.asIntN(32,o-e.getPos())))}if(s&&64&a()(i)){let r=await async function(e,t){let i=0;for(;t--;)i=(i<<7)+(127&await e.readUint8());return i}(e,4);if(4===i.version&&(r-=4),r<0)return g.z3("invalid extended header length",T,149),await h();if(await e.skip(r),(t-=r+4)<0)return g.z3("extended header too long",T,155),await h()}for(;t>n;){let o,h;if(s){if(o=await e.readString(4),h=await e.readUint32(),!h){g.z3("invalid frame size",T,168);break}if(4===i.version&&h>127)if(h<t){await e.flush();const t=e.getPos();if(!(1&a()(e)||6+h<e.remainingLength()))break;if(await v(e,t+BigInt(2)+BigInt(M(h))))h=M(h);else if(!await v(e,t+BigInt(2)+BigInt(h)))break;await e.seek(t)}else h=M(h);await e.readUint16()}else o=await e.readString(3),h=await e.readUint24();if("APIC"===o)r.apic||(r.apic=[]),r.apic.push(await e.readBuffer(h));else if("USLT"===o){const t=await e.readUint8(),i=await e.readString(3),a=await e.readBuffer(h-4);r.lyrics=`${i} ${C(t,a)}`}else if("COMM"===o||"COM"===o){const t=await e.readUint8(),i=await e.readString(3),a=await e.readBuffer(h-4);r.comment=`${i} ${C(t,a)}`}else if("PRIV"===o){const t=e.getPos(),i=[];for(;;){const t=await e.readUint8();if(0===t)break;i.push(t)}const a=m.decode(new Uint8Array(i));let s;s="com.apple.streaming.transportStreamTimestamp"===a?await e.readUint64():await e.readBuffer(h-Number(e.getPos()-t)),r[a]=s}else{let t;switch(t="T"===o[0]?C(await e.readUint8(),await e.readBuffer(h-1)):await e.readBuffer(h),o){case"TIT2":case"TT2":r.title=t;break;case"TPE1":case"TP1":r.artist=t;break;case"TPE2":case"TP2":r.albumArtist=t;break;case"TPOS":r.disc=t;break;case"TCOP":r.copyright=t;break;case"TALB":case"TAL":r.album=t;break;case"TRCK":case"TRK":r.track=t;break;case"TYER":case"TDRL":case"TDRC":r.date=t;break;case"COMM":case"COM":r.comment=t;break;case"TCON":case"TCO":r.genre=t;break;case"TSSE":case"TEN":r.encoder=t;break;case"TCOM":r.composer=t;break;case"TENC":r.vendor=t;break;case"TLAN":r.language=t;break;case"TPE3":case"TP3":r.performer=t;break;case"TPUB":r.publisher=t;break;case"TCMP":case"TCP":r.compilation=t;break;case"TDEN":r.creationTime=t;break;case"TSOA":r.albumSort=t;break;case"TSOP":r.artistSort=t;break;case"TSOT":r.titleSort=t;break;case"TIT1":r.grouping=t;break;default:r[o]=t}}t-=h+n}4==i.version&&16&a()(i)&&(o+=BigInt(10)),await e.skip(Number(BigInt.asIntN(32,o-e.getPos())))}function L(e,t,i){const r=2!==i.version;n()(t).call(t,(t=>{const i=new b.A(t),a=i.readUint8();let s;function n(){let e=Number(i.getPos());for(;e<t.length&&t[e];)e++;return e}if(r?(s=i.readString(n()-Number(i.getPos())),i.skip(1)):s=i.readString(3),!S[s])return;const o=i.readUint8();let h;const c=n()-Number(i.getPos());c&&(h=C(a,i.readBuffer(c))),i.skip(1);const d=e.createStream();d.codecpar.codecId=S[s],d.codecpar.codecType=0,d.disposition|=1024,d.attachedPic=(0,k._5)(),u.M[15](d.attachedPic+32,d.index);const f=i.remainingSize(),l=(0,B.sY)(f),g=i.readBuffer(f);(0,R.lW)(l,f,g),g.length>=8&&I.FB(g.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))&&(d.codecpar.codecId=61),(0,k.NX)(d.attachedPic,l,f),u.M[15](d.attachedPic+36,1|p.f[15](d.attachedPic+36)),d.metadata.comment=y[o],h&&(d.metadata.title=h)}))}function E(e,t,i,r){var a;let s=e.getPos();e.writeString("ID3"),e.writeUint8(t),e.writeUint16(0);const o=e.getPos();function c(i,r){const a=m.encode(r);e.writeString(i),4===t?A(e,a.length+1):e.writeUint32(a.length+1),e.writeUint16(0),e.writeUint8(3),e.writeBuffer(a)}function f(i,r){e.writeString(i),4===t?A(e,r.length):e.writeUint32(r.length),e.writeUint16(0),e.writeBuffer(r)}var l;if(e.writeUint32(0),r.poster&&f("APIC",r.poster),r.apic&&n()(l=r.apic).call(l,(e=>{f("APIC",e)})),r.title&&c("TIT2",r.title),r.artist&&c("TPE1",r.artist),r.albumArtist&&c("TPE2","albumArtist"),r.disc&&c("TPOS",r.disc),r.copyright&&c("TCOP",r.copyright),r.album&&c("TALB",r.album),r.track&&c("TRCK",r.track),r.date&&c("TDRC",r.date),r.comment){let e=r.comment;" "===e[3]&&(e=h()(e).call(e,0,3)+h()(e).call(e,4)),c("COMM",e)}if(r.lyrics){let e=r.lyrics;" "===e[3]&&(e=h()(e).call(e,0,3)+h()(e).call(e,4)),c("USLT",e)}r.genre&&c("TCON",r.genre+""),r.encoder&&c("TSSE",r.encoder),r.composer&&c("TCOM",r.composer),r.vendor&&c("TENC",r.vendor),r.language&&c("TLAN",r.language),r.performer&&c("TPE3",r.performer),r.publisher&&c("TPUB",r.publisher),r.compilation&&c("TCMP",r.compilation),r.creationTime&&c("TDEN",r.creationTime),r.albumSort&&c("TSOA",r.albumSort),r.artistSort&&c("TSOP",r.artistSort),r.titleSort&&c("TSOT",r.titleSort),r.grouping&&c("TIT1",r.grouping),i<10&&(i=10);const p=Number(BigInt.asIntN(32,e.getPos()-s));i>268435455-p&&(i=268435455-p),e.writeBuffer(d()(a=new Uint8Array(i)).call(a,0)),s=e.getPos(),e.seek(o),A(e,p),e.seek(s)}function N(e,t){var i;const r=[],a=new w.A,s=[];a.onFlush=e=>(s.push(h()(e).call(e)),0);const o=2!==t;return n()(i=e.streams).call(i,(e=>{if(1024&e.disposition&&(o&&(7===e.codecpar.codecId||61===e.codecpar.codecId||96===e.codecpar.codecId||97===e.codecpar.codecId||171===e.codecpar.codecId||78===e.codecpar.codecId)||!o&&(61===e.codecpar.codecId||7===e.codecpar.codecId))&&e.attachedPic){s.length=0,a.writeUint8(3),o?(a.writeString(U.BE(S)[e.codecpar.codecId]),a.writeUint8(0)):61===e.codecpar.codecId?a.writeString("PNG"):a.writeString("JPG");let t=0;e.metadata.comment&&l()(y).call(y,e.metadata.comment)>-1&&(t=l()(y).call(y,e.metadata.comment)),a.writeUint8(t),e.metadata.description&&a.writeString(e.metadata.description),a.writeUint8(0),a.writeBuffer((0,k.iI)(e.attachedPic)),a.flush(),r.push((0,P.A)(Uint8Array,s))}})),r}},95832:(e,t,i)=>{i.d(t,{Bq:()=>l,En:()=>h,Hm:()=>n,Ij:()=>f,XC:()=>d,_5:()=>c,f7:()=>p,hY:()=>o,uF:()=>s});var r=i(77231),a=i(37246);const s={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,r.N_,r.N_,r.N_],h=[r.N_,1,2,3,4,5,6,7];function c(e){let t=r.N_,i=r.N_,a=r.N_;return e.length>=2&&(t=e[0]>>3&31,i=o[(7&e[0])<<1|e[1]>>7],a=h[e[1]>>3&15]),{profile:t,sampleRate:i,channels:a}}function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:i,sampleRate:r,channels:a}=c(t);e.codecpar.profile=i,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=a,e.codecpar.frameSize=5===i?2048:1024,e.codecpar.format=8}}function f(e){const t=n[e.sampleRate],i=e.chLayout.nbChannels,a=e.profile===r.N_?2:e.profile,s=new Uint8Array(2);return s[0]=(31&a)<<3|(14&t)>>1,s[1]=(1&t)<<7|(15&i)<<3,s}function l(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const i=1&e[1],r=(192&e[2])>>>6,a=(60&e[2])>>>2,s=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,c=3&e[6];let d=1===i?7:9,f=n-d;return{syncWord:t,profile:r+1,sampleRate:o[a],channels:h[s],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:d,framePayloadLength:f}}function p(e,t){function i(){const e=t.readU(2);let i=0;for(let r=0;r<=e;r++)i<<=8,i|=t.readU(8);return i}t||(t=new a.A).appendBuffer(e);const r=t.getPointer(),s={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;s.syncWord=n,s.muxLengthBytes=t.readU(13);const c=1===t.readU1();if(s.useSameStreamMux=c,!c){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&i(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let r=e?i():0;const a=t.readU(5);r-=5;const n=t.readU(4);r-=4;const c=t.readU(4);if(r-=4,t.readU(3),r-=3,r>0&&t.readU(r),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)i();else{let e=0;for(;;){e<<=8;const i=1===t.readU1();if(e+=t.readU(8),!i)break}}1===t.readU1()&&t.readU(8),s.profile=a+1,s.sampleRate=o[n],s.channels=h[c]}let d=0;for(;;){const e=t.readU(8);if(d+=e,255!==e)break}return s.framePayloadLength=d,s.headerLength=t.getPointer()-r+(8===t.getBitLeft()?0:1),s}},35336:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(49859),a=i(50011);class s{constructor(e=1048576,t=!0,i){if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,i=(65280&e)>>8,r=255&e;this.littleEndian?(this.writeUint8(r),this.writeUint8(i),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(i),this.writeUint8(r))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let i=0;for(;t>0;){this.flush();const r=Math.min(this.size,t);this.buffer.set(e.subarray(i,i+r),this.pointer),this.pointer+=r,this.pos+=BigInt(r),i+=r,t-=r}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);