(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[378],{47344:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>m});var n=s(49859),r=s(11265),i=s.n(r),a=s(71426),c=s.n(a),l=s(50932),o=s(4624),u=s(9705),d=s(85947),h=s(14686),f=s(37837),g=s(71517),p=s(72739),B=s(50011),x=s(51785);const I="src/avformat/formats/IAssFormat.ts";class m extends d.A{constructor(){super(),(0,n.A)(this,"type",20),(0,n.A)(this,"queue",void 0),(0,n.A)(this,"index",void 0)}init(t){this.queue=[]}async readHeader(t){const e=await t.ioReader.readLine();if("[Script Info]"!==i()(e).call(e))return o.z3("the file format is not ass",I,68),u.LR;const s=t.createStream();s.codecpar.codecId=94230,s.codecpar.codecType=3,s.timeBase.den=1e3,s.timeBase.num=1;let n,r=e+"\n",a=!1,c=0,l=0;for(;;){const e=await t.ioReader.readLine();if(!/^;/.test(e)){if("[Events]"===i()(e).call(e)&&(a=!0),/^Format:/.test(e)&&a){r+=e,n=x.Bp(i()(e).call(e));for(let t=0;t<n.length;t++)"Start"===n[t]?c=t:"End"===n[t]&&(l=t);break}r+=e+"\n"}}const d=B.encode(r);s.codecpar.extradata=(0,f.sY)(d.length),s.codecpar.extradataSize=d.length,(0,h.lW)(s.codecpar.extradata,d.length,d),this.index=0;let g=BigInt(0);try{for(;;){var m;const e=t.ioReader.getPos(),r=i()(m=await t.ioReader.readLine()).call(m);if(/^;/.test(r)||/^Comment:/.test(r))continue;const{start:a,end:o}=x.Ew(n,r,c,l);s.nbFrames++,s.duration=o;const u={context:r,startTs:a,endTs:o,pos:e};a>=g?(this.queue.push(u),g=a):p._(this.queue,u,(t=>t.startTs<u.startTs?1:-1))}}catch(t){return 0}}async readAVPacket(t,e){var s;if(!this.queue.length)return u.LR;if(this.index>=this.queue.length)return-1048576;const n=c()(s=t.streams).call(s,(t=>3===t.codecpar.codecType)),r=this.queue[this.index++];l.M[15](e+32,n.index),l.M[15](e+76,n.timeBase.den),l.M[15](e+72,n.timeBase.num),l.M[17](e+16,r.startTs),l.M[17](e+8,r.startTs),l.M[17](e+48,r.endTs-r.startTs);const i=B.encode(r.context),a=(0,f.sY)(i.length);return(0,h.lW)(a,i.length,i),(0,g.NX)(e,a,i.length),0}async seek(t,e,s,n){if(2&n)return BigInt(u.E$);if(s<=BigInt(0))return this.index=0,BigInt(0);const r=p.El(this.queue,(t=>t.startTs>s?-1:1));if(r>=0){for(o.Yz(`seek in cues, found index: ${r}, pts: ${this.queue[r].startTs}, pos: ${this.queue[r].pos}`,I,217),this.index=Math.max(r-1,0);this.index>0&&(this.queue[this.index-1].startTs===this.queue[this.index].startTs||this.queue[this.index-1].endTs>s);)this.index--;return BigInt(0)}return BigInt(u.LR)}getAnalyzeStreamsCount(){return 1}}},85947:(t,e,s)=>{"use strict";s.d(e,{A:()=>r});var n=s(49859);class r{constructor(){(0,n.A)(this,"type",-1),(0,n.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},5028:(t,e,s)=>{"use strict";s.d(e,{Q:()=>n});const n=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},51785:(t,e,s)=>{"use strict";s.d(e,{Bp:()=>d,Ew:()=>h});var n=s(71426),r=s.n(n),i=s(18979),a=s.n(i),c=(s(48079),s(11265),s(96319),s(82895),s(4624)),l=s(5028),o=s(54825);const u="src/avformat/formats/ass/iass.ts";function d(t){return function(t,e){const s=e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),n=[];for(let e=0;e<s.length;e++){const i=r()(t).call(t,(t=>t.toLowerCase()===s[e].toLowerCase()));i||c.R8(`not support ass field(${s[e]})`,u,41),n.push(i||s[e])}return n}(l.Q,t)}function h(t,e,s,n){const[,,r]=e.match(/^(\w+?)\s*:\s*(.*)/i),i=function(t,e){let s=e.split(",");if(s.length>t.length){const e=a()(s).call(s,t.length-1).join(",");s=a()(s).call(s,0,t.length-1),s.push(e)}return s}(t,r);return{start:(0,o.j)(i[s]),end:(0,o.j)(i[n])}}},54825:(t,e,s)=>{"use strict";s.d(e,{j:()=>i,t:()=>a});var n=s(11265),r=s.n(n);function i(t){var e,s,n;if(!t)return-BigInt(1);let i=(t=r()(t).call(t)).split(":"),a=BigInt(0);var c;if(3===i.length&&(a+=BigInt(+r()(c=i.shift()).call(c))*BigInt(36e5)),a+=BigInt(+r()(e=i.shift()).call(e))*BigInt(6e4),i=r()(s=i.shift()).call(s).split("."),a+=BigInt(+r()(n=i.shift()).call(n))*BigInt(1e3),i.length){var l,o;let t=r()(l=i[0]).call(l).length,e=BigInt(+r()(o=i.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),a+=e}return a}function a(t){var e,s,n;if(!t)return-BigInt(1);let i=(t=r()(t).call(t)).split(":"),a=BigInt(0);var c;if(3===i.length&&(a+=BigInt(+r()(c=i.shift()).call(c))*BigInt(36e5)),a+=BigInt(+r()(e=i.shift()).call(e))*BigInt(6e4),i=r()(s=i.shift()).call(s).split(","),a+=BigInt(+r()(n=i.shift()).call(n))*BigInt(1e3),i.length){var l,o;let t=r()(l=i[0]).call(l).length,e=BigInt(+r()(o=i.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),a+=e}return a}},82895:(t,e,s)=>{t.exports=s(94740)},32347:(t,e,s)=>{"use strict";s(25671);var n=s(92046);t.exports=n.Number.isNaN},25671:(t,e,s)=>{"use strict";s(11091)({target:"Number",stat:!0},{isNaN:function(t){return t!=t}})},94740:(t,e,s)=>{"use strict";var n=s(32347);t.exports=n},null:()=>{},null:()=>{},null:()=>{"use strict";["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map((t=>({name:t,regex:new RegExp(`^${t}-?\\d`)})))},null:()=>{},null:()=>{}}]);