"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[597],{64436:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(49859),r=i(63939),n=(i(77162),i(37837)),s=i(71766);class o{constructor(){(0,a.A)(this,"inCodecpar",void 0),(0,a.A)(this,"inTimeBase",void 0),(0,a.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,n.Gy)(168),(0,s.Yi)(this.inCodecpar,t),this.inTimeBase={den:r.f[15](e+4),num:r.f[15](e)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},9848:(t,e,i)=>{i.d(e,{A:()=>p});var a=i(49859),r=i(63939),n=i(50932),s=i(64436),o=i(95832),c=i(14686),d=i(71517),l=i(37837),h=i(9705);class p extends s.A{constructor(...t){super(...t),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0)}init(t,e){return super.init(t,e),this.cache=(0,d._5)(),0}destroy(){super.destroy(),(0,d.Qe)(this.cache),this.cache=0,this.cached=!1}sendAVPacket(t){if(!r.f[20](t+24)||!r.f[15](t+28))return 0;const e=(0,d.rU)(t,1);if(e){const{profile:t,sampleRate:i,channels:a}=(0,o._5)((0,c.s3)(r.f[20](e),r.f[25](e+4)));n.M[15](this.inCodecpar+48,t),n.M[15](this.inCodecpar+136,i),n.M[15](this.inCodecpar+116,a)}const i=7+r.f[15](t+28),a=(0,l.sY)(i),s=(0,c.s3)(a,i);return s[0]=255,s[1]=240,s[1]|=8,s[1]|=1,s[2]=(r.f[15](this.inCodecpar+48)-1&3)<<6,s[2]|=(15&o.Hm[r.f[15](this.inCodecpar+136)])<<2,s[2]|=(4&r.f[15](this.inCodecpar+116))>>2,s[3]=(3&r.f[15](this.inCodecpar+116))<<6,s[3]|=s.length>>11&3,s[4]=s.length>>3&255,s[5]=(7&s.length)<<5,s[5]|=31,s[6]=252,s.set((0,c.s3)(r.f[20](t+24),r.f[15](t+28)),7),(0,d.zu)(this.cache,t),(0,d.NX)(this.cache,a,i),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,d.Up)(t),(0,d.rN)(t,this.cache),this.cached=!1,0):h.LT}reset(){return 0}}},60480:(t,e,i)=>{i.d(e,{A:()=>U});var a=i(49859),r=i(63939),n=i(50932),s=i(64436),o=i(95832),c=i(14686),d=i(71517),l=i(37837),h=i(9705),p=i(95335),u=i(83314);const f={mod:20},g=new Uint8Array([86,224,0]);class U extends s.A{constructor(t={}){super(),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0),(0,a.A)(this,"bitWriter",void 0),(0,a.A)(this,"counter",void 0),(0,a.A)(this,"options",void 0),this.options=p.X$({},f,t)}init(t,e){return super.init(t,e),this.cache=(0,d._5)(),this.cached=!1,this.counter=0,this.bitWriter=new u.A,0}destroy(){super.destroy(),(0,d.Qe)(this.cache),this.cache=0}writeHeader(){this.bitWriter.writeU1(0===this.counter?0:1),0===this.counter&&(this.bitWriter.writeU1(0),this.bitWriter.writeU1(1),this.bitWriter.writeU(6,0),this.bitWriter.writeU(4,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(5,r.f[15](this.inCodecpar+48)-1&31),this.bitWriter.writeU(4,15&o.Hm[r.f[15](this.inCodecpar+136)]),this.bitWriter.writeU(4,15&r.f[15](this.inCodecpar+116)),this.bitWriter.writeU(3,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(8,255),this.bitWriter.writeU1(0),this.bitWriter.writeU1(0)),this.counter++,this.counter%=this.options.mod}copyBytes(t){for(let e=0;e<t.length;e++)this.bitWriter.writeU(8,t[e])}sendAVPacket(t){if(!r.f[20](t+24)||!r.f[15](t+28))return 0;this.bitWriter.reset();const e=(0,d.rU)(t,1);if(e){const{profile:t,sampleRate:i,channels:a}=(0,o._5)((0,c.s3)(r.f[20](e),r.f[25](e+4)));n.M[15](this.inCodecpar+48,t),n.M[15](this.inCodecpar+136,i),n.M[15](this.inCodecpar+116,a),this.counter=0}this.writeHeader();let i=0;for(;i<=r.f[15](t+28)-255;i+=255)this.bitWriter.writeU(8,255);this.bitWriter.writeU(8,r.f[15](t+28)-i);const a=(0,c.s3)(r.f[20](t+24),r.f[15](t+28));129==(225&a[0])?(this.bitWriter.writeU(8,254&a[0]),this.copyBytes(a.subarray(1))):this.copyBytes(a),this.bitWriter.padding();const s=this.bitWriter.getPointer(),h=3+s,p=(0,l.sY)(h),u=(0,c.s3)(p,h);return u.set(g,0),u[1]|=s>>8&31,u[2]|=255&s,u.set(this.bitWriter.getBuffer().subarray(0,s),3),(0,d.zu)(this.cache,t),(0,d.NX)(this.cache,p,h),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,d.Up)(t),(0,d.rN)(t,this.cache),this.cached=!1,0):h.LT}reset(){return 0}}},52251:(t,e,i)=>{i.d(e,{A:()=>g});var a=i(49859),r=i(63939),n=i(50932),s=i(64436),o=i(71517),c=i(62815),d=i(67659),l=i(59166),h=i(9705),p=i(60264),u=i(4624),f=i(14686);class g extends s.A{constructor(...t){super(...t),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0),(0,a.A)(this,"naluLengthSizeMinusOne",void 0)}init(t,e){if(super.init(t,e),this.cache=(0,o._5)(),this.cached=!1,r.f[20](t+12)){const e=(0,f.s3)(r.f[20](t+12),r.f[15](t+16));(0,p.Bs)(e)||(27===r.f[15](t+4)?this.naluLengthSizeMinusOne=3&e[4]:173===r.f[15](t+4)?this.naluLengthSizeMinusOne=3&e[21]:196===r.f[15](t+4)&&(this.naluLengthSizeMinusOne=e[0]>>>1&3))}return 0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(64&r.f[15](t+36))(0,o.rN)(this.cache,t);else{let e;(0,o.zu)(this.cache,t);const i=(0,o.rU)(t,1);let a=null;i&&(a=(0,f.JW)(r.f[20](i),r.f[25](i+4)),(0,p.Bs)(a)||(27===r.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&a[4]:173===r.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&a[21]:196===r.f[15](this.inCodecpar+4)&&(this.naluLengthSizeMinusOne=a[0]>>>1&3)));const s=(0,f.JW)(r.f[20](t+24),r.f[15](t+28));27===r.f[15](this.inCodecpar+4)?e=c.OD(s,a,this.naluLengthSizeMinusOne):173===r.f[15](this.inCodecpar+4)?e=d.OD(s,a,this.naluLengthSizeMinusOne):196===r.f[15](this.inCodecpar+4)?e=l.OD(s,a,this.naluLengthSizeMinusOne):u.h2(`not support for codecId: ${r.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Avcc2AnnexbFilter.ts",121),n.M[15](this.cache+36,64|r.f[15](this.cache+36)),(0,o.NX)(this.cache,e.bufferPointer,e.length),e.key&&n.M[15](this.cache+36,1|r.f[15](this.cache+36))}return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,o.Up)(t),(0,o.rN)(t,this.cache),this.cached=!1,0):h.LR}reset(){return 0}}},77662:(t,e,i)=>{i.d(e,{A:()=>h});var a=i(49859),r=i(63939),n=i(64436),s=i(14686),o=i(71517),c=i(37837),d=i(9705),l=i(22576);class h extends n.A{constructor(...t){super(...t),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0),(0,a.A)(this,"opusPendingTrimStart",void 0)}init(t,e){return super.init(t,e),this.cache=(0,o._5)(),this.cached=!1,this.opusPendingTrimStart=48e3*(r.f[15](this.inCodecpar+148)>0?r.f[15](this.inCodecpar+148):0)/r.f[15](this.inCodecpar+136),0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(!r.f[20](t+24)||!r.f[15](t+28))return;const e=(0,s.s3)(r.f[20](t+24),r.f[15](t+28)),i=l.kt(e);let a=null;const n=(0,o.rU)(t,11);n&&(a=(0,s.s3)(r.f[20](n),r.f[25](n+4)));let d=0;a&&a.length>=10&&(d=48e3*(a[4]<<24|a[5]<<16|a[6]<<8|a[9])/r.f[15](this.inCodecpar+136));let h=e.length+2+e.length/255+1;this.opusPendingTrimStart&&(h+=2),d&&(h+=2);const p=(0,c.sY)(h),u=(0,s.s3)(p,h);u[0]=127,u[1]=224,this.opusPendingTrimStart&&(u[1]|=16),d&&(u[1]|=8);let f=e.length,g=2;do{u[g]=Math.min(f,255),f-=255,g++}while(f>=0);let U=0;return this.opusPendingTrimStart&&(U=Math.min(this.opusPendingTrimStart,i),u[g]=(65280&U)>>8,u[g+1]=255&U,g+=2,this.opusPendingTrimStart-=U),d&&(d=Math.min(d,i-U),u[g]=(65280&d)>>8,u[g+1]=255&d,g+=2),u.set(e,g),(0,o.zu)(this.cache,t),(0,o.NX)(this.cache,p,h),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,o.Up)(t),(0,o.rN)(t,this.cache),this.cached=!1,0):d.LR}reset(){return 0}}},51597:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(49859);class r{constructor(){(0,a.A)(this,"type",-1)}async destroy(t){}}(0,a.A)(r,"Capabilities",[])},15597:(t,e,i)=>{i.r(e),i.d(e,{default:()=>W});var a=i(49859),r=i(96319),n=i.n(r),s=i(18979),o=i.n(s),c=i(86226),d=i.n(c),l=i(61499),h=i(63939),p=(i(9599),i(97389)),u=i(6403),f=i(51597),g=i(30469),U=i(72739),w=i(95335),y=i(76538),A=i(9848),m=i(60480),I=i(77662),P=i(52251),b=i(77231),v=i(14686),F=i(44328),C=i(71517),k=i(37837),S=i(4624),x=i(60264),M=i(62815),D=i(67659),B=i(59166);const _="src/avformat/formats/OMpegtsFormat.ts",T={pesMaxSize:2930,delay:1.4,latm:!1,patPeriod:.1};class W extends f.A{constructor(t={}){super(),(0,a.A)(this,"type",2),(0,a.A)(this,"context",void 0),(0,a.A)(this,"sdtPacket",void 0),(0,a.A)(this,"patPacket",void 0),(0,a.A)(this,"pmtPacket",void 0),(0,a.A)(this,"options",void 0),(0,a.A)(this,"firstDtsCheck",void 0),(0,a.A)(this,"firstVideoCheck",void 0),(0,a.A)(this,"lastPatDst",void 0),(0,a.A)(this,"patPeriod",void 0),(0,a.A)(this,"avpacket",void 0),this.context=(0,p.A)(),this.options=w.X$({},T,t),this.options.pesMaxSize=this.options.pesMaxSize?(this.options.pesMaxSize+14+183)/184*184-14:0,this.firstDtsCheck=!1,this.firstVideoCheck=!1,this.patPeriod=BigInt(Math.floor(this.options.patPeriod*b.SF))}init(t){return t.ioWriter.setEndian(!0),this.avpacket=(0,C._5)(),0}async destroy(t){super.destroy(t),U.__(t.streams,(t=>{if(1024&t.disposition)return!0;const e=t.privData;n()(e)&&(n()(e).destroy(),e.filter=null)})),this.avpacket&&((0,C.Qe)(this.avpacket),this.avpacket=0)}writeHeader(t){var e;return this.context.pat=new u.Cd,this.context.pat.program2PmtPid.set(1,4096),this.context.pmt=new u.I4,this.context.pmt.programNumber=1,U.__(t.streams,(t=>{if(1024&t.disposition)return!0;t.timeBase.den=9e4,t.timeBase.num=1;const e=this.context.startPid++;this.context.pmt.pcrPid<=0&&(this.context.pmt.pcrPid=e);let i=g.Zp(t);const a=(0,y.A)();t.privData=a;const r=new u.am;r.pid=e,r.adaptationFieldControl=1,a.tsPacket=r,a.pid=e;let n=null;switch(i){case 15:this.options.latm?(a.latm=!0,i=17,n=new m.A):n=new A.A;break;case 27:case 36:case 51:n=new P.A;break;case 6:86076===t.codecpar.codecId&&(n=new I.A)}n&&n.init(t.codecpar[l.o9],t.timeBase[l.o9]),a.filter=n,this.context.pmt.pid2StreamType.set(e,i);const s=new u.xf;s.pid=e,s.streamType=i,s.streamId=g.kw(t),a.pes=s})),this.patPacket=new u.yU,this.pmtPacket=new u.yU,this.sdtPacket=new u.yU,this.sdtPacket.pid=17,this.sdtPacket.adaptationFieldControl=1,this.patPacket.pid=0,this.patPacket.adaptationFieldControl=1,this.pmtPacket.pid=4096,this.pmtPacket.adaptationFieldControl=1,this.sdtPacket.payload=g.Gj(),this.patPacket.payload=g.sG(this.context.pat),this.pmtPacket.payload=g.in(this.context.pmt,n()(e=t.streams).call(e,(t=>!(1024&t.disposition)))),g.Zn(t.ioWriter,this.sdtPacket,this.context),g.Zn(t.ioWriter,this.patPacket,this.context),g.Zn(t.ioWriter,this.pmtPacket,this.context),0}writeAVPacket(t,e){if(!h.f[15](e+28))return void S.R8(`packet's size is 0: ${h.f[15](e+32)}, ignore it`,_,234);const i=t.getStreamByIndex(h.f[15](e+32));if(!i||1024&i.disposition)return void S.R8(`can not found the stream width the packet's streamIndex: ${h.f[15](e+32)}, ignore it`,_,241);this.firstDtsCheck||((0,F.Mr)(h.f[17](e+16),e+72,i.timeBase)<BigInt(Math.floor(9e4*this.options.delay))&&(this.context.delay=BigInt(Math.floor(9e4*this.options.delay))-(0,F.Mr)(h.f[17](e+16),e+72,i.timeBase)),this.firstDtsCheck=!0,this.lastPatDst=(0,F.Mr)(h.f[17](e+16),e+72,b.KR)),this.patPeriod>BigInt(0)&&(0,F.Mr)(h.f[17](e+16),e+72,b.KR)-this.lastPatDst>this.patPeriod&&(g.Zn(t.ioWriter,this.sdtPacket,this.context),g.Zn(t.ioWriter,this.patPacket,this.context),g.Zn(t.ioWriter,this.pmtPacket,this.context),this.lastPatDst=(0,F.Mr)(h.f[17](e+16),e+72,b.KR));const a=i.privData;let r=(0,C.iI)(e);if(n()(a)){if(!this.firstVideoCheck&&(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId)&&1&h.f[15](e+36)){let t=(0,C.fQ)(e,1);if(!t&&64&h.f[15](e+36)&&(27===i.codecpar.codecId?t=!!M.sL((0,C.iI)(e)):173===i.codecpar.codecId?t=!!D.sL((0,C.iI)(e)):196===i.codecpar.codecId&&(t=!!B.sL((0,C.iI)(e)))),this.firstVideoCheck=!0,!t&&i.codecpar.extradata)if(64&h.f[15](e+36)){var s;let t=o()(s=(0,v.s3)(i.codecpar.extradata,i.codecpar.extradataSize)).call(s);if(27!==i.codecpar.codecId||M.sL((0,C.iI)(e)))if(173!==i.codecpar.codecId||D.sL((0,C.iI)(e))){if(196===i.codecpar.codecId&&!B.sL((0,C.iI)(e))){var c;let i=[],a=[],r=[];const n=[];if(x.Bs(t)){var l;d()(l=x.py(t)).call(l,(t=>{const e=t[1]>>>3&31;14===e?r.push(t):15===e?i.push(t):16===e&&a.push(t)}))}else{const e=B.HL(t);i=e.spss,a=e.ppss,r=e.vpss}d()(c=x.py((0,C.iI)(e,!0))).call(c,(t=>{20!=(t[1]>>>3&31)&&n.push(t)}));const s=B.wA(r,i,a,n,!!(1&h.f[15](e+36)));(0,C.NX)(e,s.bufferPointer,s.length)}}else{var p;let i=[],a=[],r=[];const n=[];if(x.Bs(t)){var u;d()(u=x.py(t)).call(u,(t=>{const e=t[0]>>>1&63;32===e?r.push(t):33===e?i.push(t):34===e&&a.push(t)}))}else{const e=D.HL(t);i=e.spss,a=e.ppss,r=e.vpss}d()(p=x.py((0,C.iI)(e,!0))).call(p,(t=>{35!=(t[0]>>>1&63)&&n.push(t)}));const s=D.wA(r,i,a,n);(0,C.NX)(e,s.bufferPointer,s.length)}else{var f;let i=[],a=[],r=[];const n=[],s=[];if(x.Bs(t)){var U;d()(U=x.py(t)).call(U,(t=>{const e=31&t[0];7===e?i.push(t):8===e?a.push(t):13===e&&r.push(t)}))}else{const e=M.MB(t);i=e.spss,a=e.ppss,r=e.spsExts}d()(f=x.py((0,C.iI)(e,!0))).call(f,(t=>{const e=31&t[0];6===e?n.push(t):9!==e&&s.push(t)}));const o=M.wA(i,a,r,n,s);(0,C.NX)(e,o.bufferPointer,o.length)}}else{var w;let t=o()(w=(0,v.s3)(i.codecpar.extradata,i.codecpar.extradataSize)).call(w);x.Bs(t)&&(27===i.codecpar.codecId?t=M.S1(t):173===i.codecpar.codecId?t=D.S1(t):196===i.codecpar.codecId&&(t=B.S1(t)));const a=(0,k.sY)(t.length);(0,v.lW)(a,t.length,t),(0,C.Ow)(e,1,a,t.length)}}n()(a).sendAVPacket(e),n()(a).receiveAVPacket(this.avpacket),r=(0,C.iI)(this.avpacket),e=this.avpacket}if(!r.length)return 0;r=o()(r).call(r);let y=!1;return(a.pesSlices.total+r.length>this.options.pesMaxSize||0===i.codecpar.codecType)&&(0===a.pesSlices.total&&(a.pesSlices.total=r.length,a.pesSlices.buffers.push(r),h.f[17](e+16)!==b.Dh&&(a.pes.dts=(0,F.Mr)(h.f[17](e+16),e+72,i.timeBase)+this.context.delay),h.f[17](e+8)!==b.Dh&&(a.pes.pts=(0,F.Mr)(h.f[17](e+8),e+72,i.timeBase)+this.context.delay),0!==i.codecpar.codecType||1&h.f[15](e+36)?a.pes.randomAccessIndicator=1:a.pes.randomAccessIndicator=0,y=!0),g.CE(t.ioWriter,a.pes,a.pesSlices,i,this.context),a.pesSlices.total=0,a.pesSlices.buffers=[]),y||(0===a.pesSlices.total&&(h.f[17](e+16)!==b.Dh&&(a.pes.dts=(0,F.Mr)(h.f[17](e+16),e+72,i.timeBase)+this.context.delay),h.f[17](e+8)!==b.Dh&&(a.pes.pts=(0,F.Mr)(h.f[17](e+8),e+72,i.timeBase)+this.context.delay),0!==i.codecpar.codecType||1&h.f[15](e+36)?a.pes.randomAccessIndicator=1:a.pes.randomAccessIndicator=0),a.pesSlices.total+=r.length,a.pesSlices.buffers.push(r)),0}writeTrailer(t){return U.__(t.streams,(e=>{const i=e.privData;i&&(i.pesSlices.total&&g.CE(t.ioWriter,i.pes,i.pesSlices,e,this.context),i.pesSlices.total=0,i.pesSlices.buffers=[])})),t.ioWriter.flush(),0}flush(t){return t.ioWriter.flush(),0}getCapabilities(){return W.Capabilities}}(0,a.A)(W,"Capabilities",[86076,86018,86017,86019,,86020,86065,86056,12,225,27,173,196])},50762:(t,e,i)=>{function a(t){let e=4294967295;for(let i=0;i<t.length;i++){e^=t[i]<<24;for(let t=0;t<8;t++)2147483648&e?e=e<<1^79764919:e<<=1}return e>>>0}i.d(e,{E:()=>a})},97389:(t,e,i)=>{i.d(e,{A:()=>o});var a=i(74707),r=i.n(a),n=i(77231),s=i(6403);function o(){return{currentProgram:n.N_,currentPmtPid:n.N_,tsPacketSize:n.N_,hasPAT:!1,hasPMT:!1,tsSliceQueueMap:new(r()),pat:new s.Cd,pmt:new s.I4,program2Pmt:new(r()),ioEnd:!1,startPid:256,delay:BigInt(0)}}},76538:(t,e,i)=>{i.d(e,{A:()=>r});var a=i(77231);function r(){return{pid:a.N_,filter:null,tsPacket:null,pes:null,pendingPES:null,continuityCounter:0,pesSlices:{total:0,buffers:[]},latm:!1}}},27274:(t,e,i)=>{i.d(e,{$x:()=>h,GV:()=>s,OS:()=>d,VG:()=>r,ZT:()=>n,eR:()=>a,hY:()=>c,pm:()=>o,qJ:()=>l});const a=204,r=192,n=188,s=204,o=8192,c=5,d=5,l=10,h={15:[1,86018],17:[1,86018],3:[1,86017],4:[1,86017],1:[0,2],2:[0,2],27:[0,27],16:[0,12],36:[0,173],51:[0,196],129:[1,86019],135:[1,86056],130:[1,86020]}},30469:(t,e,i)=>{i.d(e,{CE:()=>b,Gj:()=>m,Zn:()=>v,Zp:()=>U,in:()=>A,kw:()=>w,sG:()=>y});var a=i(86226),r=i.n(a),n=i(18979),s=i.n(n),o=i(63939),c=i(27274),d=i(4624),l=i(65977),h=i(92647),p=i(77231),u=i(50762);const f="src/avformat/formats/mpegts/ompegts.ts";function g(t){if(2!==t.adaptationFieldControl&&3!==t.adaptationFieldControl)return 0;if(2===t.adaptationFieldControl)return c.ZT-4;let e=2;return t.adaptationFieldInfo.pcrFlag&&(e+=6),t.adaptationFieldInfo.opcrFlag&&(e+=6),t.adaptationFieldInfo.splicingPointFlag&&(e+=1),t.adaptationFieldInfo.transportPrivateDataFlag&&(e+=t.adaptationFieldInfo.transportPrivateData?t.adaptationFieldInfo.transportPrivateData.length:0),t.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e+=t.adaptationFieldInfo.extension?t.adaptationFieldInfo.extension.length:0),e>256&&d.R8("adaptationField size is too large",f,68),e}function U(t){const e=t.privData||{};switch(t.codecpar.codecId){case 1:case 2:return 2;case 12:return 16;case 27:return 27;case 87:return 66;case 173:return 36;case 196:return 51;case 116:return 209;case 70:return 234;case 86016:case 86017:return t.codecpar.sampleRate<32e3?4:3;case 86018:return e.latm?17:15;case 86065:return 17;case 86019:return 129;case 86076:case 225:case 94209:case 98311:default:return 6;case 86060:return 131;case 86056:return 135;case 86020:return 130}}function w(t){return 0===t.codecpar.codecType?116===t.codecpar.codecId?253:224:1!==t.codecpar.codecType||86016!==t.codecpar.codecId&&86017!==t.codecpar.codecId&&86018!==t.codecpar.codecId?1===t.codecpar.codecType&&86019===t.codecpar.codecId?253:2===t.codecpar.codecType?252:189:192}function y(t){var e;const i=new Uint8Array(1024);i[1]=0,i[2]=176,i[5]=1,i[6]=193;let a=9;t.networkPid>-1&&(a+=2,i[a++]=224|t.networkPid>>8&31,i[a++]=255&t.networkPid),r()(e=t.program2PmtPid).call(e,((t,e)=>{i[a++]=e>>8&255,i[a++]=255&e,i[a++]=224|t>>8&31,i[a++]=255&t}));const n=a;a+=4;for(let t=a;t<c.ZT-4;t++)i[t]=255;const o=a-1-3;i[2]|=o>>8&15,i[3]=255&o;const d=(0,u.E)(i.subarray(1,n));return i[n]=d>>24&255,i[n+1]=d>>16&255,i[n+2]=d>>8&255,i[n+3]=255&d,s()(i).call(i,0,c.ZT-4)}function A(t,e){const i=new Uint8Array(1024);i[1]=2,i[2]=176,i[4]=t.programNumber>>8&15,i[5]=255&t.programNumber,i[6]=193;let a=9;i[a++]=224|t.pcrPid>>8&31,i[a++]=255&t.pcrPid;const r=a;function n(t){i[a++]=c.OS,i[a++]=4,i[a++]=t>>24,i[a++]=t>>16,i[a++]=t>>8,i[a++]=t}a+=2;let d=61440|a-r-2;i[r]=d>>8,i[r+1]=d;for(let t=0;t<e.length;t++){const r=U(e[t]);i[a++]=r;const s=e[t].privData;i[a++]=224|s.pid>>8&31,i[a++]=255&s.pid;const d=a;a+=2;const h=e[t].codecpar.codecId;switch(e[t].codecpar.codecType){case 1:86019===h&&n((0,l.A)("AC-3")),86056===h&&n((0,l.A)("EAC3")),65562===h&&n((0,l.A)("BSSD")),86076===h&&(n((0,l.A)("Opus")),i[a++]=127,i[a++]=2,i[a++]=128,i[a++]=e[t].codecpar.chLayout.nbChannels),i[a++]=c.qJ,i[a++]=4,i[a++]=117,i[a++]=110,i[a++]=100,i[a++]=0;break;case 0:if(225===h&&(n((0,l.A)("AV01")),e[t].codecpar.extradata)){i[a++]=128,i[a++]=e[t].codecpar.extradataSize;for(let r=0;r<e[t].codecpar.extradataSize;r++)i[a++]=o.f[2](e[t].codecpar.extradata+r)}}let p=61440|a-d-2;i[d]=p>>8,i[d+1]=p}const h=a;a+=4;for(let t=a;t<c.ZT-4;t++)i[t]=255;d=a-1-3,i[2]|=d>>8&15,i[3]=255&d;const p=(0,u.E)(i.subarray(1,h));return i[h]=p>>24&255,i[h+1]=p>>16&255,i[h+2]=p>>8&255,i[h+3]=255&p,s()(i).call(i,0,c.ZT-4)}function m(){const t=new Uint8Array(1024);t[1]=66,t[2]=240,t[5]=1,t[6]=193;let e=9;t[e++]=255,t[e++]=1,t[e++]=255,t[e++]=0,t[e++]=1,t[e++]=252;const i=e;e+=2,t[e++]=72;const a=e++;t[e++]=1;t[e++]=9;for(let i=0;i<9;i++)t[e]="format-js".charCodeAt(i),e++;t[e++]=9;for(let i=0;i<9;i++)t[e]="Service01".charCodeAt(i),e++;t[a]=e-a-1;let r=32768|e-i-2;t[i]=r>>8&255,t[i+1]=255&r;const n=e;e+=4;for(let i=e;i<c.ZT-4;i++)t[i]=255;const o=e-1-3;t[2]|=o>>8&15,t[3]=255&o;const d=(0,u.E)(t.subarray(1,n));return t[n]=d>>24&255,t[n+1]=d>>16&255,t[n+2]=d>>8&255,t[n+3]=255&d,s()(t).call(t,0,c.ZT-4)}function I(t,e,i){var a;i.tsPacketSize===c.VG&&t.skip(4),e.payload&&0!==e.payload.length||(e.adaptationFieldControl=2),1===e.adaptationFieldControl&&e.payload.length+4<c.ZT&&(e.adaptationFieldControl=3);const r=t.getPos();t.writeUint8(71);let n=0;e.payloadUnitStartIndicator&&(n|=64),n|=e.transportPriority<<5,n|=e.pid>>8,t.writeUint8(n),t.writeUint8(255&e.pid),n=(3&e.transportScramblingControl)<<6,n|=(3&e.adaptationFieldControl)<<4,n|=15&e.continuityCounter,t.writeUint8(n);let s=g(e),o=c.ZT-4-s;if(null!==(a=e.payload)&&void 0!==a&&a.length&&(o-=e.payload.length),2===e.adaptationFieldControl||3===e.adaptationFieldControl){const i=t.getPos();if(t.writeUint8(s-1+o),n=(1&e.adaptationFieldInfo.discontinuityIndicator)<<7,n|=(1&e.adaptationFieldInfo.randomAccessIndicator)<<6,n|=(1&e.adaptationFieldInfo.elementaryStreamPriorityIndicator)<<5,n|=(1&e.adaptationFieldInfo.pcrFlag)<<4,n|=(1&e.adaptationFieldInfo.opcrFlag)<<3,n|=(1&e.adaptationFieldInfo.splicingPointFlag)<<2,n|=(1&e.adaptationFieldInfo.transportPrivateDataFlag)<<1,n|=1&e.adaptationFieldInfo.adaptationFieldExtensionFlag,t.writeUint8(n),e.adaptationFieldInfo.pcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),a=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(a>>25&255),t.writeUint8(a>>17&255),t.writeUint8(a>>9&255),t.writeUint8(a>>1&255),t.writeUint8(a<<7|i>>8|126),t.writeUint8(i)}if(e.adaptationFieldInfo.opcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),a=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(a>>25&255),t.writeUint8(a>>17&255),t.writeUint8(a>>9&255),t.writeUint8(a>>1&255),t.writeUint8(a<<7|i>>8|126),t.writeUint8(i)}e.adaptationFieldInfo.splicingPointFlag&&t.writeUint8(e.adaptationFieldInfo.spliceCountDown),e.adaptationFieldInfo.transportPrivateDataFlag&&(e.adaptationFieldInfo.transportPrivateData&&e.adaptationFieldInfo.transportPrivateData.length?(t.writeUint8(e.adaptationFieldInfo.transportPrivateData.length),t.writeBuffer(e.adaptationFieldInfo.transportPrivateData)):t.writeUint8(0)),e.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e.adaptationFieldInfo.extension&&e.adaptationFieldInfo.extension.length?(t.writeUint8(e.adaptationFieldInfo.extension.length),t.writeBuffer(e.adaptationFieldInfo.extension)):t.writeUint8(0));const a=Number(t.getPos()-i);for(a<s&&t.skip(s-a);o>0;)t.writeUint8(255),o--}var l;1!==e.adaptationFieldControl&&3!==e.adaptationFieldControl||null!==(l=e.payload)&&void 0!==l&&l.length&&t.writeBuffer(e.payload),Number(t.getPos()-r)!==c.ZT&&d.z3(`write error data size to ts packet, need ${c.ZT}, wrote: ${Number(t.getPos()-r)}`,f,641),i.tsPacketSize===c.eR&&t.skip(16)}function P(t,e,i,a){let r=i<<4|(7&Number(a>>BigInt(30)))<<1|1;t[e++]=r,r=(32767&Number(a>>BigInt(15)))<<1|1,t[e++]=r>>8&255,t[e++]=255&r,r=Number(a&BigInt(32767))<<1|1,t[e++]=r>>8&255,t[e++]=255&r}function b(t,e,i,a,r){const n=e.streamId,s=new Uint8Array(function(t){let e=6;const i=t.streamId;return 188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i&&(e+=3,t.pts!==p.Dh&&(e+=5),t.dts!==p.Dh&&t.pts!==p.Dh&&t.dts!==t.pts&&(e+=5)),e}(e));s[2]=1,s[3]=n;let o=i.total;if(188!==n&&190!==n&&191!==n&&240!==n&&241!==n&&255!==n&&242!==n&&248!==n){let t=0,i=0;e.pts!==p.Dh&&(i+=5,t|=128),e.dts!==p.Dh&&e.pts!==p.Dh&&e.dts!==e.pts&&(i+=5,t|=64);let r=128;3!==a.codecpar.codecType&&2!==a.codecpar.codecType||(r|=4),s[6]=r,s[7]=t,s[8]=i,o+=i+3,e.pts!==p.Dh&&P(s,9,t>>6,e.pts),e.dts!==p.Dh&&e.pts!==p.Dh&&e.dts!==e.pts&&P(s,14,1,e.dts)}o<=p.zg&&0!==a.codecpar.codecType&&(s[4]=o>>8&255,s[5]=255&o),function(t,e,i,a,r){const n=a.privData,s=n.tsPacket;e.pid===r.pmt.pcrPid&&(s.adaptationFieldControl=3,s.adaptationFieldInfo.pcrFlag=1,s.adaptationFieldInfo.pcr=e.dts*BigInt(300)),s.adaptationFieldInfo.randomAccessIndicator=e.randomAccessIndicator,e.randomAccessIndicator&&(s.adaptationFieldControl=3);let o=g(s),d=n.continuityCounter;if(4+o+i.length<=c.ZT)return s.payloadUnitStartIndicator=1,s.payload=i,s.continuityCounter=d++%16,I(t,s,r),void(n.continuityCounter=d%16);let l=c.ZT-(4+o),h=0;for(;h<i.length;){let e=Math.min(h+l,i.length);s.payloadUnitStartIndicator=0===h?1:0,1===s.adaptationFieldControl&&e-h+4==c.ZT-1&&e--,s.payload=i.subarray(h,e),s.continuityCounter=d++%16,I(t,s,r),0===h&&(s.adaptationFieldInfo.randomAccessIndicator=0,s.adaptationFieldControl=1,s.adaptationFieldInfo.pcrFlag=0,o=g(s),l=c.ZT-(4+o)),h=e}n.continuityCounter=d%16}(t,e,(0,h.A)(Uint8Array,[s,...i.buffers]),a,r)}function v(t,e,i){const a=g(e);let r=e.continuityCounter;if(4+a+e.payload.length<=c.ZT)return e.payloadUnitStartIndicator=1,e.continuityCounter=r++%16,I(t,e,i),void(e.continuityCounter=r%16);const n=c.ZT-(4+a);let s=0;const o=e.payload;for(;s<o.length;){let d=Math.min(s+n,o.length);e.payloadUnitStartIndicator=0===s?1:0;const l=d-s;l+4===c.ZT?e.adaptationFieldControl=1:0===a&&l+4+1===c.ZT&&d--,e.payload=o.subarray(s,d),e.continuityCounter=r++%16,I(t,e,i),s=d}e.continuityCounter=r%16}},6403:(t,e,i)=>{i.d(e,{Cd:()=>l,I4:()=>u,am:()=>c,kJ:()=>p,pi:()=>d,xf:()=>f,yU:()=>h});var a=i(49859),r=i(74707),n=i.n(r),s=i(77231);class o{constructor(){(0,a.A)(this,"discontinuityIndicator",0),(0,a.A)(this,"randomAccessIndicator",0),(0,a.A)(this,"elementaryStreamPriorityIndicator",0),(0,a.A)(this,"pcrFlag",0),(0,a.A)(this,"opcrFlag",0),(0,a.A)(this,"splicingPointFlag",0),(0,a.A)(this,"transportPrivateDataFlag",0),(0,a.A)(this,"adaptationFieldExtensionFlag",0),(0,a.A)(this,"pcr",BigInt(0)),(0,a.A)(this,"opcr",BigInt(0)),(0,a.A)(this,"spliceCountDown",0),(0,a.A)(this,"transportPrivateData",null),(0,a.A)(this,"extension",null)}}class c{constructor(){(0,a.A)(this,"pos",s.Dh),(0,a.A)(this,"payloadUnitStartIndicator",0),(0,a.A)(this,"transportPriority",0),(0,a.A)(this,"pid",s.N_),(0,a.A)(this,"adaptationFieldControl",0),(0,a.A)(this,"continuityCounter",0),(0,a.A)(this,"transportScramblingControl",0),(0,a.A)(this,"adaptationFieldInfo",new o),(0,a.A)(this,"payload",null)}}class d{constructor(){(0,a.A)(this,"slices",[]),(0,a.A)(this,"totalLength",0),(0,a.A)(this,"expectedLength",s.N_),(0,a.A)(this,"randomAccessIndicator",0),(0,a.A)(this,"pid",s.N_),(0,a.A)(this,"streamType",0),(0,a.A)(this,"pos",s.Dh)}}class l{constructor(){(0,a.A)(this,"versionNumber",0),(0,a.A)(this,"networkPid",s.N_),(0,a.A)(this,"program2PmtPid",new(n()))}}class h extends c{}class p{constructor(){(0,a.A)(this,"tag",void 0),(0,a.A)(this,"buffer",void 0)}}class u{constructor(){(0,a.A)(this,"versionNumber",0),(0,a.A)(this,"programNumber",0),(0,a.A)(this,"pcrPid",0),(0,a.A)(this,"pid2StreamType",new(n())),(0,a.A)(this,"pid2ESDescriptor",new(n()))}}class f{constructor(){(0,a.A)(this,"pid",s.N_),(0,a.A)(this,"streamType",0),(0,a.A)(this,"streamId",s.N_),(0,a.A)(this,"dts",s.Dh),(0,a.A)(this,"pts",s.Dh),(0,a.A)(this,"pos",s.Dh),(0,a.A)(this,"payload",null),(0,a.A)(this,"data",null),(0,a.A)(this,"randomAccessIndicator",0),(0,a.A)(this,"flags",void 0)}}},65977:(t,e,i)=>{i.d(e,{A:()=>n});var a=i(4624);const r="src/avformat/function/mktag.ts";function n(t){4!==t.length&&a.R8(`tag length is not 4, tag: ${t}`,r,30);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},22576:(t,e,i)=>{i.d(e,{Ij:()=>d,XC:()=>c,kt:()=>o});var a=i(31865),r=i(729),n=i(44328);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,i=0,a=0;if(t.length<1)return 0;switch(e=t[0],i=s[e>>3],3&e){case 0:a=1;break;case 1:case 2:a=2;break;case 3:if(t.length<2)return 0;a=63&t[1]}return a*i}function c(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const i=new a.A(e,!1);i.skip(9),t.codecpar.chLayout.nbChannels=i.readUint8(),t.codecpar.initialPadding=i.readUint16(),t.codecpar.sampleRate=i.readUint32(),t.codecpar.seekPreroll=Number((0,n.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(t){const e=new Uint8Array(19),i=new r.A(e,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(t.chLayout.nbChannels),i.writeUint16(t.initialPadding),i.writeUint32(t.sampleRate),e}},59166:(t,e,i)=>{i.d(e,{HL:()=>D,KD:()=>O,OD:()=>z,S1:()=>_,Ui:()=>E,XC:()=>Z,kM:()=>N,oT:()=>W,sL:()=>T,wA:()=>L,wf:()=>V});var a=i(5496),r=i.n(a),n=i(73363),s=i.n(n),o=i(86226),c=i.n(o),d=i(96319),l=i.n(d),h=i(11393),p=i.n(h),u=i(31721),f=i.n(u),g=i(54810),U=i.n(g),w=i(63939),y=i(72739),A=i(729),m=i(31865),I=i(37246),P=i(14686),b=i(60264),v=i(37837),F=i(23991),C=i(83314),k=i(39381),S=i(82774);const x=3;function M(t){const e=t.readU(9),i=t.readU(3),a=t.readU(2),r=t.readU(2),n=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),c=t.readU(1),d=t.readU(8),l=t.readU(1),h=t.readU(1),p=[],u=[];if(s){for(let e=0;e<s-1;e++)p[e]=t.readU(8);p[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let a=i-2;a>=0;--a)e|=t.readU(1)<<a;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let a=i-2;a>=0;--a)e&1<<a&&(u[a]=t.readU(8))}const f=t.readU(8),g=[];if(f)for(let e=0;e<f;e++)g.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:n,chromaFormatIdc:r,constantFrameRate:a,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:h,generalConstraintInfo:p,sublayerLevelIdc:u,generalSubProfileIdc:g,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function D(t){const e=new m.A(t,!0);if(1&e.readUint8()){const i=new I.A;i.appendBuffer(t.subarray(1)),M(i),e.skip(i.getPointer())}let i=[],a=[],r=[];const n=e.readUint8();for(let t=0;t<n;t++){const t=31&e.readUint8();let n=1;13!==t&&12!==t&&(n=e.readUint16());const s=[];for(let t=0;t<n;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?a=s:16===t&&(r=s)}return{vpss:i,spss:a,ppss:r}}function B(t,e,i){const a=e[0];let n;if(a){const t=V(a);let e=t.generalConstraintInfo;var o;e.length||(e=r()(o=new Array(12)).call(o,0));const i=new C.A;if(i.writeU(9,0),i.writeU(3,t.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,t.chromaFormatIdc),i.writeU(3,t.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,e.length),i.writeU(7,t.profile),i.writeU1(t.tierFlag),i.writeU(8,t.level),i.writeU1(t.ptlFrameOnlyConstraintFlag),i.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)i.writeU(8,e[t]);i.writeU(6,e[e.length-1])}else i.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)e=e<<1|t.ptlSublayerLevelPresentFlag[i];i.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)i.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&i.writeU(8,t.sublayerLevelIdc[e])}i.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)i.writeU(8,t.sublayerLevelIdc[e]);i.writeU(16,t.width),i.writeU(16,t.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let c=2+(n?n.length:0);t.length&&(c+=3,c=s()(t).call(t,((t,e)=>t+2+e.length),c)),e.length&&(c+=3,c=s()(e).call(e,((t,e)=>t+2+e.length),c)),i.length&&(c+=3,c=s()(i).call(i,((t,e)=>t+2+e.length),c));const d=new Uint8Array(c),l=new A.A(d,!0);l.writeUint8(x<<1|(n?1:0)|248),n&&l.writeBuffer(n);let h=0;return t.length&&h++,e.length&&h++,i.length&&h++,l.writeUint8(h),t.length&&(l.writeUint8(142),l.writeUint16(t.length),y.__(t,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),e.length&&(l.writeUint8(143),l.writeUint16(e.length),y.__(e,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),i.length&&(l.writeUint8(144),l.writeUint16(i.length),y.__(i,(t=>{l.writeUint16(t.length),l.writeBuffer(t)}))),d}function _(t){let e=b.py(t);if(e.length>=2){const t=[],i=[],a=[];if(c()(e).call(e,(e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&a.push(e)})),i.length&&a.length)return B(t,i,a)}}function T(t){let e=b.py(t);if(e.length>=2){const t=[],i=[],a=[];if(c()(e).call(e,(e=>{const r=e[1]>>>3&31;14===r?t.push(e):15===r?i.push(e):16===r&&a.push(e)})),i.length&&a.length){const e=[i[0],a[0]];return t.length&&e.unshift(t[0]),b.nW(e,0)}}}function W(t,e=!1){let i,a=!1,r=b.py(t);if(r.length){const t=[],n=[],s=[];c()(r).call(r,(e=>{const i=e[1]>>>3&31;14===i?t.push(e):15===i?n.push(e):16===i&&s.push(e),8!==i&&7!==i&&9!==i&&10!==i||(a=!0)})),n.length&&s.length?(i=B(t,n,s),r=l()(r).call(r,(t=>{const i=t[1]>>>3&31;return(e||14!==i&&15!==i&&16!==i)&&20!==i}))):r=l()(r).call(r,(t=>20!=(t[1]>>>3&31)))}const n=s()(r).call(r,((t,e)=>t+x+1+e.length),0),o=(0,v.sY)(n),d=(0,P.s3)(o,n);return b.S9(r,x,d),{bufferPointer:o,length:n,extradata:i,key:a}}function L(t,e,i,a,r){const n=[b.Le(t,0),b.Le(e,0),b.Le(i,0),b.Le(a,2)];let o=s()(n).call(n,((t,e)=>t+e),0);const c=(0,v.sY)(o+7);let d=c;return S.w8((d+=1,d-1),0),S.w8((d+=1,d-1),0),S.w8((d+=1,d-1),0),S.w8((d+=1,d-1),1),S.w8((d+=1,d-1),0),S.w8((d+=1,d-1),161),S.w8((d+=1,d-1),(r?1:0)<<7|40),t.length&&(b.nW(t,0,(0,P.s3)(d,n[0])),d+=n[0]),e.length&&(b.nW(e,0,(0,P.s3)(d,n[1])),d+=n[1]),i.length&&(b.nW(i,0,(0,P.s3)(d,n[2])),d+=n[2]),a.length&&b.nW(a,2,(0,P.s3)(d,n[3])),{bufferPointer:c,length:o+7}}function N(t,e){var i;let a=p()(i=b.py(t)).call(i,b.py(e));if(a.length){let t=[],e=[],i=[],r=[];return c()(a).call(a,(a=>{const n=a[1]>>>3&31;14===n?t.push(a):15===n?e.push(a):16===n?i.push(a):20!==n&&r.push(a)})),L(t,e,i,r,!0)}}function z(t,e,i=x){var a;e&&(i=e[0]>>>1&3);let r=[],n=[],s=[],o=!1;if(e){const t=D(e);r=t.vpss,n=t.spss,s=t.ppss,o=!0}const d=l()(a=b.wN(t,i)).call(a,(t=>20!=(t[1]>>>3&31))),h=[];return c()(d).call(d,(t=>{const e=t[1]>>>3&31;15!==e||n.length?16!==e||s.length?20!==e&&h.push(t):s.push(t):n.push(t),8!==e&&7!==e||(o=!0)})),{...L(r,n,s,h,o),key:o}}function Z(t,e){let i;if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&b.Bs(e))y.__(b.py(e),(t=>{if(15==(t[1]>>>3&31))return i=t,!1}));else if(e&&e.length>=6){const{spss:t}=D(e);t.length&&(i=t[0])}i&&function(t,e){const{profile:i,level:a,width:r,height:n,videoDelay:s,chromaFormatIdc:o,bitDepthMinus8:c}=V(e);switch(t.codecpar.profile=i,t.codecpar.level=a,t.codecpar.width=r,t.codecpar.height=n,t.codecpar.videoDelay=s,c){case 0:t.codecpar.format=3===o?5:2===o?4:0;break;case 2:t.codecpar.format=3===o?68:2===o?64:62}}(t,i)}function O(t,e=4){if(64&w.f[15](t+36)){let e=b.py((0,P.s3)(w.f[20](t+24),w.f[15](t+28)));return f()(e).call(e,(t=>{const e=t[1]>>>3&31;return 8===e||7===e}))}{const i=w.f[15](t+28);let a=0;for(;a<i-e;){const i=k.r8(w.f[20](t+24)+(a+e+1))>>>3&31;if(8===i||7===i)return!0;a+=4===e?k.Sg(w.f[20](t+24)+a):3===e?k.ht(w.f[20](t+24)+a):2===e?k.yd(w.f[20](t+24)+a):k.r8(w.f[20](t+24)+a),a+=e}return!1}}function V(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,a=0,r=0,n=0,s=0,o=1,c=0,d=0,l=0;const h=[],p=[],u=[],f=[],g=b.BN(t.subarray(e)),w=new I.A(g.length);w.appendBuffer(g),w.readU1(),w.readU1(),w.readU(6),w.readU(5),w.readU(3),w.readU(8);const y=w.readU(3);o=w.readU(2);const A=w.readU(2);if(w.readU(1)){if(i=w.readU(7),c=w.readU(1),a=w.readU(8),d=w.readU(1),l=w.readU(1),w.readU(1)){for(let t=0;t<8;t++)h[t]=w.readU(8);h[8]=w.readU(7);const t=w.readU(8);w.readU(t)}w.skipPadding();for(let t=y-1;t>=0;t--)p[t]=w.readU(1);w.skipPadding();for(let t=y-1;t>=0;t--)p[t]&&(u[t]=w.readU(8));const t=w.readU(8);if(t)for(let e=0;e<t;e++)f[e]=w.readU(32)}w.readU1(),w.readU1()&&w.readU1();const m=r=F.xb(w),P=n=F.xb(w);if(w.readU1()&&(F.xb(w),F.xb(w),F.xb(w),F.xb(w)),w.readU1()){const t=F.xb(w),e=A+5,i=1<<e,a=m/(1<<e),r=P/(1<<e),n=Math.ceil(U()(a)),s=Math.ceil(U()(r));let o=0,c=0,d=0;t>0&&(d=w.readU1(),c=w.readU1());for(let e=0;t>0&&e<=t;e++)c&&0!=e||(e>0&&m>i&&w.readU(n),e>0&&P>i&&w.readU(s),e<t&&m>i&&w.readU(n),e<t&&P>i&&w.readU(s)),d||w.readU(2);if(o=F.xb(w)+1,w.readU(1)&&w.readU(1))for(let e=0;e<=t;e++)w.readU(o)}s=F.xb(w),w.readU(1),w.readU(1);const v=w.readU(4),C=w.readU(1);let k=0;C&&(k=F.xb(w));const S=[],x=w.readU(2);for(let t=0;t<8*x;t++)S[t]=w.readU(1);return{profile:i,level:a,width:r,height:n,videoDelay:y+1>2?2:y,chromaFormatIdc:o,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:c,generalConstraintInfo:h,generalSubProfileIdc:f,ptlFrameOnlyConstraintFlag:d,ptlMultilayerEnabledFlag:l,spsMaxSublayersMinus1:y,ptlSublayerLevelPresentFlag:p,sublayerLevelIdc:u,sps_log2_max_pic_order_cnt_lsb_minus4:v,sps_poc_msb_cycle_flag:C,sps_poc_msb_cycle_len_minus1:k,sps_num_extra_ph_bytes:x,sps_extra_ph_bit_present_flag:S}}function E(t){b.Bs(t)&&(t=_(t));const e=new I.A;return e.appendBuffer(t),1&e.readU(8)?M(e):{}}}}]);