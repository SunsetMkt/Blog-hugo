"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[773],{28773:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var i=a(49859),r=a(18979),o=a.n(r),n=a(48079),s=a.n(n),c=a(52730),d=a.n(c),l=a(94870),h=a.n(l),f=a(14686),p=a(61499),u=a(63939),m=a(50932),g=(a(9599),a(58121)),w=a(68243),U=a(4624),I=a(35028),R=a(62815),v=a(95832),k=a(67659),M=a(59166),b=a(21477),B=a(82014),y=a(97077),A=a(14769),D=a(22576),x=a(87518),C=a(64093),P=a(9705),S=a(85947),L=a(37837),T=a(71517),F=a(65977),N=a(44328),z=a(77231),E=a(72739),$=a(52071),V=a(34677),_=a(73040),X=(a(55833),a(99991)),O=a(67672);const Y="src/avformat/formats/IFlvFormat.ts";class W extends S.A{constructor(e={}){super(),(0,i.A)(this,"type",0),(0,i.A)(this,"header",void 0),(0,i.A)(this,"script",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"firstTagPos",void 0),this.header=new g.A,this.script=new w.A,this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{if("FLV"!==await e.ioReader.peekString(3))return U.z3("the file format is not flv",Y,120),P.LR;await this.header.read(e.ioReader),0!==await e.ioReader.readUint32()&&U.R8("the previousTagSize0 is not 0",Y,127);let t=0;if(18===await e.ioReader.peekUint8()){await e.ioReader.skip(1);const a=await e.ioReader.readUint24();await e.ioReader.skip(7),t=await this.script.read(e.ioReader,a)}return t>=0&&(this.firstTagPos=e.ioReader.getPos()),t}catch(t){return U.z3(t.message,Y,145),e.ioReader.error}}async readModEx(e,t,a){let i=await e.ioReader.readUint8()+1;256===i&&(i=await e.ioReader.readUint16()+1);const r=await e.ioReader.readBuffer(i),o=await e.ioReader.readUint8(),n=240&o;if(0===n&&0===a||0===n&&1===a){let e=0;3===r.length?(e=r[0]<<16|r[1]<<8|r[2],this.options.useNanoTimestamp?m.M[17](t+16,u.f[17](t+16)+BigInt(e)):m.M[17](t+16,u.f[17](t+16)+BigInt(e)/BigInt(1e6)),m.M[17](t+8,u.f[17](t+16))):U.R8(`Invalid ModEx size for Type TimestampOffsetNano!, need 3 but got ${r.length}`,Y,178)}else U.R8(`unknown ModEx type: ${n}`,Y,182);return 15&o}async readCodecConfigurationRecord(e,t,a,i){const r=(0,L.sY)(i);var n;t.codecpar.extradata?((0,T.Ow)(a,1,r,i),await e.ioReader.readBuffer(i,(0,f.JW)(r,i))):(t.codecpar.extradata=r,t.codecpar.extradataSize=i,await e.ioReader.readBuffer(i,(0,f.JW)(r,i)),t.sideData[1]=o()(n=(0,f.s3)(r,i)).call(n),27===t.codecpar.codecId?R.XC(t):173===t.codecpar.codecId?k.XC(t):196===t.codecpar.codecId?M.XC(t):225===t.codecpar.codecId?b.XC(t):167===t.codecpar.codecId?B.XC(t):139===t.codecpar.codecId?y.XC(t):86018===t.codecpar.codecId?v.XC(t):86028===t.codecpar.codecId?A.XC(t):86076===t.codecpar.codecId&&D.XC(t))}async readAVPacketData(e,t,a,i){const r=(0,L.sY)(i);(0,T.NX)(a,r,i),await e.ioReader.readBuffer(i,(0,f.JW)(r,i))}parseColorInfo(e,t,a){let i=!1,r=!1;if(a.hdrMdcv&&(i=a.hdrMdcv.redX>0&&a.hdrMdcv.redY>0&&a.hdrMdcv.blueX>0&&a.hdrMdcv.blueY>0&&a.hdrMdcv.greenX>0&&a.hdrMdcv.greenY>0&&a.hdrMdcv.whitePointX>0&&a.hdrMdcv.whitePointY>0,r=a.hdrMdcv.maxLuminance>0&&a.hdrMdcv.minLuminance>0),3!==a.colorConfig.matrixCoefficients&&(e.codecpar.colorSpace=a.colorConfig.matrixCoefficients),3!==a.colorConfig.colorPrimaries&&0!==a.colorConfig.colorPrimaries&&(e.codecpar.colorPrimaries=a.colorConfig.colorPrimaries),3!==a.colorConfig.transferCharacteristics&&0!==a.colorConfig.transferCharacteristics&&(e.codecpar.colorTrc=a.colorConfig.transferCharacteristics),a.hdrCll&&a.hdrCll.maxCLL&&a.hdrCll.maxFall){const o=(0,L.Gy)(8);m.M[8](o,a.hdrCll.maxCLL),m.M[8](o+4,a.hdrCll.maxFall),(0,T.sn)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,22)?(0,T.Ow)(t,22,o,8):(0,T.$W)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,22,o,8)}if(r||i){const n=(0,L.Gy)(88);function s(e,t){const a=(0,N.j2)(t,z.go);m.M[15](e+4,a.den),m.M[15](e,a.num)}r&&(m.M[15](n+84,1),s(n+72,a.hdrMdcv.maxLuminance),s(n+64,a.hdrMdcv.minLuminance)),i&&(m.M[15](n+80,1),s(n,a.hdrMdcv.redX),s(n+8,a.hdrMdcv.redY),s(n+16,a.hdrMdcv.greenX),s(n+16+8,a.hdrMdcv.greenY),s(n+32,a.hdrMdcv.blueX),s(n+32+8,a.hdrMdcv.blueY)),(0,T.sn)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,20)?(0,T.Ow)(t,20,n,88):(0,T.$W)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,20,n,88)}}findStream(e,t,a){for(let i=0;i<e.streams.length;i++)if(e.streams[i].codecpar.codecType===t){const t=e.streams[i].privData;if(t&&t.trackId===a)return e.streams[i]}}createStream(e,t,a,i){var r;const o=e.createStream();o.codecpar.codecType=t,o.timeBase.den=this.options.useNanoTimestamp?z.H3:z.qs,o.timeBase.num=1,o.startTime=u.f[17](a+8);const n={trackId:i};var s,c,d;if(o.privData=n,null!==(r=this.script.onMetaData)&&void 0!==r&&r.duration&&(o.duration=(0,N.k)(BigInt(Math.floor(1e3*this.script.onMetaData.duration)),z.i0,o.timeBase)),0===t)(null===(s=this.script.onMetaData)||void 0===s?void 0:s.width)>0&&(o.codecpar.width=this.script.onMetaData.width),(null===(c=this.script.onMetaData)||void 0===c?void 0:c.height)>0&&(o.codecpar.height=this.script.onMetaData.height),null!==(d=this.script.onMetaData)&&void 0!==d&&null!==(d=d.videoTrackIdInfoMap)&&void 0!==d&&d[i]&&(this.script.onMetaData.videoTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.videoTrackIdInfoMap[i].title),this.script.onMetaData.videoTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.videoTrackIdInfoMap[i].lang),this.script.onMetaData.videoTrackIdInfoMap[i].width>0&&(o.codecpar.width=this.script.onMetaData.videoTrackIdInfoMap[i].width),this.script.onMetaData.videoTrackIdInfoMap[i].height>0&&(o.codecpar.height=this.script.onMetaData.videoTrackIdInfoMap[i].height),this.script.onMetaData.videoTrackIdInfoMap[i].duration>0&&(o.duration=(0,N.k)(BigInt(1e3*this.script.onMetaData.videoTrackIdInfoMap[i].duration),z.i0,o.timeBase)));else if(1===t){var l;null!==(l=this.script.onMetaData)&&void 0!==l&&null!==(l=l.audioTrackIdInfoMap)&&void 0!==l&&l[i]&&(this.script.onMetaData.audioTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.audioTrackIdInfoMap[i].title),this.script.onMetaData.audioTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.audioTrackIdInfoMap[i].lang),this.script.onMetaData.audioTrackIdInfoMap[i].duration>0&&(o.duration=(0,N.k)(BigInt(1e3*this.script.onMetaData.audioTrackIdInfoMap[i].duration),z.i0,o.timeBase)))}return this.onStreamAdd&&this.onStreamAdd(o),o}async readAVPacket_(e,t){const a=e.ioReader.getPos();m.M[17](t+56,a);let i=!1;const r=31&await e.ioReader.readUint8();let o=await e.ioReader.readUint24(),n=await e.ioReader.readUint24();const c=await e.ioReader.readUint8();if(c&&(n|=c<<24),m.M[17](t+16,this.options.useNanoTimestamp?(0,N.k)(BigInt(Math.floor(n)),z.i0,z.FQ):BigInt(Math.floor(n))),m.M[17](t+8,u.f[17](t+16)),await e.ioReader.skip(3),8===r){m.M[15](t+36,1|u.f[15](t+36));const r=await e.ioReader.readUint8();o--;const n=(240&r)>>4;if(9===n){let n=!1,c=15&r;for(;7===c;){let a=e.ioReader.getPos();c=await this.readModEx(e,t,1),o-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let d=0,l=0;if(5===c){n=!0;const t=await e.ioReader.readUint8();o--,l=(240&t)>>4,c=15&t,2!==l&&(d=await e.ioReader.readUint32(),o-=4)}else d=await e.ioReader.readUint32(),o-=4;let h=t;for(;;){let r=o,g=0;n&&(2===l&&(d=await e.ioReader.readUint32(),o-=4),g=await e.ioReader.readUint8(),o--,0!==l?(r=await e.ioReader.readUint24(),o-=3):r=o);let w=this.findStream(e,1,g);if(w||(w=this.createStream(e,1,h,g),d===(0,F.A)("ac-3")?w.codecpar.codecId=86019:d===(0,F.A)("ec-3")?w.codecpar.codecId=86056:d===(0,F.A)("Opus")?(w.codecpar.codecId=86076,w.codecpar.sampleRate=48e3):d===(0,F.A)(".mp3")?w.codecpar.codecId=86017:d===(0,F.A)("fLaC")?w.codecpar.codecId=86028:d===(0,F.A)("mp4a")?w.codecpar.codecId=86018:(U.R8(`unknown codec fourcc(${d.toString(16)})`,Y,511),w.codecpar.codecId=0)),m.M[15](h+32,w.index),o-=r,4===c){const t=await e.ioReader.readUint8(),a=await e.ioReader.readUint8();if(r-=2,(0,X.bl)(w.codecpar[p.o9]+112),2===t){(0,X.xY)(w.codecpar[p.o9]+112,a);for(let t=0;t<a;t++){const a=await e.ioReader.readUint8();r--,a<18?m.M[15](s()(w.codecpar.chLayout.u)+24*t,a):a>=18&&a<=23?m.M[15](s()(w.codecpar.chLayout.u)+24*t,a-18+35):254===a?m.M[15](s()(w.codecpar.chLayout.u)+24*t,512):m.M[15](s()(w.codecpar.chLayout.u)+24*t,768)}}else if(1===t){let t=BigInt(await e.ioReader.readUint32());r-=4,t=t&BigInt(262143)|(t&BigInt(16515072))<<BigInt(35)-BigInt(18),(0,X.ML)(w.codecpar[p.o9]+112,t)}i=!0}else if(0===c)r?(await this.readCodecConfigurationRecord(e,w,h,r),r=0,i=!1,(0,T.fQ)(t,1)||(i=!0)):i=!0;else if(2===c)m.M[15](h+36,32|u.f[15](h+36)),i=!1;else if(1===c){if(await this.readAVPacketData(e,w,h,r),(86019===w.codecpar.codecId||86056===w.codecpar.codecId||86017===w.codecpar.codecId)&&w.codecpar.sampleRate===z.N_)if(86019===w.codecpar.codecId||86056===w.codecpar.codecId){const e=x.R((0,T.iI)(h));O.ai(e)||(w.codecpar.sampleRate=e.sampleRate,w.codecpar.chLayout.nbChannels=e.channels,w.codecpar.bitrate=BigInt(e.bitrate))}else 86017===w.codecpar.codecId&&C.XC(w,(0,T.iI)(h));i=!1,r=0}else U.R8(`invalid audioPacketType ${c}`,Y,593);if(r&&await e.ioReader.skip(r),h===t||i||e.interval.packetBuffer.push(h),!n||0===l||!o)break;h=(0,T._5)(),m.M[17](h+56,a),(0,f.Mr)(h+72,t+72,8),m.M[17](h+16,u.f[17](t+16)),m.M[17](h+8,u.f[17](t+8)),m.M[15](h+36,1|u.f[15](h+36))}}else{let a=this.findStream(e,1,0);if(!a){if(a=this.createStream(e,1,t,0),a.disposition|=1,a.codecpar.chLayout.nbChannels=1&~r?1:2,a.codecpar.sampleRate=44100<<((12&r)>>>2)>>3,a.codecpar.bitsPerCodedSample=2&r?16:8,0===n)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else if(3===n)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else{var d;a.codecpar.codecId=null!==(d=I.FJ[n])&&void 0!==d?d:0}86051===a.codecpar.codecId?(a.codecpar.sampleRate=16e3,a.codecpar.chLayout.nbChannels=1):65543!==a.codecpar.codecId&&65542!==a.codecpar.codecId||(a.codecpar.sampleRate=8e3)}m.M[15](t+32,a.index),86018===a.codecpar.codecId&&(o--,0===await e.ioReader.readUint8()&&(this.readCodecConfigurationRecord(e,a,t,o),o=0,(0,T.fQ)(t,1)||(i=!0))),o&&(await this.readAVPacketData(e,a,t,o),o=0)}}else if(9===r){const r=await e.ioReader.readUint8(),n=128&r,s=(112&r)>>4;if(o--,1===s&&m.M[15](t+36,1|u.f[15](t+36)),n){let n=!0,c=!1,d=15&r;for(;7===d;){let a=e.ioReader.getPos();d=await this.readModEx(e,t,0),o-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let l=0,h=0;if(4!==d&&5===s)n=!1,i=!0;else if(6===d){c=!0;const t=await e.ioReader.readUint8();o--,h=(240&t)>>4,d=15&t,2!==h&&(l=await e.ioReader.readUint32(),o-=4)}else l=await e.ioReader.readUint32(),o-=4;let p=t;for(;n;){let r=o,n=0;c&&(2===h&&(l=await e.ioReader.readUint32(),o-=4),n=await e.ioReader.readUint8(),o--,0!==h?(r=await e.ioReader.readUint24(),o-=3):r=o);let g=this.findStream(e,0,n);if(g||(g=this.createStream(e,0,p,n),l===(0,F.A)("avc1")?g.codecpar.codecId=27:l===(0,F.A)("hvc1")?g.codecpar.codecId=173:l===(0,F.A)("vvc1")?g.codecpar.codecId=196:l===(0,F.A)("av01")?g.codecpar.codecId=225:l===(0,F.A)("vp09")?g.codecpar.codecId=167:l===(0,F.A)("vp08")&&(g.codecpar.codecId=139)),m.M[15](p+32,g.index),o-=r,4===d){const t=e.ioReader.getPos()+BigInt(Math.floor(r)),a=await _.$x(e.ioReader,t),o=await _.$x(e.ioReader,t);"colorInfo"===a?this.parseColorInfo(g,p,o):U.R8(`unknown metadata key ${a}`,Y,770),e.ioReader.getPos()<t&&await e.ioReader.seek(t),i=!0,r=0}else if(0===d)r?(await this.readCodecConfigurationRecord(e,g,p,r),r=0,i=!1,(0,T.fQ)(t,1)||(i=!0)):i=!0;else if(2===d)m.M[15](p+36,32|u.f[15](p+36)),i=!1;else if(5===d)225===g.codecpar.codecId?(await this.readCodecConfigurationRecord(e,g,p,r-2),i=!1,r=0,(0,T.fQ)(t,1)||(i=!0)):i=!0;else if(1===d||3===d){if(1===d&&(173===g.codecpar.codecId||196===g.codecpar.codecId||27===g.codecpar.codecId)){const a=await e.ioReader.readInt24();m.M[17](p+8,u.f[17](p+16)+(this.options.useNanoTimestamp?(0,N.FP)(BigInt(0|a),z.i0,t+72):BigInt(0|a))),r-=3}await this.readAVPacketData(e,g,p,r),r=0,i=!1}else U.R8(`invalid videoPacketType ${d}`,Y,829);if(r&&await e.ioReader.skip(r),i||p===t||e.interval.packetBuffer.push(p),!c||0===h||!o)break;p=(0,T._5)(),m.M[17](p+56,a),(0,f.Mr)(p+72,t+72,8),m.M[17](p+16,u.f[17](t+16)),m.M[17](p+8,u.f[17](t+8)),1===s&&m.M[15](p+36,1|u.f[15](p+36))}}else if(5!==s){let a=this.findStream(e,0,0);var l;if(a||(a=this.createStream(e,0,t,0),a.disposition|=1,a.codecpar.codecId=null!==(l=I.U5[15&r])&&void 0!==l?l:0),m.M[15](t+32,a.index),27===a.codecpar.codecId||173===a.codecpar.codecId||196===a.codecpar.codecId||12===a.codecpar.codecId){const r=await e.ioReader.readUint8(),n=await e.ioReader.readInt24();o-=4,m.M[17](t+8,u.f[17](t+16)+(this.options.useNanoTimestamp?(0,N.FP)(BigInt(0|n),z.i0,t+72):BigInt(0|n))),0===r?(await this.readCodecConfigurationRecord(e,a,t,o),(0,T.fQ)(t,1)||(i=!0)):2===r?m.M[15](t+36,32|u.f[15](t+36)):await this.readAVPacketData(e,a,t,o)}else await this.readAVPacketData(e,a,t,o);o=0}else i=!0}else{if(18===r){let a=await this.script.read(e.ioReader,o);return a<0?a:await this.readAVPacket_(e,t)}if(15!==r)return U.R8(`invalid tag type: ${r}, try to sync to next tag`,Y,915),await this.syncTag(e),this.readAVPacket_(e,t);U.R8("not support script tag encoded by amf3, ignore it",Y,912)}o&&await e.ioReader.skip(o);const h=e.ioReader.getPos()-a,g=BigInt(Math.floor(await e.ioReader.readUint32()));return h!==g&&U.R8(`tag ${r} size not match, size: ${h}, previousTagSize: ${g}`,Y,928),i?this.readAVPacket_(e,t):0}async readAVPacket(e,t){try{return m.M[15](t+76,this.options.useNanoTimestamp?z.H3:z.qs),m.M[15](t+72,1),await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(U.z3(`read packet error, ${t}`,Y,946),P.LR):e.ioReader.error}}async syncTag(e){let t=z.Dh;for(;;)try{if(8&d()(e.ioReader))break;const a=await e.ioReader.readUint8();if(8===a||9===a){t=e.ioReader.getPos()-BigInt(1);const a=await e.ioReader.readUint24();if(a>10485760){await e.ioReader.seek(t+BigInt(1));continue}if(await e.ioReader.skip(4),0!==await e.ioReader.readUint24()){await e.ioReader.seek(t+BigInt(1));continue}await e.ioReader.skip(a);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32()))){await e.ioReader.seek(t+BigInt(1)),t=z.Dh;continue}{let a=0;for(;a<=3;){const t=e.ioReader.getPos(),i=await e.ioReader.readUint8();if(8!==i&&9!==i&&18!==i)break;{const i=await e.ioReader.readUint24();await e.ioReader.skip(7+i);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32())))break;a++}}if(!(a<3))break;await e.ioReader.seek(t+BigInt(1)),t=z.Dh}}}catch(e){break}t!==z.Dh&&await e.ioReader.seek(t)}async seek(e,t,a,i){const r=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(a),4&i||await this.syncTag(e),r;var o,n;if(t&&t.sampleIndexes.length){let i=E.El(t.sampleIndexes,(e=>e.pts>a?-1:1));if(i>0&&(0,N.k)(a-t.sampleIndexes[i-1].pts,t.timeBase,z.i0)<BigInt(1e4))return U.Yz(`seek in sampleIndexes, found index: ${i}, pts: ${t.sampleIndexes[i-1].pts}, pos: ${t.sampleIndexes[i-1].pos}`,Y,1053),await e.ioReader.seek(t.sampleIndexes[i-1].pos),r}if(this.script.canSeek()){const{pos:i,dts:o}=this.script.dts2Position(Number((0,N.k)(a,t.timeBase,z.i0)/BigInt(1e3)));if(i>0){U.Yz(`seek in filepositions, found pts: ${o}, pos: ${i}`,Y,1062),await e.ioReader.seek(BigInt(Math.floor(i)));const t=await e.ioReader.peekUint8();return 8!==t&&9!==t&&18!==t&&await this.syncTag(e),r}}return U.Yz("not found any keyframe index, try to seek in bytes",Y,1072),(0,$.A)(e,t,a,this.firstTagPos,h()(o=this.readAVPacket).call(o,this),h()(n=this.syncTag).call(n,this))}getAnalyzeStreamsCount(){let e=0;return(this.header.hasAudio||(0,V.A)(this.script.onMetaData.audiocodecid))&&e++,(this.header.hasVideo||(0,V.A)(this.script.onMetaData.videocodecid))&&e++,e}}},85947:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(49859);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},58121:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(49859),r=a(52730),o=a.n(r);class n{constructor(){(0,i.A)(this,"signature",void 0),(0,i.A)(this,"version",void 0),(0,i.A)(this,"flags",void 0),(0,i.A)(this,"dataOffset",void 0),(0,i.A)(this,"hasVideo",void 0),(0,i.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&o()(this)),this.hasVideo=!!(1&o()(this))}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(o()(this)),e.writeUint32(this.dataOffset)}}},68243:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(49859),r=a(18979),o=a.n(r),n=a(35336),s=a(92647),c=a(4624),d=a(94889),l=a(9705),h=a(73040);class f{constructor(){(0,i.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const a=e.getPos(),i=a+BigInt(Math.floor(t)),r=await(0,h.$x)(e,i),o=await(0,h.$x)(e,i);this[r]=o,i>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,i-e.getPos())));const n=Number(e.getPos()-a),s=await e.readUint32();return n+11!==s?(c.R8(`script size not match, size: ${n+11}, previousTagSize: ${s}`,"src/avformat/formats/flv/FlvScriptTag.ts",63),l.LR):0}computeSize(){const e=[],t=new n.A;return t.onFlush=t=>(e.push(o()(t).call(t)),0),(0,h.bD)(t,"onMetaData"),(0,h.bD)(t,this.onMetaData),t.flush(),(0,s.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],a=new n.A;a.onFlush=e=>(t.push(o()(e).call(e)),0),(0,h.bD)(a,"onMetaData"),(0,h.bD)(a,this.onMetaData),a.flush();const i=(0,s.A)(Uint8Array,t);d.M5(e,18,BigInt(0),void 0,i)}}dts2Position(e){if(this.canSeek()){let t=-1;const a=this.onMetaData.keyframes.times,i=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<a.length;r++){if(a[r]===e){t=r;break}if(a[r]>e){t=Math.max(r-1,0);break}}return r&&r===a.length&&(t=a.length-1),{pos:i[t],dts:a[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let a=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let o=0;for(o=0;o<r.length;o++)if(r[o]>e){a=o;break}var t;return o===r.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:i[i.length-1]:i[a]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(e,t,a)=>{a.d(t,{FJ:()=>r,FV:()=>i,Tf:()=>n,U5:()=>o});const i={65541:0,65536:3,86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,12:9,4:2,86:3,92:4,106:5,131:6},r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},o={7:27,12:173,9:12,2:4,3:86,4:92,5:106,6:131},n={27:"avc1",173:"hvc1",196:"vvc1",139:"vp08",167:"vp09",225:"av01",86019:"ac-3",86056:"ec-3",86076:"Opus",86028:"fLaC",86017:".mp3",86018:"mp4a"}},94889:(e,t,a)=>{a.d(t,{C$:()=>l,M5:()=>d,Q4:()=>h,zk:()=>f});var i=a(35028),r=a(44328),o=a(77231),n=a(65977),s=a(67672);function c(e,t,a){const i=e.getPos(),r=e.getPointer(),o=i-BigInt(Math.floor(r));t<i&&t>=o?(e.seekInline(r+Number(t-i)),e.writeUint24(a),e.seekInline(r)):(e.seek(t),e.writeUint24(a),e.seek(i))}function d(e,t,a,i,r,o){e.flush(),e.writeUint8(t);const n=e.getPos();e.writeUint24(0),e.writeUint24(Number(a&BigInt(16777215))),e.writeUint8(Number(a>>BigInt(24)&BigInt(255))),e.writeUint24(0);const d=e.getPos();i&&i(e),s.Pc(r)?(r(e),c(e,n,Number(e.getPos()-d))):r&&(c(e,n,r.length+Number(e.getPos()-d)),e.writeBuffer(r));const l=Number(e.getPos()-n)+1;o&&o(l),e.writeUint32(l)}function l(e){return 86018!==e&&27!==e&&86017!==e&&12!==e&&!!i.Tf[e]}function h(e,t,a,s,c,d,l,h,f=0){const p=t.privData;let u=s?128:0;if(u|=(1&d?1:2)<<4,s){if(a.enableNanoTimestamp&&h){const t=(0,r.Mr)(l,h,o.FQ)-(0,r.Mr)(l,h,o.i0)*BigInt(1e6);t&&(u|=7,e.writeUint8(u),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),u=0)}a.multiVideoTracks&&(u|=6,e.writeUint8(u),u=0),u|=c,e.writeUint8(u),e.writeUint32((0,n.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(p.trackId),1===c&&e.writeInt24(f)}else u|=15&i.FV[t.codecpar.codecId],e.writeUint8(u),27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&12!==t.codecpar.codecId||(e.writeUint8(c),e.writeInt24(f))}function f(e,t,a,s,c,d,l){const h=t.privData;let f=(s?9:15&i.FV[t.codecpar.codecId])<<4;if(s){if(a.enableNanoTimestamp){const t=(0,r.Mr)(d,l,o.FQ)-(0,r.Mr)(d,l,o.i0)*BigInt(1e6);t&&(f|=7,e.writeUint8(f),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),f=0)}a.multiVideoTracks&&(f|=5,e.writeUint8(f),f=0),f|=c,e.writeUint8(f),e.writeUint32((0,n.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(h.trackId)}else(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(f|=1),65541!==t.codecpar.codecId&&(f|=2),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?f|=12:t.codecpar.sampleRate>=22e3?f|=8:t.codecpar.sampleRate>=11e3&&(f|=4),e.writeUint8(f),86018===t.codecpar.codecId&&e.writeUint8(c)}},2187:(e,t,a)=>{a.d(t,{d:()=>n});var i=a(72739),r=a(44328),o=a(77231);function n(e,t,a){let n=BigInt(0);return i.__(e,(e=>{n+=e.codecpar.bitrate*(0,r.k)(t,a,o.i0)/BigInt(8e3)})),n}},65977:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4624);const r="src/avformat/function/mktag.ts";function o(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,r,30);let t=0;for(let a=0;a<4;a++)t=t<<8|e.charCodeAt(a);return t}},52071:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(52730),r=a.n(i),o=a(63939),n=(a(9599),a(77231)),s=a(44328),c=a(2187),d=a(71517),l=a(9705),h=a(4624);const f="src/avformat/function/seekInBytes.ts";async function p(e,t,a,i,p,u){const m=e.ioReader.getPos(),g=await e.ioReader.fileSize();let w=n.Dh,U=a;t.startTime!==n.Dh?U-=t.startTime:U-=t.firstDTS;const I=(0,s.k)(a,t.timeBase,n.i0);if(I<BigInt(1e4))return h.Yz(`seek pts is earlier then 10s, seek to first packet pos(${i}) directly`,f,64),await e.ioReader.seek(i),m;let R=(0,c.d)(e.streams,U,t.timeBase);const v=g-(0,c.d)(e.streams,BigInt(1e4),n.i0),k=(0,c.d)(e.streams,BigInt(1e4),n.i0);if(R>v&&(R=v),R<i)return await e.ioReader.seek(i),m;const M=(0,d._5)();let b=g,B=BigInt(0);e:for(;b-B<k&&(R=B),await e.ioReader.seek(R),await u(e),!(8&r()(e.ioReader));){let a=await p(e,M),i=o.f[17](M+56);if(!(a>=0)){w=n.Dh;break}{const r=(0,s.Mr)(o.f[17](M+8),M+72,n.i0);let c=r-I;if(h.Yz(`try to seek to pos: ${R}, got packet pts: ${o.f[17](M+8)}(${r}ms), diff: ${c}ms`,f,101),c<=BigInt(0)&&-c<BigInt(1e4)||b-B<k){const r=[i];for(;c<=0;){if(o.f[15](M+32)===t.index&&1&o.f[15](M+36)&&r.push(i),(0,d.Up)(M),a=await p(e,M),a<0){if(-1048576===a)break;if(-1048575===a)continue;w=n.Dh;break e}i=o.f[17](M+56),c=(0,s.Mr)(o.f[17](M+8),M+72,n.i0)-I}w=r.pop();break}c>BigInt(0)?(b=R,R=B+b>>BigInt(1)):(B=R,R=B+b>>BigInt(1))}if(8&r()(e.ioReader))break}return(0,d.Qe)(M),w!==n.Dh?(h.Yz(`finally seek to pos ${w}`,f,156),await e.ioReader.seek(w),await u(e),m):(await e.ioReader.seek(m),8&r()(e.ioReader)?BigInt(l.LT):BigInt(l.E$))}},95832:(e,t,a)=>{a.d(t,{Bq:()=>f,En:()=>c,Hm:()=>n,Ij:()=>h,XC:()=>l,_5:()=>d,f7:()=>p,hY:()=>s,uF:()=>o});var i=a(77231),r=a(37246);const o={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],c=[i.N_,1,2,3,4,5,6,7];function d(e){let t=i.N_,a=i.N_,r=i.N_;return e.length>=2&&(t=e[0]>>3&31,a=s[(7&e[0])<<1|e[1]>>7],r=c[e[1]>>3&15]),{profile:t,sampleRate:a,channels:r}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:i,channels:r}=d(t);e.codecpar.profile=a,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=r,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function h(e){const t=n[e.sampleRate],a=e.chLayout.nbChannels,r=e.profile===i.N_?2:e.profile,o=new Uint8Array(2);return o[0]=(31&r)<<3|(14&t)>>1,o[1]=(1&t)<<7|(15&a)<<3,o}function f(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],i=(192&e[2])>>>6,r=(60&e[2])>>>2,o=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let l=1===a?7:9,h=n-l;return{syncWord:t,profile:i+1,sampleRate:s[r],channels:c[o],aacFrameLength:n,numberOfRawDataBlocksInFrame:d,headerLength:l,framePayloadLength:h}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let i=0;i<=e;i++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const i=t.getPointer(),o={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;o.syncWord=n,o.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(o.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?a():0;const r=t.readU(5);i-=5;const n=t.readU(4);i-=4;const d=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),o.profile=r+1,o.sampleRate=s[n],o.channels=c[d]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return o.framePayloadLength=l,o.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),o}},87518:(e,t,a)=>{a.d(t,{R:()=>p,j:()=>r});var i=a(37246);const r=[3,4,3,7,259,263,1539,1543],o=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],s=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],h=[1,2,3,6],f=7;function p(e){const t=new i.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=s[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=c[a.srCode]>>a.srShift,a.bitrate=1e3*d[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*o[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<f)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=c[e]/2,a.srShift=1}else a.numBlocks=h[t.readU(2)],a.sampleRate=c[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},21477:(e,t,a)=>{a.d(t,{Ui:()=>m,XC:()=>u,Yj:()=>g,k9:()=>p,zk:()=>l});var i=a(71426),r=a.n(i),o=a(63939),n=a(37246),s=a(11573),c=a(83314),d=a(97317);const l={0:"Main",1:"High",2:"Professional"},h=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],f=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function p(e,t,a){const i=e*t;for(const e of h)if(i<=e.maxResolution)return e.level}function u(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const a=m(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function m(e){const t=new n.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const a=t.readU(3),i=t.readU(5),r=t.readU1();let o=t.readU1()?10:8;return t.readU1()&&(o=12),{profile:a,level:i,tier:r,bitDepth:o,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}function g(e,t){var a;const i=new c.A(4);i.writeU1(1),i.writeU(7,1);const l=r()(a=function(e){const t=new n.A;t.appendBuffer(e);const a=[];for(;t.remainingLength();){const i=t.getPointer();t.readU1(),t.readU(4);const r=t.readU1(),o=t.readU1();t.readU1(),r&&t.readU(8);const n=o?s.v(t):e.length-1-r,c=t.getPointer()-i;a.push(e.subarray(i,i+c+n)),t.skip(8*n)}return a}(t)).call(a,(e=>1==(e[0]>>>3&15)));if(l){const e=function(e){const t=new n.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(4);const a=t.readU1(),i=t.readU1();t.readU1(),a&&t.readU(8),i&&s.v(t);const r=s.f(t,3),o=(s.f(t,1),s.f(t,1));let c=0,d=0,l=[0],h=[0],p=[0],u=[0],m=[0],g=[0],w=0,U=[0],I=[0],R=[0];if(o)h[0]=s.f(t,5);else{c=s.f(t,1),c?(s.f(t,32),s.f(t,32),s.f(t,1)&&s.d(t),s.f(t,1)&&(w=s.f(t,5),s.f(t,32),s.f(t,5),s.f(t,5))):d=0;let e=s.f(t,1),a=s.f(t,5);for(let i=0;i<=a;i++){if(l[i]=s.f(t,12),h[i]=s.f(t,5),h[i]>7?p[i]=s.f(t,1):p[i]=0,d){if(u[i]=s.f(t,1),u[i]){let e=w+1;U[i]=s.f(t,e),I[i]=s.f(t,e),R[i]=s.f(t,1)}}else u[i]=0;e&&(m[i]=s.f(t,1),m[i]&&(g[i]=s.f(t,4)))}}let v=s.f(t,4),k=s.f(t,4),M=v+1,b=s.f(t,M);M=k+1;let B=s.f(t,M),y=0,A=0,D=0;y=o?0:s.f(t,1),y&&(s.f(t,4),s.f(t,3)),s.f(t,1),s.f(t,1),s.f(t,1);let x=0,C=0,P=0,S=0,L=0,T=0,F=2,N=2,z=0;o||(s.f(t,1),s.f(t,1),s.f(t,1),s.f(t,1),S=s.f(t,1),S?(L=s.f(t,1),T=s.f(t,1)):(L=0,T=0),F=s.f(t,1)?2:s.f(t,1),F>0?s.f(t,1)?2:s.f(t,1):2,S&&s.f(t,3)),s.f(t,1),s.f(t,1),s.f(t,1);let E=s.f(t,1),$=0,V=0,_=0;2==r&&E?($=s.f(t,1),V=$?12:10):r<=2&&(V=E?10:8),_=1==r?0:s.f(t,1);let X=0,O=0,Y=0;s.f(t,1)?(X=s.f(t,8),O=s.f(t,8),Y=s.f(t,8)):(X=2,O=2,Y=2);let W=0,H=0,Q=0,j=0,J=0;return _?(W=s.f(t,1),H=1,Q=1,j=0,J=0):1==X&&13==O&&0==Y?(W=1,H=0,Q=0,J=s.f(t,1)):(W=s.f(t,1),0==r?(H=1,Q=1):1==r?(H=0,Q=0):12==V?(H=s.f(t,1),Q=H?s.f(t,1):0):(H=1,Q=0),H&&Q&&(j=s.f(t,2)),J=s.f(t,1)),s.f(t,1),{width:b+1,height:B+1,profile:r,level:f[h[0]],tier:p[0],bitDepth:V,monoChrome:_,colorRange:W,colorPrimaries:X,transferCharacteristics:O,matrixCoefficients:Y,subsamplingX:H,subsamplingY:Q,chromaSamplePosition:j}}(l);i.writeU(3,e.profile),i.writeU(5,e.level),i.writeU(1,e.tier),i.writeU(1,e.bitDepth>8?1:0),i.writeU(1,12===e.bitDepth?1:0),i.writeU(1,e.monoChrome),i.writeU(1,e.subsamplingX),i.writeU(1,e.subsamplingY),i.writeU(1,e.chromaSamplePosition)}else{const t=(0,d.I)(o.f[15](e+28));i.writeU(3,o.f[15](e+48)),i.writeU(5,o.f[15](e+52)),i.writeU(1,0),i.writeU(1,t.comp[0].depth>8?1:0),i.writeU(1,12===t.comp[0].depth?1:0),i.writeU(1,0),i.writeU(1,1),i.writeU(1,1),i.writeU(1,0)}return i.writeU(8,0),i.padding(),i.getBuffer()}},14769:(e,t,a)=>{a.d(t,{DK:()=>s,XC:()=>d,Xr:()=>c,jA:()=>o,ob:()=>r,oe:()=>n});var i=a(31865);const r=34,o=8,n=[0,8,12,0,16,20,24,32],s=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],c=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===r){const{bitsPerRawSample:a,sampleRate:r,channels:o}=function(e){const t=new i.A(e);t.skip(10);const a=t.readUint24();return{sampleRate:a>>4,channels:1+((15&a)>>>1),bitsPerRawSample:1+((1&a)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=o}}},64093:(e,t,a)=>{a.d(t,{Au:()=>U,He:()=>I,XC:()=>R,Y2:()=>m,hG:()=>g,oz:()=>w});var i=a(77231);const r=[44100,48e3,32e3,0],o=[22050,24e3,16e3,0],n=[11025,12e3,8e3,0],s=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],h=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],p=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],u=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return n[t];case 2:return o[t];case 3:return r[t]}return i.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return s[t]}return i.N_}function w(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return u[a];case 3:return f[a]}break;case 2:switch(e){case 0:case 2:return u[a];case 3:return h[a]}case 3:switch(e){case 0:case 2:return p[a];case 3:return l[a]}}return i.N_}function U(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return i.N_}const I={32:"Layer1",33:"Layer2",34:"Layer3"};function R(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,i=(6&t[1])>>1,r=(12&t[2])>>>2,o=3&~(t[3]>>>6)?2:1,n=U(i),s=m(a,r);e.codecpar.profile=n,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=o}}},22576:(e,t,a)=>{a.d(t,{Ij:()=>d,XC:()=>c,kt:()=>s});var i=a(31865),r=a(729),o=a(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function s(e){let t=0,a=0,i=0;if(e.length<1)return 0;switch(t=e[0],a=n[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*a}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const a=new i.A(t,!1);a.skip(9),e.codecpar.chLayout.nbChannels=a.readUint8(),e.codecpar.initialPadding=a.readUint16(),e.codecpar.sampleRate=a.readUint32(),e.codecpar.seekPreroll=Number((0,o.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(e){const t=new Uint8Array(19),a=new r.A(t,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(e.chLayout.nbChannels),a.writeUint16(e.initialPadding),a.writeUint32(e.sampleRate),t}},97077:(e,t,a)=>{a.d(t,{Ui:()=>o,XC:()=>r});var i=a(37246);function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=o(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function o(e){const t=new i.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},82014:(e,t,a)=>{a.d(t,{Ui:()=>m,XC:()=>u,Yj:()=>g,k9:()=>p,wN:()=>h});var i=a(63939),r=a(9599),o=a(29170),n=a(37246),s=a(77231),c=a(97317),d=a(44328),l=a(729);const h={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},f=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function p(e,t,a){const i=e*t;for(const e of f)if(i<=e.maxResolution&&a<=e.maxFrameRate)return e.level}function u(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=m(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function m(e){const t=new n.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}function g(e){const t=new l.A(new Uint8Array(8)),a=function(e){let t=i.f[15](e+48),a=i.f[15](e+52);a===s.N_&&(a=p(i.f[15](e+56),i.f[15](e+60),(0,d.lb)((0,o.A)(e+72,r.P))));const n=(0,c.I)(i.f[15](e+28));let l=i.f[15](e+40),h=1;n&&(l=n.comp[0].depth,1===n.log2ChromaW&&1===n.log2ChromaH?1===i.f[15](e+100)&&(h=0):1===n.log2ChromaW&&0===n.log2ChromaH?h=2:0===n.log2ChromaW&&0===n.log2ChromaH&&(h=3));const f=2===i.f[15](e+84)?1:0;return t===s.N_&&l&&(t=0==h||1==h?8==l?0:2:8==l?1:3),{profile:t,level:a,bitDepth:l,chromaSubsampling:h,fullRange:f}}(e);return t.writeUint8(a.profile),t.writeUint8(a.level),t.writeUint8(a.bitDepth<<4|a.chromaSubsampling<<1|a.fullRange),t.writeUint8(i.f[15](e+88)),t.writeUint8(i.f[15](e+92)),t.writeUint8(i.f[15](e+96)),t.writeUint16(0),t.getWroteBuffer()}},73040:(e,t,a)=>{a.d(t,{$x:()=>s,bD:()=>c});var i=a(67672),r=a(72739),o=a(95335);async function n(e,t){return{key:await e.readString(await e.readUint16()),value:await s(e,t)}}async function s(e,t){let a;switch(await e.readUint8()){case 0:a=await e.readDouble();break;case 1:a=!!await e.readUint8();break;case 2:a=await e.readString(await e.readUint16());break;case 3:for(a={};e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(a={},await e.skip(4);e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:a=null;break;case 10:a=[];const i=await e.readUint32();for(let r=0;r<i;r++)a.push(await s(e,t));break;case 11:const r=await e.readDouble(),o=await e.readInt16();a=new Date(r+60*o*1e3);break;case 12:a=await e.readString(await e.readUint32())}return a}function c(e,t){i.ai(t)?(e.writeUint8(0),e.writeDouble(t)):i.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):i.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):i.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):i.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),r.__(t,(t=>{c(e,t)}))):i.Ik(t)?(e.writeUint8(3),o.__(t,((t,a)=>{e.writeUint16(a.length),e.writeString(a),c(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}},11573:(e,t,a)=>{function i(e,t){let a=0;for(let i=0;i<t;i++)a=2*a+e.readU1();return a}function r(e){let t=0;for(;!i(e,1);)t++;return t>=32?0:i(e,t)+(1<<t)-1}function o(e){let t=0;for(let a=0;a<8;a++){let r=i(e,8);if(t|=(127&r)<<7*a,!(128&r))break}return t}a.d(t,{d:()=>r,f:()=>i,v:()=>o}),a(54810)},35336:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(49859),r=a(50011);class o{constructor(e=1048576,t=!0,a){if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,a&&a.view)this.size=a.length,this.buffer=a,this.data=a.view;else if(a&&!a.byteOffset)this.size=a.length,this.buffer=a,this.data=new DataView(this.buffer.buffer);else{if(a)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,a=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(a),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(a),this.writeUint8(i))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let a=0;for(;t>0;){this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(a,a+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),a+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=r.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);