"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[31],{460:(t,e,i)=>{i.d(e,{A:()=>h});var r=i(4467),a=i(9983),n=i(3458),s=i(3674),o=i(495),c=i(4187),d=i(1755),l=i(3690);class h extends n.A{constructor(){super(...arguments),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"opusPendingTrimStart",void 0)}init(t,e){return super.init(t,e),this.cache=(0,c._5)(),this.cached=!1,this.opusPendingTrimStart=48e3*(a.f[15](this.inCodecpar+148)>0?a.f[15](this.inCodecpar+148):0)/a.f[15](this.inCodecpar+136),0}destroy(){super.destroy(),(0,c.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(!a.f[20](t+24)||!a.f[15](t+28))return;const e=(0,s.s3)(a.f[20](t+24),a.f[15](t+28)),i=l.kt(e);let r=null;const n=(0,c.rU)(t,11);n&&(r=(0,s.s3)(a.f[20](n),a.f[25](n+4)));let o=0;r&&r.length>=10&&(o=48e3*(r[4]<<24|r[5]<<16|r[6]<<8|r[9])/a.f[15](this.inCodecpar+136));let h=e.length+2+e.length/255+1;this.opusPendingTrimStart&&(h+=2),o&&(h+=2);const p=(0,d.sY)(h),f=(0,s.s3)(p,h);f[0]=127,f[1]=224,this.opusPendingTrimStart&&(f[1]|=16),o&&(f[1]|=8);let u=e.length,g=2;do{f[g]=Math.min(u,255),u-=255,g++}while(u>=0);let U=0;return this.opusPendingTrimStart&&(U=Math.min(this.opusPendingTrimStart,i),f[g]=(65280&U)>>8,f[g+1]=255&U,g+=2,this.opusPendingTrimStart-=U),o&&(o=Math.min(o,i-U),f[g]=(65280&o)>>8,f[g+1]=255&o,g+=2),f.set(e,g),(0,c.zu)(this.cache,t),(0,c.NX)(this.cache,p,h),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,c.Up)(t),(0,c.rN)(t,this.cache),this.cached=!1,0):o.LR}reset(){return 0}}},2518:(t,e,i)=>{i.d(e,{A:()=>U});var r=i(4467),a=i(9983),n=i(2320),s=i(3458),o=i(665),c=i(4916),d=i(3674),l=i(495),h=i(4187),p=i(1755),f=i(7314);const u={mod:20},g=new Uint8Array([86,224,0]);class U extends s.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"bitWriter",void 0),(0,r.A)(this,"counter",void 0),(0,r.A)(this,"options",void 0),this.options=o.X$({},u,t)}init(t,e){return super.init(t,e),this.cache=(0,h._5)(),this.cached=!1,this.counter=0,this.bitWriter=new c.A,0}destroy(){super.destroy(),(0,h.Qe)(this.cache),this.cache=0}writeHeader(){this.bitWriter.writeU1(0===this.counter?0:1),0===this.counter&&(this.bitWriter.writeU1(0),this.bitWriter.writeU1(1),this.bitWriter.writeU(6,0),this.bitWriter.writeU(4,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(5,a.f[15](this.inCodecpar+48)-1&31),this.bitWriter.writeU(4,15&f.Hm[a.f[15](this.inCodecpar+136)]),this.bitWriter.writeU(4,15&a.f[15](this.inCodecpar+116)),this.bitWriter.writeU(3,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(8,255),this.bitWriter.writeU1(0),this.bitWriter.writeU1(0)),this.counter++,this.counter%=this.options.mod}copyBytes(t){for(let e=0;e<t.length;e++)this.bitWriter.writeU(8,t[e])}sendAVPacket(t){if(!a.f[20](t+24)||!a.f[15](t+28))return 0;this.bitWriter.reset();const e=(0,h.rU)(t,1);if(e){const{profile:t,sampleRate:i,channels:r}=f._5((0,d.s3)(a.f[20](e),a.f[25](e+4)));n.M[15](this.inCodecpar+48,t),n.M[15](this.inCodecpar+136,i),n.M[15](this.inCodecpar+116,r),this.counter=0}this.writeHeader();let i=0;for(;i<=a.f[15](t+28)-255;i+=255)this.bitWriter.writeU(8,255);this.bitWriter.writeU(8,a.f[15](t+28)-i);const r=(0,d.s3)(a.f[20](t+24),a.f[15](t+28));129==(225&r[0])?(this.bitWriter.writeU(8,254&r[0]),this.copyBytes(r.subarray(1))):this.copyBytes(r),this.bitWriter.padding();const s=this.bitWriter.getPointer(),o=3+s,c=(0,p.sY)(o),l=(0,d.s3)(c,o);return l.set(g,0),l[1]|=s>>8&31,l[2]|=255&s,l.set(this.bitWriter.getBuffer().subarray(0,s),3),(0,h.zu)(this.cache,t),(0,h.NX)(this.cache,c,o),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,h.Up)(t),(0,h.rN)(t,this.cache),this.cached=!1,0):l.LT}reset(){return 0}}},3458:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(4467),a=i(9983),n=i(1755),s=i(2836);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,n.Gy)(168),(0,s.Yi)(this.inCodecpar,t),this.inTimeBase={den:a.f[15](e+4),num:a.f[15](e)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},3690:(t,e,i)=>{i.d(e,{Ij:()=>d,XC:()=>c,kt:()=>o});var r=i(3262),a=i(5815),n=i(187);const s=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(t){let e=0,i=0,r=0;if(t.length<1)return 0;switch(e=t[0],i=s[e>>3],3&e){case 0:r=1;break;case 1:case 2:r=2;break;case 3:if(t.length<2)return 0;r=63&t[1]}return r*i}function c(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length>=19){const i=new a.A(e,!1);i.skip(9),t.codecpar.chLayout.nbChannels=i.readUint8(),t.codecpar.initialPadding=i.readUint16(),t.codecpar.sampleRate=i.readUint32(),t.codecpar.seekPreroll=Number((0,r.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(t){const e=new Uint8Array(19),i=new n.A(e,!1);return i.writeString("OpusHead"),i.writeUint8(1),i.writeUint8(t.chLayout.nbChannels),i.writeUint16(t.initialPadding),i.writeUint32(t.sampleRate),e}},3915:(t,e,i)=>{i.d(e,{CE:()=>m,Gj:()=>U,Zn:()=>A,Zp:()=>p,in:()=>g,kw:()=>f,sG:()=>u});var r=i(9983),a=i(5144),n=i(9515),s=i(9508),o=i(1237),c=i(9906),d=i(3737);const l="packages/avformat/src/formats/mpegts/ompegts.ts";function h(t){if(2!==t.adaptationFieldControl&&3!==t.adaptationFieldControl)return 0;if(2===t.adaptationFieldControl)return a.ZT-4;let e=2;return t.adaptationFieldInfo.pcrFlag&&(e+=6),t.adaptationFieldInfo.opcrFlag&&(e+=6),t.adaptationFieldInfo.splicingPointFlag&&(e+=1),t.adaptationFieldInfo.transportPrivateDataFlag&&(e+=t.adaptationFieldInfo.transportPrivateData?t.adaptationFieldInfo.transportPrivateData.length:0),t.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e+=t.adaptationFieldInfo.extension?t.adaptationFieldInfo.extension.length:0),e>256&&c.R8("adaptationField size is too large",l,67),e}function p(t){const e=t.privData||{};switch(t.codecpar.codecId){case 1:case 2:return 2;case 12:return 16;case 27:return 27;case 87:return 66;case 173:return 36;case 196:return 51;case 116:return 209;case 70:return 234;case 86016:case 86017:return t.codecpar.sampleRate<32e3?4:3;case 86018:return e.latm?17:15;case 86065:return 17;case 86019:return 129;case 86076:case 225:case 94209:case 98311:default:return 6;case 86060:return 131;case 86056:return 135;case 86020:return 130}}function f(t){return 0===t.codecpar.codecType?116===t.codecpar.codecId?253:224:1!==t.codecpar.codecType||86016!==t.codecpar.codecId&&86017!==t.codecpar.codecId&&86018!==t.codecpar.codecId?1===t.codecpar.codecType&&86019===t.codecpar.codecId?253:2===t.codecpar.codecType?252:189:192}function u(t){const e=new Uint8Array(1024);e[1]=0,e[2]=176,e[5]=1,e[6]=193;let i=9;t.networkPid>-1&&(i+=2,e[i++]=224|t.networkPid>>8&31,e[i++]=255&t.networkPid),t.program2PmtPid.forEach(((t,r)=>{e[i++]=r>>8&255,e[i++]=255&r,e[i++]=224|t>>8&31,e[i++]=255&t}));const r=i;i+=4;for(let t=i;t<a.ZT-4;t++)e[t]=255;const n=i-1-3;e[2]|=n>>8&15,e[3]=255&n;const o=(0,s.E)(e.subarray(1,r));return e[r]=o>>24&255,e[r+1]=o>>16&255,e[r+2]=o>>8&255,e[r+3]=255&o,e.slice(0,a.ZT-4)}function g(t,e){const i=new Uint8Array(1024);i[1]=2,i[2]=176,i[4]=t.programNumber>>8&15,i[5]=255&t.programNumber,i[6]=193;let o=9;i[o++]=224|t.pcrPid>>8&31,i[o++]=255&t.pcrPid;const c=o;function d(t){i[o++]=a.OS,i[o++]=4,i[o++]=t>>24,i[o++]=t>>16,i[o++]=t>>8,i[o++]=t}o+=2;let l=61440|o-c-2;i[c]=l>>8,i[c+1]=l;for(let t=0;t<e.length;t++){const s=p(e[t]);i[o++]=s;const c=e[t].privData;i[o++]=224|c.pid>>8&31,i[o++]=255&c.pid;const l=o;o+=2;const h=e[t].codecpar.codecId;switch(e[t].codecpar.codecType){case 1:86019===h&&d((0,n.A)("AC-3")),86056===h&&d((0,n.A)("EAC3")),65562===h&&d((0,n.A)("BSSD")),86076===h&&(d((0,n.A)("Opus")),i[o++]=127,i[o++]=2,i[o++]=128,i[o++]=e[t].codecpar.chLayout.nbChannels),i[o++]=a.qJ,i[o++]=4,i[o++]=117,i[o++]=110,i[o++]=100,i[o++]=0;break;case 0:if(225===h&&(d((0,n.A)("AV01")),e[t].codecpar.extradata)){i[o++]=128,i[o++]=e[t].codecpar.extradataSize;for(let a=0;a<e[t].codecpar.extradataSize;a++)i[o++]=r.f[2](e[t].codecpar.extradata+a)}}let f=61440|o-l-2;i[l]=f>>8,i[l+1]=f}const h=o;o+=4;for(let t=o;t<a.ZT-4;t++)i[t]=255;l=o-1-3,i[2]|=l>>8&15,i[3]=255&l;const f=(0,s.E)(i.subarray(1,h));return i[h]=f>>24&255,i[h+1]=f>>16&255,i[h+2]=f>>8&255,i[h+3]=255&f,i.slice(0,a.ZT-4)}function U(){const t=new Uint8Array(1024);t[1]=66,t[2]=240,t[5]=1,t[6]=193;let e=9;t[e++]=255,t[e++]=1,t[e++]=255,t[e++]=0,t[e++]=1,t[e++]=252;const i=e;e+=2,t[e++]=72;const r=e++;t[e++]=1;t[e++]=9;for(let i=0;i<9;i++)t[e]="format-js".charCodeAt(i),e++;t[e++]=9;for(let i=0;i<9;i++)t[e]="Service01".charCodeAt(i),e++;t[r]=e-r-1;let n=32768|e-i-2;t[i]=n>>8&255,t[i+1]=255&n;const o=e;e+=4;for(let i=e;i<a.ZT-4;i++)t[i]=255;const c=e-1-3;t[2]|=c>>8&15,t[3]=255&c;const d=(0,s.E)(t.subarray(1,o));return t[o]=d>>24&255,t[o+1]=d>>16&255,t[o+2]=d>>8&255,t[o+3]=255&d,t.slice(0,a.ZT-4)}function w(t,e,i){var r;i.tsPacketSize===a.VG&&t.skip(4),e.payload&&0!==e.payload.length||(e.adaptationFieldControl=2),1===e.adaptationFieldControl&&e.payload.length+4<a.ZT&&(e.adaptationFieldControl=3);const n=t.getPos();t.writeUint8(71);let s=0;e.payloadUnitStartIndicator&&(s|=64),s|=e.transportPriority<<5,s|=e.pid>>8,t.writeUint8(s),t.writeUint8(255&e.pid),s=(3&e.transportScramblingControl)<<6,s|=(3&e.adaptationFieldControl)<<4,s|=15&e.continuityCounter,t.writeUint8(s);let o=h(e),d=a.ZT-4-o;if(null!==(r=e.payload)&&void 0!==r&&r.length&&(d-=e.payload.length),2===e.adaptationFieldControl||3===e.adaptationFieldControl){const i=t.getPos();if(t.writeUint8(o-1+d),s=(1&e.adaptationFieldInfo.discontinuityIndicator)<<7,s|=(1&e.adaptationFieldInfo.randomAccessIndicator)<<6,s|=(1&e.adaptationFieldInfo.elementaryStreamPriorityIndicator)<<5,s|=(1&e.adaptationFieldInfo.pcrFlag)<<4,s|=(1&e.adaptationFieldInfo.opcrFlag)<<3,s|=(1&e.adaptationFieldInfo.splicingPointFlag)<<2,s|=(1&e.adaptationFieldInfo.transportPrivateDataFlag)<<1,s|=1&e.adaptationFieldInfo.adaptationFieldExtensionFlag,t.writeUint8(s),e.adaptationFieldInfo.pcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),r=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(r>>25&255),t.writeUint8(r>>17&255),t.writeUint8(r>>9&255),t.writeUint8(r>>1&255),t.writeUint8(r<<7|i>>8|126),t.writeUint8(i)}if(e.adaptationFieldInfo.opcrFlag){const i=Number(e.adaptationFieldInfo.pcr%BigInt(300)),r=Number((e.adaptationFieldInfo.pcr-BigInt(Math.floor(i)))/BigInt(300));t.writeUint8(r>>25&255),t.writeUint8(r>>17&255),t.writeUint8(r>>9&255),t.writeUint8(r>>1&255),t.writeUint8(r<<7|i>>8|126),t.writeUint8(i)}e.adaptationFieldInfo.splicingPointFlag&&t.writeUint8(e.adaptationFieldInfo.spliceCountDown),e.adaptationFieldInfo.transportPrivateDataFlag&&(e.adaptationFieldInfo.transportPrivateData&&e.adaptationFieldInfo.transportPrivateData.length?(t.writeUint8(e.adaptationFieldInfo.transportPrivateData.length),t.writeBuffer(e.adaptationFieldInfo.transportPrivateData)):t.writeUint8(0)),e.adaptationFieldInfo.adaptationFieldExtensionFlag&&(e.adaptationFieldInfo.extension&&e.adaptationFieldInfo.extension.length?(t.writeUint8(e.adaptationFieldInfo.extension.length),t.writeBuffer(e.adaptationFieldInfo.extension)):t.writeUint8(0));const r=Number(t.getPos()-i);for(r<o&&t.skip(o-r);d>0;)t.writeUint8(255),d--}var p;1!==e.adaptationFieldControl&&3!==e.adaptationFieldControl||null!==(p=e.payload)&&void 0!==p&&p.length&&t.writeBuffer(e.payload),Number(t.getPos()-n)!==a.ZT&&c.z3(`write error data size to ts packet, need ${a.ZT}, wrote: ${Number(t.getPos()-n)}`,l,640),i.tsPacketSize===a.eR&&t.skip(16)}function y(t,e,i,r){let a=i<<4|(7&Number(r>>BigInt(30)))<<1|1;t[e++]=a,a=(32767&Number(r>>BigInt(15)))<<1|1,t[e++]=a>>8&255,t[e++]=255&a,a=Number(r&BigInt(32767))<<1|1,t[e++]=a>>8&255,t[e++]=255&a}function m(t,e,i,r,n){const s=e.streamId,c=new Uint8Array(function(t){let e=6;const i=t.streamId;return 188!==i&&190!==i&&191!==i&&240!==i&&241!==i&&255!==i&&242!==i&&248!==i&&(e+=3,t.pts!==o.Dh&&(e+=5),t.dts!==o.Dh&&t.pts!==o.Dh&&t.dts!==t.pts&&(e+=5)),e}(e));c[2]=1,c[3]=s;let l=i.total;if(188!==s&&190!==s&&191!==s&&240!==s&&241!==s&&255!==s&&242!==s&&248!==s){let t=0,i=0;e.pts!==o.Dh&&(i+=5,t|=128),e.dts!==o.Dh&&e.pts!==o.Dh&&e.dts!==e.pts&&(i+=5,t|=64);let a=128;3!==r.codecpar.codecType&&2!==r.codecpar.codecType||(a|=4),c[6]=a,c[7]=t,c[8]=i,l+=i+3,e.pts!==o.Dh&&y(c,9,t>>6,e.pts),e.dts!==o.Dh&&e.pts!==o.Dh&&e.dts!==e.pts&&y(c,14,1,e.dts)}l<=o.zg&&0!==r.codecpar.codecType&&(c[4]=l>>8&255,c[5]=255&l),function(t,e,i,r,n){const s=r.privData,o=s.tsPacket;e.pid===n.pmt.pcrPid&&(o.adaptationFieldControl=3,o.adaptationFieldInfo.pcrFlag=1,o.adaptationFieldInfo.pcr=e.dts*BigInt(300)),o.adaptationFieldInfo.randomAccessIndicator=e.randomAccessIndicator,e.randomAccessIndicator&&(o.adaptationFieldControl=3);let c=h(o),d=s.continuityCounter;if(4+c+i.length<=a.ZT)return o.payloadUnitStartIndicator=1,o.payload=i,o.continuityCounter=d++%16,w(t,o,n),void(s.continuityCounter=d%16);let l=a.ZT-(4+c),p=0;for(;p<i.length;){let e=Math.min(p+l,i.length);o.payloadUnitStartIndicator=0===p?1:0,1===o.adaptationFieldControl&&e-p+4==a.ZT-1&&e--,o.payload=i.subarray(p,e),o.continuityCounter=d++%16,w(t,o,n),0===p&&(o.adaptationFieldInfo.randomAccessIndicator=0,o.adaptationFieldControl=1,o.adaptationFieldInfo.pcrFlag=0,c=h(o),l=a.ZT-(4+c)),p=e}s.continuityCounter=d%16}(t,e,(0,d.A)(Uint8Array,[c,...i.buffers]),r,n)}function A(t,e,i){const r=h(e);let n=e.continuityCounter;if(4+r+e.payload.length<=a.ZT)return e.payloadUnitStartIndicator=1,e.continuityCounter=n++%16,w(t,e,i),void(e.continuityCounter=n%16);const s=a.ZT-(4+r);let o=0;const c=e.payload;for(;o<c.length;){let d=Math.min(o+s,c.length);e.payloadUnitStartIndicator=0===o?1:0;const l=d-o;l+4===a.ZT?e.adaptationFieldControl=1:0===r&&l+4+1===a.ZT&&d--,e.payload=c.subarray(o,d),e.continuityCounter=n++%16,w(t,e,i),o=d}e.continuityCounter=n%16}},4096:(t,e,i)=>{i.d(e,{HL:()=>w,OD:()=>v,S1:()=>m,Ui:()=>S,XC:()=>F,kM:()=>b,mW:()=>C,oT:()=>I,sL:()=>A,wA:()=>P,wf:()=>k});var r=i(9983),a=i(1958),n=i(1755),s=i(2149),o=i(2171),c=i(8636),d=i(3674),l=i(3321),h=i(84),p=i(4916),f=i(5815),u=i(187);const g=3;function U(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),a=t.readU(2),n=t.readU(3);t.readU(5),t.readU(2);const s=t.readU(6),o=t.readU(7),c=t.readU(1),d=t.readU(8),l=t.readU(1),h=t.readU(1),p=[],f=[];if(s){for(let e=0;e<s-1;e++)p[e]=t.readU(8);p[s-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(f[r]=t.readU(8))}const u=t.readU(8),g=[];if(u)for(let e=0;e<u;e++)g.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:n,chromaFormatIdc:a,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:h,generalConstraintInfo:p,sublayerLevelIdc:f,generalSubProfileIdc:g,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function w(t){const e=new f.A(t,!0);if(1&e.readUint8()){const i=new h.A;i.appendBuffer(t.subarray(1)),U(i),e.skip(i.getPointer())}let i=[],r=[],a=[];const n=e.readUint8();for(let t=0;t<n;t++){const t=31&e.readUint8();let n=1;13!==t&&12!==t&&(n=e.readUint16());const s=[];for(let t=0;t<n;t++){const t=e.readUint16();s.push(e.readBuffer(t))}14===t?i=s:15===t?r=s:16===t&&(a=s)}return{vpss:i,spss:r,ppss:a}}function y(t,e,i){const r=e[0];let a;if(r){const t=k(r);let e=t.generalConstraintInfo;e.length||(e=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,t.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,t.chromaFormatIdc),i.writeU(3,t.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,e.length),i.writeU(7,t.profile),i.writeU1(t.tierFlag),i.writeU(8,t.level),i.writeU1(t.ptlFrameOnlyConstraintFlag),i.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)i.writeU(8,e[t]);i.writeU(6,e[e.length-1])}else i.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)e=e<<1|t.ptlSublayerLevelPresentFlag[i];i.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)i.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&i.writeU(8,t.sublayerLevelIdc[e])}i.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)i.writeU(8,t.sublayerLevelIdc[e]);i.writeU(16,t.width),i.writeU(16,t.height),i.writeU(16,0),i.padding(),a=i.getBuffer().subarray(0,i.getPointer())}let n=2+(a?a.length:0);t.length&&(n+=3,n=t.reduce(((t,e)=>t+2+e.length),n)),e.length&&(n+=3,n=e.reduce(((t,e)=>t+2+e.length),n)),i.length&&(n+=3,n=i.reduce(((t,e)=>t+2+e.length),n));const s=new Uint8Array(n),o=new u.A(s,!0);o.writeUint8(g<<1|(a?1:0)|248),a&&o.writeBuffer(a);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,o.writeUint8(c),t.length&&(o.writeUint8(142),o.writeUint16(t.length),l.__(t,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),e.length&&(o.writeUint8(143),o.writeUint16(e.length),l.__(e,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),i.length&&(o.writeUint8(144),o.writeUint16(i.length),l.__(i,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),s}function m(t){let e=a.py(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const a=e[1]>>>3&31;14===a?t.push(e):15===a?i.push(e):16===a&&r.push(e)})),i.length&&r.length)return y(t,i,r)}}function A(t){let e=a.py(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const a=e[1]>>>3&31;14===a?t.push(e):15===a?i.push(e):16===a&&r.push(e)})),i.length&&r.length){const e=[i[0],r[0]];return t.length&&e.unshift(t[0]),a.nW(e,0)}}}function I(t){let e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1,s=a.py(t);if(s.length){const t=[],a=[],n=[];s.forEach((e=>{const i=e[1]>>>3&31;14===i?t.push(e):15===i?a.push(e):16===i&&n.push(e),8!==i&&7!==i&&9!==i&&10!==i||(r=!0)})),a.length&&n.length?(e=y(t,a,n),s=s.filter((t=>{const e=t[1]>>>3&31;return(i||14!==e&&15!==e&&16!==e)&&20!==e}))):s=s.filter((t=>20!=(t[1]>>>3&31)))}const o=s.reduce(((t,e)=>t+g+1+e.length),0),c=(0,n.sY)(o),l=(0,d.s3)(c,o);return a.S9(s,g,l),{bufferPointer:c,length:o,extradata:e,key:r}}function P(t,e,i,r,s){const o=[a.Le(t,0),a.Le(e,0),a.Le(i,0),a.Le(r,2)];let l=o.reduce(((t,e)=>t+e),0);const h=(0,n.sY)(l+7);let p=h;return c.w8((p+=1,p-1),0),c.w8((p+=1,p-1),0),c.w8((p+=1,p-1),0),c.w8((p+=1,p-1),1),c.w8((p+=1,p-1),0),c.w8((p+=1,p-1),161),c.w8((p+=1,p-1),(s?1:0)<<7|40),t.length&&(a.nW(t,0,(0,d.s3)(p,o[0])),p+=o[0]),e.length&&(a.nW(e,0,(0,d.s3)(p,o[1])),p+=o[1]),i.length&&(a.nW(i,0,(0,d.s3)(p,o[2])),p+=o[2]),r.length&&a.nW(r,2,(0,d.s3)(p,o[3])),{bufferPointer:h,length:l+7}}function b(t,e){let i=a.py(t).concat(a.py(e));if(i.length){let t=[],e=[],r=[],a=[];return i.forEach((i=>{const n=i[1]>>>3&31;14===n?t.push(i):15===n?e.push(i):16===n?r.push(i):20!==n&&a.push(i)})),P(t,e,r,a,!0)}}function v(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;e&&(i=e[0]>>>1&3);let r=[],n=[],s=[],o=!1;if(e){const t=w(e);r=t.vpss,n=t.spss,s=t.ppss,o=!0}const c=a.wN(t,i).filter((t=>20!=(t[1]>>>3&31))),d=[];return c.forEach((t=>{const e=t[1]>>>3&31;15!==e||n.length?16!==e||s.length?20!==e&&d.push(t):s.push(t):n.push(t),8!==e&&7!==e||(o=!0)})),{...P(r,n,s,d,o),key:o}}function F(t,e){let i;if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&a.Bs(e))l.__(a.py(e),(t=>{if(15==(t[1]>>>3&31))return i=t,!1}));else if(e&&e.length>=6){const{spss:t}=w(e);t.length&&(i=t[0])}i&&function(t,e){const{profile:i,level:r,width:a,height:n,videoDelay:s,chromaFormatIdc:o,bitDepthMinus8:c}=k(e);switch(t.codecpar.profile=i,t.codecpar.level=r,t.codecpar.width=a,t.codecpar.height=n,t.codecpar.videoDelay=s,c){case 0:t.codecpar.format=3===o?5:2===o?4:0;break;case 2:t.codecpar.format=3===o?68:2===o?64:62}}(t,i)}function C(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](t+36))return a.py((0,d.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>{const e=t[1]>>>3&31;return 8===e||7===e||9===e}));{const i=r.f[15](t+28);let a=0;for(;a<i-e;){const i=o.r8(r.f[20](t+24)+(a+e+1))>>>3&31;if(8===i||7===i||9===i)return!0;a+=4===e?o.Sg(r.f[20](t+24)+a):3===e?o.ht(r.f[20](t+24)+a):2===e?o.yd(r.f[20](t+24)+a):o.r8(r.f[20](t+24)+a),a+=e}return!1}}function k(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,n=0,o=0,c=0,d=1,l=0,p=0,f=0;const u=[],g=[],U=[],w=[],y=a.BN(t.subarray(e)),m=new h.A(y.length);m.appendBuffer(y),m.readU1(),m.readU1(),m.readU(6),m.readU(5),m.readU(3),m.readU(8);const A=m.readU(3);d=m.readU(2);const I=m.readU(2);if(m.readU(1)){if(i=m.readU(7),l=m.readU(1),r=m.readU(8),p=m.readU(1),f=m.readU(1),m.readU(1)){for(let t=0;t<8;t++)u[t]=m.readU(8);u[8]=m.readU(7);const t=m.readU(8);m.readU(t)}m.skipPadding();for(let t=A-1;t>=0;t--)g[t]=m.readU(1);m.skipPadding();for(let t=A-1;t>=0;t--)g[t]&&(U[t]=m.readU(8));const t=m.readU(8);if(t)for(let e=0;e<t;e++)w[e]=m.readU(32)}m.readU1(),m.readU1()&&m.readU1();const P=n=s.xb(m),b=o=s.xb(m);if(m.readU1()&&(s.xb(m),s.xb(m),s.xb(m),s.xb(m)),m.readU1()){const t=s.xb(m),e=I+5,i=1<<e,r=P/(1<<e),a=b/(1<<e),n=Math.ceil(Math.log2(r)),o=Math.ceil(Math.log2(a));let c=0,d=0,l=0;t>0&&(l=m.readU1(),d=m.readU1());for(let e=0;t>0&&e<=t;e++)d&&0!=e||(e>0&&P>i&&m.readU(n),e>0&&b>i&&m.readU(o),e<t&&P>i&&m.readU(n),e<t&&b>i&&m.readU(o)),l||m.readU(2);if(c=s.xb(m)+1,m.readU(1)&&m.readU(1))for(let e=0;e<=t;e++)m.readU(c)}c=s.xb(m),m.readU(1),m.readU(1);const v=m.readU(4),F=m.readU(1);let C=0;F&&(C=s.xb(m));const k=[],S=m.readU(2);for(let t=0;t<8*S;t++)k[t]=m.readU(1);return{profile:i,level:r,width:n,height:o,videoDelay:A+1>2?2:A,chromaFormatIdc:d,bitDepthMinus8:c,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:u,generalSubProfileIdc:w,ptlFrameOnlyConstraintFlag:p,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:A,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:U,sps_log2_max_pic_order_cnt_lsb_minus4:v,sps_poc_msb_cycle_flag:F,sps_poc_msb_cycle_len_minus1:C,sps_num_extra_ph_bytes:S,sps_extra_ph_bit_present_flag:k}}function S(t){a.Bs(t)&&(t=m(t));const e=new h.A;return e.appendBuffer(t),1&e.readU(8)?U(e):{}}},4970:(t,e,i)=>{i.d(e,{A:()=>p});var r=i(4467),a=i(9983),n=i(2320),s=i(3458),o=i(3674),c=i(495),d=i(4187),l=i(1755),h=i(7314);class p extends s.A{constructor(){super(...arguments),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(t,e){return super.init(t,e),this.cache=(0,d._5)(),0}destroy(){super.destroy(),(0,d.Qe)(this.cache),this.cache=0,this.cached=!1}sendAVPacket(t){if(!a.f[20](t+24)||!a.f[15](t+28))return 0;const e=(0,d.rU)(t,1);if(e){const{profile:t,sampleRate:i,channels:r}=h._5((0,o.s3)(a.f[20](e),a.f[25](e+4)));n.M[15](this.inCodecpar+48,t),n.M[15](this.inCodecpar+136,i),n.M[15](this.inCodecpar+116,r)}const i=7+a.f[15](t+28),r=(0,l.sY)(i),s=(0,o.s3)(r,i);return s[0]=255,s[1]=240,s[1]|=8,s[1]|=1,s[2]=(a.f[15](this.inCodecpar+48)-1&3)<<6,s[2]|=(15&h.Hm[a.f[15](this.inCodecpar+136)])<<2,s[2]|=(4&a.f[15](this.inCodecpar+116))>>2,s[3]=(3&a.f[15](this.inCodecpar+116))<<6,s[3]|=s.length>>11&3,s[4]=s.length>>3&255,s[5]=(7&s.length)<<5,s[5]|=31,s[6]=252,s.set((0,o.s3)(a.f[20](t+24),a.f[15](t+28)),7),(0,d.zu)(this.cache,t),(0,d.NX)(this.cache,r,i),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,d.Up)(t),(0,d.rN)(t,this.cache),this.cached=!1,0):c.LT}reset(){return 0}}},5144:(t,e,i)=>{i.d(e,{$x:()=>h,GV:()=>s,OS:()=>d,VG:()=>a,ZT:()=>n,eR:()=>r,hY:()=>c,pm:()=>o,qJ:()=>l});const r=204,a=192,n=188,s=204,o=8192,c=5,d=5,l=10,h={15:[1,86018],17:[1,86018],3:[1,86017],4:[1,86017],1:[0,2],2:[0,2],27:[0,27],16:[0,12],36:[0,173],51:[0,196],129:[1,86019],135:[1,86056],130:[1,86020]}},5836:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(1237);function a(){return{pid:r.N_,filter:null,tsPacket:null,pes:null,pendingPES:null,continuityCounter:0,pesSlices:{total:0,buffers:[]},latm:!1}}},6911:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(4467);class a{constructor(){(0,r.A)(this,"type",-1)}async destroy(t){}}(0,r.A)(a,"Capabilities",[])},7124:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(1237),a=i(9085);function n(){return{currentProgram:r.N_,currentPmtPid:r.N_,tsPacketSize:r.N_,hasPAT:!1,hasPMT:!1,tsSliceQueueMap:new Map,pat:new a.Cd,pmt:new a.I4,program2Pmt:new Map,ioEnd:!1,startPid:256,delay:BigInt(0)}}},9031:(t,e,i)=>{i.r(e),i.d(e,{default:()=>x});var r=i(4467),a=i(7127),n=i(9983),s=i(7124),o=i(9085),c=i(6911),d=i(3915),l=i(5836),h=i(4970),p=i(2518),f=i(460),u=i(9681),g=i(3674),U=i(4187),w=i(1755),y=i(3262),m=i(1237),A=i(1958),I=i(1497),P=i(4229),b=i(4096),v=i(3321),F=i(665),C=i(9906);const k="packages/avformat/src/formats/OMpegtsFormat.ts",S={pesMaxSize:2930,delay:1.4,latm:!1,patPeriod:.1};class x extends c.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"type",2),(0,r.A)(this,"context",void 0),(0,r.A)(this,"sdtPacket",void 0),(0,r.A)(this,"patPacket",void 0),(0,r.A)(this,"pmtPacket",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"firstDtsCheck",void 0),(0,r.A)(this,"firstVideoCheck",void 0),(0,r.A)(this,"lastPatDst",void 0),(0,r.A)(this,"patPeriod",void 0),(0,r.A)(this,"avpacket",void 0),this.context=(0,s.A)(),this.options=F.X$({},S,t),this.options.pesMaxSize=this.options.pesMaxSize?(this.options.pesMaxSize+14+183)/184*184-14:0,this.firstDtsCheck=!1,this.firstVideoCheck=!1,this.patPeriod=BigInt(Math.floor(this.options.patPeriod*m.SF))}init(t){return t.ioWriter.setEndian(!0),this.avpacket=(0,U._5)(),0}async destroy(t){super.destroy(t),v.__(t.streams,(t=>{if(1024&t.disposition)return!0;const e=t.privData;e.filter&&(e.filter.destroy(),e.filter=null)})),this.avpacket&&((0,U.Qe)(this.avpacket),this.avpacket=0)}writeHeader(t){return this.context.pat=new o.Cd,this.context.pat.program2PmtPid.set(1,4096),this.context.pmt=new o.I4,this.context.pmt.programNumber=1,v.__(t.streams,(t=>{if(1024&t.disposition)return!0;t.timeBase.den=9e4,t.timeBase.num=1;const e=this.context.startPid++;this.context.pmt.pcrPid<=0&&(this.context.pmt.pcrPid=e);let i=d.Zp(t);const r=(0,l.A)();t.privData=r;const n=new o.am;n.pid=e,n.adaptationFieldControl=1,r.tsPacket=n,r.pid=e;let s=null;switch(i){case 15:this.options.latm?(r.latm=!0,i=17,s=new p.A):s=new h.A;break;case 27:case 36:case 51:s=new u.A;break;case 6:86076===t.codecpar.codecId&&(s=new f.A)}s&&s.init(t.codecpar[a.o9],t.timeBase[a.o9]),r.filter=s,this.context.pmt.pid2StreamType.set(e,i);const c=new o.xf;c.pid=e,c.streamType=i,c.streamId=d.kw(t),r.pes=c})),this.patPacket=new o.yU,this.pmtPacket=new o.yU,this.sdtPacket=new o.yU,this.sdtPacket.pid=17,this.sdtPacket.adaptationFieldControl=1,this.patPacket.pid=0,this.patPacket.adaptationFieldControl=1,this.pmtPacket.pid=4096,this.pmtPacket.adaptationFieldControl=1,this.sdtPacket.payload=d.Gj(),this.patPacket.payload=d.sG(this.context.pat),this.pmtPacket.payload=d.in(this.context.pmt,t.streams.filter((t=>!(1024&t.disposition)))),d.Zn(t.ioWriter,this.sdtPacket,this.context),d.Zn(t.ioWriter,this.patPacket,this.context),d.Zn(t.ioWriter,this.pmtPacket,this.context),0}writeAVPacket(t,e){if(!n.f[15](e+28))return void C.R8(`packet's size is 0: ${n.f[15](e+32)}, ignore it`,k,256);const i=t.getStreamByIndex(n.f[15](e+32));if(!i||1024&i.disposition)return void C.R8(`can not found the stream width the packet's streamIndex: ${n.f[15](e+32)}, ignore it`,k,263);this.firstDtsCheck||((0,y.Mr)(n.f[17](e+16),e+72,i.timeBase)<BigInt(Math.floor(9e4*this.options.delay))&&(this.context.delay=BigInt(Math.floor(9e4*this.options.delay))-(0,y.Mr)(n.f[17](e+16),e+72,i.timeBase)),this.firstDtsCheck=!0,this.lastPatDst=(0,y.Mr)(n.f[17](e+16),e+72,m.KR)),this.patPeriod>BigInt(0)&&(0,y.Mr)(n.f[17](e+16),e+72,m.KR)-this.lastPatDst>this.patPeriod&&(d.Zn(t.ioWriter,this.sdtPacket,this.context),d.Zn(t.ioWriter,this.patPacket,this.context),d.Zn(t.ioWriter,this.pmtPacket,this.context),this.lastPatDst=(0,y.Mr)(n.f[17](e+16),e+72,m.KR));const r=i.privData;let a=(0,U.iI)(e);if(r.filter){if(!this.firstVideoCheck&&(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId)&&1&n.f[15](e+36)){let t=(0,U.fQ)(e,1);if(!t&&64&n.f[15](e+36)&&(27===i.codecpar.codecId?t=!!I.sL((0,U.iI)(e)):173===i.codecpar.codecId?t=!!P.sL((0,U.iI)(e)):196===i.codecpar.codecId&&(t=!!b.sL((0,U.iI)(e)))),this.firstVideoCheck=!0,!t&&i.codecpar.extradata)if(64&n.f[15](e+36)){let t=(0,g.s3)(i.codecpar.extradata,i.codecpar.extradataSize).slice();if(27!==i.codecpar.codecId||I.sL((0,U.iI)(e)))if(173!==i.codecpar.codecId||P.sL((0,U.iI)(e))){if(196===i.codecpar.codecId&&!b.sL((0,U.iI)(e))){let i=[],r=[],a=[];const s=[];if(A.Bs(t))A.py(t).forEach((t=>{const e=t[1]>>>3&31;14===e?a.push(t):15===e?i.push(t):16===e&&r.push(t)}));else{const e=b.HL(t);i=e.spss,r=e.ppss,a=e.vpss}A.py((0,U.iI)(e,!0)).forEach((t=>{20!=(t[1]>>>3&31)&&s.push(t)}));const o=b.wA(a,i,r,s,!!(1&n.f[15](e+36)));(0,U.NX)(e,o.bufferPointer,o.length)}}else{let i=[],r=[],a=[];const n=[];if(A.Bs(t))A.py(t).forEach((t=>{const e=t[0]>>>1&63;32===e?a.push(t):33===e?i.push(t):34===e&&r.push(t)}));else{const e=P.HL(t);i=e.spss,r=e.ppss,a=e.vpss}A.py((0,U.iI)(e,!0)).forEach((t=>{35!=(t[0]>>>1&63)&&n.push(t)}));const s=P.wA(a,i,r,n);(0,U.NX)(e,s.bufferPointer,s.length)}else{let i=[],r=[],a=[];const n=[],s=[];if(A.Bs(t))A.py(t).forEach((t=>{const e=31&t[0];7===e?i.push(t):8===e?r.push(t):13===e&&a.push(t)}));else{const e=I.MB(t);i=e.spss,r=e.ppss,a=e.spsExts}A.py((0,U.iI)(e,!0)).forEach((t=>{const e=31&t[0];6===e?n.push(t):9!==e&&s.push(t)}));const o=I.wA(i,r,a,n,s);(0,U.NX)(e,o.bufferPointer,o.length)}}else{let t=(0,g.s3)(i.codecpar.extradata,i.codecpar.extradataSize).slice();A.Bs(t)&&(27===i.codecpar.codecId?t=I.S1(t):173===i.codecpar.codecId?t=P.S1(t):196===i.codecpar.codecId&&(t=b.S1(t)));const r=(0,w.sY)(t.length);(0,g.lW)(r,t.length,t),(0,U.Ow)(e,1,r,t.length)}}r.filter.sendAVPacket(e),r.filter.receiveAVPacket(this.avpacket),a=(0,U.iI)(this.avpacket),e=this.avpacket}if(!a.length)return 0;a=a.slice();let s=!1;return(r.pesSlices.total+a.length>this.options.pesMaxSize||0===i.codecpar.codecType)&&(0===r.pesSlices.total&&(r.pesSlices.total=a.length,r.pesSlices.buffers.push(a),n.f[17](e+16)!==m.Dh&&(r.pes.dts=(0,y.Mr)(n.f[17](e+16),e+72,i.timeBase)+this.context.delay),n.f[17](e+8)!==m.Dh&&(r.pes.pts=(0,y.Mr)(n.f[17](e+8),e+72,i.timeBase)+this.context.delay),0!==i.codecpar.codecType||1&n.f[15](e+36)?r.pes.randomAccessIndicator=1:r.pes.randomAccessIndicator=0,s=!0),d.CE(t.ioWriter,r.pes,r.pesSlices,i,this.context),r.pesSlices.total=0,r.pesSlices.buffers=[]),s||(0===r.pesSlices.total&&(n.f[17](e+16)!==m.Dh&&(r.pes.dts=(0,y.Mr)(n.f[17](e+16),e+72,i.timeBase)+this.context.delay),n.f[17](e+8)!==m.Dh&&(r.pes.pts=(0,y.Mr)(n.f[17](e+8),e+72,i.timeBase)+this.context.delay),0!==i.codecpar.codecType||1&n.f[15](e+36)?r.pes.randomAccessIndicator=1:r.pes.randomAccessIndicator=0),r.pesSlices.total+=a.length,r.pesSlices.buffers.push(a)),0}writeTrailer(t){return v.__(t.streams,(e=>{const i=e.privData;i&&(i.pesSlices.total&&d.CE(t.ioWriter,i.pes,i.pesSlices,e,this.context),i.pesSlices.total=0,i.pesSlices.buffers=[])})),t.ioWriter.flush(),0}flush(t){return t.ioWriter.flush(),0}getCapabilities(){return x.Capabilities}}(0,r.A)(x,"Capabilities",[86076,86018,86017,86019,,86020,86065,86056,12,225,27,173,196])},9085:(t,e,i)=>{i.d(e,{Cd:()=>c,I4:()=>h,am:()=>s,kJ:()=>l,pi:()=>o,xf:()=>p,yU:()=>d});var r=i(4467),a=i(1237);class n{constructor(){(0,r.A)(this,"discontinuityIndicator",0),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"elementaryStreamPriorityIndicator",0),(0,r.A)(this,"pcrFlag",0),(0,r.A)(this,"opcrFlag",0),(0,r.A)(this,"splicingPointFlag",0),(0,r.A)(this,"transportPrivateDataFlag",0),(0,r.A)(this,"adaptationFieldExtensionFlag",0),(0,r.A)(this,"pcr",BigInt(0)),(0,r.A)(this,"opcr",BigInt(0)),(0,r.A)(this,"spliceCountDown",0),(0,r.A)(this,"transportPrivateData",null),(0,r.A)(this,"extension",null)}}class s{constructor(){(0,r.A)(this,"pos",a.Dh),(0,r.A)(this,"payloadUnitStartIndicator",0),(0,r.A)(this,"transportPriority",0),(0,r.A)(this,"pid",a.N_),(0,r.A)(this,"adaptationFieldControl",0),(0,r.A)(this,"continuityCounter",0),(0,r.A)(this,"transportScramblingControl",0),(0,r.A)(this,"adaptationFieldInfo",new n),(0,r.A)(this,"payload",null)}}class o{constructor(){(0,r.A)(this,"slices",[]),(0,r.A)(this,"totalLength",0),(0,r.A)(this,"expectedLength",a.N_),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"pid",a.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"pos",a.Dh)}}class c{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"networkPid",a.N_),(0,r.A)(this,"program2PmtPid",new Map)}}class d extends s{}class l{constructor(){(0,r.A)(this,"tag",void 0),(0,r.A)(this,"buffer",void 0)}}class h{constructor(){(0,r.A)(this,"versionNumber",0),(0,r.A)(this,"programNumber",0),(0,r.A)(this,"pcrPid",0),(0,r.A)(this,"pid2StreamType",new Map),(0,r.A)(this,"pid2ESDescriptor",new Map)}}class p{constructor(){(0,r.A)(this,"pid",a.N_),(0,r.A)(this,"streamType",0),(0,r.A)(this,"streamId",a.N_),(0,r.A)(this,"dts",a.Dh),(0,r.A)(this,"pts",a.Dh),(0,r.A)(this,"pos",a.Dh),(0,r.A)(this,"payload",null),(0,r.A)(this,"data",null),(0,r.A)(this,"randomAccessIndicator",0),(0,r.A)(this,"flags",void 0)}}},9508:(t,e,i)=>{function r(t){let e=4294967295;for(let i=0;i<t.length;i++){e^=t[i]<<24;for(let t=0;t<8;t++)2147483648&e?e=e<<1^79764919:e<<=1}return e>>>0}i.d(e,{E:()=>r})},9515:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(9906);const a="packages/avformat/src/function/mktag.ts";function n(t){4!==t.length&&r.R8(`tag length is not 4, tag: ${t}`,a,31);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},9681:(t,e,i)=>{i.d(e,{A:()=>g});var r=i(4467),a=i(9983),n=i(2320),s=i(3458),o=i(3674),c=i(9906),d=i(495),l=i(4187),h=i(1958),p=i(1497),f=i(4229),u=i(4096);class g extends s.A{constructor(){super(...arguments),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"naluLengthSizeMinusOne",void 0)}init(t,e){if(super.init(t,e),this.cache=(0,l._5)(),this.cached=!1,a.f[20](t+12)){const e=(0,o.s3)(a.f[20](t+12),a.f[15](t+16));h.Bs(e)||(27===a.f[15](t+4)?this.naluLengthSizeMinusOne=3&e[4]:173===a.f[15](t+4)?this.naluLengthSizeMinusOne=3&e[21]:196===a.f[15](t+4)&&(this.naluLengthSizeMinusOne=e[0]>>>1&3))}return 0}destroy(){super.destroy(),(0,l.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(64&a.f[15](t+36))(0,l.rN)(this.cache,t);else{let e;(0,l.zu)(this.cache,t);const i=(0,l.rU)(t,1);let r=null;i&&(r=(0,o.JW)(a.f[20](i),a.f[25](i+4)),h.Bs(r)||(27===a.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&r[4]:173===a.f[15](this.inCodecpar+4)?this.naluLengthSizeMinusOne=3&r[21]:196===a.f[15](this.inCodecpar+4)&&(this.naluLengthSizeMinusOne=r[0]>>>1&3)));const s=(0,o.JW)(a.f[20](t+24),a.f[15](t+28));27===a.f[15](this.inCodecpar+4)?e=p.OD(s,r,this.naluLengthSizeMinusOne):173===a.f[15](this.inCodecpar+4)?e=f.OD(s,r,this.naluLengthSizeMinusOne):196===a.f[15](this.inCodecpar+4)?e=u.OD(s,r,this.naluLengthSizeMinusOne):c.h2(`not support for codecId: ${a.f[15](this.inCodecpar+4)}`,"packages/avformat/src/bsf/h2645/Avcc2AnnexbFilter.ts",138),n.M[15](this.cache+36,64|a.f[15](this.cache+36)),(0,l.NX)(this.cache,e.bufferPointer,e.length),e.key&&n.M[15](this.cache+36,1|a.f[15](this.cache+36))}return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,l.Up)(t),(0,l.rN)(t,this.cache),this.cached=!1,0):d.LR}reset(){return 0}}}}]);