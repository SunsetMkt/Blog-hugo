!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AVTranscoder=t():e.AVTranscoder=t()}(self,(()=>(()=>{"use strict";var e,t,r={17:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(9906);class a{constructor(){(0,i.A)(this,"tasks",void 0),this.tasks=new Map}async clear(){if(this.tasks.size)for(const e of this.tasks.keys())await this.unregisterTask(e)}async setLogLevel(e){s.V$(e)}async getTaskCount(){return this.tasks.size}}},39:(e,t,r)=>{function i(e,t){let r=0;for(let i=0;i<t;i++)r=2*r+e.readU1();return r}function s(e){let t=0;for(;!i(e,1);)t++;return t>=32?0:i(e,t)+(1<<t)-1}function a(e){let t=0;for(let r=0;r<8;r++){let s=i(e,8);if(t|=(127&s)<<7*r,!(128&s))break}return t}r.d(t,{d:()=>s,f:()=>i,v:()=>a})},84:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(9906);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"bitsLeft",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"endPointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),this.pointer=0,this.bitsLeft=8,this.pos=BigInt(0),this.size=e,this.endPointer=0,this.error=0,this.buffer=new Uint8Array(this.size)}peekU1(){let e=0;(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush();let t=this.pointer,r=this.bitsLeft;return 0===r&&(t++,r=8),e=this.buffer[t]>>r-1&1,e}readU1(){let e=0;return(this.remainingLength()<1||1===this.remainingLength()&&0===this.bitsLeft)&&this.flush(),this.bitsLeft--,e=this.buffer[this.pointer]>>this.bitsLeft&1,0===this.bitsLeft&&(this.pointer++,this.bitsLeft=8,this.pos++),e}readU(e){let t=0;for(let r=0;r<e;r++)t|=this.readU1()<<e-r-1;return t}peekU(e){const t=this.pointer,r=this.bitsLeft,i=this.pos,s=this.readU(e);return this.pointer=t,this.bitsLeft=r,this.pos=i,s}remainingLength(){return this.endPointer-this.pointer}getBitLeft(){return this.bitsLeft}getPointer(){return this.pointer}setPointer(e){this.pointer=e}getPos(){return this.pos}skip(e){const t=(e-e%8)/8;this.pointer+=t,this.pos+=BigInt(t);const r=e%8;this.bitsLeft<=r?(this.pointer++,this.pos++,this.bitsLeft=8-(r-this.bitsLeft)):this.bitsLeft-=r}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOReader error, flush failed because of no flush callback");if(0===this.bitsLeft&&(this.pointer++,this.pos++),!(this.size-this.remainingLength()<=0))if(this.pointer<this.endPointer){this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0);const e=this.onFlush(this.buffer.subarray(this.endPointer-this.pointer,this.size));if(e<0)throw this.error=e,Error("IOReader error, flush failed");this.endPointer=this.endPointer-this.pointer+e,this.pointer=0}else{const e=this.onFlush(this.buffer);if(this.endPointer=e,this.pointer=0,this.bitsLeft=8,e<0)throw this.error=e,Error("IOReader error, flush failed")}}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,s.R8("BSReader, call appendBuffer but the buffer's size is lagger then the remaining size","packages/common/src/io/BitReader.ts",257)}}reset(){this.pointer=this.endPointer=0,this.bitsLeft=8,this.error=0,this.pos=BigInt(0)}skipPadding(){this.bitsLeft<8&&(this.bitsLeft=8,this.pointer++,this.pos++)}}},187:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(9906),a=r(4405);class o{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"byteStart",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}writeUint8(e){this.data.setUint8(this.pos+++this.byteStart,e)}writeUint16(e){this.data.setUint16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeUint24(e){const t=3840&e,r=240&e,i=15&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(r),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(r),this.writeUint8(i))}writeUint32(e){this.data.setUint32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeUint64(e){this.data.setBigUint64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}writeInt8(e){this.data.setInt8(this.pos+++this.byteStart,e)}writeInt16(e){this.data.setInt16(this.pos+this.byteStart,e,this.littleEndian),this.pos+=2}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.data.setInt32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeInt64(e){this.data.setBigInt64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}writeFloat(e){this.data.setFloat32(this.pos+this.byteStart,e,this.littleEndian),this.pos+=4}writeDouble(e){this.data.setFloat64(this.pos+this.byteStart,e,this.littleEndian),this.pos+=8}getPos(){return this.pos}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}writeBuffer(e){let t=e.length;this.remainingSize()<t&&(t=this.remainingSize(),s.R8(`the remaining buffer size is smaller then the wrote buffer, hope set ${e.length}, but set ${t}`,"packages/common/src/io/BufferWriter.ts",202)),this.buffer.set(e,this.pos),this.pos+=e.length}writeString(e){const t=a.encode(e);return this.writeBuffer(t),t.length}getWroteBuffer(){return this.buffer.subarray(0,this.pos)}resetBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},245:(e,t,r)=>{r.d(t,{A:()=>g});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(495),c=r(3394),d=r(1755),h=r(9239),l=r(1058),u=r(3463),f=r(8590),p=r(665),m=r(9906);class g{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"frame",0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"decoderOptions",0),(0,i.A)(this,"timeBase",void 0),(0,i.A)(this,"dtsQueue",[]),this.options=e,this.decoder=new l.A(this.options.resource)}getAVFrame(){return this.frame?this.frame:this.frame=this.options.avframePool?this.options.avframePool.alloc():(0,c.FP)()}outputAVFrame(){this.frame&&(2&s.f[15](this.parameters+160)&&this.dtsQueue.length&&a.M[17](this.frame+104,this.dtsQueue.shift()),this.options.onReceiveAVFrame?(a.M[15](this.frame+124,this.timeBase.den),a.M[15](this.frame+120,this.timeBase.num),this.options.onReceiveAVFrame(this.frame)):this.options.avframePool?this.options.avframePool.release(this.frame):(0,c.xj)(this.frame),this.frame=0)}receiveAVFrame(){return this.decoder.invoke("decoder_receive",this.getAVFrame())}async receiveAVFrameAsync(){return this.decoder.invokeAsync("decoder_receive",this.getAVFrame())}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.decoder.run(void 0,t);let i=0;const c=o.s_.malloc(4);return a.M[20](c,0),p.HP(r).length&&(this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0),this.decoderOptions=(0,d.Gy)(8),p.__(r,((e,t)=>{(f.Yj(e)||f.Yj(t))&&h.a5(this.decoderOptions,t,e)})),a.M[20](c,this.decoderOptions)),u.A.jspi?i=await this.decoder.invokeAsync("decoder_open",e,0,t,c):(i=this.decoder.invoke("decoder_open",e,0,t,c),await this.decoder.childThreadsReady()),this.decoderOptions=s.f[20](c),o.s_.free(c),i<0?(m.z3(`open video decoder failed, ret: ${i}`,"packages/avcodec/src/wasmcodec/VideoDecoder.ts",189),n.r8):(this.parameters=e,this.timeBase=void 0,this.dtsQueue.length=0,0)}decode(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=this.decoder.invoke("decoder_decode",e);if(t)return t;for(2&s.f[15](this.parameters+160)&&this.dtsQueue.push(s.f[17](e+16));;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async decodeAsync(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=await this.decoder.invokeAsync("decoder_decode",e);if(t)return t;for(2&s.f[15](this.parameters+160)&&this.dtsQueue.push(s.f[17](e+16));;){if(t=await this.receiveAVFrameAsync(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.invoke("decoder_flush");;){const e=this.receiveAVFrame();if(e<1)return e;this.outputAVFrame()}return 0}async flushAsync(){for(await this.decoder.invokeAsync("decoder_flush");;){const e=await this.receiveAVFrameAsync();if(e<1)return e;this.outputAVFrame()}return 0}close(){this.decoder.invoke("decoder_close"),this.decoder.destroy(),this.frame&&(this.options.avframePool?this.options.avframePool.release(this.frame):(0,c.xj)(this.frame),this.frame=0),this.parameters=0,this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0)}setSkipFrameDiscard(e){this.decoder.invoke("decoder_discard",e)}getChildThreadCount(){return this.decoder?this.decoder.getChildThreadCount():0}}},294:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(2837),s=r(2494);let a;typeof setImmediate===s.s0&&(0,i.A)(setImmediate)&&(a=setImmediate),a=typeof MessageChannel===s.s0&&(0,i.A)(MessageChannel)?function(e){const t=new MessageChannel;t.port1.onmessage=e,t.port2.postMessage(1)}:"function"==typeof setTimeout?setTimeout:function(e){setTimeout(e)};const o=a},363:(e,t,r)=>{r.r(t),r.d(t,{Timespec:()=>d,wasm_sem_destroy:()=>l,wasm_sem_init:()=>h,wasm_sem_post:()=>m,wasm_sem_timedwait:()=>p,wasm_sem_trywait:()=>f,wasm_sem_wait:()=>u});var i,s=r(4467),a=r(7127),o=r(7601),n=r(9983),c=r(8710);class d{constructor(){(0,s.A)(this,"tvSec",void 0),(0,s.A)(this,"tvNSec",void 0)}}function h(e,t,r){return c.Ts(e,r)}function l(e){return c.zr(e)}function u(e){return c.uk(e)}function f(e){return c.Zr(e)}function p(e,t){let r=1e3*Number(n.f[17](t))+n.f[15](t+8)/1e6;return c.XR(e,r)}function m(e){return c.bE(e)}i=d,(()=>{const e=i.prototype,t=new Map;t.set("tvSec",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("tvNSec",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,8),(0,o.A)(e,a.g7,16),(0,o.A)(e,a.JY,t)})()},381:(e,t,r)=>{r.d(t,{Xv:()=>d,fG:()=>h,oD:()=>c});var i=r(4467),s=r(6262),a=r(4187),o=r(4624);class n{constructor(){(0,i.A)(this,"packetBuffer",void 0),this.packetBuffer=[]}}class c{constructor(){(0,i.A)(this,"metadataHeaderPadding",-1),(0,i.A)(this,"metadata",void 0),(0,i.A)(this,"streams",void 0),(0,i.A)(this,"streamGroups",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"chapters",void 0),(0,i.A)(this,"privateData",void 0),(0,i.A)(this,"privateData2",void 0),(0,i.A)(this,"iformat",void 0),(0,i.A)(this,"oformat",void 0),(0,i.A)(this,"ioReader",void 0),(0,i.A)(this,"ioWriter",void 0),(0,i.A)(this,"errorFlag",void 0),(0,i.A)(this,"interval",void 0),(0,i.A)(this,"streamIndex",void 0),(0,i.A)(this,"streamGroupIndex",void 0),(0,i.A)(this,"getDecoderResource",null),this.streams=[],this.streamGroups=[],this.errorFlag=0,this.streamIndex=0,this.streamGroupIndex=0,this.interval=new n,this.options={},this.privateData={},this.metadata={},this.chapters=[]}get format(){return this.iformat?this.iformat.type:this.oformat?this.oformat.type:-1}getStreamById(e){return this.streams.find((t=>t.id===e))}getStreamGroupById(e){return this.streamGroups.find((t=>t.id===e))}getStreamByIndex(e){return this.streams.find((t=>t.index===e))}getStreamGroupByIndex(e){return this.streamGroups.find((t=>t.index===e))}getStreamByMediaType(e){return this.streams.find((t=>{var r;return(null===(r=t.codecpar)||void 0===r?void 0:r.codecType)===e&&!(1024&t.disposition)}))}getStreamGroupByGroupType(e){return this.streamGroups.find((t=>t.type===e))}getAttachmentPicture(){return this.streams.find((e=>{var t;return 0===(null===(t=e.codecpar)||void 0===t?void 0:t.codecType)&&1024&e.disposition}))}createStream(){const e=new s.Ay;return e.index=this.streamIndex++,e.id=(0,o.A)(),this.removeStreamByIndex(e.index),this.streams.push(e),e}createStreamGroup(e){const t=new s.Tr;return t.index=this.streamGroupIndex++,t.type=e,t.id=(0,o.A)(),this.removeStreamGroupByIndex(t.index),this.streamGroups.push(t),t}addStream(e){this.removeStreamByIndex(e.index),this.streams.push(e)}addStreamGroup(e){this.removeStreamGroupByIndex(e.index),this.streamGroups.push(e)}addStreamToStreamGroup(e,t){e.streams.some((e=>e===t))||e.streams.push(t)}removeStream(e){this.removeStreamByIndex(e.index)}removeStreamGroup(e){this.removeStreamGroupByIndex(e.index)}removeStreamById(e){const t=this.streams.findIndex((t=>t.id===e));if(t>-1){const e=this.streams.splice(t,1);e[0]&&e[0].destroy()}}removeStreamGroupById(e){const t=this.streamGroups.findIndex((t=>t.id===e));if(t>-1){const e=this.streamGroups.splice(t,1);e[0]&&e[0].destroy()}}removeStreamByIndex(e){const t=this.streams.findIndex((t=>t.index===e));if(t>-1){const e=this.streams.splice(t,1);e[0]&&e[0].destroy()}}removeStreamGroupByIndex(e){const t=this.streamGroups.findIndex((t=>t.index===e));if(t>-1){const e=this.streamGroups.splice(t,1);e[0]&&e[0].destroy()}}async destroy(){this.oformat&&this.oformat.destroy(this),this.iformat&&await this.iformat.destroy(this),this.interval.packetBuffer.length&&this.interval.packetBuffer.forEach((e=>{(0,a.Qe)(e)})),this.streams.forEach((e=>{e.destroy()})),this.streams=[],this.interval=null,this.ioReader=this.ioWriter=null,this.oformat=this.iformat=null}}function d(){return new c}function h(){return new c}},399:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(8590),s=r(2494);function a(e,t,r){if(i.Pc(e))return i.YO(r)?e.apply(t,r):t!==s.ZH?e.call(t,r):r!==s.ZH?e(r):e()}},432:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(665);const a={isLive:!1,preload:5242880,retryCount:20,retryInterval:1};class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,i.A)(this,"options",void 0),(0,i.A)(this,"status",void 0),(0,i.A)(this,"retryCount",void 0),(0,i.A)(this,"retryTimeout",void 0),this.options=e,this.status=0,this.retryCount=0,this.options=s.X$({},a),s.X$(this.options,e)}write(e){throw new Error("need implemented write function")}}},449:(e,t,r)=>{r.d(t,{ML:()=>h,bl:()=>d,xY:()=>l});var i=r(9983),s=r(2320),a=r(9377),o=r(1755),n=r(495),c=r(3674);function d(e){2==i.f[15](e)&&(0,o.aI)(e+8),(0,c.sO)(e,0,24)}function h(e,t){return t?(s.M[15](e,1),s.M[15](e+4,(0,a.Xb)(t)),s.M[10](e+8,t),0):n.UY}function l(e,t){if(t<=0)throw new Error("invalid channels");const r=(0,o.Gy)(24*t);for(let e=0;e<t;e++)s.M[15](r+24*e,768);s.M[15](e,2),s.M[15](e+4,t),s.M[20](e+8,r)}},495:(e,t,r)=>{r.d(t,{E$:()=>i,LR:()=>s,LT:()=>d,NU:()=>l,OY:()=>c,UY:()=>a,gR:()=>o,lh:()=>n,nr:()=>u,r8:()=>h});const i=-1,s=-2,a=-3,o=-4,n=-5,c=-6,d=-7,h=-8,l=-9,u=-10},499:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(4467),s=r(6332),a=r(1762),o=r(2316),n=r(2905);let c,d=0;function h(){return c?(d++,c):(c=new o.A,d=1,c)}function l(){0!==d&&(d--,0===d&&(c.destroy(),c=null))}class u{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.A)(this,"messageChannel",void 0),(0,i.A)(this,"interval",void 0),(0,i.A)(this,"started",void 0),(0,i.A)(this,"timer",void 0),(0,i.A)(this,"workerTimer",void 0),(0,i.A)(this,"workerSetTimeout",void 0),(0,i.A)(this,"onClock",void 0),(0,i.A)(this,"nextTick",void 0),(0,i.A)(this,"a",void 0),(0,i.A)(this,"b",void 0),(0,i.A)(this,"beta",void 0),(0,i.A)(this,"alpha",void 0),(0,i.A)(this,"count",void 0),(0,i.A)(this,"equivalent",void 0),(0,i.A)(this,"timestamp",void 0),(0,i.A)(this,"onVisibilityChange",void 0),(0,i.A)(this,"timeoutNext",void 0),(0,i.A)(this,"running",void 0),(0,i.A)(this,"highPerformance",void 0),(0,i.A)(this,"forceWorker",void 0),this.started=!1,this.interval=e,this.highPerformance=t,this.forceWorker=r,this.a=.2,this.b=4,this.equivalent=50,this.timestamp=0,this.nextTick=()=>{if(this.started&&!this.running)if(this.running=!0,this.interval>=4||!this.highPerformance)this.timeoutTick();else if(this.interval<=0)this.messageChannel.port1.postMessage(null);else{const e=(0,a.A)();e-this.timestamp>this.equivalent&&(this.count=0,this.timestamp=e),this.count<this.beta?this.messageChannel.port1.postMessage(null):this.timeoutTick()}},this.compute(),this.messageChannel=new MessageChannel,this.handleEvent(),this.timeoutNext=e=>{e?this.workerTimer=null:this.timer=null,this.running=!1,this.count++,this.onClock?this.onClock(this.nextTick):this.nextTick()},(0,s.A)()||"hidden"!==document.visibilityState||(this.workerSetTimeout=h()),this.running=!1}compute(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.interval>0&&(this.beta=Math.ceil(this.equivalent*(1-this.b/this.interval)/(this.a-this.b)),this.alpha=Math.floor(this.equivalent/this.interval-this.beta),e&&(this.count=0))}timeoutTick(){this.workerSetTimeout&&"hidden"===document.visibilityState&&(this.interval<1e3||this.forceWorker)?this.workerTimer=this.workerSetTimeout.setTimeout(this.timeoutNext,this.interval):this.timer=setTimeout(this.timeoutNext,this.interval)}start(){this.started||(this.started=!0,this.timestamp=(0,a.A)(),this.nextTick())}stop(){this.started=!1,this.timer&&(clearTimeout(this.timer),this.timer=null),this.workerTimer&&this.workerSetTimeout&&this.workerSetTimeout.clearTimeout(this.workerTimer),this.running=!1}isStarted(){return this.started}setInterval(e){this.interval=Math.max(e,0),this.compute()}getInterval(){return this.interval}isZeroTimeout(){return this.interval<4}destroy(){this.stop(),this.workerSetTimeout&&(l(),this.workerSetTimeout=null),this.onVisibilityChange&&(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.onVisibilityChange=null)}handleEvent(){this.messageChannel.port2.onmessage=()=>{this.started&&(this.running=!1,this.count++,this.onClock?this.onClock(this.nextTick):this.nextTick())},(0,s.A)()||(this.onVisibilityChange=(0,n.A)((e=>{"hidden"===document.visibilityState?(this.workerSetTimeout=h(),this.timer&&(clearTimeout(this.timer),this.timer=null,this.running=!1),this.nextTick()):(this.workerTimer&&(this.workerSetTimeout.clearTimeout(this.workerTimer),this.workerTimer=null,this.running=!1),this.timer&&(clearTimeout(this.timer),this.timer=null,this.running=!1),l(),this.workerSetTimeout=null,this.nextTick())}),20),document.addEventListener("visibilitychange",this.onVisibilityChange))}}},524:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(9983),s=r(3262),a=r(3674),o=r(1237);function n(e){const t=1&i.f[15](e+36);return new EncodedAudioChunk({type:t?"key":"delta",duration:i.f[17](e+48)<0?void 0:Number((0,s.Mr)(i.f[17](e+48),e+72,o.KR)),timestamp:i.f[17](e+8)===o.Dh?o.N_:Number((0,s.Mr)(i.f[17](e+8),e+72,o.KR)),data:(0,a.s3)(i.f[20](e+24),i.f[15](e+28))})}},544:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(4125),a=r(2935);class o{constructor(e){(0,i.A)(this,"demuxerControlChannel",void 0),(0,i.A)(this,"demuxerControlIPCPort",void 0),(0,i.A)(this,"observer",void 0),this.observer=e,this.demuxerControlChannel=(0,s.A)(),this.demuxerControlIPCPort=new a.Ay(this.demuxerControlChannel.port2),this.demuxerControlIPCPort.on(a.S3,(async e=>{"getDecoderResource"===e.method&&this.demuxerControlIPCPort.reply(e,await this.observer.onGetDecoderResource(e.params.mediaType,e.params.codecId))}))}getDemuxerRenderControlPort(){return this.demuxerControlChannel.port1}destroy(){this.demuxerControlIPCPort&&this.demuxerControlIPCPort.destroy(),this.demuxerControlChannel=null}}},576:(e,t,r)=>{function i(e,t){for(;0!==t;)[e,t]=[t,e%t];return e}r.d(t,{A:()=>i})},624:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var i=r(2494),s=r(8590),a=r(2935);let o=i.TK;function n(e){let t;o.onmessage=r=>{const n=r.data,c=n.type,d=n.data;switch(c){case"init":if(i.TK.CHeap&&i.TK.CHeap.initThread&&i.TK.CHeap.Config.USE_THREADS)return void i.TK.CHeap.initThread(d).then((()=>{o.postMessage({type:"ready"})}));o.postMessage({type:"ready"});break;case"run":o.postMessage({type:"running"}),h=d.port,t=new a.Ay(h),t.on(a.S3,(async r=>{const i=r.method,a=r.params;if(s.Pc(e[i]))try{e[i].transfer||(e[i].transfer=[]);const s=await e[i](...a.params);t.reply(r,s,null,e[i].transfer),e[i].transfer.length=0}catch(e){t.reply(r,-2097152,{message:e.message})}}));break;case"stop":t&&t.destroy(),i.TK.__freeSmartPtr__&&i.TK.__freeSmartPtr__(),o.postMessage({type:"stopped"})}var h}}},652:(e,t,r)=>{r.d(t,{A:()=>M});var i=r(9882),s=r(7921),a=r(3463),o=r(8288),n=r(1762),c=r(294);let d;const h=s.USE_THREADS||!o.A.chrome&&a.A.atomics||o.A.checkVersion(o.A.majorVersion,"94",!0);function l(e,t,r,i){if(h)return Atomics.add(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]+=t,o}}function u(e,t,r,i){if(h)return Atomics.sub(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]-=t,o}}function f(e,t,r,i){if(h)return Atomics.and(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]&=t,o}}function p(e,t,r,i){if(h)return Atomics.or(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]|=t,o}}function m(e,t,r,i){if(h)return Atomics.xor(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]^=t,o}}function g(e,t,r,i){if(h)return Atomics.store(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]=t,o}}function A(e,t,r){return h?Atomics.load(d(t),e>>>r):d(t)[e>>>r]}function v(e,t,r,i,s){if(h)return Atomics.compareExchange(d(i),e>>>s,t,r);{const a=d(i),o=e>>>s,n=a[o];return n===t&&(a[o]=r),n}}function w(e,t,r,i){if(h)return Atomics.exchange(d(r),e>>>i,t);{const s=d(r),a=e>>>i,o=s[a];return s[a]=t,o}}function y(e,t){return h?Atomics.notify(d(16),e>>>2,t):void 0}const b={ok:0,"not-equal":1,"timed-out":2};function k(e,t){return b[Atomics.wait(d(16),e>>>2,t)]}function _(e,t,r){return b[Atomics.wait(d(16),e>>>2,t,r)]}async function I(e,t){if(Atomics.waitAsync){const r=Atomics.waitAsync(d(16),e>>>2,t);return r.async?b[await r.value]:b[r.value]}if(A(e)!==t)return 1;for(;A(e)===t;)await new Promise((e=>{(0,c.A)((()=>{e()}))}));return 0}async function x(e,t,r){if(Atomics.waitAsync){const i=Atomics.waitAsync(d(16),e>>>2,t,r);return i.async?b[await i.value]:b[i.value]}if(A(e)!==t)return 1;{const i=(0,n.A)();for(;A(e)===t&&(0,n.A)()-i<r;)await new Promise((e=>{(0,c.A)((()=>{e()}))}));return A(e)!==t?0:2}}function M(e){d=e,(0,i.$Z)({add:l,sub:u,and:f,or:p,xor:m,store:g,load:A,compareExchange:v,exchange:w,notify:y,wait:k,waitTimeout:_,waitAsync:I,waitTimeoutAsync:x})}},665:(e,t,r)=>{r.d(t,{BE:()=>f,C:()=>l,HP:()=>n,X$:()=>h,__:()=>c,zy:()=>u});var i=r(8590),s=r(3321),a=r(2494),o=r(5967);function n(e){return(0,o.A)(e)?Object.keys(e):[]}function c(e,t){for(let r in e)if(t(e[r],r)===a.W8)break}function d(e,t){return i.Ik(e)?i.Ik(t)?(c(t,(function(t,r){e[r]=t})),e):e:t}function h(e,t,r){return d(d(e,t),r)}function l(e,t){let r=e;return i.YO(e)?t?(r=[],s.__(e,(function(e,i){r[i]=l(e,t)}))):r=e.slice():i.Ik(e)&&(r={},c(e,(function(e,i){r[i]=t?l(e,t):e}))),r}function u(e,t){return e[t]!==a.ZH}function f(e){const t={};return c(e,((e,r)=>{t[e]=r})),t}},679:(e,t,r)=>{r.d(t,{Fn:()=>l,T$:()=>u,iT:()=>f});var i=r(4012),s=r(865),a=r(6766),o=r(5267),n=r(9906);const c="packages/avfilter/src/graph.ts";function d(e,t){const r=e.options;switch(t&&(r.avframePool=t),e.type){case"resampler":return new s.A(r);case"scaler":return new o.A(r);case"range":return new i.A(r);case"framerate":return new a.A(r);default:throw new Error(`invalid GraphNodeType, ${e.type}`)}}let h=0;function l(e,t){return{id:h++,type:e,options:t}}function u(e,t){const r=[],i=[],s=[],a=new Map,o=new Map,h=new Map;return e.vertices.forEach((e=>{const i={id:e.id,filter:d(e,t),children:[],parents:[]};a.set(i.id,i),r.push(i)})),e.edges.forEach(((e,t)=>{const r=a.get(e.parent),i=a.get(e.child);r||n.h2(`${t} edge parent(${e.parent}) not found`,c,125),i||n.h2(`${t} edge child(${e.child}) not found`,c,128),r.children.push(i),i.parents.push(r),o.set(r.id,!0),h.set(i.id,!0),r.filter.connect(i.filter)})),e.vertices.forEach((e=>{h.has(e.id)||i.push(a.get(e.id)),o.has(e.id)||s.push(a.get(e.id))})),{vertices:r,edges:e.edges,inputs:i,outputs:s}}function f(e,t,r){const i=new Map,s=new Map;for(let e=0;e<t.length;e++)i.has(t[e].id)?i.set(t[e].id,i.get(t[e].id)+1):i.set(t[e].id,1);for(let e=0;e<r.length;e++)s.has(r[e].id)?s.set(r[e].id,s.get(r[e].id)+1):s.set(r[e].id,1);for(let t=0;t<e.inputs.length;t++){var a;if(e.inputs[t].filter.getInputCount()>(null!==(a=i.get(e.inputs[t].id))&&void 0!==a?a:0))return n.z3(`input filter(${e.inputs[t].id}) only has ${i.get(e.inputs[t].id)} input channel port`,c,178),!1}for(let t=0;t<e.outputs.length;t++){var o;if(e.outputs[t].filter.getOutputCount()>(null!==(o=s.get(e.outputs[t].id))&&void 0!==o?o:0))return n.z3(`output filter(${e.outputs[t].id}) only has ${s.get(e.outputs[t].id)} output channel port`,c,185),!1}for(let t=0;t<e.vertices.length;t++)if(e.vertices[t].children.length&&e.vertices[t].parents.length){if(e.vertices[t].filter.getOutputCount()!==e.vertices[t].children.length)return n.z3(`filter(${e.vertices[t].id}) only has ${e.vertices[t].children.length} output channel port`,c,193),!1;if(e.vertices[t].filter.getInputCount()!==e.vertices[t].parents.length)return n.z3(`filter(${e.vertices[t].id}) only has ${e.vertices[t].parents.length} input channel port`,c,197),!1}return!0}},700:(e,t,r)=>{r.d(t,{XA:()=>g,bX:()=>v,bx:()=>m,dJ:()=>A,ho:()=>p});var i=r(9983),s=r(2320),a=r(7526),o=r(495),n=r(1237),c=r(3321),d=r(665),h=r(1605),l=r(9906);const u="packages/avformat/src/mux.ts",f={zeroStart:!1,nonnegative:!1};function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=d.X$({},f,t);e.ioWriter||l.h2("need ioWriter",u,65),e.oformat||l.h2("need oformat",u,68),e.options=r,e.privateData2={firstPts:new Map,firstDts:new Map,dtsPtsDelta:new Map};let i=e.oformat.getCapabilities();if(i)for(let t=0;t<e.streams.length;t++){if(1024&e.streams[t].disposition)continue;const r=e.streams[t].codecpar.codecId,s=e.streams[t].codecpar.codecType;if(16===e.oformat.type){if(r<65536||r>69683)return l.z3(`format ${(0,a.L_)(e.oformat.type)} not support codecId ${(0,a.eG)(e.streams[t].codecpar.codecType,r)}`,u,90),o.r8}else if(2!==s&&4!==s&&!c.zy(i,r))return l.z3(`format ${(0,a.L_)(e.oformat.type)} not support codecId ${(0,a.eG)(e.streams[t].codecpar.codecType,r)}`,u,98),o.r8}return e.oformat.init(e)}function m(e){return e.oformat.writeHeader(e),0}function g(e,t){const r=e.privateData2;return r.firstDts.has(i.f[15](t+32))||r.firstDts.set(i.f[15](t+32),i.f[17](t+16)===n.Dh?BigInt(0):i.f[17](t+16)),r.firstPts.has(i.f[15](t+32))||(r.firstPts.set(i.f[15](t+32),i.f[17](t+8)===n.Dh?BigInt(0):i.f[17](t+8)),r.dtsPtsDelta.set(i.f[15](t+32),h.jk(r.firstDts.get(i.f[15](t+32)),r.firstPts.get(i.f[15](t+32))))),(e.options.zeroStart||e.options.nonnegative&&(r.firstDts.get(i.f[15](t+32))<0||r.firstPts.get(i.f[15](t+32))<0))&&(s.M[17](t+16,i.f[17](t+16)-r.dtsPtsDelta.get(i.f[15](t+32))),s.M[17](t+8,i.f[17](t+8)-r.dtsPtsDelta.get(i.f[15](t+32)))),e.oformat.writeAVPacket(e,t)}function A(e){return e.oformat.writeTrailer(e),0}function v(e){e.oformat.flush(e)}},714:(e,t,r)=>{r.d(t,{WA:()=>h,ab:()=>u,lL:()=>p,mt:()=>l,nG:()=>f});var i=r(9983),s=r(2320),a=r(3394),o=r(3139),n=r(4365),c=r(1237),d=r(1730);function h(e){var t;return null!==(t=d.GR[e])&&void 0!==t?t:-1}function l(e){var t;return null!==(t=d.SY[e])&&void 0!==t?t:1}function u(e){var t;return null!==(t=d.OG[e])&&void 0!==t?t:1}function f(e){var t;return null!==(t=d.re[e])&&void 0!==t?t:1}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0===t?t=(0,a.FP)():(0,a.to)(t),s.M[15](t+80,h(e.format)),s.M[17](t+104,BigInt(Math.floor(e.timestamp))),s.M[17](t+232,i.f[17](t+104)),s.M[15](t+68,e.codedWidth),s.M[15](t+72,e.codedHeight),s.M[17](t+312,BigInt(Math.floor(e.duration))),s.M[15](t+124,c.SF),s.M[15](t+120,1),s.M[15](t+220,l(e.colorSpace.matrix)),s.M[15](t+212,u(e.colorSpace.primaries)),s.M[15](t+216,f(e.colorSpace.transfer)),s.M[15](t+208,e.colorSpace.fullRange?2:1),e.visibleRect&&(s.M[25](t+276,e.visibleRect.left),s.M[25](t+280,e.codedWidth-e.visibleRect.right),s.M[25](t+268,e.visibleRect.top),s.M[25](t+272,e.codedHeight-e.visibleRect.bottom)),(0,a.UD)(t);const r=(0,o.I)(i.f[15](t+80)),d=[];for(let e=0;e<r.comp.length;e++)r.comp[e].plane>=e&&d.push({offset:i.f[20](t+4*e),stride:i.f[15](t+32+4*e)});return await e.copyTo((0,n.Lv)(),{layout:d}),t}},769:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(4405);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,r&&r.view)this.size=r.length,this.buffer=r,this.data=r.view;else if(r&&!r.byteOffset)this.size=r.length,this.buffer=r,this.data=new DataView(this.buffer.buffer);else{if(r)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}async writeUint8(e){this.remainingLength()<1&&await this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}async writeUint16(e){this.remainingLength()<2&&await this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}async writeUint24(e){this.remainingLength()<3&&await this.flush();const t=(16711680&e)>>16,r=(65280&e)>>8,i=255&e;this.littleEndian?(await this.writeUint8(i),await this.writeUint8(r),await this.writeUint8(t)):(await this.writeUint8(t),await this.writeUint8(r),await this.writeUint8(i))}async writeUint32(e){this.remainingLength()<4&&await this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeUint64(e){this.remainingLength()<8&&await this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}async writeInt8(e){this.remainingLength()<1&&await this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}async writeInt16(e){this.remainingLength()<2&&await this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}async writeInt24(e){await this.writeUint24(e<0?e+16777216:e)}async writeInt32(e){this.remainingLength()<4&&await this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeInt64(e){this.remainingLength()<8&&await this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}async writeFloat(e){this.remainingLength()<4&&await this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}async writeDouble(e){this.remainingLength()<8&&await this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}async writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let r=0;for(;t>0;){await this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(r,r+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),r+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}async writeString(e){const t=s.encode(e);return await this.writeBuffer(t),t.length}async flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=await this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}async flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=await this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}async seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");await this.flush();const t=await this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}},825:(e,t,r)=>{r.d(t,{B:()=>y,CK:()=>b,LS:()=>k,Lq:()=>M,Pp:()=>P,WU:()=>x,h2:()=>I,nK:()=>_});var i,s=r(4467),a=r(7127),o=r(2320),n=r(7601),c=r(9983),d=r(3674),h=r(4405),l=r(5316);const u=[null,[],[]],f=0,p=28;function m(e,t){const r=u[e];0===t||10===t?(console.log.bind(console)(h.decode(r)),r.length=0):r.push(t)}const g={};let A,v="./this.program";function w(){if(!A){const e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:v||"./this.program"};for(let t in g)e[t]=g[t];const t=[];for(let r in e)t.push(r+"="+e[r]);A=t}return A}function y(e,t){let r=0;return w().forEach((function(i,s){const a=t+r;o.M[20](e+4*s,a),function(e,t){for(let r=0;r<e.length;++r)o.M[4](t,e.charCodeAt(r)),t+=1;o.M[4](t,0)}(i,a),r+=i.length+1})),0}function b(e,t){const r=w();o.M[25](e,r.length);let i=0;return r.forEach((function(e){i+=e.length+1})),o.M[25](t,i),0}function k(e,t){let r=0;return 0==e?r=2:1!=e&&2!=e||(r=64),o.M[11](t,2),o.M[13](t+2,1),o.M[15](t+8,r),o.M[15](t+12,0),o.M[17](t+16,BigInt(0)),f}function _(e,t,r,i){let s=0;for(let i=0;i<r;i++){let r=c.f[20](t),i=c.f[25](t+4);for(let t=0;t<i;t++)m(e,c.f[4](r+t));s+=i,t+=8}return o.M[25](i,s),f}function I(e){throw e=`abort(${e+=""}). Build with -s ASSERTIONS=1 for more info.`,new WebAssembly.RuntimeError(e)}function x(e,t,r){if(0!==e)return p;const i=(new Date).getTime();return o.M[10](r,BigInt(i)*BigInt(1e6)),f}function M(e,t){return 0!==e?p:(o.M[10](t,BigInt(1e6)),f)}function P(e,t){const r=(0,d.s3)(e,t);return(0,l.A)(r),f}i=class{constructor(){(0,s.A)(this,"buf",void 0),(0,s.A)(this,"len",void 0)}},(()=>{const e=i.prototype,t=new Map;t.set("buf",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("len",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,n.A)(e,a.Og,!0),(0,n.A)(e,a.dc,4),(0,n.A)(e,a.g7,8),(0,n.A)(e,a.JY,t)})()},865:(e,t,r)=>{r.d(t,{A:()=>v});var i=r(4467),s=r(3674),a=r(9983),o=r(2320),n=r(495),c=r(3394),d=r(1755),h=r(6229),l=r(1237),u=r(8842),f=r(2364),p=r(5238),m=r(3554),g=r(8590),A=r(9906);class v extends m.A{constructor(e){super(e,1,1),(0,i.A)(this,"resampler",void 0),(0,i.A)(this,"pcm",0)}async ready(){this.pcm=(0,d.Gy)(48)}async destroy(){this.pcm&&(a.f[20](this.pcm)&&((0,d.aI)(a.f[20](this.pcm)),(0,d.aI)(this.pcm)),(0,d.Eb)(this.pcm)),this.resampler&&(this.resampler.close(),this.resampler=void 0)}async process(e,t){const r=e[0];if(r<0)return void(t[0]=r);const i=this.options.avframePool?this.options.avframePool.alloc():(0,c.FP)();if(a.f[15](r+152)!==this.options.output.sampleRate||a.f[15](r+292)!==this.options.output.channels||a.f[15](r+80)!==this.options.output.format&&this.options.output.format!==l.N_){if(this.resampler){const e=this.resampler.getInputPCMParameters();e.channels===a.f[15](r+292)&&e.sampleRate===a.f[15](r+152)&&e.format===a.f[15](r+80)||(this.resampler.close(),this.resampler=void 0)}if(!this.resampler){let e=this.options.resource;g.sv(e)&&(e=await(0,f.A)(e)),this.resampler=new p.A({resource:e});const i=await this.resampler.open({channels:a.f[15](r+292),sampleRate:a.f[15](r+152),format:a.f[15](r+80)},{channels:this.options.output.channels,sampleRate:this.options.output.sampleRate,format:this.options.output.format===l.N_?a.f[15](r+80):this.options.output.format});if(i)return A.z3(`open resampler failed, error ${i}`,"packages/avfilter/src/audio/ResampleFilterNode.ts",112),void(t[0]=n.E$)}this.resampler.resample(a.f[20](r+64),this.pcm,a.f[15](r+76)),o.M[15](i+80,this.options.output.format===l.N_?a.f[15](r+80):this.options.output.format),o.M[15](i+76,a.f[15](this.pcm+8)),o.M[15](i+152,a.f[15](this.pcm+20)),o.M[15](i+292,a.f[15](this.pcm+16)),o.M[15](i+32,a.f[15](this.pcm+4)),o.M[17](i+104,a.f[17](r+104)),o.M[17](i+312,a.f[17](r+312)),o.M[17](i+112,a.f[17](r+112)),(0,s.Mr)(i+120,r+120,8);const e=u.K0(a.f[15](i+80)),m=e?a.f[15](i+292):1;if(m>l.pu){if(o.M[20](i+64,(0,d.sY)(4*m)),!a.f[20](i+64))return(0,d.aI)(i+64),void(t[0]=n.gR)}else o.M[20](i+64,i);for(let r=0;r<Math.min(m,l.pu);r++){if(0===r&&(o.M[20](i+156+4*r,(0,h.aw)(a.f[20](a.f[20](this.pcm)+4*r),a.f[15](this.pcm+4)*(e?a.f[15](this.pcm+16):1))),!a.f[20](i+156+4*r)))return(0,c.to)(i),void(t[0]=n.gR);o.M[20](a.f[20](i+64)+4*r,a.f[20](a.f[20](this.pcm)+4*r)),o.M[20](i+4*r,a.f[20](a.f[20](this.pcm)+4*r)),o.M[20](a.f[20](this.pcm)+4*r,0)}for(let e=0;e<m-l.pu;e++)o.M[20](a.f[20](i+64)+4*(e+l.pu),a.f[20](a.f[20](this.pcm)+4*e)),o.M[20](a.f[20](this.pcm)+4*e,0);o.M[15](this.pcm+12,0),t[0]=i}else(0,c.gg)(i,r),t[0]=i}}},872:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(4365),s=r(7127),a=r(3214),o=r(5951),n=r(3463);function c(e){const t=e[s.o9];t&&(i.s_.free(t),e[s.o9]=0,n.A.proxy?(0,a.SQ)(e):(0,o.X)(e))}},882:(e,t,r)=>{r.d(t,{KJ:()=>d,Ko:()=>h,Ts:()=>l});var i=r(3669),s=r(9658),a=r(9906),o=r(9179),n=r(9882);const c="packages/cheap/src/thread/asm/atomics.ts";let d;function h(){return!!d}function l(e,t,r){try{if(!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))return;{const a=s.bx(i.E_(o.A),{shared:!0,initial:t,maximum:r});d=new WebAssembly.Instance(new WebAssembly.Module(a),{env:{memory:e}})}(0,n.$Z)({add:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.add8(e,t);case 12:return d.exports.add8(e,t);case 14:return d.exports.add16(e,t);case 7:return 65535&d.exports.add16(e,t);case 16:return d.exports.add32(e,t);case 9:return 4294967295&d.exports.add32(e,t);case 21:return d.exports.add64(e,t);case 22:return BigInt.asUintN(64,d.exports.add64(e,t))}},sub:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.sub8(e,t);case 12:return d.exports.sub8(e,t);case 14:return d.exports.sub16(e,t);case 7:return 65535&d.exports.sub16(e,t);case 16:return d.exports.sub32(e,t);case 9:return 4294967295&d.exports.sub32(e,t);case 21:return d.exports.sub64(e,t);case 22:return BigInt.asUintN(64,d.exports.sub64(e,t))}},and:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.and8(e,t);case 12:return d.exports.and8(e,t);case 14:return d.exports.and16(e,t);case 7:return 65535&d.exports.and16(e,t);case 16:return d.exports.and32(e,t);case 9:return 4294967295&d.exports.and32(e,t);case 21:return d.exports.and64(e,t);case 22:return BigInt.asUintN(64,d.exports.and64(e,t))}},or:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.or8(e,t);case 12:return d.exports.or8(e,t);case 14:return d.exports.or16(e,t);case 7:return 65535&d.exports.or16(e,t);case 16:case 9:return d.exports.or32(e,t);case 21:return d.exports.or64(e,t);case 22:return BigInt.asUintN(64,d.exports.or64(e,t))}},xor:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.xor8(e,t);case 12:return d.exports.xor8(e,t);case 14:return d.exports.xor16(e,t);case 7:return 65535&d.exports.xor16(e,t);case 16:case 9:return d.exports.xor32(e,t);case 21:return d.exports.xor64(e,t);case 22:return BigInt.asUintN(64,d.exports.xor64(e,t))}},store:function(e,t,r){switch(r){case 5:case 12:case 3:return d.exports.store8(e,t);case 14:case 7:return d.exports.store16(e,t);case 16:case 9:return d.exports.store32(e,t);case 21:case 22:return d.exports.store64(e,t)}},load:function(e,t){switch(t){case 5:case 3:return 255&d.exports.load8(e);case 12:return d.exports.load8(e);case 14:case 7:return d.exports.load16(e);case 16:return d.exports.load32(e);case 9:return 4294967295&d.exports.load32(e);case 21:return d.exports.load64(e);case 22:return BigInt.asUintN(64,d.exports.load64(e))}},compareExchange:function(e,t,r,i){switch(i){case 5:case 3:return 255&d.exports.compare_exchange8(e,t,r);case 12:return d.exports.compare_exchange8(e,t,r);case 14:return d.exports.compare_exchange16(e,t,r);case 7:return 65535&d.exports.compare_exchange16(e,t,r);case 16:return d.exports.compare_exchange32(e,t,r);case 9:return 4294967295&d.exports.compare_exchange32(e,t,r);case 21:return d.exports.compare_exchange64(e,t,r);case 22:return BigInt.asUintN(64,d.exports.compare_exchange64(e,t,r))}},exchange:function(e,t,r){switch(r){case 5:case 3:return 255&d.exports.exchange8(e,t);case 12:return d.exports.exchange8(e,t);case 14:return d.exports.exchange16(e,t);case 7:return 65535&d.exports.exchange16(e,t);case 16:return d.exports.exchange32(e,t);case 9:return 4294967295&d.exports.exchange32(e,t);case 21:return d.exports.exchange64(e,t);case 22:return BigInt.asUintN(64,d.exports.exchange64(e,t))}},notify:function(e,t){return d.exports.notify(e,t)},wait:function(e,t){return d.exports.wait(e,t)},waitTimeout:function(e,t,r){return d.exports.waitTimeout(e,t,BigInt(0|r)*BigInt(1e6))}})}catch(e){a.R8("atomics asm not support, cannot use asm atomics function",c,289)}}},1003:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(4467),s=r(1755),a=r(3394),o=r(9882),n=r(5419);class c{constructor(e,t){(0,i.A)(this,"list",void 0),(0,i.A)(this,"mutex",void 0),this.list=e,this.mutex=t}alloc(){let e=this.list.find((e=>-1===o.p_(e+320,-1,1,16,2)),20);return e||(e=(0,s.Gy)(328),(0,a._h)(e),o.M_(e+320,1,16,2),n.s2(this.mutex),this.list.push(e,20),n.Tl(this.mutex)),e}release(e){o.Hh(e+320,16,2)<=0||1===o.jb(e+320,1,16,2)&&((0,a.to)(e),o.M_(e+320,-1,16,2))}}},1042:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(4467),s=r(8590),a=r(3321),o=r(5041),n=r(665),c=r(8927),d=r(399),h=r(2494);class l{constructor(e){(0,i.A)(this,"ns",void 0),(0,i.A)(this,"listeners",void 0),(0,i.A)(this,"nativeListeners",void 0),this.ns=e||h.W8,this.listeners={}}fire(e,t,r){let i=this,c=s.Yj(e)?i.parse(e):e,l=i.listeners[c.type],u=h.rT;if(l){l=n.C(l);const e=t&&t[0]instanceof o.A?t[0]:h.ZH;a.__(l,(function(s){if(!p(c.ns,s,h.rT)||!a.zy(l,s)||r&&!r(c,t,s))return;e&&(e.listener=s.fn);let o=(0,d.A)(s.fn,s.ctx,t);return e&&(e.listener=h.ZH),s.num=s.num?s.num+1:1,s.num===s.max&&i.off(c,s.fn),e&&(o===h.W8?e.prevent().stop():e.isStopped&&(o=h.W8)),o===h.W8?u=h.W8:void 0}))}return u}on(e,t){const r=this,i=r.listeners,o=s.Pc(t)?{fn:t}:t;if(s.Ik(o)&&s.Pc(o.fn)){const t=s.Yj(e)?r.parse(e):e;o.ns=t.ns,a.VC(i[t.type]||(i[t.type]=[]),o)}return this}one(e,t){return s.Pc(t)?t={fn:t,max:1}:t.max=1,this.on(e,t)}off(e,t){const r=this,i=r.listeners;if(e){const o=s.Yj(e)?r.parse(e):e,c=o.type,d=o.ns,l=f(t),u=function(e,t){a.__(e,(function(t,r){l(t)&&e.splice(r,1)}),h.rT),e.length||delete i[t]},m=function(e,t){a.__(e,(function(t,r){p(d,t)&&e.splice(r,1)}),h.rT),e.length||delete i[t]};c?i[c]&&u(i[c],c):d&&n.__(i,m)}else r.listeners={}}has(e,t){let r=this.listeners,i=s.Yj(e)?this.parse(e):e,o=i.type,c=i.ns,d=h.rT,l=f(t);var u;return o?r[o]&&(u=r[o],a.__(u,(function(e){if(l(e))return d=h.W8}))):c&&n.__(r,(function(e){return a.__(e,(function(e){if(p(c,e))return d=h.W8})),d})),!d}parse(e){const t={type:e,ns:h.u1};if(this.ns){const r=c.qh(e,h.ZG);r>=0&&(t.type=c.di(e,0,r),t.ns=c.di(e,r+1))}return t}}function u(){return h.rT}function f(e){return s.Pc(e)?function(t){return e===t.fn}:u}function p(e,t,r){const{ns:i}=t;return i&&e?i===e:r?h.rT:h.W8}},1058:(e,t,r)=>{r.d(t,{A:()=>D});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(3674),c=r(825),d=r(7656),h=r(4169),l=r(363),u=r(7921),f=r(9882),p=r(882),m=r(9973),g=r(4897),A=r(4138),v=r(4026),w=r(5419),y=(r(8387),r(2494)),b=r(8335),k=r(3463),_=r(8590),I=r(3321),x=r(665),M=r(9906),P=r(2990),T=r(6332),E=r(2107);const B="packages/cheap/src/webassembly/WebAssemblyRunner.ts";let C=y.TK.Worker;function S(){}let U=!1;class D{static getTable(){return o.XI}static mutexLock(e){w.s2(e)}static mutexUnlock(e){w.Tl(e)}static condWait(e,t){v.uk(e,t)}static readPointer(e){return s.f[20](e)}static writePointer(e,t){a.M[20](e,t)}constructor(e){var t,r;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,i.A)(this,"resource",void 0),(0,i.A)(this,"instance",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"builtinMalloc",void 0),(0,i.A)(this,"memoryBase",void 0),(0,i.A)(this,"tableBase",void 0),(0,i.A)(this,"childImports",void 0),(0,i.A)(this,"childUrl",void 0),(0,i.A)(this,"childImportUrl",void 0),(0,i.A)(this,"childBlob",void 0),(0,i.A)(this,"childThreads",void 0),(0,i.A)(this,"imports",void 0),(0,i.A)(this,"childReadyPromises",void 0),(0,i.A)(this,"threadPool",void 0),(0,i.A)(this,"initCalling",void 0),(0,i.A)(this,"promisingMap",void 0),this.resource=e,this.builtinMalloc=[],this.initCalling=!1,this.childThreads=new Map,this.childReadyPromises=[],this.promisingMap=new Map,_.Yj(p.childImports)?this.childImports=p.childImports:_.Ik(p.childImports)&&p.childImports instanceof Blob&&(this.childImports=URL.createObjectURL(p.childImports)),this.memoryBase=e.dataSize?o.s_.alignedAlloc(null!==(t=e.dataAlign)&&void 0!==t?t:8,e.dataSize):0,this.memoryBase&&e.bssSize&&(0,n.sO)(this.memoryBase+(e.dataSize-e.bssSize),0,e.bssSize),p.thread&&p.tableBase&&o.XI.getPointer()!==p.tableBase&&o.XI.alloc(p.tableBase-o.XI.getPointer()),this.tableBase=e.tableSize?o.XI.alloc(e.tableSize):0,this.options=p,this.imports={env:{memory:o.ce,__stack_pointer:o.GE,__indirect_function_table:o.XI.table,clock_time_get:c.WU,clock_res_get:c.Lq,random_get:c.Pp,abort:c.h2,proc_exit:function(e){M.z3(`wasm module exit, code: ${e}`,B,171)},__syscall_renameat:S,__syscall_unlinkat:S,environ_get:c.B,environ_sizes_get:c.CK,fd_close:S,fd_fdstat_get:c.LS,fd_read:S,fd_seek:S,fd_write:c.nK,emscripten_builtin_malloc:e=>{const t=o.s_.malloc(e);return this.builtinMalloc.push(t),t},emscripten_builtin_free:e=>{o.s_.free(e)},emscripten_builtin_memalign:(e,t,r)=>{const i=o.s_.alignedAlloc(t,r);return 0!==i?(a.M[20](e,i),this.builtinMalloc.push(i),0):-1},emscripten_memcpy_big:function(e,t,r){(0,n.Mr)(e,t,r)},__libc_malloc:function(e){return o.s_.malloc(e)},__libc_free:e=>{o.s_.free(e)},malloc:e=>{if(!0===this.initCalling){const t=o.s_.malloc(e);return this.builtinMalloc.push(t),t}return o.s_.malloc(e)},calloc:function(e,t){return o.s_.calloc(e,t)},realloc:function(e,t){return o.s_.realloc(e,t)},aligned_alloc:(e,t)=>o.s_.alignedAlloc(e,t),free:function(e){o.s_.free(e)},posix_memalign:function(e,t,r){const i=o.s_.alignedAlloc(t,r);return 0!==i?(a.M[20](e,i),0):-1},memalign:function(e,t){return o.s_.alignedAlloc(e,t)}},"GOT.func":{malloc:new WebAssembly.Global({mutable:!0,value:"i32"},2),calloc:new WebAssembly.Global({mutable:!0,value:"i32"},3),realloc:new WebAssembly.Global({mutable:!0,value:"i32"},4),aligned_alloc:new WebAssembly.Global({mutable:!0,value:"i32"},5),free:new WebAssembly.Global({mutable:!0,value:"i32"},1)}};{const e=(e,t,r,i)=>{if(this.threadPool&&this.threadPool.hasFree())return this.threadPool.createThread(e,t,r,i),0;this.childUrl||this.createChildUrl();const c=(0,o.pv)(),d=new C(this.childUrl,{name:y.TK.name?`${y.TK.name}-Thread-${c}`:""});a.M[15](e,c),a.M[16](e+12,1),a.M[15](e+8,0),a.M[20](e+4,0);const h=o.s_.alignedAlloc(u.STACK_ALIGNMENT,u.STACK_SIZE),l=o.s_.malloc(8);(0,n.sO)(l,0,8),this.childThreads.set(s.f[15](e),{thread:e,worker:d,stackPointer:h,threadDescriptor:l});const{promise:f,resolve:p}=(0,E.A)();k.A.jspi||this.childReadyPromises.push(f);return d.onmessage=e=>{const t=e.data,r=t.type;t.data,"run"===r&&p(0)},this.childImportUrl&&d.postMessage({type:"import",data:{url:this.childImportUrl.href}}),d.postMessage({type:"run",data:{cheap:{memory:o.ce,stackPointer:h,stackSize:u.STACK_SIZE,id:s.f[15](e)},runner:{resource:{tableSize:this.resource.tableSize,module:this.resource.threadModule.module,initFuncs:this.resource.threadModule.initFuncs},options:{memoryBase:this.options.memoryBase||this.memoryBase,tableBase:this.tableBase,thread:e,threadDescriptor:l,childImports:this.childImports},func:r,args:i,imports:this.childImports,thread:e}}}),k.A.jspi?f:0};x.X$(this.imports.env,{wasm_pthread_create:k.A.jspi?new WebAssembly.Suspending(e):e,wasm_pthread_join2:(e,t)=>{if(this.threadPool&&this.threadPool.isPoolThread(e))return this.threadPool.joinThread(e,t),0;if(1&s.f[15](e+8))return this.childThreads.delete(s.f[15](e)),0;f.uk(e+12,1),0!==t&&a.M[20](t,s.f[20](e+4));const r=this.childThreads.get(s.f[15](e));return o.s_.free(r.stackPointer),o.s_.free(r.threadDescriptor),r.worker.terminate(),this.childThreads.delete(s.f[15](e)),(0,n.sO)(e,0,16),0},wasm_pthread_detach2:e=>{if(this.threadPool&&this.threadPool.isPoolThread(e))return this.threadPool.detachThread(e),0;const t=this.childThreads.get(s.f[15](e));a.M[15](t.threadDescriptor,1|s.f[15](t.threadDescriptor)),a.M[15](e+8,1|s.f[15](e+8))}}),x.X$(this.imports.env,d),x.X$(this.imports.env,h),x.X$(this.imports.env,l)}if(this.memoryBase?x.X$(this.imports.env,{__memory_base:this.memoryBase}):p.memoryBase&&x.X$(this.imports.env,{__memory_base:p.memoryBase}),this.tableBase&&x.X$(this.imports.env,{__table_base:this.tableBase}),null!==(r=p.imports)&&void 0!==r&&r.env&&(x.X$(this.imports.env,p.imports.env),p.envKey&&p.importMap)){const e={};x.__(this.imports.env,((t,r)=>{p.importMap[r]&&(e[p.importMap[r]]=t)})),this.imports[p.envKey]=e}this.imports.wasi_snapshot_preview1=this.imports.env}createChildUrl(){{let e="";{r(8387);const t=(0,b.A)(1058,{varName:"__WebAssemblyRunner__",exportName:"__WebAssemblyRunner__",pointName:D.name,exportIsClass:!0}),i=(0,b.A)(8387,{varName:"runThread"});let s="",a="";this.childImports&&(s=`importScripts('${this.childImports}');`),y.TK.CHEAP_POLYFILL_URL&&(a=`importScripts('${y.TK.CHEAP_POLYFILL_URL}');`),e=`\n          ${t}\n          ${i}\n          self.imports = {env:{}};\n          ${a}\n          ${s}\n          runThread.default();\n        `}this.childBlob=new Blob([e],{type:"text/javascript"}),this.childUrl=URL.createObjectURL(this.childBlob)}}overrideAtomic(){d.override({atomic_add_i8:p.KJ.exports.add8,atomic_sub_i8:p.KJ.exports.sub8,atomic_and_i8:p.KJ.exports.and8,atomic_or_i8:p.KJ.exports.or8,atomic_xor_i8:p.KJ.exports.xor8,atomic_store_i8:p.KJ.exports.store8,atomic_load_i8:p.KJ.exports.load8,atomic_compare_exchange_i8:p.KJ.exports.compare_exchange8,atomic_exchange_i8:p.KJ.exports.exchange8,atomic_add_i16:p.KJ.exports.add16,atomic_sub_i16:p.KJ.exports.sub16,atomic_and_i16:p.KJ.exports.and16,atomic_or_i16:p.KJ.exports.or16,atomic_xor_i16:p.KJ.exports.xor16,atomic_store_i16:p.KJ.exports.store16,atomic_load_i16:p.KJ.exports.load16,atomic_compare_exchange_i16:p.KJ.exports.compare_exchange16,atomic_exchange_i16:p.KJ.exports.exchange16,atomic_add_i32:p.KJ.exports.add32,atomic_sub_i32:p.KJ.exports.sub32,atomic_and_i32:p.KJ.exports.and32,atomic_or_i32:p.KJ.exports.or32,atomic_xor_i32:p.KJ.exports.xor32,atomic_store_i32:p.KJ.exports.store32,atomic_load_i32:p.KJ.exports.load32,atomic_compare_exchange_i32:p.KJ.exports.compare_exchange32,atomic_exchange_i32:p.KJ.exports.exchange32,atomic_add_i64:p.KJ.exports.add64,atomic_sub_i64:p.KJ.exports.sub64,atomic_and_i64:p.KJ.exports.and64,atomic_or_i64:p.KJ.exports.or64,atomic_xor_i64:p.KJ.exports.xor64,atomic_store_i64:p.KJ.exports.store64,atomic_load_i64:p.KJ.exports.load64,atomic_compare_exchange_i64:p.KJ.exports.compare_exchange64,atomic_exchange_i64:p.KJ.exports.exchange64,atomics_notify:p.KJ.exports.notify,atomics_wait:p.KJ.exports.wait}),x.X$(this.imports.env,d)}async run(e,t){if(_.Ik(e)&&x.X$(this.options.imports,e),g.Ko()&&this.resource.threadModule&&(g.LK||(g.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM,h.override),(0,T.A)()||(0,P.A)()||!k.A.jspi||h.override({wasm_pthread_mutex_lock:new WebAssembly.Suspending(h.wasm_pthread_mutex_lock_async),wasm_pthread_cond_wait:new WebAssembly.Suspending(h.wasm_pthread_cond_wait_async),wasm_pthread_cond_timedwait:new WebAssembly.Suspending(h.wasm_pthread_cond_timedwait_async)})),x.X$(this.imports.env,h)),!m.LK&&m.Ko()&&m.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM),!U&&p.Ko()&&(U=!0,this.overrideAtomic()),this.instance=await WebAssembly.instantiate(this.resource.module,this.imports),this.initRunTime(),this.resource.threadModule&&this.resource.enableThreadPool&&t>0&&!k.A.jspi){this.childUrl||this.createChildUrl();let e=t;this.resource.enableThreadCountRate&&(e*=this.resource.enableThreadCountRate),this.threadPool=new A.A(e,this.childUrl,this.childImportUrl),await this.threadPool.ready({tableSize:this.resource.tableSize,module:this.resource.threadModule.module,initFuncs:this.resource.threadModule.initFuncs,memoryBase:this.options.memoryBase||this.memoryBase,tableBase:this.tableBase,childImports:this.childImports})}}runAsChild(e){_.Ik(e)&&x.X$(this.options.imports,e),g.Ko()&&(g.LK||g.Ts(o.ce,u.HEAP_INITIAL,u.HEAP_MAXIMUM,h.override),x.X$(this.imports.env,h)),!U&&p.Ko()&&(U=!0,this.overrideAtomic()),this.instance=new WebAssembly.Instance(this.resource.module,this.imports),this.initRunTime()}async childThreadsReady(){if(!this.childReadyPromises.length)return;const e=this.childReadyPromises;this.childReadyPromises=[],await Promise.all(e)}initRunTime(){this.builtinMalloc=[],this.initCalling=!0,_.YO(this.resource.initFuncs)&&I.__(this.resource.initFuncs,(e=>{let t;if(this.asm[e]&&(t=this.asm[e]),t)return t()})),this.initCalling=!1}invoke(e){if(!this.asm)return-1;let t;if(this.asm[e]?t=this.asm[e]:this.options.exportMap&&this.options.exportMap[e]&&this.asm[this.options.exportMap[e]]&&(t=this.asm[this.options.exportMap[e]]),t){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return t.apply(null,i)}M.z3(`the wasm module has not function ${e} to call`,B,737)}async invokeAsync(e){if(!this.asm)return-1;for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(!k.A.jspi)return this.invoke(e,...r);let s;if(this.promisingMap.has(e)?s=this.promisingMap.get(e):(this.asm[e]?s=this.asm[e]:this.options.exportMap&&this.options.exportMap[e]&&this.asm[this.options.exportMap[e]]&&(s=this.asm[this.options.exportMap[e]]),s=WebAssembly.promising(s),this.promisingMap.set(e,s)),s)return s.apply(null,r);M.z3(`the wasm module has not function ${e} to call`,B,778)}get asm(){return this.instance&&this.instance.exports}getInstance(){return this.instance}getChildThreadCount(){return this.childThreads.size}destroy(){var e;null!==(e=this.builtinMalloc)&&void 0!==e&&e.length&&(I.__(this.builtinMalloc,(e=>{o.s_.free(e)})),this.builtinMalloc.length=0),this.memoryBase&&(o.s_.free(this.memoryBase),this.memoryBase=null),this.tableBase&&(o.XI.free(this.tableBase),this.tableBase=0),this.childImports&&(URL.revokeObjectURL(this.childImports),this.childImports=null),this.childUrl&&(_.Yj(this.childUrl)&&URL.revokeObjectURL(this.childUrl),this.childUrl=null),this.childBlob=null,this.childImportUrl=null,this.childReadyPromises.length=0,this.childThreads.size&&this.childThreads.forEach(((e,t)=>{1&s.f[15](e.threadDescriptor)||(M.R8("has child thread running, maybe resource leakage",B,839),e.worker.terminate(),a.M[16](e.thread+12,0),e.stackPointer&&o.s_.free(e.stackPointer),o.s_.free(e.threadDescriptor),this.childThreads.delete(t))})),this.builtinMalloc=null,this.instance=null,this.options.thread&&(this.options.threadDescriptor&&a.M[15](this.options.threadDescriptor+4,0),this.options.threadDescriptor&&(1&s.f[15](this.options.threadDescriptor)||4&s.f[15](this.options.thread+8))?2&s.f[15](this.options.threadDescriptor)||(o.wE&&o.s_.free(o.wE),o.s_.free(this.options.threadDescriptor),(0,n.sO)(this.options.thread,0,16),self.close()):(a.M[16](this.options.thread+12,0),f.me(this.options.thread+12,1))),this.threadPool&&this.threadPool.destroy(),this.threadPool=null,this.promisingMap&&(this.promisingMap.clear(),this.promisingMap=null)}}},1228:(e,t,r)=>{r.d(t,{A:()=>g});var i,s,a=r(4467),o=r(7127),n=r(7601),c=r(4365),d=r(9983),h=r(2320),l=r(8085),u=r(3674),f=r(8590),p=r(6890);class m{constructor(){(0,a.A)(this,"prev",void 0),(0,a.A)(this,"next",void 0),(0,a.A)(this,"data",void 0)}}i=m,(()=>{const e=i.prototype,t=new Map;t.set("prev",{0:i,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("next",{0:i,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("data",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,12),(0,n.A)(e,o.JY,t)})();class g{constructor(){(0,a.A)(this,"length",0),(0,a.A)(this,"head",0),(0,a.A)(this,"tail",0)}createNode(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=c.s_.malloc(12);if(h.M[20](i+4,0),h.M[20](i,0),f.ai(t))if(20===t)h.M[20](i+8,e);else{const r=c.s_.malloc((0,l.A)(t));h.M[t](r,e),h.M[20](i+8,r)}else if(r)h.M[20](i+8,e);else{const r=c.s_.malloc((0,l.A)(t));(0,u.Mr)(r,e[o.o9],(0,l.A)(t)),h.M[20](i+8,r)}return i}getItem(e,t){let r;return r=f.ai(t)?20===t?e:d.f[t](e):(0,p.A)(e,t),r}push(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.createNode(e,t,r);this.tail?(h.M[20](this.tail+4,i),h.M[20](i,this.tail),this.tail=i):(this.head=i,this.tail=i),this.length++}pop(e){const t=this.tail;let r=this.getItem(d.f[20](t+8),e);return this.length>1?(h.M[20](d.f[20](t)+4,0),this.tail=d.f[20](t)):(this.head=0,this.tail=0),this.length--,c.s_.free(d.f[20](t+8)),c.s_.free(t),r}shift(e){const t=this.head;let r=this.getItem(d.f[20](t+8),e);return this.length>1?(h.M[20](d.f[20](t+4),0),this.head=d.f[20](t+4)):(this.head=0,this.tail=0),this.length--,c.s_.free(d.f[20](t+8)),c.s_.free(t),r}unshift(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this.createNode(e,t,r);this.head?(h.M[20](this.head,i),h.M[20](i+4,this.head),this.head=i):(this.head=i,this.tail=i),this.length++}forEach(e,t){if(!this.length)return;let r=this.head,i=0;for(;0!==r&&!1!==e(this.getItem(d.f[20](r+8),t),i);)r=d.f[20](r+4),i++}find(e,t){if(!this.length)return 0;let r=this.head,i=0;for(;0!==r;){const s=this.getItem(d.f[20](r+8),t);if(!0===e(s,i))return s;r=d.f[20](r+4),i++}return 0}indexOf(e,t){if(!this.length)return 0;let r=this.head,i=0;for(;0!==r;){if(i===e)return this.getItem(d.f[20](r+8),t);r=d.f[20](r+4),i++}return 0}clear(e,t){if(this.length){let r=this.head;for(;0!==r;){e&&e(this.getItem(d.f[20](r+8),t)),c.s_.free(d.f[20](r+8));const i=d.f[20](r+4);c.s_.free(r),r=i}}this.head=0,this.tail=0,this.length=0}}s=g,(()=>{const e=s.prototype,t=new Map;t.set("length",{0:8,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("head",{0:m,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("tail",{0:m,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,12),(0,n.A)(e,o.JY,t)})()},1237:(e,t,r)=>{r.d(t,{Dh:()=>s,FQ:()=>l,H3:()=>c,KR:()=>d,N_:()=>a,SF:()=>o,f7:()=>m,go:()=>u,i0:()=>h,mN:()=>g,pu:()=>A,qs:()=>n,vh:()=>f,zg:()=>p});var i=r(7145);const s=-BigInt(1),a=-1,o=1e6,n=1e3,c=1e9,d=new i.Q({den:o,num:1}),h=new i.Q({den:n,num:1}),l=new i.Q({den:c,num:1}),u=(new i.Q({den:1,num:1}),2147483647),f=BigInt(0x8000000000000000),p=65535,m=4294967295,g=BigInt(0x10000000000000000),A=8},1277:(e,t,r)=>{r.d(t,{J:()=>i});const i={0:{bits:8,planar:!1},1:{bits:16,planar:!1},2:{bits:32,planar:!1},10:{bits:64,planar:!1},3:{bits:32,planar:!1},4:{bits:64,planar:!1},5:{bits:8,planar:!0},6:{bits:16,planar:!0},7:{bits:32,planar:!0},11:{bits:64,planar:!0},8:{bits:32,planar:!0},9:{bits:64,planar:!0}}},1292:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(4467),s=r(4310),a=r(495),o=r(665),n=r(9906),c=r(1762),d=r(432);const h="packages/avnetwork/src/ioLoader/FetchIOLoader.ts";class l extends d.A{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),(0,i.A)(this,"contentLength",void 0),(0,i.A)(this,"receivedLength",void 0),(0,i.A)(this,"info",void 0),(0,i.A)(this,"range",void 0),(0,i.A)(this,"startBytes",void 0),(0,i.A)(this,"endBytes",void 0),(0,i.A)(this,"eofIndex",void 0),(0,i.A)(this,"abortController",void 0),(0,i.A)(this,"reader",void 0),(0,i.A)(this,"buffers",void 0),(0,i.A)(this,"supportRange",void 0),(0,i.A)(this,"abortSleep_",void 0),(0,i.A)(this,"aborted",void 0),(0,i.A)(this,"bandwidth",void 0),(0,i.A)(this,"delay",void 0)}async getTotalSize(e){var t,r,i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={method:e,headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(t=this.info.httpOptions)&&void 0!==t&&t.headers&&o.__(this.info.httpOptions.headers,((e,t)=>{a.headers[t]=e})),o.__(s,((e,t)=>{a.headers[t]=e})),null!==(r=this.info.httpOptions)&&void 0!==r&&r.credentials&&(a.credentials=this.info.httpOptions.credentials),null!==(i=this.info.httpOptions)&&void 0!==i&&i.referrerPolicy&&(a.referrerPolicy=this.info.httpOptions.referrerPolicy),"function"==typeof AbortController&&(this.abortController=new AbortController,a.signal=this.abortController.signal);try{const e=await fetch(this.info.url,a);if(e.ok&&e.status>=200&&e.status<=299){this.abortController&&(this.abortController.abort(),this.abortController=null);const t=e.headers.get("Accept-Ranges");t&&-1===t.indexOf("bytes")&&(this.supportRange=!1);const r=e.headers.get("Content-Range");if(r){const e=r.split("/")[1];if(e)return parseInt(e)}const i=e.headers.get("X-Content-Length")||e.headers.get("Content-Length");if(null!=i)return parseInt(i)}}catch(e){}return 0}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{from:0,to:-1};var r;if(this.info=e,this.range=t,this.range.to||(this.range.to=-1),this.range.from=Math.max(this.range.from,0),this.startBytes=0,this.endBytes=-1,this.eofIndex=-1,this.receivedLength=0,this.buffers=[],this.supportRange=!0,this.aborted=!1,this.bandwidth=0,this.range.to>0&&(this.eofIndex=t.to),this.range&&!this.options.isLive&&(this.startBytes=null!==(r=this.range.from)&&void 0!==r?r:0),this.status=1,!this.options.isLive&&!this.options.disableSegment){let e=await this.getTotalSize("HEAD");e||(e=await this.getTotalSize("Get",{range:"bytes=0-1"})),e<=2&&(e=0),e?(this.contentLength=e,this.range.to<0&&(this.eofIndex=this.contentLength+this.range.to),this.supportRange&&(this.endBytes=Math.min(this.startBytes+this.options.preload-1,this.eofIndex))):this.endBytes=-1}return this.status=2,0}getBandwidthReader(e,t){const r=[];let i,s=!1,a=0;const o=this;return new ReadableStream({async start(n){for(;;){const{value:n,done:d}=await e.read();if(d){s=!0;const e=((0,c.A)()-t)/1e3;o.bandwidth=8*a/e,i&&(i(),i=null);break}r.push(n),a+=n.length,i&&(i(),i=null)}},async pull(e){for(;;){if(r.length)return void e.enqueue(r.shift());if(s&&!r.length)return void e.close();await new Promise((e=>{i=e}))}}}).getReader()}async openReader(){var e,t,r;const i={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(e=this.info.httpOptions)&&void 0!==e&&e.headers&&o.__(this.info.httpOptions.headers,((e,t)=>{i.headers[t]=e})),this.options.isLive||this.options.disableSegment||(i.headers.range=`bytes=${this.startBytes}-${this.endBytes>0?this.endBytes:""}`),null!==(t=this.info.httpOptions)&&void 0!==t&&t.credentials&&(i.credentials=this.info.httpOptions.credentials),null!==(r=this.info.httpOptions)&&void 0!==r&&r.referrerPolicy&&(i.referrerPolicy=this.info.httpOptions.referrerPolicy),this.abortController&&this.abortController.abort(),"function"==typeof AbortController&&(this.abortController=new AbortController,i.signal=this.abortController.signal);try{const e=(0,c.A)(),t=await fetch(this.info.url,i),r=(0,c.A)();this.delay=r-e,t.ok&&t.status>=200&&t.status<=299?this.reader=this.options.enableBandwidthReader?this.getBandwidthReader(t.body.getReader(),r):t.body.getReader():(this.status=3,n.h2(`FetchStreamLoader: Http code invalid, ${t.status} ${t.statusText}`,h,297))}catch(e){if(this.retryCount<this.options.retryCount&&(!this.options.isLive||!this.receivedLength)){if(this.retryCount++,this.status=1,this.abortSleep_=new s.A(this.options.retryInterval),await this.abortSleep_,this.abortSleep_=null,this.aborted)return;return this.openReader()}n.h2(`FetchStreamLoader: exception ${e.message}`,h,314)}}async readInterval(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(;this.buffers.length&&r<e.length;){const t=this.buffers.shift();t.length>e.length-r?(e.set(t.subarray(0,e.length-r),r),this.buffers.unshift(t.subarray(e.length-r)),r=e.length):(e.set(t,r),r+=t.length)}if(r>=e.length)return e.length+t;if(4===this.status)return r>0?r+t:t>0?t:-1048576;if(!this.reader&&(await this.openReader(),this.aborted))return-1048576;const{value:i,done:s}=await this.reader.read();return s?void 0!==this.contentLength&&this.receivedLength+this.range.from<this.endBytes+1?(this.status=3,void n.h2("Fetch stream meet Early-EOF",h,356)):this.options.isLive||this.options.disableSegment||this.receivedLength+this.range.from>=this.eofIndex?(this.status=4,this.startBytes=0,r>0?r+t:t>0?t:-1048576):(await this.reader.cancel(),this.abortController&&(this.abortController.abort(),this.abortController=null),this.reader=null,this.startBytes=this.endBytes+1,this.endBytes=Math.min(this.startBytes+this.options.preload-1,this.eofIndex),this.readInterval(e.subarray(r,void 0,!0),r)):(this.receivedLength+=i.length,i.length>e.length-r?(e.set(i.subarray(0,e.length-r),r),this.buffers.push(i.subarray(e.length-r)),e.length+t):(e.set(i,r),r+=i.length,r+t))}async read(e){return this.readInterval(e)}async seek(e){return this.supportRange?this.eofIndex>0&&Number(e)>this.eofIndex?a.nr:(await this.abort(),this.aborted=!1,this.receivedLength=Number(e)-this.range.from,this.startBytes=Number(e),this.options.disableSegment||(this.endBytes=Math.min(this.startBytes+this.options.preload,this.eofIndex)),this.buffers.length=0,4===this.status&&(this.status=2),0):a.NU}async size(){return this.options.isLive?BigInt(0):BigInt(Math.floor(this.contentLength||0))}abortSleep(){this.aborted=!0,this.abortSleep_&&(this.abortSleep_.stop(),this.abortSleep_=null)}async abort(){this.abortSleep(),this.reader&&(await this.reader.cancel(),this.abortController&&(this.abortController.abort(),this.abortController=null),this.reader=null)}async stop(){this.status=0,await this.abort()}getUrl(){var e;return null===(e=this.info)||void 0===e?void 0:e.url}}},1497:(e,t,r)=>{r.d(t,{MB:()=>b,OD:()=>T,S1:()=>_,XC:()=>E,k9:()=>y,kM:()=>P,mW:()=>B,oT:()=>x,sL:()=>I,tZ:()=>v,wA:()=>M,wf:()=>C});var i=r(9983),s=r(1958),a=r(1755),o=r(2149),n=r(2171),c=r(8636),d=r(3674),h=r(3321),l=r(9906),u=r(84),f=r(5815),p=r(187);const m="packages/avutil/src/codecs/h264.ts",g=16,A=3,v={66:"Constrained Baseline",77:"Main",100:"High",110:"High10",122:"High422",244:"High444"},w=[{level:10,maxResolution:25344,maxFrameRate:15},{level:11,maxResolution:25344,maxFrameRate:30},{level:12,maxResolution:101376,maxFrameRate:30},{level:13,maxResolution:101376,maxFrameRate:30},{level:20,maxResolution:101376,maxFrameRate:30},{level:21,maxResolution:202752,maxFrameRate:30},{level:22,maxResolution:414720,maxFrameRate:30},{level:30,maxResolution:414720,maxFrameRate:30},{level:31,maxResolution:921600,maxFrameRate:30},{level:32,maxResolution:1310720,maxFrameRate:60},{level:40,maxResolution:2097152,maxFrameRate:30},{level:41,maxResolution:2097152,maxFrameRate:60},{level:42,maxResolution:2228224,maxFrameRate:60},{level:50,maxResolution:8912896,maxFrameRate:30},{level:51,maxResolution:8912896,maxFrameRate:60},{level:52,maxResolution:8912896,maxFrameRate:120},{level:60,maxResolution:35651584,maxFrameRate:30},{level:61,maxResolution:35651584,maxFrameRate:60},{level:62,maxResolution:35651584,maxFrameRate:120}];function y(e,t,r){const i=e*t;for(const e of w)if(i<=e.maxResolution&&r<=e.maxFrameRate)return e.level}function b(e){const t=new f.A(e);t.skip(5);const r=[],i=[],s=[],a=31&t.readUint8();for(let e=0;e<a;e++){const e=t.readUint16();r.push(t.readBuffer(e))}const o=t.readUint8();for(let e=0;e<o;e++){const e=t.readUint16();i.push(t.readBuffer(e))}if(t.remainingSize()>4){t.skip(3);const e=t.readUint8();if(e>0)for(let r=0;r<e;r++){const e=t.readUint16();s.push(t.readBuffer(e))}}return{spss:r,ppss:i,spsExts:s}}function k(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];e.length>32&&(l.R8(`h264 metadata's sps max length is 32, but get ${e.length}`,m,227),e=e.slice(0,32)),e.length>256&&(l.R8(`h264 metadata's pps max length is 256, but get ${e.length}`,m,231),e=e.slice(0,256));let i=7;i=e.reduce(((e,t)=>e+2+t.length),i),i=t.reduce(((e,t)=>e+2+t.length),i);const s=e[0],a=C(s);66!==a.profile&&77!==a.profile&&88!==a.profile&&(i+=4,r.length&&(i=r.reduce(((e,t)=>e+2+t.length),i)));const o=new Uint8Array(i),n=new p.A(o);return n.writeUint8(1),n.writeUint8(s[1]),n.writeUint8(s[2]),n.writeUint8(s[3]),n.writeUint8(252|A),n.writeUint8(224|31&e.length),h.__(e,(e=>{n.writeUint16(e.length),n.writeBuffer(e)})),n.writeUint8(t.length),h.__(t,(e=>{n.writeUint16(e.length),n.writeBuffer(e)})),66!==a.profile&&77!==a.profile&&88!==a.profile&&(n.writeUint8(252|a.chromaFormatIdc),n.writeUint8(248|a.bitDepthLumaMinus8),n.writeUint8(248|a.bitDepthChromaMinus8),r.length&&h.__(r,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),o}function _(e){let t=s.py(e);if(t.length>1){const e=[],r=[],i=[];if(t.forEach((t=>{const s=31&t[0];7===s?e.push(t):8===s?r.push(t):13===s&&i.push(t)})),e.length&&r.length)return k(e,r,i)}}function I(e){let t=s.py(e);if(t.length>1){const e=[],r=[],i=[];if(t.forEach((t=>{const s=31&t[0];7===s?e.push(t):8===s?r.push(t):13===s&&i.push(t)})),e.length&&r.length){const t=[e[0],r[0]];return i.length&&t.push(i[0]),s.nW(t,0)}}}function x(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=s.py(e),o=!1;if(i.length){const e=[],s=[],a=[];i.forEach((t=>{const r=31&t[0];7===r?e.push(t):8===r?s.push(t):13===r?a.push(t):5===r&&(o=!0)})),e.length&&s.length?(t=k(e,s,a),i=i.filter((e=>{const t=31&e[0];return r?9!==t:9!==t&&8!==t&&7!==t&&13!==t}))):i=i.filter((e=>9!=(31&e[0])))}const n=i.reduce(((e,t)=>e+A+1+t.length),0),c=(0,a.sY)(n),h=(0,d.s3)(c,n);return s.S9(i,A,h),{bufferPointer:c,length:n,key:o,extradata:t}}function M(e,t,r,i,o){const n=[s.Le(i,0),s.Le(e,0),s.Le(t,0),s.Le(r,0),s.Le(o,2)];let h=n.reduce(((e,t)=>e+t),0);const l=(0,a.sY)(h+6);let u=l;return c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),1),c.w8((u+=1,u-1),9),c.w8((u+=1,u-1),240),i.length&&(s.nW(i,0,(0,d.s3)(u,n[0])),u+=n[0]),e.length&&(s.nW(e,0,(0,d.s3)(u,n[1])),u+=n[1]),t.length&&(s.nW(t,0,(0,d.s3)(u,n[2])),u+=n[2]),r.length&&(s.nW(r,0,(0,d.s3)(u,n[3])),u+=n[3]),o.length&&s.nW(o,2,(0,d.s3)(u,n[4])),{bufferPointer:l,length:h+6}}function P(e,t){let r=s.py(e).concat(s.py(t));if(r.length){const e=[],t=[],i=[],s=[],a=[];return r.forEach((r=>{const o=31&r[0];7===o?e.push(r):8===o?t.push(r):13===o?i.push(r):6===o?s.push(r):9!==o&&a.push(r)})),M(e,t,i,s,a)}}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A;t&&(r=3&t[4]);let i=[],a=[],o=[],n=!1;if(t){const e=b(t);i=e.spss,a=e.ppss,o=e.spsExts,n=!0}const c=[],d=[];return s.wN(e,r).forEach((e=>{const t=31&e[0];6===t?d.push(e):7!==t||i.length?8!==t||a.length?9!==t&&c.push(e):a.push(e):i.push(e),5===t&&(n=!0)})),{...M(i,a,o,d,c),key:n}}function E(e,t){let r;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))h.__(s.py(t),(e=>{if(7==(31&e[0]))return r=e,!1}));else if(t&&t.length>=6){const{spss:e}=b(t);e.length&&(r=e[0])}if(r){const{profile:t,level:i,width:s,height:a,videoDelay:o,chromaFormatIdc:n,bitDepthLumaMinus8:c}=C(r);switch(e.codecpar.profile=t,e.codecpar.level=i,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,c){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 1:e.codecpar.format=3===n?66:2===n?70:60;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}}function B(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&i.f[15](e+36))return s.py((0,d.s3)(i.f[20](e+24),i.f[15](e+28))).some((e=>{const t=31&e[0];return 5===t||6===t&&6===e[1]}));{const r=i.f[15](e+28);let s=0;for(;s<r-t;){const r=31&n.r8(i.f[20](e+24)+(s+t));if(5===r)return!0;if(6===r&&6===n.r8(i.f[20](e+24)+(s+t)+1))return!0;s+=4===t?n.Sg(i.f[20](e+24)+s):3===t?n.ht(i.f[20](e+24)+s):2===t?n.yd(i.f[20](e+24)+s):n.r8(i.f[20](e+24)+s),s+=t}return!1}}function C(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const r=s.BN(e.subarray(t)),i=new u.A(r.length);i.appendBuffer(r),i.readU1(),i.readU(2),i.readU(5);const a=i.readU(8);i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU1(),i.readU(2);const n=i.readU(8);o.xb(i);let c=1,d=0,h=0;if(100==a||110==a||122==a||244==a||44==a||83==a||86==a||118==a||128==a||138==a||139==a||134==a||135==a){function I(e){let t,r=8,s=8;for(let a=0;a<e;a++)0!==s&&(t=o.$x(i),s=(r+t+256)%256),r=0===s?r:s}if(c=o.xb(i),3===c&&i.readU1(),d=o.xb(i),h=o.xb(i),i.readU1(),i.readU1()){const x=new Array(8);for(let M=0;M<(3!=c?8:12);M++)x[M]=i.readU1(),x[M]&&I(M<6?16:64)}}const l=o.xb(i),f=o.xb(i);let p=0,m=0;if(0===f)p=o.xb(i);else if(1===f){m=i.readU1(),o.$x(i),o.$x(i);const P=o.xb(i);for(let T=0;T<P;T++)o.$x(i)}o.xb(i),i.readU1();const A=o.xb(i),v=o.xb(i),w=i.readU1();let y=16*(A+1),b=(2-w)*(v+1)*16;w||i.readU1(),i.readU1();const k=i.readU1();if(k){let E=1,B=2-k;1===c?(E=2,B=2*(2-k)):2===k&&(E=2,B=2-k),y-=E*(o.xb(i)+o.xb(i)),b-=B*(o.xb(i)+o.xb(i))}let _=0;if(i.readU1()){let C=i.readU1();function S(){const e=o.xb(i)+1;i.readU(4),i.readU(4);for(let t=0;t<e;t++)o.xb(i),o.xb(i),i.readU1();i.readU(5),i.readU(5),i.readU(5),i.readU(5)}C&&i.readU(8)>=17&&(i.readU(16),i.readU(16)),C=i.readU1(),C&&i.readU1(),C=i.readU1(),C&&(i.readU(3),i.readU1(),C=i.readU1(),C&&(i.readU(8),i.readU(8),i.readU(8))),C=i.readU1(),C&&(o.xb(i),o.xb(i)),C=i.readU1(),C&&(i.readU(32),i.readU(32),i.readU1());let U=i.readU1();U&&S();let D=i.readU1();D&&S(),(U||D)&&i.readU1(),i.readU1(),C=i.readU1(),C&&(i.readU1(),o.xb(i),o.xb(i),o.xb(i),o.xb(i),_=Math.min(o.xb(i),g))}return{profile:a,level:n,width:y,height:b,chromaFormatIdc:c,bitDepthLumaMinus8:d,bitDepthChromaMinus8:h,frameMbsOnlyFlag:w,picOrderCntType:f,log2MaxPicOrderCntLsbMinus4:p,deltaPicOrderAlwaysZeroFlag:m,log2MaxFrameNumMinus4:l,videoDelay:_}}},1598:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(1228),s=r(6890),a=r(495),o=r(1003),n=r(17),c=r(1718),d=r(5725),h=r(679);class l extends n.A{constructor(){super()}async createTask(e){const t=new o.A((0,s.A)(e.avframeList,i.A),e.avframeListMutex),r=(0,h.T$)(e.graph,t);if(!(0,h.iT)(r,e.inputPorts,e.outputPorts))return a.lh;const n=[],l=[];for(let t=0;t<e.inputPorts.length;t++){const i=new c.A(e.inputPorts[t].port);n.push(i);const s=r.inputs.find((r=>r.id===e.inputPorts[t].id));i.connect(s.filter)}for(let t=0;t<e.outputPorts.length;t++){const i=new d.A(e.outputPorts[t].port);l.push(i),r.outputs.find((r=>r.id===e.outputPorts[t].id)).filter.connect(i)}for(let e=0;e<r.vertices.length;e++)await r.vertices[e].filter.ready();return this.tasks.set(e.taskId,{...e,filterGraph:r,inputNodes:n,outputNodes:l,avframePool:t}),0}async registerTask(e){return this.tasks.has(e.taskId)?a.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);if(t){for(let e=0;e<t.filterGraph.vertices.length;e++)t.filterGraph.vertices[e].filter.disconnect(),await t.filterGraph.vertices[e].filter.destroy();this.tasks.delete(e)}}}},1605:(e,t,r)=>{function i(e){return e>0?e:-e}function s(e,t){return e>t?e:t}function a(e,t){return e>t?t:e}r.d(t,{T9:()=>s,jk:()=>a,tn:()=>i})},1621:(e,t,r)=>{r.d(t,{z:()=>s});var i=r(4467);class s{constructor(){(0,i.A)(this,"table",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"nodes",void 0),this.table=new WebAssembly.Table({initial:16,element:"anyfunc",address:"i32",index:"i32"}),this.pointer=6,this.nodes=[{pointer:this.pointer,length:10,free:!0}]}getPointer(){return this.pointer}alloc(e){let t=this.findFree(e);if(t<0){const r=this.nodes[this.nodes.length-1],i=e-(r.free?r.length:0);this.table.grow(i),r.free?r.length=r.length+i:this.nodes.push({pointer:r.pointer+r.length,length:i,free:!0}),t=this.findFree(e)}const r=this.nodes[t];return r.length>e&&(this.nodes.splice(t+1,0,{pointer:r.pointer+e,length:r.length-e,free:!0}),r.length=e),r.free=!1,r.pointer}free(e){let t=this.findNode(e);const r=this.nodes[t];if(r&&!r.free){const e=this.nodes[t-1],i=this.nodes[t+1];e&&e.free?i&&i.free?(e.length+=r.length+i.length,this.nodes.splice(t,2)):(e.length+=r.length,this.nodes.splice(t,1)):i&&i.free?(r.length+=i.length,this.nodes.splice(t+1,1),r.free=!0):r.free=!0}if(1===this.nodes.length&&this.nodes[0].free){const e=new WebAssembly.Table({initial:16,element:"anyfunc",address:"i32",index:"i32"});this.pointer=6,this.nodes=[{pointer:this.pointer,length:10,free:!0}];for(let t=1;t<this.pointer;t++)e.set(t,this.table.get(t));this.table=e}}get(e){return this.table.get(e)}set(e,t){if(e<0||e>=this.pointer)throw new RangeError("index out of bound");this.table.set(e,t)}inspect(){return this.nodes}findFree(e){let t=-1;for(let r=0;r<this.nodes.length;r++)if(this.nodes[r].length>=e&&this.nodes[r].free){t=r;break}return t}findNode(e){let t=-1;for(let r=0;r<this.nodes.length;r++)if(this.nodes[r].pointer===e){t=r;break}return t}}},1718:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(3554);class a{constructor(e){(0,i.A)(this,"nodePort",void 0),(0,i.A)(this,"outputNode",void 0),this.nodePort=new s.t(e)}connect(e){const{port:t,index:r}=e.getFreeInputNodePort();this.nodePort.connect(t),e.addInputPeer(this,r),this.outputNode=e}}},1730:(e,t,r)=>{r.d(t,{GR:()=>i,OG:()=>a,SY:()=>s,re:()=>o});const i={BGRA:28,BGRX:121,I420:0,I420P10:62,I420P12:123,I420A:33,I420AP10:87,I420AP12:229,I422:4,I422P10:64,I422P12:127,I422A:78,I422AP10:89,I422AP12:185,I444:5,I444P10:68,I444P12:131,I444A:79,I444AP10:91,I444AP12:187,NV12:23,RGBA:26,RGBX:119},s={bt709:1,smpte170m:6,bt470bg:5,"bt2020-ncl":9,rgb:0},a={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},o={bt709:1,"iec61966-2-1":13,smpte170m:6,linear:8,pq:16,hlg:18}},1755:(e,t,r)=>{r.d(t,{Eb:()=>l,Gy:()=>h,aI:()=>u,cz:()=>f,sY:()=>d});var i=r(4365),s=r(9983),a=r(2320),o=r(3674),n=r(9906);const c="packages/avutil/src/util/mem.ts";function d(e){const t=i.s_.malloc(e);return t||n.h2("can not alloc buffer",c,32),t}function h(e){const t=i.s_.malloc(e);return t||n.h2("can not alloc buffer",c,40),(0,o.sO)(t,0,e),t}function l(e){i.s_.free(e)}function u(e){i.s_.free(s.f[20](e)),a.M[20](e,0)}function f(e,t){return i.s_.realloc(e,t)}},1762:(e,t,r)=>{function i(){return Date.now()}r.d(t,{A:()=>i})},1781:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(9983),s=r(3139);function a(e){if(0!==i.f[15](e))return!1;const t=(0,s.I)(i.f[15](e+28));return t&&128&t.flags}},1787:(e,t,r)=>{function i(e){return e.alpha&&e.alpha instanceof VideoFrame}r.d(t,{z:()=>i})},1942:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(8590),a=r(3321);class o{constructor(){(0,i.A)(this,"queue",void 0),this.queue=[]}async execute(e){try{const t=await e.task();e.resolve(t)}catch(t){e.reject(t)}}async next(){if(this.queue.length){const e=this.queue[0];e.error?e.reject(e.error):await this.execute(e),this.queue.shift(),this.queue.length&&this.next()}}async push(e){if(!s.Pc(e))throw new TypeError("task must be a function");return new Promise(((t,r)=>{const i={task:e,resolve:t,reject:r};this.queue.push(i),1===this.queue.length&&this.next()}))}clear(e){a.__(this.queue,(t=>{t.error=e||new Error("command queue clear")}))}clearPadding(){this.queue.length=0}get length(){return this.queue.length}}},1958:(e,t,r)=>{r.d(t,{BN:()=>p,Bs:()=>n,Ky:()=>c,Le:()=>l,S9:()=>f,nW:()=>u,py:()=>d,wN:()=>h});var i=r(7138),s=r(3321),a=r(5815),o=r(187);function n(e){return e.length>4&&0===e[0]&&0===e[1]&&(1===e[2]||0===e[2]&&1===e[3])}function c(e,t){let r=0;for(let i=t;i<e.length;i++)switch(e[i]){case 0:r++;break;case 1:if(r>=2)return{offset:i-Math.min(r,3),startCode:Math.min(r+1,4)};r=0;break;default:r=0}return{offset:-1,startCode:0}}function d(e){const t=[];e instanceof i.A&&(e=e.subarray(0,e.length,!1));let r=c(e,0),s={offset:-1,startCode:0};for(;s=c(e,r.offset+r.startCode),s.offset>-1;)t.push(e.subarray(r.offset+r.startCode,s.offset,!0)),r=s;return t.push(e.subarray(r.offset+r.startCode,void 0,!0)),t}function h(e,t){const r=[],i=new a.A(e);for(;i.remainingSize()>0;){let s=0;s=3===t?i.readUint32():2===t?i.readUint24():1===t?i.readUint16():i.readUint8();const a=e.subarray(Number(BigInt.asIntN(32,i.getPos())),Number(BigInt.asIntN(32,i.getPos()))+s,!0);i.skip(s),r.push(a)}return r}function l(e,t){return e.reduce(((e,r,i)=>0===t?e+4+r.length:1===t?e+3+r.length:e+(i?3:4)+r.length),0)}function u(e,t,r){if(!r){let i=e.reduce(((e,r,i)=>0===t?e+4+r.length:1===t?e+3+r.length:e+(i?3:4)+r.length),0);r=new Uint8Array(i)}const i=new o.A(r);return s.__(e,((e,r)=>{i.writeUint8(0),i.writeUint8(0),(0===t||2===t&&!r)&&i.writeUint8(0),i.writeUint8(1),i.writeBuffer(e)})),r}function f(e,t,r){if(!r){const i=e.reduce(((e,r)=>e+t+1+r.length),0);r=new Uint8Array(i)}const i=new o.A(r);return s.__(e,(e=>{3===t?i.writeUint32(e.length):2===t?i.writeUint24(e.length):1===t?i.writeUint16(e.length):i.writeUint8(e.length),i.writeBuffer(e)})),r}function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;r||(r=e.length);const i=new Uint8Array(e.length);let s=0,a=0;for(let o=0;o<e.length;o++){if(o>=t&&o<r)if(0===e[o])s++;else if(3===e[o]&&2===s&&o+1<e.length&&e[o+1]<=3){if(o++,o===e.length)break;s=0===e[o]?1:0}else s=0;i[a++]=e[o]}return i.slice(0,a)}},1959:(e,t,r)=>{r.d(t,{A:()=>M});var i=r(4467),s=r(9983),a=r(2320),o=r(7145),n=r(6890),c=r(495),d=r(3139),h=r(4187),l=r(3394),u=r(3262),f=r(1237),p=r(5074),m=r(5055),g=r(8477),A=r(3831),v=r(6760),w=r(4659),y=r(714),b=r(7683),k=r(8288),_=r(665),I=r(9906);const x="packages/avcodec/src/webcodec/VideoEncoder.ts";class M{constructor(e){(0,i.A)(this,"encoder",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"timeBase",void 0),(0,i.A)(this,"currentError",null),(0,i.A)(this,"avframeMap",void 0),(0,i.A)(this,"framerateTimebase",void 0),(0,i.A)(this,"inputCounter",BigInt(0)),(0,i.A)(this,"outputCounter",BigInt(0)),(0,i.A)(this,"extradata",void 0),(0,i.A)(this,"ptsQueue",[]),this.options=e,this.avframeMap=new Map}async output(e,t){const r=BigInt(e.timestamp);let i=(0,u.k)(this.outputCounter++,this.framerateTimebase,this.timeBase);this.options.copyTs&&this.ptsQueue.length&&(i=this.ptsQueue.shift());const o=this.options.avpacketPool?this.options.avpacketPool.alloc():(0,h._5)();if(this.extradata)(0,m.A)(e,o,t);else{var n,c;if(null!=t&&null!==(n=t.decoderConfig)&&void 0!==n&&n.description){let e;e=t.decoderConfig.description instanceof ArrayBuffer?new Uint8Array(t.decoderConfig.description):new Uint8Array(t.decoderConfig.description.buffer),k.A.chrome&&!k.A.checkVersion(k.A.version,"130",!0)&&27===s.f[15](this.parameters+4)&&function(e){const t=e[2];void 0!==t&&t.toString(2).slice(-2).includes("1")&&(e[2]=0)}(e),this.extradata=e}if(null!=t&&null!==(c=t.decoderConfig)&&void 0!==c&&c.colorSpace&&(a.M[15](this.parameters+96,(0,y.mt)(t.decoderConfig.colorSpace.matrix)),a.M[15](this.parameters+88,(0,y.ab)(t.decoderConfig.colorSpace.primaries)),a.M[15](this.parameters+92,(0,y.nG)(t.decoderConfig.colorSpace.transfer))),(0,m.A)(e,o,t?_.X$({},t,{decoderConfig:void 0}):void 0),!this.extradata){let e;225===s.f[15](this.parameters+4)?e=A.Yj(this.parameters,(0,h.iI)(o)):167===s.f[15](this.parameters+4)&&(e=v.Yj(this.parameters)),e&&(this.extradata=e)}}a.M[17](o+8,r),a.M[17](o+16,i),a.M[15](o+76,this.timeBase.den),a.M[15](o+72,this.timeBase.num),a.M[17](o+48,(0,u.k)(BigInt(1),this.framerateTimebase,this.timeBase)),27!==s.f[15](this.parameters+4)&&173!==s.f[15](this.parameters+4)&&196!==s.f[15](this.parameters+4)||(1&s.f[15](this.parameters+160)?a.M[15](o+36,64|s.f[15](o+36)):a.M[15](o+36,-65&s.f[15](o+36))),this.options.onReceiveAVPacket(o);const d=this.avframeMap.get(r);d&&(this.options.avframePool?this.options.avframePool.release(d):(0,l.xj)(d)),this.avframeMap.delete(r)}error(e){this.currentError=e,this.options.onError(e)}async open(e,t){var r;this.currentError=null;const i=(0,d.I)(s.f[15](e+28));if(!i||i.comp[0].depth>8)return I.z3(`format ${s.f[15](e+28)} not support`,x,222),c.r8;const a={codec:(0,g.A)(e),width:s.f[15](e+56),height:s.f[15](e+60),bitrate:Number(s.f[17](e+32)),framerate:(0,u.lb)((0,n.A)(e+72,o.Q)),hardwareAcceleration:(0,w.C)(null===(r=this.options.enableHardwareAcceleration)||void 0===r||r),latencyMode:s.f[15](e+104)?"quality":"realtime",alpha:i&&128&i.flags?"keep":"discard"};this.options.latencyMode&&(a.latencyMode=this.options.latencyMode),this.options.bitrateMode&&(a.bitrateMode=this.options.bitrateMode),this.options.contentHint&&(a.contentHint=this.options.contentHint),this.options.scalabilityMode&&(a.scalabilityMode=this.options.scalabilityMode),27===s.f[15](e+4)?a.avc={format:1&s.f[15](e+160)?"annexb":"avc"}:173===s.f[15](e+4)?a.hevc={format:1&s.f[15](e+160)?"annexb":"hevc"}:196===s.f[15](e+4)&&(a.vvc={format:1&s.f[15](e+160)?"annexb":"vvc"});try{if(!(await VideoEncoder.isConfigSupported(a)).supported)return I.z3("not support",x,270),c.nr}catch(e){return I.z3(`${e}`,x,275),c.r8}return this.encoder&&"closed"!==this.encoder.state&&this.encoder.close(),this.encoder=new VideoEncoder({output:this.output.bind(this),error:this.error.bind(this)}),this.encoder.reset(),this.encoder.configure(a),this.currentError?(I.z3(`open video encoder error, ${this.currentError}`,x,292),c.r8):(this.parameters=e,this.timeBase=t,this.inputCounter=BigInt(0),this.outputCounter=BigInt(0),this.ptsQueue.length=0,this.framerateTimebase={den:s.f[15](e+72),num:s.f[15](e+76)},0)}encode(e,t){if(this.currentError)return I.z3(`encode error, ${this.currentError}`,x,312),c.LR;let r=(0,u.k)(this.inputCounter,this.framerateTimebase,this.timeBase);if(this.options.copyTs&&((0,b.A)(e)&&s.f[17](e+104)!==f.Dh&&0!==s.f[15](e+124)&&0!==s.f[15](e+120)||!(0,b.A)(e)&&e.timestamp>=0)&&(r=(0,b.A)(e)?(0,u.Mr)(s.f[17](e+104),e+120,this.timeBase):(0,u.k)(BigInt(e.timestamp),f.KR,this.timeBase),this.ptsQueue.push(r)),(0,b.A)(e)){const t=this.options.avframePool?this.options.avframePool.alloc():(0,l.FP)();(0,l.gg)(t,e),a.M[17](t+104,r),this.avframeMap.set(s.f[17](t+104),t),a.M[17](t+312,(0,u.k)(BigInt(1),this.framerateTimebase,(0,n.A)(t+120,o.Q))),e=(0,p.pt)(t,r)}else e=new VideoFrame(e,{timestamp:Number(r),duration:Number((0,u.k)(BigInt(1),this.framerateTimebase,this.timeBase))});try{return this.encoder.encode(e,{keyFrame:t}),e.close(),this.inputCounter++,0}catch(t){return I.z3(`encode error, ${t}`,x,360),e.close(),c.LR}}async flush(){if(this.currentError)return I.z3(`flush error, ${this.currentError}`,x,368),c.LR;try{return await this.encoder.flush(),0}catch(e){return I.z3(`flush error, ${e}`,x,376),c.LR}}close(){this.encoder&&"closed"!==this.encoder.state&&this.encoder.close(),this.avframeMap.size&&this.avframeMap.forEach((e=>{this.options.avframePool?this.options.avframePool.release(e):(0,l.xj)(e)})),this.encoder=void 0}getExtraData(){return this.extradata}getColorSpace(){return{colorSpace:s.f[15](this.parameters+96),colorPrimaries:s.f[15](this.parameters+88),colorTrc:s.f[15](this.parameters+92)}}getQueueLength(){var e,t;return null!==(e=null===(t=this.encoder)||void 0===t?void 0:t.encodeQueueSize)&&void 0!==e?e:0}static async isSupported(e,t){const r=(0,d.I)(s.f[15](e+28));if(!r||r.comp[0].depth>8)return!1;const i={codec:(0,g.A)(e),width:s.f[15](e+56),height:s.f[15](e+60),bitrate:Number(s.f[17](e+32)),framerate:(0,u.lb)((0,n.A)(e+72,o.Q)),hardwareAcceleration:(0,w.C)(null==t||t),latencyMode:s.f[15](e+104)?"quality":"realtime",alpha:r&&128&r.flags?"keep":"discard"};try{return(await VideoEncoder.isConfigSupported(i)).supported}catch(e){return!1}}}},2029:(e,t,r)=>{r.d(t,{A:()=>x});var i=r(9983),s=r(2320),a=r(1228),o=r(6890),n=r(2935),c=r(495),d=r(1755),h=r(8588),l=r(2836),u=r(9210),f=r(2364),p=r(1003),m=r(8696),g=r(7683),A=r(8590),v=r(3321),w=r(9906),y=r(1762),b=r(5946),k=r(2660),_=r(17);const I="packages/avpipeline/src/AudioDecodePipeline.ts";class x extends _.A{constructor(){super()}createWebcodecDecoder(e){return new k.A({onError:t=>{w.z3(`audio decode error, taskId: ${e.taskId}, error: ${t}`,I,115)},onReceiveAudioData(t){const r=(0,u.t)(t,e.avframePool.alloc());e.frameCaches.push(r),s.M[17](e.stats+56,i.f[17](e.stats+56)+BigInt(1)),s.M[15](e.stats+248,Math.max((0,y.A)()-e.lastDecodeTimestamp,i.f[15](e.stats+248))),t.close()}})}createWasmcodecDecoder(e,t){return new b.A({resource:t,onReceiveAVFrame(t){e.frameCaches.push(t),s.M[17](e.stats+56,i.f[17](e.stats+56)+BigInt(1)),s.M[15](e.stats+248,Math.max((0,y.A)()-e.lastDecodeTimestamp,i.f[15](e.stats+248)))},avframePool:e.avframePool})}async pullAVPacketInternal(e,t){const r=await t.request("pull");if(A.ai(r)||(0,g.A)(r))return r;{const t=e.avpacketPool.alloc();return(0,h.r0)(r,t),t}}async createTask(e){const t=new n.Ay(e.leftPort),r=new n.Ay(e.rightPort),c=[],d=new p.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),h={...e,resource:await(0,f.A)(e.resource),frameCaches:c,inputEnd:!1,decoder:null,parameters:0,lastDecodeTimestamp:0,avframePool:d,avpacketPool:new m.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex)};return h.resource?h.decoder=this.createWasmcodecDecoder(h,h.resource):h.decoder=this.createWebcodecDecoder(h),this.tasks.set(e.taskId,h),r.on(n.S3,(async a=>{switch(a.method){case"pull":if(c.length){const e=c.shift();r.reply(a,e);break}if(!h.inputEnd){for(;;){if(c.length){const e=c.shift();r.reply(a,e);break}h.pending&&await h.pending,h.lastDecodeTimestamp=(0,y.A)();const o=await this.pullAVPacketInternal(h,t);if(-1048576===o){if(await h.decoder.flush(),h.inputEnd=!0,c.length){const e=c.shift();r.reply(a,e);break}w.pq(`audio decoder ended, taskId: ${h.taskId}`,I,222),r.reply(a,-1048576);break}if(!(o>0)){w.z3(`audio decode pull avpacket error, taskId: ${e.taskId}, ret: ${o}`,I,240),r.reply(a,o);break}{const t=h.decoder.decode(o);h.avpacketPool.release(o),t<0&&(s.M[15](h.stats+48,i.f[15](h.stats+48)+1),w.z3(`audio decode error, taskId: ${e.taskId}, ret: ${t}`,I,235))}}break}r.reply(a,-1048576)}})),0}async open(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.tasks.get(e);if(i){i.wasmDecoderOptions=r;const e=(0,d.Gy)(168);return(0,g.A)(t)?(0,l.Yi)(e,t):(0,h.T8)(t,e),i.parameters&&(0,l.dn)(i.parameters),i.parameters=e,new Promise((async(t,r)=>{const s=await i.decoder.open(e,i.wasmDecoderOptions);if(s)return w.z3(`open audio decoder failed, error: ${s}`,I,274),void t(c.r8);t(0)}))}w.h2("task not found",I,281)}async beforeReopenDecoder(e){const t=this.tasks.get(e);t?t.pending=new Promise((e=>{t.pendingResolve=e})):w.h2("task not found",I,292)}async reopenDecoder(e,t,r,i){const s=this.tasks.get(e);if(s){i&&(s.wasmDecoderOptions=i);const e=(0,d.Gy)(168);let a;return(0,g.A)(t)?(0,l.Yi)(e,t):(0,h.T8)(t,e),s.parameters&&(0,l.dn)(s.parameters),s.parameters=e,r?(r=await(0,f.A)(r),a=this.createWasmcodecDecoder(s,r)):a=this.createWebcodecDecoder(s),new Promise((async(t,i)=>{const o=await a.open(e);if(o)return w.z3(`reopen audio decoder failed, error: ${o}`,I,329),void t(c.r8);r&&(s.resource=r),s.decoder.close(),s.decoder=a,w.Yz(`reopen audio decoder, taskId: ${s.taskId}`,I,339),t(0),s.pendingResolve&&(s.pendingResolve(),s.pending=null)}))}w.h2("task not found",I,347)}async resetTask(e){const t=this.tasks.get(e);t&&(t.decoder&&await t.decoder.flush(),v.__(t.frameCaches,(e=>{t.avframePool.release(e)})),t.frameCaches.length=0,t.inputEnd=!1,t.lastDecodeTimestamp=(0,y.A)(),w.pq(`reset audio decoder, taskId: ${t.taskId}`,I,363))}async registerTask(e){return this.tasks.has(e.taskId)?c.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.decoder.close(),t.frameCaches.forEach((e=>{t.avframePool.release(e)})),t.parameters&&(0,l.dn)(t.parameters),this.tasks.delete(e),w.Yz(`unregisterTask task, taskId: ${e}`,I,387))}}},2030:(e,t,r)=>{r.d(t,{nE:()=>v,pt:()=>A});var i=r(4365),s=r(7921),a=r(2494),o=r(3535),n=r(8335),c=r(8590),d=r(4566),h=r(2935);let l=a.TK.Worker,u=a.TK.MessageChannel;r(8770),r(3644),r(624);const f=(0,n.A)(8770,{varName:"init"}),p=((0,n.A)(3644,{varName:"init"}),(0,n.A)(624,{varName:"init"}),Symbol("revoke")),m=new Map;function g(e,t){return`${e}_${t}`}function A(e,t,r){t=t||{},c.Pc(t)&&(r=t,t={});let A,v=[];function w(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];const a=new e(...i);return new Promise((t=>{const i={$worker:null,$ipc:null,$channel:null,$moduleId:(0,d.A)(r),$stackPointer:0,$instance:a,$type:"class"},{proxy:s,revoke:o}=Proxy.revocable(i,{get(t,r,s){if(t[r])return i[r];if(r in e.prototype&&"function"==typeof e.prototype[r]){const e=function(){return a[r](...arguments)};e.transfer=function(){return{invoke:function(){return a[r](...arguments)}}},t[r]=e}return t[r]}});i[p]=o,t(s)}))}return A=function(){for(var A=arguments.length,w=new Array(A),y=0;y<A;y++)w[y]=arguments[y];let b;if(c.Pc(r))b=r();else{let i;const s=g(r,"class");if(m.has(s))i=m.get(s).url,m.get(s).refCount++;else{const t=(0,n.A)(r,{varName:`__module_${e.name}__`,exportName:`__${e.name}__`,pointName:e.name,exportIsClass:!0}),o=`\n            self.CHEAP_DISABLE_THREAD = ${a.TK.CHEAP_DISABLE_THREAD}\n            self.CHEAP_HEAP_INITIAL = ${a.TK.CHEAP_HEAP_INITIAL}\n            self.CHEAP_HEAP_MAXIMUM = ${a.TK.CHEAP_HEAP_MAXIMUM}\n            ${a.TK.CHEAP_POLYFILL_URL?`self.CHEAP_POLYFILL_URL = '${a.TK.CHEAP_POLYFILL_URL}'`:""}\n            ${a.TK.CHEAP_POLYFILL_URL?`importScripts('${a.TK.CHEAP_POLYFILL_URL}');`:""}\n            ${t}\n            function run(params) {\n              params.unshift(null)\n              return new (Function.prototype.bind.apply(__module_${e.name}__.__${e.name}__, params))()\n            }\n            ${f}\n            init.default(run);\n          `;{const e=new Blob([o],{type:"text/javascript"});i=URL.createObjectURL(e)}m.set(s,{url:i,refCount:1})}b=new l(i,t)}const k=new u;return new Promise(((a,n)=>{var c;const l=s.USE_THREADS?i.s_.alignedAlloc(s.STACK_ALIGNMENT,t.stackSize?(0,o.A)(t.stackSize,s.STACK_ALIGNMENT):s.STACK_SIZE):0;b.onmessage=t=>{const i=t.data,s=i.type;switch(i.data,s){case"ready":b.postMessage({type:"run",data:{port:k.port2,params:w}},[k.port2,...v]);break;case"running":!function(){const t=new h.Ay(k.port1),i={$worker:b,$ipc:t,$channel:k,$moduleId:(0,d.A)(r),$stackPointer:l,$type:"class"},{proxy:s,revoke:o}=Proxy.revocable(i,{get(r,s,a){if(r[s])return i[s];if(s in e.prototype&&"function"==typeof e.prototype[s]){const e=async function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return t.request(s,{params:r})};e.transfer=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return{invoke:async function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return t.request(s,{params:i},r)}}},r[s]=e}return r[s]}});i[p]=o,a(s)}()}},b.postMessage({type:"init",data:{memory:s.USE_THREADS?i.ce:null,name:t.name||e.name,stackPointer:l,stackSize:null!==(c=t.stackSize)&&void 0!==c?c:s.STACK_SIZE}})}))},{run:!s.USE_THREADS&&!t.dispatchToWorker||t.disableWorker?w:A,transfer:function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return v=r,{run:!s.USE_THREADS&&!t.dispatchToWorker||t.disableWorker?w:A}}}}function v(e){if(e.$worker&&(e.$worker.terminate(),e.$worker=null),e.$moduleId){if(c.Yj(e.$moduleId)){const t=g(e.$moduleId,e.$type);m.has(t)&&(m.get(t).refCount--,0===m.get(t).refCount&&(URL.revokeObjectURL(m.get(t).url),m.delete(t)))}e.$moduleId=null}if(e.$ipc&&(e.$ipc.destroy(),e.$ipc=null),e.$stackPointer&&(i.s_.free(e.$stackPointer),e.$stackPointer=0),e.$channel=null,e.$instance=null,e[p]){const t=e[p];e[p]=null,t()}}},2047:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(3365);class a extends s.A{constructor(){super(...arguments),(0,i.A)(this,"info",void 0),(0,i.A)(this,"transport",void 0),(0,i.A)(this,"datagramReader",void 0),(0,i.A)(this,"reader",void 0),(0,i.A)(this,"datagramWriter",void 0),(0,i.A)(this,"writer",void 0),(0,i.A)(this,"stream",void 0),(0,i.A)(this,"readPacketQueue",void 0),(0,i.A)(this,"consumePacket",void 0)}async send(e){return this.writer?(this.writer.write(e.slice()),0):-1048574}async handleRead(){let e=!1;for(;;)try{const{value:t,done:r}=await this.reader.read();if(r){e=r,this.status=4,this.consume&&this.consume();break}this.readQueue.push(t)}catch(t){e||(this.status=3,this.consume&&this.consume());break}}async readDatagram(){let e=!1;for(;;)try{const{value:t,done:r}=await this.datagramReader.read();if(r){e=!0,this.status=4,this.consumePacket&&this.consumePacket();break}this.readPacketQueue.push(t)}catch(t){e||(this.status=3,this.consumePacket&&this.consumePacket());break}}async open(e){return this.info=e,this.transport=new WebTransport(e.url,e.webtransportOptions),this.readPacketQueue=[],this.status=1,await this.transport.ready,this.transport.closed.then((()=>{this.transport?this.status=3:this.status=4})),this.status=2,this.stream=await this.transport.createBidirectionalStream(),this.reader=this.stream.readable.getReader(),this.writer=this.stream.writable.getWriter(),this.datagramReader=this.transport.datagrams.readable.getReader(),this.datagramWriter=this.transport.datagrams.writable.getWriter(),this.handleRead(),this.readDatagram(),0}async readPacket(e){for(;;){if(this.readPacketQueue.length){const t=this.readPacketQueue.shift();return e.set(t,0),t.length}if(4===this.status||0===this.status)return-1048576;if(3===this.status)return-1048573;await new Promise((e=>{this.consumePacket=e})),this.consumePacket=null}}async writePacket(e){return this.datagramWriter?(this.datagramWriter.write(e.slice()),0):-1048574}seek(e,t){throw new Error("Method not implemented.")}size(){throw new Error("Method not implemented.")}async stop(){this.transport&&(this.transport.close(),this.transport=null),this.status=4,this.consume&&this.consume()}}},2107:(e,t,r)=>{function i(){let e,t;return{promise:new Promise(((r,i)=>{e=r,t=i})),resolve:e,reject:t}}r.d(t,{A:()=>i})},2149:(e,t,r)=>{function i(e){let t=0,r=0;for(;r<32&&0===e.readU1();)r++;return t=e.readU(r),t+=(1<<r)-1,t}function s(e){let t=i(e);return t=1&t?(t+1)/2:-t/2,t}r.d(t,{$x:()=>s,xb:()=>i})},2150:(e,t,r)=>{r.d(t,{V:()=>s,v:()=>i});const i=256e3,s=BigInt(5e3)},2171:(e,t,r)=>{r.d(t,{E3:()=>a,Sg:()=>d,Y0:()=>c,ht:()=>n,r8:()=>s,v4:()=>h,yd:()=>o});var i=r(9983);function s(e){return i.f[2](e)}function a(e){return s(e+1)<<8|s(e)}function o(e){return s(e)<<8|s(e+1)}function n(e){return s(e)<<16|s(e+1)<<8|s(e+2)}function c(e){return a(e+2)<<16|a(e)}function d(e){return o(e)<<16|o(e+2)}function h(e){return BigInt(d(e))<<BigInt(32)|BigInt(d(e+4))}},2259:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(8085),s=r(4365),a=r(3674),o=r(6890),n=r(665),c=r(5967);function d(e,t){(0,c.A)(t)||(t=e,e=null);const r=(0,i.A)(t),d=s.s_.malloc(r);if(!d)throw new TypeError("cannot alloc memory for struct");(0,a.sO)(d,0,r);const h=(0,o.A)(d,t),l=new t;return e&&n.X$(l,e),n.__(l,((e,t)=>{(0,c.A)(e)&&(h[t]=e)})),h}},2284:(e,t,r)=>{function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}r.d(t,{A:()=>i})},2316:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467);function s(e){e.addEventListener("message",(t=>{var r;let i=t.data.data;setTimeout((()=>{e.postMessage({type:"pong",id:i.id})}),Math.max(null!==(r=i.timeout)&&void 0!==r?r:0,4))}))}class a{constructor(){(0,i.A)(this,"worker",void 0),(0,i.A)(this,"workerUrl",void 0),(0,i.A)(this,"taskMap",void 0),(0,i.A)(this,"id",void 0),this.id=0,this.taskMap=new Map;const e=`\n      ${s.toString()}\n      ${s.name}(self)\n    `,t=new Blob([e],{type:"text/javascript"});this.workerUrl=URL.createObjectURL(t),this.worker=new Worker(this.workerUrl),this.worker.addEventListener("message",(e=>{const t=e.data,r=t.type,i=t.id;if("pong"===r){const e=this.taskMap.get(i);e&&e(!0)}}))}setTimeout(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=this.id++;return this.taskMap.set(r,e),this.worker.postMessage({type:"ping",data:{timeout:t,id:r}}),r}clearTimeout(e){this.taskMap.delete(e)}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.workerUrl&&(URL.revokeObjectURL(this.workerUrl),this.workerUrl=null),this.taskMap&&(this.taskMap.clear(),this.taskMap=null)}}},2320:(e,t,r)=>{r.d(t,{$:()=>o,M:()=>a});var i=r(665),s=r(3601);const a={4:s.A,5:s.A,2:s.A,3:s.A,6:s.A,7:s.A,8:s.A,9:s.A,10:s.A,11:s.A,12:s.A,13:s.A,14:s.A,15:s.A,16:s.A,17:s.A,18:s.A,19:s.A,20:s.A,0:s.A,1:s.A,22:s.A,21:s.A,23:s.A,24:s.A,25:s.A,copy:s.A,fill:s.A};function o(e){i.X$(a,e)}},2327:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(2284);function s(e,t){if("object"!=(0,i.A)(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,t||"default");if("object"!=(0,i.A)(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}},2364:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(8590),s=r(6513),a=r(7921);async function o(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i.Yj(e)||i.sv(e)?(t=await(0,s.A)({source:e}),a.USE_THREADS&&r&&(t.threadModule=await(0,s.A)({source:t.buffer},{child:!0})),delete t.buffer):t=e,t}},2458:(e,t,r)=>{async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=await e.peekString(8);if(/^FLV/.test(r))return 0;if(/^DKIF/.test(r))return 5;if(/^ftyp/.test(r.slice(4,8)))return 1;if(/^OggS/.test(r))return 4;if(/^ID3/.test(r))return 14;if(/^fLaC/.test(r))return 17;if(/^RIFF/.test(r)){const t=(await e.peekString(12)).slice(8);if(/^WAVE/.test(t))return 16;if(/^AVI/.test(t))return 10}else{if(/^ADIF/.test(r))return 15;if(440786851===await e.peekUint32())return 8;if(/^WEBVTT/.test(r))return 18;if(/^LIMA/.test(r))return await e.skip(4),await e.readUint16();{const t=await e.peekBuffer(2);switch(t[0]){case 86:if(!(224&~t[1]))return 15;break;case 255:if(240==(246&t[1]))return 15;if([242,244,246,250,252].includes(254&t[1]))return 14}}}return t}r.d(t,{A:()=>i})},2479:(e,t,r)=>{r.d(t,{t:()=>a,z:()=>s});var i=r(4365);function s(e){return i.GE.value=i.GE.value-e,i.GE.value}function a(e){i.GE.value=i.GE.value+e}},2494:(e,t,r)=>{r.d(t,{Cq:()=>a,Cy:()=>n,M_:()=>u,Ml:()=>m,TK:()=>f,W8:()=>s,ZG:()=>h,ZH:()=>o,aV:()=>c,rT:()=>i,s0:()=>d,u1:()=>g,x7:()=>p});const i=!0,s=!1,a=null,o=void 0,n=-1,c="undefined",d="function",h=".",l=typeof window!==c?window:o,u=(typeof document!==c&&document,typeof globalThis!==c?globalThis:typeof r.g!==c?r.g:l),f=typeof self!==c?self:u,p=function(){},m=(Object.freeze({}),Object.freeze([])),g=""},2535:(e,t,r)=>{r.d(t,{A:()=>i});class i{constructor(){}get ext(){throw new Error("need implemented ext getter")}get flags(){return 0}get name(){return"CustomIOLoader."+Math.random()}get minBuffer(){return 4}write(e){throw new Error("need implemented write function")}}},2660:(e,t,r)=>{r.d(t,{A:()=>f});var i=r(4467),s=r(9983),a=r(495),o=r(4187),n=r(524),c=r(8738),d=r(3674),h=r(3321),l=r(9906);const u="packages/avcodec/src/webcodec/AudioDecoder.ts";class f{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"extradata",void 0),(0,i.A)(this,"currentError",null),this.options=e}output(e){this.options.onReceiveAudioData?this.options.onReceiveAudioData(e):e.close()}error(e){this.currentError=e,this.options.onError(e)}async open(e){var t;this.currentError=null,this.parameters=e,this.extradata=void 0,0!==s.f[20](e+12)&&(this.extradata=(0,d.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const r={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,c.A)(this.parameters),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),description:this.extradata};r.description||delete r.description;try{if(!(await AudioDecoder.isConfigSupported(r)).supported)return l.z3("not support",u,98),a.nr}catch(e){return l.z3(`${e}`,u,103),a.r8}return this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.decoder=new AudioDecoder({output:this.output.bind(this),error:this.error.bind(this)}),this.decoder.reset(),this.decoder.configure(r),this.currentError?(l.z3(`open audio decoder error, ${this.currentError}`,u,120),a.r8):0}changeExtraData(e){var t;return h.FB(e,this.extradata)?0:(this.currentError=null,this.extradata=e.slice(),this.decoder.reset(),this.decoder.configure({codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,c.A)(this.parameters),sampleRate:s.f[15](this.parameters+136),numberOfChannels:s.f[15](this.parameters+116),description:this.extradata}),this.currentError?(l.z3(`change extra data error, ${this.currentError}`,u,144),a.r8):0)}decode(e){if(this.currentError)return l.z3(`decode error, ${this.currentError}`,u,153),a.LR;const t=(0,o.rU)(e,1);if(0!==t){let e=this.changeExtraData((0,d.s3)(s.f[20](t),s.f[25](t+4)));if(e)return e}const r=(0,n.A)(e);try{this.decoder.decode(r)}catch(e){return l.z3(`decode error, ${e}`,u,172),a.LR}return 0}async flush(){if(this.currentError)return l.z3(`flush error, ${this.currentError}`,u,181),a.LR;try{return await this.decoder.flush(),0}catch(e){return l.z3(`flush error, ${e}`,u,189),a.LR}}close(){"closed"!==this.decoder.state&&this.decoder.close(),this.decoder=void 0}getQueueLength(){var e,t;return null!==(e=null===(t=this.decoder)||void 0===t?void 0:t.decodeQueueSize)&&void 0!==e?e:0}static async isSupported(e){let t;0!==s.f[20](e+12)&&(t=(0,d.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const r={codec:(0,c.A)(e),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),description:t};r.description||delete r.description;try{return(await AudioDecoder.isConfigSupported(r)).supported}catch(e){return!1}}}},2707:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(9983),s=r(3262),a=r(3674),o=r(1237);function n(e){const t=1&i.f[15](e+36);return new EncodedVideoChunk({type:t?"key":"delta",duration:i.f[17](e+48)<0?void 0:Number((0,s.Mr)(i.f[17](e+48),e+72,o.KR)),timestamp:i.f[17](e+8)===o.Dh?o.N_:Number((0,s.Mr)(i.f[17](e+8),e+72,o.KR)),data:(0,a.s3)(i.f[20](e+24),i.f[15](e+28))})}},2709:(e,t,r)=>{r.d(t,{A:()=>y});var i=r(9983),s=r(2320),a=r(1228),o=r(6890),n=r(2935),c=r(495),d=r(2364),h=r(1003),l=r(8696),u=r(7683),f=r(3321),p=r(9906),m=r(4310),g=r(5922),A=r(6616),v=r(17);const w="packages/avpipeline/src/AudioEncodePipeline.ts";class y extends v.A{constructor(){super()}createWebcodecEncoder(e){var t;return new A.A({onError:t=>{p.z3(`audio encode error, taskId: ${e.taskId}, error: ${t}`,w,104)},onReceiveAVPacket(t){e.avpacketCaches.push(t),s.M[17](e.stats+64,i.f[17](e.stats+64)+BigInt(1))},avpacketPool:e.avpacketPool,avframePool:e.avframePool,copyTs:null!==(t=e.copyTs)&&void 0!==t&&t})}async createTask(e){const t=new n.Ay(e.leftPort),r=new n.Ay(e.rightPort),c=[],f=new l.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex),v={...e,resource:await(0,d.A)(e.resource),avpacketCaches:c,encoder:null,inputEnd:!1,parameters:0,avframePool:new h.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),avpacketPool:f};var y;return v.resource?v.encoder=new g.A({resource:v.resource,onReceiveAVPacket(e){v.avpacketCaches.push(e),s.M[17](v.stats+64,i.f[17](v.stats+64)+BigInt(1))},avpacketPool:f,copyTs:null!==(y=v.copyTs)&&void 0!==y&&y}):v.encoder=this.createWebcodecEncoder(v),this.tasks.set(e.taskId,v),r.on(n.S3,(async a=>{switch(a.method){case"pull":if(c.length){const e=c.shift();r.reply(a,e);break}if(!v.inputEnd){for(;;){if(c.length){const e=c.shift();r.reply(a,e);break}const o=await t.request("pull");if(!((0,u.A)(o)||o instanceof AudioData)){if(-1048576===o){if(await v.encoder.flush(),v.inputEnd=!0,c.length){const e=c.shift();r.reply(a,e);break}p.pq(`audio encoder ended, taskId: ${v.taskId}`,w,206),r.reply(a,-1048576);break}p.z3(`audio encoder pull avpacket error, taskId: ${e.taskId}, ret: ${o}`,w,212),r.reply(a,o);break}{const t=v.encoder.encode(o);if((0,u.A)(o)?v.avframePool.release(o):o.close(),t<0){s.M[15](v.stats+52,i.f[15](v.stats+52)+1),p.z3(`audio encode error, taskId: ${e.taskId}, ret: ${t}`,w,184),r.reply(a,t);break}for(;v.encoder instanceof A.A&&v.encoder.getQueueLength()>4;)await new m.A(0)}}break}p.pq(`audio encoder ended, taskId: ${v.taskId}`,w,220),r.reply(a,-1048576)}})),0}async open(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=this.tasks.get(e);if(s)return s.wasmEncoderOptions=i,new Promise((async(e,i)=>{const a=await s.encoder.open(t,r,s.wasmEncoderOptions);if(a)return p.z3(`open audio encoder failed, error: ${a}`,w,237),void e(c.r8);s.parameters=t,e(0)}));p.h2("task not found",w,245)}async getExtraData(e){const t=this.tasks.get(e);if(t)return t.encoder.getExtraData();p.h2("task not found",w,253)}async resetTask(e){const t=this.tasks.get(e);t&&(t.encoder&&await t.encoder.flush(),f.__(t.avpacketCaches,(e=>{t.avpacketPool.release(e)})),t.avpacketCaches.length=0,t.inputEnd=!1,p.pq(`reset audio encoder, taskId: ${t.taskId}`,w,268))}async registerTask(e){return this.tasks.has(e.taskId)?c.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.encoder.close(),t.avpacketCaches.forEach((e=>{t.avpacketPool.release(e)})),this.tasks.delete(e))}}},2734:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(7698);function s(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const s=t.split("."),a=e.split(".");for(let e=0;e<a.length;e++){if(r&&e==a.length-1&&(0,i.A)(a[e])>=(0,i.A)(s[e]))return a.length>=s.length;if((0,i.A)(a[e])>(0,i.A)(s[e]))return!0;if((0,i.A)(a[e])<(0,i.A)(s[e]))return!1;if(e===s.length-1&&e===a.length-1)return r;if(e===s.length-1)return!0;if(e===a.length-1)return!1}return!0}},2836:(e,t,r)=>{r.d(t,{Yi:()=>h,dn:()=>l});var i=r(3674),s=r(9983),a=r(2320),o=r(1755),n=r(449),c=r(4187),d=r(1237);function h(e,t){a.M[15](e,s.f[15](t)),a.M[15](e+4,s.f[15](t+4)),a.M[8](e+8,s.f[8](t+8)),a.M[15](e+28,s.f[15](t+28)),a.M[17](e+32,s.f[17](t+32)),a.M[15](e+40,s.f[15](t+40)),a.M[15](e+44,s.f[15](t+44)),a.M[15](e+48,s.f[15](t+48)),a.M[15](e+52,s.f[15](t+52)),a.M[15](e+56,s.f[15](t+56)),a.M[15](e+60,s.f[15](t+60)),a.M[15](e+68,s.f[15](t+68)),a.M[15](e+64,s.f[15](t+64)),a.M[15](e+80,s.f[15](t+80)),a.M[15](e+84,s.f[15](t+84)),a.M[15](e+88,s.f[15](t+88)),a.M[15](e+92,s.f[15](t+92)),a.M[15](e+96,s.f[15](t+96)),a.M[15](e+100,s.f[15](t+100)),a.M[15](e+104,s.f[15](t+104)),(0,i.Mr)(e+112,t+112,24),a.M[15](e+136,s.f[15](t+136)),a.M[15](e+140,s.f[15](t+140)),a.M[15](e+144,s.f[15](t+144)),a.M[15](e+148,s.f[15](t+148)),a.M[15](e+152,s.f[15](t+152)),a.M[15](e+156,s.f[15](t+156)),a.M[15](e+160,s.f[15](t+160)),(0,i.Mr)(e+72,t+72,8),s.f[20](t+12)&&(s.f[20](e+12)&&(0,o.Eb)(s.f[20](e+12)),a.M[20](e+12,(0,o.sY)(s.f[15](t+16))),a.M[15](e+16,s.f[15](t+16)),(0,i.Mr)(s.f[20](e+12),s.f[20](t+12),s.f[15](t+16))),s.f[20](t+20)&&function(e,t,r,n){if(!r)return;const c=(0,o.Gy)(12*n);for(let e=0;e<n;e++)a.M[15](c+12*e+8,s.f[15](r+12*e+8)),a.M[25](c+12*e+4,s.f[25](r+12*e+4)),a.M[20](c+12*e,(0,o.sY)(s.f[25](r+12*e+4))),(0,i.Mr)(s.f[20](c+12*e),s.f[20](r+12*e),s.f[25](r+12*e+4));a.M[15](t,n),a.M[20](e,c)}(e+20,e+24,s.f[20](t+20),s.f[15](t+24))}function l(e){e&&(function(e){s.f[20](e+12)&&(0,o.aI)(e+12),(0,n.bl)(e+112),(0,c.NZ)(e+20,e+24),(0,i.sO)(e,0,168),a.M[15](e,-1),a.M[15](e+4,0),a.M[15](e+28,-1),a.M[15](e+112,0),a.M[15](e+80,0),a.M[15](e+84,0),a.M[15](e+88,2),a.M[15](e+92,2),a.M[15](e+96,2),a.M[15](e+100,0),a.M[15](e+64,0),a.M[15](e+68,1),a.M[15](e+72,0),a.M[15](e+72,1),a.M[15](e+48,d.N_),a.M[15](e+52,d.N_),a.M[15](e+160,0)}(e),(0,o.Eb)(e))}},2837:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(8590),s=r(4566),a=r(8927);function o(e){return i.Pc(e)&&a.zy((0,s.A)(e),"[native code]")}},2905:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(399),s=r(3321),a=r(2494);function o(e,t,r){let o,n,c=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return function(){let d=this;c&&(n=s.$r(arguments)),o||(c||(n=s.$r(arguments)),r&&(0,i.A)(e,d,n),o=setTimeout((function(){o=a.ZH,r||(0,i.A)(e,d,n)}),t))}}},2935:(e,t,r)=>{r.d(t,{Ay:()=>c,S3:()=>n,Wo:()=>o});var i=r(4467),s=r(1042),a=r(5967);const o="notify",n="request";class c extends s.A{constructor(e){super(!0),(0,i.A)(this,"port",void 0),(0,i.A)(this,"requestMap",void 0),(0,i.A)(this,"seq",void 0),(0,i.A)(this,"closed",void 0),this.port=e,this.port.onmessage=this.handle.bind(this),this.seq=0,this.requestMap=new Map,this.port.start(),this.closed=!1}handle(e){const t=e.data,r=t.type,i=t.data;if("notify"===r)this.fire(o,i);else if("reply"===r){const e=this.requestMap.get(i.seq);e&&((0,a.A)(i.result)?e.resolve(i.result):i.error?e.reject(i.error):e.resolve(void 0),this.requestMap.delete(i.seq))}else"request"===r&&this.fire(n,i)}notify(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.port.postMessage({type:"notify",data:{method:e,params:t}},r)}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(((i,s)=>{const a=this.seq++;this.requestMap.set(a,{resolve:i,reject:s}),this.port.postMessage({type:"request",data:{seq:a,method:e,params:t}},r)}))}reply(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const s={seq:e.seq};(0,a.A)(t)?s.result=t:r&&(s.error=r),null!=i&&i.length?this.port.postMessage({type:"reply",data:s},i):this.port.postMessage({type:"reply",data:s})}getPort(){return this.port}destroy(){this.requestMap.size&&(this.requestMap.forEach((e=>{e.reject("ipc port close")})),this.requestMap.clear()),this.port&&(this.port.close(),this.port=null),this.closed=!0}}},2990:(e,t,r)=>{function i(){return"function"==typeof registerProcessor&&"number"==typeof sampleRate&&"number"==typeof currentFrame&&"number"==typeof currentTime}r.d(t,{A:()=>i})},3050:(e,t,r)=>{function i(e){return e<=0?1:Math.pow(2,Math.ceil(Math.log2(e)))}r.d(t,{A:()=>i})},3064:(e,t,r)=>{r.d(t,{Ts:()=>l});var i=r(9983),s=r(2320),a=r(9257),o=r(3669),n=r(9658),c=r(9906);const d="packages/cheap/src/asm/memory.ts";let h;function l(e,t,r){try{const c=n.bx(o.E_(a.A),{shared:"function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer,initial:t,maximum:r});h=new WebAssembly.Instance(new WebAssembly.Module(c),{env:{memory:e}}),(0,i.$)({4:h.exports.readU8,5:h.exports.readU8,2:h.exports.readU8,3:h.exports.readU8,6:h.exports.readU16,7:h.exports.readU16,8:e=>h.exports.read32(e)>>>0,9:e=>h.exports.read32(e)>>>0,10:e=>BigInt.asUintN(64,h.exports.read64(e)),22:e=>BigInt.asUintN(64,h.exports.read64(e)),11:h.exports.read8,12:h.exports.read8,13:h.exports.read16,14:h.exports.read16,15:h.exports.read32,16:h.exports.read32,17:h.exports.read64,21:h.exports.read64,18:h.exports.readf32,19:h.exports.readf64,20:e=>h.exports.read32(e)>>>0,25:e=>h.exports.read32(e)>>>0}),(0,s.$)({4:h.exports.write8,5:h.exports.write8,2:h.exports.write8,3:h.exports.write8,6:h.exports.write16,7:h.exports.write16,8:h.exports.write32,9:h.exports.write32,10:h.exports.write64,22:h.exports.write64,11:h.exports.write8,12:h.exports.write8,13:h.exports.write16,14:h.exports.write16,15:h.exports.write32,16:h.exports.write32,17:h.exports.write64,21:h.exports.write64,18:h.exports.writef32,19:h.exports.writef64,20:h.exports.write32,25:h.exports.write32,copy:h.exports.copy,fill:h.exports.fill})}catch(e){c.R8("memory asm not support, cannot use asm memory function",d,122)}}},3082:(e,t,r)=>{r.d(t,{O5:()=>u,S5:()=>f,Xo:()=>p,uC:()=>h});var i=r(9983),s=r(2320),a=r(3139),o=r(495),n=r(1237),c=r(3674),d=r(2479);function h(e){if(!(e<=0||e>=7))return{x:128*(1&e),y:128*(e>>>1^(e<4?1:0))}}function l(e,t,r,i,s){if(!s)return o.UY;if(e<0)return o.UY;const a=1===i||2===i?s.log2ChromaW:0,c=e+(1<<a)-1>>>a;if(c&&r>n.go/c)return o.UY;let d=r*c;return 4&s.flags&&(d=d+7>>>3),d}function u(e,t,r){const i=(0,a.I)(t);if(!i)return o.UY;const{maxPixSteps:n,maxPixStepsComps:d}=function(e){const t=[0,0,0,0],r=[0,0,0,0];for(let i=0;i<4;i++)e.comp[i]&&e.comp[i].step>t[e.comp[i].plane]&&(t[e.comp[i].plane]=e.comp[i].step,r[e.comp[i].plane]=i);return{maxPixSteps:t,maxPixStepsComps:r}}(i);(0,c.sO)(e,0,16);let h=0;for(let t=0;t<4;t++){if((h=l(r,0,n[t],d[t],i))<0)return h;s.M[15](e+4*t,h)}}function f(e,t,r,d){const h=[0,0,0,0],l=(0,a.I)(t);if(!l)return o.UY;if((0,c.sO)(e,0,16),i.f[15](d)>n.go/r)return o.UY;if(s.M[25](e,i.f[15](d)*r),2&l.flags)return s.M[25](e+4,1024),0;for(let e=0;e<4;e++)l.comp[e]&&(h[l.comp[e].plane]=1);for(let t=0;t<4&&h[t];t++){let a=1===t||2===t?l.log2ChromaH:0,c=r+(1<<a)-1>>a;if(i.f[15](d+4*t)>n.go/c)return o.UY;s.M[25](e+4*t,c*i.f[15](d+4*t))}return 0}function p(e,t,r,a,h){const l=d.z(16),u=d.z(16);(0,c.sO)(e,0,16);for(let e=0;e<4;e++)s.M[15](l+4*e,i.f[15](h+4*e));let p=f(u,t,r,l);if(p<0)return m(),p;p=0;for(let e=0;e<4;e++){if(i.f[25](u+4*e)>n.go-p)return m(),o.UY;p+=i.f[25](u+4*e)}if(!a)return m(),p;s.M[20](e,a);for(let t=1;t<4&&i.f[25](u+4*t);t++)s.M[20](e+4*t,i.f[20](e+4*(t-1))+i.f[25](u+4*(t-1)));return m(),p;function m(){d.t(16),d.t(16)}}},3139:(e,t,r)=>{r.d(t,{I:()=>s,U:()=>a});const i=new Map;function s(e){if(i.has(e))return i.get(e);const t=C[e];if(!t)return;const r={log2ChromaW:t[0],log2ChromaH:t[1],flags:t[2],comp:t[3].map((e=>({plane:e[0],step:e[1],offset:e[2],shift:e[3],depth:e[4]})))};return i.set(e,r),r}function a(e){const t=s(e);if(t){let e=0,r=0,i=t.log2ChromaW+t.log2ChromaH;for(e=0;e<t.comp.length;e++){let s=1==e||2==e?0:i;r+=t.comp[e].depth<<s}return r>>i}return 0}const o=[[0,1,0,0,8],[1,1,0,0,8],[2,1,0,0,8]],n=[...o,[3,1,0,0,8]],c=[[0,2,0,0,9],[1,2,0,0,9],[2,2,0,0,9]],d=[...c,[3,2,0,0,9]],h=[[0,2,0,0,10],[1,2,0,0,10],[2,2,0,0,10]],l=[...h,[3,2,0,0,10]],u=[[0,2,0,0,12],[1,2,0,0,12],[2,2,0,0,12]],f=[...u,[3,2,0,0,12]],p=[[0,2,0,0,14],[1,2,0,0,14],[2,2,0,0,14]],m=[[0,2,0,0,16],[1,2,0,0,16],[2,2,0,0,16]],g=[...m,[3,2,0,0,16]],A=[[0,1,0,0,8],[1,2,0,0,8],[1,2,1,0,8]],v=[[0,1,0,0,8],[1,2,1,0,8],[1,2,0,0,8]],w=[[0,8,2,0,16],[0,8,4,0,16],[0,8,6,0,16],[0,8,0,0,16]],y=[[0,2,0,6,10],[1,4,0,6,10],[1,4,2,6,10]],b=[[0,2,0,4,12],[1,4,0,4,12],[1,4,2,4,12]],k=[[0,2,0,0,16],[1,4,0,0,16],[1,4,2,0,16]],_=[[0,8,0,0,16],[0,8,2,0,16],[0,8,4,0,16],[0,8,6,0,16]],I=[[0,8,4,0,16],[0,8,2,0,16],[0,8,0,0,16],[0,8,6,0,16]],x=[[2,2,0,0,9],[0,2,0,0,9],[1,2,0,0,9]],M=[[2,2,0,0,10],[0,2,0,0,10],[1,2,0,0,10]],P=[[2,2,0,0,12],[0,2,0,0,12],[1,2,0,0,12]],T=[[2,2,0,0,14],[0,2,0,0,14],[1,2,0,0,14]],E=[[2,2,0,0,16],[0,2,0,0,16],[1,2,0,0,16]],B=[[2,2,0,0,16],[0,2,0,0,16],[1,2,0,0,16],[3,2,0,0,16]],C={6:[2,2,16,o],0:[1,1,16,o],12:[1,1,16,o],4:[1,0,16,o],13:[1,0,16,o],5:[0,0,16,o],14:[0,0,16,o],23:[1,1,16,A],24:[1,1,16,v],188:[0,0,16,A],189:[0,0,16,v],59:[1,1,17,c],60:[1,1,16,c],69:[1,0,17,c],70:[1,0,16,c],65:[0,0,17,c],66:[0,0,16,c],61:[1,1,17,h],62:[1,1,16,h],63:[1,0,17,h],64:[1,0,16,h],67:[0,0,17,h],68:[0,0,16,h],122:[1,1,17,u],123:[1,1,16,u],126:[1,0,17,u],127:[1,0,16,u],130:[0,0,17,u],131:[0,0,16,u],124:[1,1,17,p],125:[1,1,16,p],128:[1,0,17,p],129:[1,0,16,p],132:[0,0,17,p],133:[0,0,16,p],46:[1,1,17,m],45:[1,1,16,m],48:[1,0,17,m],47:[1,0,16,m],50:[0,0,17,m],49:[0,0,16,m],33:[1,1,144,n],78:[1,0,144,n],79:[0,0,144,n],80:[1,1,145,d],81:[1,1,144,d],82:[1,0,145,d],83:[1,0,144,d],84:[0,0,145,d],85:[0,0,144,d],86:[1,1,145,l],87:[1,1,144,l],88:[1,0,145,l],89:[1,0,144,l],90:[0,0,145,l],91:[0,0,144,l],230:[1,1,145,f],229:[1,1,144,f],184:[1,0,145,f],185:[1,0,144,f],186:[0,0,145,f],187:[0,0,144,f],92:[1,1,145,g],93:[1,1,144,g],94:[1,0,145,g],95:[1,0,144,g],96:[0,0,145,g],97:[0,0,144,g],156:[0,0,129,w],155:[0,0,128,w],159:[1,1,17,y],158:[1,1,16,y],210:[1,1,17,b],209:[1,1,16,b],170:[1,1,17,k],169:[1,1,16,k],8:[0,0,0,[[0,1,0,0,8]]],29:[0,0,1,[[0,2,0,0,16]]],30:[0,0,0,[[0,2,0,0,16]]],56:[0,0,128,[[0,2,0,0,8],[0,2,1,0,8]]],109:[0,0,129,[[0,4,0,0,16],[0,4,2,0,16]]],110:[0,0,128,[[0,4,0,0,16],[0,4,2,0,16]]],26:[0,0,160,[[0,4,0,0,8],[0,4,1,0,8],[0,4,2,0,8],[0,4,3,0,8]]],25:[0,0,160,[[0,4,1,0,8],[0,4,2,0,8],[0,4,3,0,8],[0,4,0,0,8]]],104:[0,0,161,_],105:[0,0,160,_],28:[0,0,160,[[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8],[0,4,3,0,8]]],27:[0,0,160,[[0,4,3,0,8],[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8]]],106:[0,0,161,I],107:[0,0,160,I],2:[0,0,32,[[0,3,0,0,8],[0,3,1,0,8],[0,3,2,0,8]]],3:[0,0,32,[[0,3,2,0,8],[0,3,1,0,8],[0,3,0,0,8]]],119:[0,0,32,[[0,4,0,0,8],[0,4,1,0,8],[0,4,2,0,8]]],121:[0,0,32,[[0,4,2,0,8],[0,4,1,0,8],[0,4,0,0,8]]],71:[0,0,48,[[2,1,0,0,8],[0,1,0,0,8],[1,1,0,0,8]]],111:[0,0,176,[[2,1,0,0,8],[0,1,0,0,8],[1,1,0,0,8],[3,1,0,0,8]]],72:[0,0,49,x],73:[0,0,48,x],74:[0,0,49,M],75:[0,0,48,M],134:[0,0,49,P],135:[0,0,48,P],136:[0,0,49,T],137:[0,0,48,T],76:[0,0,49,E],77:[0,0,48,E],112:[0,0,177,B],113:[0,0,176,B]}},3201:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(4467),s=r(9906),a=r(4405),o=r(4310);const n="packages/common/src/io/IOReader.ts";class c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"endPointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"fileSize_",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),(0,i.A)(this,"onSize",void 0),(0,i.A)(this,"flags",void 0),(0,i.A)(this,"flushResolve",void 0),this.pos=BigInt(0),this.pointer=0,this.error=0,this.endPointer=0,this.littleEndian=!t,this.flags=0,r&&r.view)this.size=r.length,this.buffer=r,this.data=r.view;else if(r&&!r.byteOffset)this.size=r.length,this.buffer=r,this.data=new DataView(this.buffer.buffer);else{if(r)throw new Error("not support subarray of ArrayBuffer");this.size=Math.max(e,102400),this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}async readUint8(){this.remainingLength()<1&&await this.flush(1);const e=this.data.getUint8(this.pointer);return this.pointer++,this.pos++,e}async peekUint8(){return this.remainingLength()<1&&await this.flush(1),this.data.getUint8(this.pointer)}async readUint16(){this.remainingLength()<2&&await this.flush(2);const e=this.data.getUint16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),e}async peekUint16(){return this.remainingLength()<2&&await this.flush(2),this.data.getUint16(this.pointer,this.littleEndian)}async readUint24(){this.remainingLength()<3&&await this.flush(3);const e=await this.readUint16(),t=await this.readUint8();return this.littleEndian?t<<16|e:e<<8|t}async peekUint24(){this.remainingLength()<3&&await this.flush(3);const e=this.pointer,t=this.pos,r=await this.readUint16(),i=await this.readUint8(),s=this.littleEndian?i<<16|r:r<<8|i;return this.pointer=e,this.pos=t,s}async readUint32(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getUint32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekUint32(){return this.remainingLength()<4&&await this.flush(4),this.data.getUint32(this.pointer,this.littleEndian)}async readUint64(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getBigUint64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekUint64(){return this.remainingLength()<8&&await this.flush(8),this.data.getBigUint64(this.pointer,this.littleEndian)}async readInt8(){this.remainingLength()<1&&await this.flush(1);const e=this.data.getInt8(this.pointer);return this.pointer++,this.pos++,e}async peekInt8(){return this.remainingLength()<1&&await this.flush(1),this.data.getInt8(this.pointer)}async readInt16(){this.remainingLength()<2&&await this.flush(2);const e=this.data.getInt16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),e}async peekInt16(){return this.remainingLength()<2&&await this.flush(2),this.data.getInt16(this.pointer,this.littleEndian)}async readInt24(){const e=await this.readUint24();return 8388608&e?e-16777216:e}async peekInt24(){const e=await this.peekUint24();return 8388608&e?e-16777216:e}async readInt32(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getInt32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekInt32(){return this.remainingLength()<4&&await this.flush(4),this.data.getInt32(this.pointer,this.littleEndian)}async readInt64(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getBigInt64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekInt64(){return this.remainingLength()<8&&await this.flush(8),this.data.getBigInt64(this.pointer,this.littleEndian)}async readFloat(){this.remainingLength()<4&&await this.flush(4);const e=this.data.getFloat32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),e}async peekFloat(){return this.remainingLength()<4&&await this.flush(4),this.data.getFloat32(this.pointer,this.littleEndian)}async readDouble(){this.remainingLength()<8&&await this.flush(8);const e=this.data.getFloat64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),e}async peekDouble(){return this.remainingLength()<8&&await this.flush(8),this.data.getFloat64(this.pointer,this.littleEndian)}async readHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let r=0;r<e;r++){const e=(await this.readUint8()).toString(16);t+=1===e.length?"0"+e:e}return t}async peekHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;e>this.size&&(this.error=-1048574,s.h2("peekHex, length too large",n,416)),this.remainingLength()<e&&await this.flush(e);const t=this.pointer,r=this.pos;let i="";for(let t=0;t<e;t++){const e=(await this.readUint8()).toString(16);i+=1===e.length?"0"+e:e}return this.pointer=t,this.pos=r,i}async readBuffer(e,t){if(t||(t=new Uint8Array(e)),this.remainingLength()<e){let r=0;if(this.remainingLength()>0){const i=this.remainingLength();t.set(this.buffer.subarray(this.pointer,this.pointer+i),r),r+=i,this.pointer+=i,this.pos+=BigInt(i),e-=i}for(;e>0;){await this.flush();const i=Math.min(this.endPointer-this.pointer,e);t.set(this.buffer.subarray(this.pointer,this.pointer+i),r),r+=i,this.pointer+=i,this.pos+=BigInt(i),e-=i}}else t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),this.pointer+=e,this.pos+=BigInt(e);return t}async peekBuffer(e,t){return e>this.size&&(this.error=-1048574,s.h2("peekBuffer, length too large",n,501)),this.remainingLength()<e&&await this.flush(e),t||(t=new Uint8Array(e)),t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),t}async readToBuffer(e,t){if(this.remainingLength()<e){let r=0;if(this.remainingLength()>0){const i=this.remainingLength();t.set(this.buffer.subarray(this.pointer,this.pointer+i),r),r+=i,this.pointer+=i,this.pos+=BigInt(i),e-=i}for(;e>0;){try{await this.flush()}catch(e){if(-1048576===this.error&&r)return r;throw e}const i=Math.min(this.endPointer-this.pointer,e);t.set(this.buffer.subarray(this.pointer,this.pointer+i),r),r+=i,this.pointer+=i,this.pos+=BigInt(i),e-=i}return r}return t.set(this.buffer.subarray(this.pointer,this.pointer+e),0),this.pointer+=e,this.pos+=BigInt(e),e}async readString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=await this.readBuffer(e);return a.decode(t)}async peekString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=await this.peekBuffer(e);return a.decode(t)}async readLine(){let e="";for(;;){let t=!1;for(let r=this.pointer;r<this.endPointer;r++)if(10===this.buffer[r]||13===this.buffer[r]){r!==this.pointer&&(e+=await this.readString(r-this.pointer)),t=!0;break}if(t)break;e+=await this.readString(this.remainingLength()),await this.flush()}let t=await this.peekUint8();return 10!==t&&13!==t||(this.pointer++,13===t&&(t=await this.peekUint8(),10===t&&this.pointer++)),e}async peekLine(){if(this.remainingLength()<this.size)try{await this.flush()}catch(e){if(-1048576!==this.error)throw e}let e="",t=!1;for(let r=this.pointer;r<this.endPointer;r++)if(10===this.buffer[r]||13===this.buffer[r]){e+=await this.peekString(r-this.pointer),t=!0;break}return t||(this.error=-1048574,s.h2("peekLine, out of buffer",n,659)),e}getPointer(){return this.pointer}getPos(){return this.pos}async skip(e){const t=e;for(;this.remainingLength()<e;)e-=this.remainingLength(),this.pointer=this.endPointer,await this.flush();this.remainingLength()>=e&&(this.pointer+=e),this.pos+=BigInt(t)}remainingLength(){return this.endPointer-this.pointer}async flush_(e){return new Promise((async t=>{for(this.flushResolve=t;;){const r=await this.onFlush(e);if(-1048575!==r){this.flushResolve=null,t(r);break}await new o.A(0)}}))}async flush(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.onFlush||(this.error=-1048574,s.h2("IOReader error, flush failed because of no flush callback",n,738)),!(this.size-this.remainingLength()<=0)){if(e=Math.min(e,this.size),this.pointer<this.endPointer?(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer):this.endPointer=0,this.pointer=0,e)for(;this.remainingLength()<e;){const e=await this.flush_(this.buffer.subarray(this.endPointer));if(e<0)throw this.error=e,new Error(`IOReader error, flush ${-1048576===e?"ended":"failed"}, ret: ${e}`);this.endPointer+=e}else{const e=await this.flush_(this.buffer.subarray(this.endPointer));if(e<0)throw this.error=e,new Error(`IOReader error, flush ${-1048576===e?"ended":"failed"}, ret: ${e}`);this.endPointer+=e}this.error=0}}async seek(e){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])){const t=Number(e-this.pos);if(t<0&&Math.abs(t)<=this.pointer)return this.pointer+=t,void(this.pos=e);if(t>0&&this.pointer+t<this.endPointer)return this.pointer+=t,void(this.pos=e);if(0===t)return}this.onSeek||(this.error=-1048574,s.h2("IOReader error, seek failed because of no seek callback",n,809)),this.pointer=this.endPointer=0,this.pos=e;const r=await this.onSeek(e);0!==r&&(this.error=r,s.h2("IOReader error, seek failed",n,818)),t&&await this.flush()}getBuffer(){return this.buffer}appendBuffer(e){if(this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=e.length)this.buffer.set(e,this.endPointer),this.endPointer+=e.length;else{const t=Math.min(this.size-this.endPointer,e.length);this.buffer.set(e.subarray(0,t),this.endPointer),this.endPointer+=t,s.R8("IOReader, call appendBuffer but the buffer's size is lagger then the remaining size",n,856)}}reset(){this.pointer=this.endPointer=0,this.pos=BigInt(0),this.error=0}setEndian(e){this.littleEndian=!e}isBigEndian(){return!this.littleEndian}async fileSize(){if(this.fileSize_)return this.fileSize_;if(!this.onSize)return s.R8("IOReader error, fileSize failed because of no onSize callback",n,898),BigInt(0);try{this.fileSize_=await this.onSize()}catch(e){s.R8(`IOReader error, call fileSize failed: ${e}`,n,905),this.fileSize_=BigInt(0)}return this.fileSize_}getBufferSize(){return this.size}async pipe(e,t){if(t)if(this.remainingLength()<t){if(this.remainingLength()>0){const r=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+r)),this.pointer+=r,this.pos+=BigInt(r),t-=r}for(;t>0;){await this.flush();const r=Math.min(this.remainingLength(),t);await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+r)),this.pointer+=r,this.pos+=BigInt(r),t-=r}}else await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t);else{if(this.remainingLength()>0){const t=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t)}for(;await this.flush_(this.buffer.subarray(0))>0;){const t=this.remainingLength();await e.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+t)),this.pointer+=t,this.pos+=BigInt(t)}}}abort(){this.error=-1048572,this.flushResolve&&(this.flushResolve(-1048572),this.flushResolve=null)}}},3214:(e,t,r)=>{r.d(t,{I_:()=>m,SQ:()=>g});var i=r(8085),s=r(9983),a=r(2320),o=r(7127),n=r(7332),c=r(8590),d=r(3321),h=r(665),l=r(7698);const u=Object.getPrototypeOf({});function f(e,t){for(;;){let r=e[o.JY];if(r){const e=r.get(t);if(e)return e}if(!(e=Object.getPrototypeOf(e))||e===u)return null}}function p(e,t,r,n){const d={};d[o.o9]=e;let u=(0,i.A)(n?20:r);return new Proxy(d,{get(e,t,i){if(t===o.o9)return e[o.o9];const a=(0,l.A)(t);return n?s.f[20](e[o.o9]+a*u):c.Pc(r)?e[t]:s.f[r](e[o.o9]+a*u)},set(e,t,i,s){if(t===o.o9)return e[o.o9]=i,!0;const d=(0,l.A)(t);if(n)a.M[20](e[o.o9]+d*u,i),e[t]=i;else if(c.Pc(r)){const s=e[t]||(e[t]=m(e[o.o9]+d*u,r));h.__(i,((e,t)=>{s[t]=e})),e[t]=s}else a.M[r](e[o.o9]+d*u,i),e[t]=i;return!0}})}function m(e,t){const r=c.Pc(t)?t.prototype:t,i={};i[o.o9]=e,Object.setPrototypeOf(i,r);const{proxy:l,revoke:u}=Proxy.revocable(i,{get(e,t,i){if(c.Yj(t)){const i=f(r,t.replace(/^\$+/,""));if(i){const r=e[o.o9]+i[7];if(i[3]){let s=e[t];return s||(s=p(r,i[4],i[0],i[1]),e[t]=s),s[o.o9]=r,s}if(i[1])return s.f[20](r);if(c.Pc(i[0])||c.Ik(i[0]))return e[t]||(e[t]=m(r,i[0]));{let e=s.f[i[0]](r);return i[5]&&(e=e>>>8*n.i[i[0]]-i[8]-i[6]&Math.pow(2,i[6])-1),e}}return e[t]}return e[t]},set(e,t,i,l){if(c.Yj(t)){const l=f(r,t.replace(/^\$+/,""));if(l){const r=e[o.o9]+l[7];if(l[3]){const s=e[t]||p(r,l[4],l[0],l[1]);d.__(i,((e,t)=>{s[t]=e})),e[t]=s}else if(l[1])a.M[20](r,i),e[t]=i;else if(c.Pc(l[0])||c.Ik(l[0])){const s=e[t]||(e[t]=m(r,l[0]));h.__(i,((e,t)=>{s[t]=e})),e[t]=s}else{if(l[5]){let e=0,t=8*n.i[l[0]];for(let r=0;r<l[6];r++)e|=1<<t-1-(r+l[8]);const o=s.f[l[0]](r);a.M[l[0]](r,o&~e|(i&Math.pow(2,l[6])-1)<<t-l[8]-l[6])}else a.M[l[0]](r,i);e[t]=i}}else e[t]=i}else e[t]=i;return!0},getOwnPropertyDescriptor:(e,t)=>({enumerable:!0,configurable:!0}),ownKeys:e=>Array.from(e[o.JY].keys())});return i[o.kE]=u,l}function g(e){const t=e[o.kE];t&&t()}},3262:(e,t,r)=>{r.d(t,{FP:()=>c,Mr:()=>n,iU:()=>l,j2:()=>h,k:()=>o,lb:()=>d});var i=r(9983),s=r(1237),a=r(576);function o(e,t,r){return e*BigInt(t.num)*BigInt(r.den)/(BigInt(t.den)*BigInt(r.num))}function n(e,t,r){return e*BigInt(i.f[15](t))*BigInt(r.den)/(BigInt(i.f[15](t+4))*BigInt(r.num))}function c(e,t,r){return e*BigInt(t.num)*BigInt(i.f[15](r+4))/(BigInt(t.den)*BigInt(i.f[15](r)))}function d(e){return e.num/e.den}function h(e,t){if(isNaN(19))return{den:0,num:0};if(Math.abs(e)>s.go+3)return{den:0,num:e<0?-1:1};const r=e>1?{den:Math.floor(t/e+.5),num:t}:{den:t,num:Math.floor(e*t+.5)};return l(r),r}function l(e){const t=(0,a.A)(e.num,e.den);t<=1||(e.den/=t,e.num/=t)}},3270:(e,t,r)=>{function i(e,t,r,i){if(e<=0||e>64)return 0;if(t)switch(e){case 32:return r?65556:65557;case 64:return r?65558:65559;default:return 0}else if(e+=7,i&1<<(e>>>=3)-1)switch(e){case 1:return 65540;case 2:return r?65537:65536;case 3:return r?65549:65548;case 4:return r?65545:65544;case 8:return r?65568:65567;default:return 0}else switch(e){case 1:return 65541;case 2:return r?65539:65538;case 3:return r?65551:65550;case 4:return r?65547:65546;default:return 0}}function s(e){switch(e){case 69649:return 2;case 69648:return 3;case 69647:case 69633:case 69632:case 69645:case 69638:return 4;default:return function(e){switch(e){case 86070:case 86071:case 69674:case 69644:case 69678:case 69651:case 69661:case 69677:case 69655:case 69664:case 69636:case 69675:case 69660:case 69646:case 69670:return 4;case 86089:case 86090:case 86091:case 86092:case 65543:case 65542:case 65571:case 65540:case 65563:case 65572:case 65541:case 81924:case 81926:return 8;case 65537:case 65566:case 65536:case 65554:case 65539:case 65538:return 16;case 65552:case 65549:case 65548:case 65564:case 65551:case 65550:return 24;case 65545:case 65544:case 65565:case 65547:case 65546:case 65556:case 65557:case 65570:case 65569:return 32;case 65558:case 65559:case 65568:case 65567:return 64;default:return 0}}(e)}}r.d(t,{MZ:()=>s,uU:()=>i})},3316:(e,t,r)=>{r.d(t,{default:()=>_e});var i,s=r(4467),a=r(7127),o=r(7601),n=r(1228),c=r(5419),d=r(2259),h=r(9983),l=r(2320),u=r(7145),f=r(6890),p=r(872),m=r(6038),g=r(5992),A=r(2029),v=r(2709),w=r(4158),y=r(4081),b=r(7827),k=r(5280),_=r(5256),I=r(1042),x=r(3463),M=r(8288),P=r(7084),T=r(8590),E=r(665),B=r(1605),C=r(9906),S=r(5134),U=r(1762),D=r(4310),R=r(6756),L=r(2935),$=r(3674),F=r(6513),z=r(2030),O=r(495),V=r(3139),N=r(4824),W=r(1781),Q=r(4187),H=r(3394),G=r(1755),j=r(3262),Y=r(1237),q=r(2836),K=r(8738),X=r(8477),J=r(5633),Z=r(2364),ee=r(7194),te=r(7314),re=r(3831),ie=r(1497),se=r(4229),ae=r(3690),oe=r(6760),ne=r(3270),ce=r(7526),de=r(2535),he=r(1292),le=r(3830),ue=r(8105),fe=r(3535),pe=r(679),me=r(8293),ge=r(8742),Ae=r(1598),ve=r(4125),we=r(544);const ye="packages/avtranscoder/src/AVTranscoder.ts";class be{constructor(){(0,s.A)(this,"avpacketList",void 0),(0,s.A)(this,"avframeList",void 0),(0,s.A)(this,"avpacketListMutex",void 0),(0,s.A)(this,"avframeListMutex",void 0)}}i=be,(()=>{const e=i.prototype,t=new Map;t.set("avpacketList",{0:n.A,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("avframeList",{0:n.A,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("avpacketListMutex",{0:c.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("avframeListMutex",{0:c.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,32),(0,o.A)(e,a.JY,t)})();const ke={};class _e extends I.A{constructor(e){super(!0),(0,s.A)(this,"level",C.rD),(0,s.A)(this,"DemuxThreadReady",void 0),(0,s.A)(this,"AudioThreadReady",void 0),(0,s.A)(this,"VideoThreadReady",void 0),(0,s.A)(this,"MuxThreadReady",void 0),(0,s.A)(this,"IOThread",void 0),(0,s.A)(this,"DemuxerThread",void 0),(0,s.A)(this,"MuxThread",void 0),(0,s.A)(this,"AudioDecoderThread",void 0),(0,s.A)(this,"AudioFilterThread",void 0),(0,s.A)(this,"AudioEncoderThread",void 0),(0,s.A)(this,"VideoDecoderThread",void 0),(0,s.A)(this,"VideoFilterThread",void 0),(0,s.A)(this,"VideoEncoderThread",void 0),(0,s.A)(this,"GlobalData",void 0),(0,s.A)(this,"tasks",void 0),(0,s.A)(this,"options",void 0),(0,s.A)(this,"reportTimer",void 0),this.options=E.X$({},ke,e),this.GlobalData=(0,d.A)(be),c.Ts(this.GlobalData[a.o9]+24),c.Ts(this.GlobalData[a.o9]+28),this.tasks=new Map,this.reportTimer=new R.A((()=>{this.report()}),0,1e3),C.pq("create transcoder",ye,467)}async getResource(e,t,r){var i;const s=null!=t?`${e}-${t}`:e;if(_e.Resource.has(s))return _e.Resource.get(s);const a=this.options.getWasm?this.options.getWasm(e,t,r):(0,J.A)(null!==(i=this.options.wasmBaseUrl)&&void 0!==i?i:`https://cdn.jsdelivr.net/gh/zhaohappy/libmedia@${"v0.6.1-408-gdf1fec0d".split("-")[0].replace(/^[v|n]/,"")}/dist`,e,t);if(a){let e;if((M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0))&&(T.Yj(a)||T.sv(a)))if(T.Yj(a)){const t={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"},r=await fetch(a,t);e=await r.arrayBuffer()}else e=a;else e=await(0,Z.A)(a,0===r);return _e.Resource.set(s,e),e}}report(){this.tasks.forEach((e=>{if(e.startTime){const t=e.stats.videoPacketEncodeCount||e.stats.audioPacketEncodeCount,r=(0,U.A)()-e.startTime;let i=BigInt(0),s=BigInt(0);if(e.stats.lastVideoMuxDts){const t=e.streams.find((e=>0===h.f[15](e.input.codecpar)));i=e.stats.lastVideoMuxDts-e.stats.firstVideoMuxDts,s=t.output?(0,j.k)(t.output.duration,t.output.timeBase,Y.i0):(0,j.k)(t.input.duration,t.input.timeBase,Y.i0)}if(e.stats.lastAudioMuxDts&&!i){const t=e.streams.find((e=>1===h.f[15](e.input.codecpar)));i=e.stats.lastAudioMuxDts-e.stats.firstAudioMuxDts,s=t.output?(0,j.k)(t.output.duration,t.output.timeBase,Y.i0):(0,j.k)(t.input.duration,t.input.timeBase,Y.i0)}const a=r?Number(t)/(r/1e3):Number(t),o=Number(e.stats.bufferOutputBytes)/1e3,n=i?8*o/(Number(i)/1e3):0,c=Number(i)/1e3/(r/1e3);let d=s?Number(i)/Number(s)*100:0;d>100&&(d=100),C.pq(`[${e.taskId}] frame=${t} fps=${a.toFixed(2)} size=${o}kB time=${ce.iV(i)} bitrate=${n.toFixed(2)}kbps speed=${c.toFixed(2)}x progress=${d.toFixed(2)}%`,ye,561),this.options.onprogress&&this.options.onprogress(e.taskId,d)}}))}async startDemuxPipeline(){return this.DemuxThreadReady?this.DemuxThreadReady:this.DemuxThreadReady=new Promise((async e=>{this.IOThread=await(0,z.pt)(y.A,{name:"IOThread"},4081).run(),this.IOThread.setLogLevel(this.level),this.DemuxerThread=await(0,z.pt)(w.A,{name:"DemuxerThread"},4158).run(),this.DemuxerThread.setLogLevel(this.level),e()}))}async startVideoPipeline(){return this.VideoThreadReady?this.VideoThreadReady:this.VideoThreadReady=new Promise((async e=>{this.VideoDecoderThread=await(0,z.pt)(k.A,{name:"VideoDecoderThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},5280).run(),this.VideoDecoderThread.setLogLevel(this.level),this.VideoFilterThread=await(0,z.pt)(Ae.A,{name:"VideoFilterThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},1598).run(),this.VideoFilterThread.setLogLevel(this.level),this.VideoEncoderThread=await(0,z.pt)(_.A,{name:"VideoEncoderThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},5256).run(),this.VideoEncoderThread.setLogLevel(this.level),e()}))}async startAudioPipeline(){return this.AudioThreadReady?this.AudioThreadReady:this.AudioThreadReady=new Promise((async e=>{this.AudioDecoderThread=await(0,z.pt)(A.A,{name:"AudioDecoderThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},2029).run(),this.AudioDecoderThread.setLogLevel(this.level),this.AudioFilterThread=await(0,z.pt)(Ae.A,{name:"AudioFilterThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},1598).run(),this.AudioFilterThread.setLogLevel(this.level),this.AudioEncoderThread=await(0,z.pt)(v.A,{name:"AudioEncoderThread",disableWorker:M.A.safari&&!M.A.checkVersion(M.A.version,"16.1",!0)||P.A.ios&&!M.A.checkVersion(P.A.version,"16.1",!0)},2709).run(),this.AudioEncoderThread.setLogLevel(this.level),e()}))}async startMuxPipeline(){return this.MuxThreadReady?this.MuxThreadReady:this.MuxThreadReady=new Promise((async e=>{this.MuxThread=await(0,z.pt)(b.A,{name:"MuxThread",disableWorker:!x.A.workerMSE},7827).run(),this.MuxThread.setLogLevel(this.level),e()}))}isHls(e){return e.ext?"m3u8"===e.ext||"m3u"===e.ext:e.options.input.file instanceof de.A?"m3u8"===e.options.input.file.ext:"m3u8"===e.options.input.ext}isDash(e){return e.ext?"mpd"===e.ext:e.options.input.file instanceof de.A?"mpd"===e.options.input.file.ext:"mpd"===e.options.input.ext}async ready(){await this.startDemuxPipeline(),await this.startAudioPipeline(),await this.startVideoPipeline(),await this.startMuxPipeline(),C.pq("AVTranscoder pipelines started",ye,703)}changeAVStreamTimebase(e,t){let r=e.startTime,i=e.duration;r!==Y.Dh&&(r=(0,j.k)(r,e.timeBase,t)),i!==Y.Dh&&(i=(0,j.k)(i,e.timeBase,t)),e.duration=i,e.startTime=r,e.timeBase.den=t.den,e.timeBase.num=t.num}copyAVStreamInterface(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=E.X$({},t);if(i.codecpar=(0,G.Gy)(168),(0,q.Yi)(i.codecpar,t.codecpar),i.timeBase={den:1,num:1},i.timeBase.den=t.timeBase.den,i.timeBase.num=t.timeBase.num,l.M[8](i.codecpar+8,0),i.timeBase.num>1&&(1===h.f[15](i.codecpar)?this.changeAVStreamTimebase(i,{num:1,den:h.f[15](i.codecpar+136)}):0===h.f[15](i.codecpar)&&this.changeAVStreamTimebase(i,{num:1,den:9e4})),1===e.oformat&&0===h.f[15](i.codecpar)){const e=(0,j.lb)((0,f.A)(i.codecpar+72,u.Q));e===Math.floor(e)&&this.changeAVStreamTimebase(i,{num:1,den:256*e})}return h.f[20](i.codecpar+12)&&!r&&((0,G.Eb)(h.f[20](i.codecpar+12)),l.M[20](i.codecpar+12,0),l.M[15](i.codecpar+16,0)),t.attachedPic&&(i.attachedPic=(0,Q._5)(),(0,Q.rN)(i.attachedPic,t.attachedPic)),e.options.duration&&(i.duration=(0,j.k)(BigInt(Math.floor(e.options.duration)),Y.i0,i.timeBase)),r||(i.metadata.encoder="libmedia-v0.6.1-408-gdf1fec0d"),i}freeAVStreamInterface(e){e.codecpar&&((0,q.dn)(e.codecpar),e.codecpar=0),e.attachedPic&&((0,Q.Qe)(e.attachedPic),e.attachedPic=0)}async setTaskInput(e){const t=e.taskId,r=e.options,i=e.ioloader2DemuxerChannel=(0,ve.A)(),s=e.stats;let o,n=0;if(T.Yj(r.input.file)){let{info:e,type:c,ext:d}=await(0,ee.A)(r.input.file,r.input.ext,r.input.http);o=d,n=await this.IOThread.registerTask.transfer(i.port1).invoke({type:c,info:{...e},range:{from:-1,to:-1},taskId:t,options:{isLive:!1},rightPort:i.port1,stats:s[a.o9]})}else if(r.input.file instanceof File)o=r.input.file.name.split(".").pop(),n=await this.IOThread.registerTask.transfer(i.port1).invoke({type:1,info:{file:r.input.file},range:{from:-1,to:-1},taskId:t,options:{isLive:!1},rightPort:i.port1,stats:s[a.o9]});else if(r.input.file instanceof de.A){const t=e.inputIPCPort=new L.Ay(i.port1);t.on(L.S3,(async r=>{switch(r.method){case"open":{const i=await e.options.input.file.open();if(i<0){C.z3(`custom loader open error, ${i}, taskId: ${e.taskId}`,ye,862),t.reply(r,null,i);break}t.reply(r,i);break}case"read":{const i=r.params.pointer,s=r.params.length,a=(0,$.JW)(i,s);try{const i=await e.options.input.file.read(s,a);i>0&&(e.stats.bufferReceiveBytes+=BigInt(0|i)),t.reply(r,i)}catch(i){C.z3(`loader read error, ${i}, taskId: ${e.taskId}`,ye,886),t.reply(r,O.LR)}break}case"write":{const i=r.params.pointer,s=r.params.length,a=(0,$.JW)(i,s);try{const i=await e.options.input.file.write(a);e.stats.bufferSendBytes+=s,t.reply(r,i)}catch(i){C.z3(`loader write error, ${i}, taskId: ${e.taskId}`,ye,908),t.reply(r,O.LR)}break}case"seek":{const i=r.params.pos;try{const s=await e.options.input.file.seek(i);if(s<0){C.z3(`custom loader seek error, ${s}, taskId: ${e.taskId}`,ye,923),t.reply(r,null,s);break}t.reply(r,s)}catch(i){C.z3(`loader seek error, ${i}, taskId: ${e.taskId}`,ye,930),t.reply(r,null,i)}break}case"size":t.reply(r,await e.options.input.file.size())}}))}else C.h2("invalid source",ye,944);o&&(e.ext=o),n<0&&C.h2(`register io task failed, ret: ${n}, taskId: ${t}`,ye,953)}async setTaskOutput(e){var t,r;const i=e.muxer2OutputChannel=(0,ve.A)(),s=e.outputIPCPort=new L.Ay(i.port2);let o;if(e.options.output.format)o=me.iW[e.options.output.format];else if(e.options.output.file instanceof FileSystemFileHandle){let t=e.options.output.file.name.split(".").pop();o=me.HR[t]}T.ai(o)||C.h2("invalid output format",ye,975),e.oformat=o;let n,c=await this.MuxThread.registerTask.transfer(i.port1).invoke({taskId:e.taskId,format:o,avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,stats:e.stats[a.o9],rightPort:i.port1,formatOptions:e.options.output.formatOptions,zeroStart:null!==(t=e.options.startAtZero)&&void 0!==t&&t,nonnegative:null!==(r=e.options.nonnegative)&&void 0!==r&&r});c<0&&C.h2(`register mux task failed, ret: ${c}, taskId: ${e.taskId}`,ye,994),e.options.output.file instanceof FileSystemFileHandle?(n=e.safeFileIO=new ue.A(e.options.output.file),await e.safeFileIO.ready()):n=e.options.output.file,s.on(L.Wo,(async t=>{switch(t.method){case"write":try{if(null!=t.params.pos?n.appendBufferByPosition(t.params.data,Number(t.params.pos)):n.write(t.params.data),e.options.output.file instanceof FileSystemFileHandle&&e.safeFileIO.writeQueueSize>5)try{for(await this.MuxThread.pause(e.taskId);e.safeFileIO.writeQueueSize>5;)await new D.A(0);await this.MuxThread.unpause(e.taskId)}catch(e){}}catch(t){C.z3(`ioWriter write error, ${t}, taskId: ${e.taskId}`,ye,1036)}break;case"seek":{const r=t.params.pos;try{n.seek(Number(r))}catch(t){C.z3(`ioWriter seek error, ${t}, taskId: ${e.taskId}`,ye,1049)}break}case"end":await n.close(),await this.clearTask(e),this.fire(ge.TASK_ENDED,[e.taskId]),C.pq(`transcode ended, taskId: ${e.taskId}, cost: ${ce.iV(BigInt(Math.floor((0,U.A)()-e.startTime)))}`,ye,1057);break;case"error":await n.close(),await this.clearTask(e),this.fire(ge.TASK_ERROR,[e.taskId]),C.pq(`transcode error, taskId: ${e.taskId}`,ye,1065)}}))}async analyzeInputStreams(e){const t=e.taskId,r=e.ioloader2DemuxerChannel,i=e.ext,s=e.stats;let o,n=0;if(this.isDash(e)){await this.IOThread.open(t);const n=await this.IOThread.hasAudio(t),c=await this.IOThread.hasVideo(t);n&&c?(o=(0,S.A)(),await this.DemuxerThread.registerTask.transfer(r.port2,e.controller.getDemuxerRenderControlPort()).invoke({taskId:t,leftPort:r.port2,controlPort:e.controller.getDemuxerRenderControlPort(),format:me.HR[i],stats:s[a.o9],isLive:!1,flags:2,ioloaderOptions:{mediaType:"audio"},avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,formatOptions:e.options.input.formatOptions}),await this.DemuxerThread.registerTask({taskId:o,mainTaskId:t,flags:2,format:me.HR[i],stats:s[a.o9],isLive:!1,ioloaderOptions:{mediaType:"video"},avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,formatOptions:e.options.input.formatOptions})):await this.DemuxerThread.registerTask.transfer(r.port2,e.controller.getDemuxerRenderControlPort()).invoke({taskId:t,leftPort:r.port2,controlPort:e.controller.getDemuxerRenderControlPort(),format:me.HR[i],stats:s[a.o9],isLive:!1,flags:2,ioloaderOptions:{mediaType:n?"audio":"video"},avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,formatOptions:e.options.input.formatOptions})}else await this.DemuxerThread.registerTask.transfer(r.port2,e.controller.getDemuxerRenderControlPort()).invoke({taskId:t,leftPort:r.port2,controlPort:e.controller.getDemuxerRenderControlPort(),format:me.HR[i],stats:s[a.o9],isLive:!1,flags:this.isHls(e)?2:0,avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,formatOptions:e.options.input.formatOptions});n=await this.DemuxerThread.openStream(t,15e3),n<0&&C.h2(`open stream failed, ret: ${n}, taskId: ${t}`,ye,1162);let c=await this.DemuxerThread.analyzeStreams(t);if(!T.ai(c)){if(c.streams.length||C.h2("not found any stream",ye,1170),o){n=await this.DemuxerThread.openStream(o,15e3),n<0&&C.h2(`open stream failed, ret: ${n}, taskId: ${t}`,ye,1176);const e=await this.DemuxerThread.analyzeStreams(o);if(T.ai(e))return void C.h2(`analyze stream failed, ret: ${e}`,ye,1180);e.streams.length||C.h2("not found any stream",ye,1184),c.streams=c.streams.concat(e.streams)}if(o&&(e.subTaskId=o),this.isHls(e)||this.isDash(e)){const e=1e3*await this.IOThread.getDuration(t);if(e>0)for(let t=0;t<c.streams.length;t++)c.streams[t].duration=(0,j.k)(BigInt(Math.floor(e)),Y.i0,c.streams[t].timeBase)}return c}C.h2(`analyze stream failed, ret: ${c}`,ye,1166)}async handleAudioStream(e,t){const r=t.options.output.audio;if(null!=r&&r.disable)return await this.DemuxerThread.setAVStreamDiscard(t.taskId,e.index,48),0;if("copy"!==(null==r?void 0:r.codec)||t.options.start||t.options.duration){var i;const s=(0,ve.A)(),o=(0,ve.A)(),n=(0,ve.A)(),c=(0,ve.A)(),d=this.copyAVStreamInterface(t,e),u=(0,S.A)();let f=0;if(r){if(r.codec&&"copy"!==r.codec){const t=me.n1[r.codec];T.ai(t)||(this.freeAVStreamInterface(d),C.h2(`invalid codec name(${r.codec})`,ye,1261)),l.M[15](d.codecpar+4,t),h.f[15](d.codecpar+4)!==h.f[15](e.codecpar+4)&&(l.M[15](d.codecpar+48,Y.N_),l.M[15](d.codecpar+52,Y.N_))}if(r.bitrate&&l.M[17](d.codecpar+32,BigInt(Math.floor(r.bitrate))),r.channels&&l.M[15](d.codecpar+116,r.channels),r.sampleRate&&l.M[15](d.codecpar+136,r.sampleRate),r.sampleFmt){const e=me.Sz[r.sampleFmt];T.ai(e)||(this.freeAVStreamInterface(d),C.h2(`invalid sampleFmt name(${r.sampleFmt})`,ye,1283)),l.M[15](d.codecpar+28,e)}r.profile&&l.M[15](d.codecpar+48,r.profile)}if(16===t.oformat){if(65557!==h.f[15](d.codecpar+4)&&65559!==h.f[15](d.codecpar+4)&&65541!==h.f[15](d.codecpar+4)&&65536!==h.f[15](d.codecpar+4)&&65548!==h.f[15](d.codecpar+4)&&65544!==h.f[15](d.codecpar+4)&&65567!==h.f[15](d.codecpar+4))switch(h.f[15](d.codecpar+28)){case 3:case 8:default:l.M[15](d.codecpar+4,65557);break;case 4:case 9:l.M[15](d.codecpar+4,65559);break;case 0:case 5:l.M[15](d.codecpar+4,65541);break;case 1:case 6:l.M[15](d.codecpar+4,65536);break;case 2:case 7:l.M[15](d.codecpar+4,65544);break;case 10:case 11:l.M[15](d.codecpar+4,65567)}switch(h.f[15](d.codecpar+4)){case 65557:l.M[15](d.codecpar+28,3);break;case 65559:l.M[15](d.codecpar+28,4);break;case 65541:l.M[15](d.codecpar+28,0);break;case 65536:l.M[15](d.codecpar+28,1);break;case 65548:case 65544:l.M[15](d.codecpar+28,2);break;case 65567:l.M[15](d.codecpar+28,10)}l.M[15](d.codecpar+40,ne.MZ(h.f[15](e.codecpar+4)))}if(86018===h.f[15](d.codecpar+4))l.M[15](d.codecpar+28,8),h.f[15](d.codecpar+136)>48e3&&l.M[15](d.codecpar+136,48e3);else if(86017===h.f[15](d.codecpar+4))l.M[15](d.codecpar+28,8),h.f[15](d.codecpar+136)>48e3&&l.M[15](d.codecpar+136,48e3);else if(86021===h.f[15](d.codecpar+4))l.M[15](d.codecpar+28,8);else if(86076===h.f[15](d.codecpar+4))l.M[15](d.codecpar+136,48e3),l.M[15](d.codecpar+28,8);else if(86028===h.f[15](d.codecpar+4))1!==h.f[15](d.codecpar+28)&&2!==h.f[15](d.codecpar+28)&&l.M[15](d.codecpar+28,1);else if(65543===h.f[15](d.codecpar+4)||65542===h.f[15](d.codecpar+4))l.M[15](d.codecpar+136,8e3),l.M[17](d.codecpar+32,BigInt(64e3)),l.M[15](d.codecpar+28,1);else if(86051===h.f[15](d.codecpar+4))l.M[15](d.codecpar+28,1),h.f[15](d.codecpar+136)>32e3&&l.M[15](d.codecpar+136,32e3);else if(86020===h.f[15](d.codecpar+4)){l.M[15](d.codecpar+28,2);let e=h.f[15](d.codecpar+116);const t=6===e||3===e?1:0;t&&e--;const r=((0,fe.A)(132+1389*e+72*t,32)*h.f[15](d.codecpar+136)-h.f[15](d.codecpar+136)+1)/512;l.M[17](d.codecpar+32,B.T9(BigInt(0|r),h.f[17](d.codecpar+32)))}h.f[15](d.codecpar+48)===Y.N_&&(86018===h.f[15](d.codecpar+4)?l.M[15](d.codecpar+48,2):86017===h.f[15](d.codecpar+4)&&l.M[15](d.codecpar+48,34)),1===t.oformat&&this.changeAVStreamTimebase(d,{num:1,den:h.f[15](d.codecpar+136)}),await this.DemuxerThread.connectStreamTask.transfer(s.port1).invoke(t.taskId,e.index,s.port1);let p=await this.getResource("decoder",h.f[15](e.codecpar+4),h.f[15](e.codecpar));if(!p){if(!x.A.audioDecoder)return C.z3(`audio decoder codecId ${h.f[15](e.codecpar+4)} not support`,ye,1440),(0,q.dn)(d.codecpar),O.NU;if(!(await AudioDecoder.isConfigSupported({codec:(0,X.A)(e.codecpar),sampleRate:h.f[15](e.codecpar+136),numberOfChannels:h.f[15](e.codecpar+116)})).supported)return C.z3(`AudioDecoder codecId ${h.f[15](e.codecpar+4)} not support`,ye,1434),(0,q.dn)(d.codecpar),O.NU}if(await this.AudioDecoderThread.registerTask.transfer(s.port2,n.port1).invoke({taskId:u,resource:p,leftPort:s.port2,rightPort:n.port1,stats:t.stats[a.o9],avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28}),f=await this.AudioDecoderThread.open(u,e.codecpar),f<0)return C.z3(`cannot open audio ${ce.eG(h.f[15](e.codecpar),h.f[15](e.codecpar+4))} decoder`,ye,1464),this.freeAVStreamInterface(d),f;let m=await this.getResource("resampler");if(!m)return C.z3("resampler not found",ye,1471),this.freeAVStreamInterface(d),O.NU;const g=[],A=[];let v,w;const y=(0,pe.Fn)("resampler",{resource:m,output:{channels:h.f[15](d.codecpar+116),sampleRate:h.f[15](d.codecpar+136),format:h.f[15](d.codecpar+28)}});if(g.push(y),v={id:y.id,port:n.port2},w={id:y.id,port:c.port1},t.options.start||t.options.duration){const r=(0,j.k)(BigInt(Math.floor(t.options.start||0)),Y.i0,e.timeBase),i=(0,pe.Fn)("range",{start:r,end:t.options.duration?(0,j.k)(BigInt(Math.floor(t.options.duration)),Y.i0,Y.KR)+r:-BigInt(1)});g.push(i),v={id:i.id,port:n.port2},A.push({parent:i.id,child:y.id})}await this.AudioFilterThread.registerTask.transfer(n.port2,c.port1).invoke({taskId:u,graph:{vertices:g,edges:A},inputPorts:[v],outputPorts:[w],stats:t.stats[a.o9],avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28});let b=await this.getResource("encoder",h.f[15](d.codecpar+4),h.f[15](d.codecpar));if(!b){if(!x.A.audioEncoder)return C.z3(`${ce.eG(h.f[15](d.codecpar),h.f[15](d.codecpar+4))} encoder codecId ${h.f[15](d.codecpar+4)} not support`,ye,1550),this.freeAVStreamInterface(d),O.NU;if(!(await AudioEncoder.isConfigSupported({codec:(0,K.A)(d.codecpar),sampleRate:h.f[15](d.codecpar+136),numberOfChannels:h.f[15](d.codecpar+116),bitrate:Number(BigInt.asIntN(32,h.f[17](d.codecpar+32))),bitrateMode:"constant"})).supported)return C.z3(`AudioEncoder ${ce.eG(h.f[15](d.codecpar),h.f[15](d.codecpar+4))} codecId ${h.f[15](d.codecpar+4)} not support`,ye,1544),this.freeAVStreamInterface(d),O.NU}return await this.AudioEncoderThread.registerTask.transfer(c.port2,o.port1).invoke({taskId:u,resource:b,leftPort:c.port2,rightPort:o.port1,stats:t.stats[a.o9],avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28,copyTs:null!==(i=t.options.copyTs)&&void 0!==i&&i}),f=await this.AudioEncoderThread.open(u,d.codecpar,{num:d.timeBase.num,den:d.timeBase.den}),f<0?(C.z3(`cannot open audio ${ce.eG(h.f[15](d.codecpar),h.f[15](d.codecpar+4))} encoder`,ye,1575),this.freeAVStreamInterface(d),f):(await this.MuxThread.addStream.transfer(o.port2).invoke(t.taskId,d,o.port2),t.streams.push({taskId:u,input:e,output:d,demuxer2DecoderChannel:s,decoder2FilterChannel:n,filter2EncoderChannel:c,encoder2MuxerChannel:o}),0)}{let r=this.copyAVStreamInterface(t,e,!0);try{const i=(0,ve.A)();return await this.DemuxerThread.connectStreamTask.transfer(i.port1).invoke(t.taskId,r.index,i.port1),await this.MuxThread.addStream.transfer(i.port2).invoke(t.taskId,r,i.port2),this.freeAVStreamInterface(r),t.streams.push({input:e,demuxer2MuxerChannel:i}),0}catch(e){throw this.freeAVStreamInterface(r),e}}}async handleVideoStream(e,t){const r=t.options.output.video;if(null!=r&&r.disable)return await this.DemuxerThread.setAVStreamDiscard(t.taskId,e.index,48),0;if("copy"!==(null==r?void 0:r.codec)||t.options.start||t.options.duration){var i,s,o,n;const p=(0,ve.A)(),m=(0,ve.A)(),g=(0,ve.A)(),A=(0,ve.A)(),v=this.copyAVStreamInterface(t,e);l.M[15](v.codecpar+160,-3&h.f[15](v.codecpar+160)),l.M[15](v.codecpar+160,-5&h.f[15](v.codecpar+160));const w=(0,S.A)();let y=0;if(r){if(r.codec&&"copy"!==r.codec){const t=me._R[r.codec];T.ai(t)||(this.freeAVStreamInterface(v),C.h2(`invalid codec name(${r.codec})`,ye,1651)),l.M[15](v.codecpar+4,t),h.f[15](v.codecpar+4)!==h.f[15](e.codecpar+4)&&(l.M[15](v.codecpar+48,Y.N_),l.M[15](v.codecpar+52,Y.N_))}if(r.width&&l.M[15](v.codecpar+56,r.width),r.height&&l.M[15](v.codecpar+60,r.height),r.bitrate&&l.M[17](v.codecpar+32,BigInt(Math.floor(r.bitrate))),r.pixfmt){const e=me.qO[r.pixfmt];T.ai(e)||C.h2(`invalid pixfmt name(${r.pixfmt})`,ye,1672),l.M[15](v.codecpar+28,e)}r.framerate&&(l.M[15](v.codecpar+72,r.framerate>>>0),l.M[15](v.codecpar+76,1)),r.aspect&&(l.M[15](v.codecpar+68,r.aspect.den),l.M[15](v.codecpar+64,r.aspect.num)),r.profile&&l.M[15](v.codecpar+48,r.profile),r.level&&l.M[15](v.codecpar+52,r.level),r.delay&&l.M[15](v.codecpar+104,r.delay)}if(h.f[15](v.codecpar+48)===Y.N_)if(27===h.f[15](v.codecpar+4)){var c;const e=(0,V.I)(h.f[15](v.codecpar+28));l.M[15](v.codecpar+48,10===(null==e||null===(c=e.comp[0])||void 0===c?void 0:c.depth)?110:100)}else if(173===h.f[15](v.codecpar+4)){var d;const e=(0,V.I)(h.f[15](v.codecpar+28));l.M[15](v.codecpar+48,10===(null==e||null===(d=e.comp[0])||void 0===d?void 0:d.depth)?2:1)}else 196===h.f[15](v.codecpar+4)||(225===h.f[15](v.codecpar+4)||167===h.f[15](v.codecpar+4)||139===h.f[15](v.codecpar+4))&&l.M[15](v.codecpar+48,0);h.f[15](v.codecpar+52)===Y.N_&&(27===h.f[15](v.codecpar+4)?l.M[15](v.codecpar+52,ie.k9(h.f[15](v.codecpar+56),h.f[15](v.codecpar+60),(0,j.lb)((0,f.A)(v.codecpar+72,u.Q)))):173===h.f[15](v.codecpar+4)?l.M[15](v.codecpar+52,se.k9(h.f[15](v.codecpar+48),h.f[15](v.codecpar+56),h.f[15](v.codecpar+60),(0,j.lb)((0,f.A)(v.codecpar+72,u.Q)),Number(h.f[17](v.codecpar+32)))):196===h.f[15](v.codecpar+4)||(225===h.f[15](v.codecpar+4)?l.M[15](v.codecpar+52,re.k9(h.f[15](v.codecpar+56),h.f[15](v.codecpar+60),(0,j.lb)((0,f.A)(v.codecpar+72,u.Q)))):167===h.f[15](v.codecpar+4)&&l.M[15](v.codecpar+52,oe.k9(h.f[15](v.codecpar+56),h.f[15](v.codecpar+60),(0,j.lb)((0,f.A)(v.codecpar+72,u.Q)))))),r&&null!=r.delay||0!==h.f[15](v.codecpar+104)||l.M[15](v.codecpar+104,4),27!==h.f[15](v.codecpar+4)&&12!==h.f[15](v.codecpar+4)&&173!==h.f[15](v.codecpar+4)&&196!==h.f[15](v.codecpar+4)||(2===t.oformat||11===t.oformat||12===t.oformat||13===t.oformat?l.M[15](v.codecpar+160,1|h.f[15](v.codecpar+160)):l.M[15](v.codecpar+160,-2&h.f[15](v.codecpar+160))),12===h.f[15](v.codecpar+4)&&v.timeBase.den>65535&&this.changeAVStreamTimebase(v,{num:1,den:65535}),await this.DemuxerThread.connectStreamTask.transfer(p.port1).invoke(t.subTaskId||t.taskId,e.index,p.port1);let b=await this.getResource("decoder",h.f[15](e.codecpar+4),h.f[15](e.codecpar));if(!b){if(!x.A.videoDecoder)return C.z3(`video decoder codecId ${h.f[15](e.codecpar+4)} not support`,ye,1786),this.freeAVStreamInterface(v),O.NU;if(!(await VideoDecoder.isConfigSupported({codec:(0,X.A)(e.codecpar)})).supported)return C.z3(`VideoDecoder codecId ${h.f[15](e.codecpar+4)} not support`,ye,1780),this.freeAVStreamInterface(v),O.NU}const k=(0,V.I)(h.f[15](e.codecpar+28));let _=!0;if((null==k||null===(i=k.comp[0])||void 0===i?void 0:i.depth)>8&&(_=!1),await this.VideoDecoderThread.registerTask.transfer(p.port2,g.port1).invoke({taskId:w,resource:b,leftPort:p.port2,rightPort:g.port1,stats:t.stats[a.o9],enableHardware:!!t.options.input.enableHardware&&!!t.options.input.enableWebCodecs&&_,avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28,preferWebCodecs:!(0,N.A)(e.codecpar)&&!(0,W.A)(e.codecpar)&&!!t.options.input.enableWebCodecs}),y=await this.VideoDecoderThread.open(w,e.codecpar),y<0)return C.z3(`cannot open video ${ce.eG(h.f[15](e.codecpar),h.f[15](e.codecpar+4))} decoder`,ye,1819),this.freeAVStreamInterface(v),y;let I=await this.getResource("scaler");I||C.h2("scaler not found",ye,1826);const M=[],P=[];let B,U,D;const R=(0,pe.Fn)("scaler",{resource:I,output:{width:h.f[15](v.codecpar+56),height:h.f[15](v.codecpar+60),format:h.f[15](v.codecpar+28)}});if(M.push(R),B={id:R.id,port:g.port2},U={id:R.id,port:A.port1},t.options.start||t.options.duration){const e=(0,j.k)(BigInt(Math.floor(t.options.start||0)),Y.i0,Y.KR),r=(0,pe.Fn)("range",{start:e,end:t.options.duration?(0,j.k)(BigInt(Math.floor(t.options.duration)),Y.i0,Y.KR)+e:-BigInt(1)});M.push(r),B={id:r.id,port:g.port2},P.push({parent:r.id,child:R.id}),D=r.id}if((0,j.lb)((0,f.A)(e.codecpar+72,u.Q))>(0,j.lb)((0,f.A)(v.codecpar+72,u.Q))){const e=(0,pe.Fn)("framerate",{framerate:{num:h.f[15](v.codecpar+72),den:h.f[15](v.codecpar+76)}});M.push(e),P.length=0,D?(P.push({parent:D,child:e.id}),P.push({parent:e.id,child:R.id})):(B={id:e.id,port:g.port2},P.push({parent:e.id,child:R.id}))}await this.VideoFilterThread.registerTask.transfer(g.port2,A.port1).invoke({taskId:w,graph:{vertices:M,edges:P},inputPorts:[B],outputPorts:[U],stats:t.stats[a.o9],avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28});let L=await this.getResource("encoder",h.f[15](v.codecpar+4),h.f[15](v.codecpar));if(!L){if(!x.A.videoEncoder)return C.z3(`${ce.eG(h.f[15](v.codecpar),h.f[15](v.codecpar+4))} encoder codecId ${h.f[15](v.codecpar+4)} not support`,ye,1937),this.freeAVStreamInterface(v),O.NU;if(!(await VideoEncoder.isConfigSupported({codec:(0,X.A)(v.codecpar),width:h.f[15](v.codecpar+56),height:h.f[15](v.codecpar+60)})).supported)return C.z3(`VideoEncoder ${ce.eG(h.f[15](v.codecpar),h.f[15](v.codecpar+4))} codecId ${h.f[15](v.codecpar+4)} not support`,ye,1931),this.freeAVStreamInterface(v),O.NU}const $={},F={};return 173===h.f[15](v.codecpar+4)?(F.enableThreadPool=!0,F.enableThreadCountRate=2):167===h.f[15](v.codecpar+4)&&(F.enableThreadPool=!0),null!==(s=t.options)&&void 0!==s&&null!==(s=s.output)&&void 0!==s&&null!==(s=s.video)&&void 0!==s&&s.encoderOptions&&E.__(t.options.output.video.encoderOptions,((e,t)=>{$[t]=e})),await this.VideoEncoderThread.registerTask.transfer(A.port2,m.port1).invoke({taskId:w,resource:L,resourceExtraData:F,leftPort:A.port2,rightPort:m.port1,stats:t.stats[a.o9],enableHardware:!!r.enableHardware&&!!r.enableWebCodecs,avpacketList:this.GlobalData[a.o9],avpacketListMutex:this.GlobalData[a.o9]+24,avframeList:this.GlobalData[a.o9]+12,avframeListMutex:this.GlobalData[a.o9]+28,gop:(0,j.lb)((0,f.A)(v.codecpar+72,u.Q))*(null!==(o=r.keyFrameInterval)&&void 0!==o?o:5e3)/1e3|0,preferWebCodecs:!(0,N.A)(v.codecpar)&&!(0,W.A)(v.codecpar)&&!!r.enableWebCodecs,copyTs:null!==(n=t.options.copyTs)&&void 0!==n&&n}),y=await this.VideoEncoderThread.open(w,v.codecpar,{num:v.timeBase.num,den:v.timeBase.den},$),y<0?(C.z3(`cannot open video ${ce.eG(h.f[15](v.codecpar),h.f[15](v.codecpar+4))} encoder`,ye,1985),this.freeAVStreamInterface(v),y):(await this.MuxThread.addStream.transfer(m.port2).invoke(t.taskId,v,m.port2),t.streams.push({taskId:w,input:e,output:v,demuxer2DecoderChannel:p,decoder2FilterChannel:g,filter2EncoderChannel:A,encoder2MuxerChannel:m}),0)}{let r=this.copyAVStreamInterface(t,e,!0);try{const i=(0,ve.A)();return await this.DemuxerThread.connectStreamTask.transfer(i.port1).invoke(t.subTaskId||t.taskId,r.index,i.port1),await this.MuxThread.addStream.transfer(i.port2).invoke(t.taskId,r,i.port2),this.freeAVStreamInterface(r),t.streams.push({input:e,demuxer2MuxerChannel:i}),0}catch(e){throw this.freeAVStreamInterface(r),e}}}async handleCopyStream(e,t){let r=this.copyAVStreamInterface(t,e,!0);try{const i=(0,ve.A)();return 1024&e.disposition||await this.DemuxerThread.connectStreamTask.transfer(i.port1).invoke(t.subTaskId||t.taskId,r.index,i.port1),await this.MuxThread.addStream.transfer(i.port2).invoke(t.taskId,r,i.port2),this.freeAVStreamInterface(r),t.streams.push({input:e,demuxer2MuxerChannel:i}),0}catch(e){throw this.freeAVStreamInterface(r),e}}async clearTask(e){this.MuxThread.unregisterTask(e.taskId);for(let t=0;t<e.streams.length;t++)e.streams[t].taskId&&(1===h.f[15](e.streams[t].input.codecpar)?(await this.AudioEncoderThread.unregisterTask(e.streams[t].taskId),await this.AudioFilterThread.unregisterTask(e.streams[t].taskId),await this.AudioDecoderThread.unregisterTask(e.streams[t].taskId)):0===h.f[15](e.streams[t].input.codecpar)&&(await this.VideoEncoderThread.unregisterTask(e.streams[t].taskId),await this.VideoFilterThread.unregisterTask(e.streams[t].taskId),await this.VideoDecoderThread.unregisterTask(e.streams[t].taskId))),e.streams[t].output&&this.freeAVStreamInterface(e.streams[t].output);this.DemuxerThread.unregisterTask(e.taskId),e.subTaskId&&this.DemuxerThread.unregisterTask(e.subTaskId),this.IOThread.unregisterTask(e.taskId),e.inputIPCPort&&e.inputIPCPort.destroy(),e.outputIPCPort&&e.outputIPCPort.destroy(),e.safeFileIO&&e.safeFileIO.destroy(),e.stats&&(0,p.A)(e.stats),this.tasks.delete(e.taskId),this.tasks.size||this.reportTimer.stop()}async addTask(e){var t,r;null!==(t=e.output.audio)&&void 0!==t&&t.disable&&null!==(r=e.output.video)&&void 0!==r&&r.disable&&C.h2("audio and video are all disable",ye,2089);const i=(0,S.A)(),s={taskId:i,startTime:0,options:e,ioloader2DemuxerChannel:null,muxer2OutputChannel:null,stats:(0,d.A)(m.A),iformat:-1,oformat:-1,streams:[],formatContext:null,controller:new we.A(this)};try{var a,o;let e=0;await this.setTaskInput(s),await this.setTaskOutput(s);const t=s.formatContext=await this.analyzeInputStreams(s);if(await this.MuxThread.addFormatContextMetadata(s.taskId,E.X$({},null!==(a=s.options.output.metadata)&&void 0!==a?a:{},t.metadata)),t.chapters.length||null!==(o=s.options.output.chapters)&&void 0!==o&&o.length){var n;const e=[];t.chapters.length&&e.push(...t.chapters),null!==(n=s.options.output.chapters)&&void 0!==n&&n.length&&e.push(...s.options.output.chapters),await this.MuxThread.addFormatContextChapters(s.taskId,e)}s.iformat=t.format;for(let r=0;r<t.streams.length;r++){const i=h.f[15](t.streams[r].codecpar);e=1===i?await this.handleAudioStream(t.streams[r],s):0!==i||1024&t.streams[r].disposition?await this.handleCopyStream(t.streams[r],s):await this.handleVideoStream(t.streams[r],s),e<0&&C.h2(`config transcode error, ret: ${e}`,ye,2148)}const r={streams:[],format:s.oformat,metadata:{},chapters:[],streamGroups:[]};let c="Mapping:\n";return s.streams.forEach((e=>{e.output?(r.streams.push(e.output),c+=`  Stream #0:${e.input.index} -> #0:${e.output.index} (${ce.eG(h.f[15](e.input.codecpar),h.f[15](e.input.codecpar+4))} -> ${ce.eG(h.f[15](e.output.codecpar),h.f[15](e.output.codecpar+4))})\n`):(r.streams.push(e.input),c+=`  Stream #0:${e.input.index} -> #0:${e.input.index} (${ce.eG(h.f[15](e.input.codecpar),h.f[15](e.input.codecpar+4))} -> copy)\n`)})),C.pq("\nAVTranscoder version v0.6.1-408-gdf1fec0d Copyright (c) 2024-present the libmedia developers\n"+(0,ce.Ay)([t],[{from:T.Yj(s.options.input.file)?s.options.input.file:s.options.input.file instanceof File?s.options.input.file.name:"ioReader",tag:"Input"}])+"\n"+c+"\n"+(0,ce.Ay)([r],[{from:s.options.output.file instanceof FileSystemFileHandle?s.options.output.file.name:"IOWriter",tag:"Output"}]),ye,2174),this.tasks.set(i,s),i}catch(e){throw await this.clearTask(s),e}}async startTask(e){const t=this.tasks.get(e);if(t){t.options.start&&await this.DemuxerThread.seek(t.taskId,BigInt(Math.floor(t.options.start)),16);let r=0;await this.DemuxerThread.startDemux(e,!1,10),r=await this.MuxThread.open(e),r<0&&(await this.clearTask(t),C.h2(`start transcode error, ret ${r}`,ye,2208));const i=t.streams;for(let e=0;e<i.length;e++){if(!i[e].output)continue;let r,s=!1;if(1===h.f[15](i[e].output.codecpar))r=await this.AudioEncoderThread.getExtraData(i[e].taskId);else if(0===h.f[15](i[e].output.codecpar)){r=await this.VideoEncoderThread.getExtraData(i[e].taskId);const t=await this.VideoEncoderThread.getColorSpace(i[e].taskId);t&&(l.M[15](i[e].output.codecpar+96,t.colorSpace),l.M[15](i[e].output.codecpar+88,t.colorPrimaries),l.M[15](i[e].output.codecpar+92,t.colorTrc),s=!0)}if(!r){const t=h.f[15](i[e].output.codecpar+4);86018===t?r=te.Ij((0,f.A)(i[e].output.codecpar,g.A)):86076===t&&(r=ae.Ij((0,f.A)(i[e].output.codecpar,g.A)))}if(r){const t=(0,G.sY)(r.length);(0,$.lW)(t,r.length,r),h.f[20](i[e].output.codecpar+12)&&(0,G.Eb)(h.f[20](i[e].output.codecpar+12)),l.M[20](i[e].output.codecpar+12,t),l.M[15](i[e].output.codecpar+16,r.length),s=!0}s&&await this.MuxThread.updateAVCodecParameters(t.taskId,i[e].output.id,i[e].output.codecpar)}r=await this.MuxThread.start(e),r<0&&(await this.clearTask(t),C.h2(`start transcode error, ret ${r}`,ye,2261)),t.startTime=(0,U.A)(),this.reportTimer.isStarted()||this.reportTimer.start()}else C.h2(`task ${e} not found`,ye,2270)}async pauseTask(e){this.tasks.get(e)?await this.MuxThread.pause(e):C.h2(`task ${e} not found`,ye,2280)}async unpauseTask(e){this.tasks.get(e)?await this.MuxThread.unpause(e):C.h2(`task ${e} not found`,ye,2290)}async cancelTask(e){const t=this.tasks.get(e);t?(await this.MuxThread.unpause(e),await this.clearTask(t)):C.h2(`task ${e} not found`,ye,2301)}async destroy(){this.MuxThread&&(await this.MuxThread.clear(),(0,z.nE)(this.MuxThread)),this.AudioEncoderThread&&(await this.AudioEncoderThread.clear(),(0,z.nE)(this.AudioEncoderThread)),this.AudioFilterThread&&(await this.AudioFilterThread.clear(),(0,z.nE)(this.AudioFilterThread)),this.AudioDecoderThread&&(await this.AudioDecoderThread.clear(),(0,z.nE)(this.AudioDecoderThread)),this.VideoEncoderThread&&(await this.VideoEncoderThread.clear(),(0,z.nE)(this.VideoEncoderThread)),this.VideoFilterThread&&(await this.VideoFilterThread.clear(),(0,z.nE)(this.VideoFilterThread)),this.VideoDecoderThread&&(await this.VideoDecoderThread.clear(),(0,z.nE)(this.VideoDecoderThread)),this.DemuxerThread&&(await this.DemuxerThread.clear(),(0,z.nE)(this.DemuxerThread)),this.IOThread&&(await this.IOThread.clear(),(0,z.nE)(this.IOThread)),this.VideoEncoderThread=null,this.VideoFilterThread=null,this.VideoDecoderThread=null,this.AudioEncoderThread=null,this.AudioFilterThread=null,this.AudioDecoderThread=null,this.DemuxerThread=null,this.IOThread=null,this.MuxThread=null,this.GlobalData&&(this.GlobalData.avframeList.clear((e=>{(0,H.to)(e)}),20),this.GlobalData.avpacketList.clear((e=>{(0,Q.Up)(e)}),20),c.zr(this.GlobalData[a.o9]+24),c.zr(this.GlobalData[a.o9]+28),(0,p.A)(this.GlobalData),this.GlobalData=null),C.pq("AVTranscoder pipelines stopped",ye,2368)}setLogLevel(e){this.level=e,C.V$(e),this.IOThread&&this.IOThread.setLogLevel(e),this.DemuxerThread&&this.DemuxerThread.setLogLevel(e),this.AudioDecoderThread&&this.AudioDecoderThread.setLogLevel(e),this.AudioFilterThread&&this.AudioFilterThread.setLogLevel(e),this.AudioEncoderThread&&this.AudioEncoderThread.setLogLevel(e),this.VideoDecoderThread&&this.VideoDecoderThread.setLogLevel(e),this.VideoFilterThread&&this.VideoFilterThread.setLogLevel(e),this.VideoEncoderThread&&this.VideoEncoderThread.setLogLevel(e),this.MuxThread&&this.MuxThread.setLogLevel(e),C.pq(`set log level: ${e}`,ye,2404)}async onGetDecoderResource(e,t){return this.getResource("decoder",t,e)}}(0,s.A)(_e,"Events",ge),(0,s.A)(_e,"Util",{compile:F.A,browser:M.A,os:P.A}),(0,s.A)(_e,"IOLoader",{CustomIOLoader:de.A,FetchIOLoader:he.A,FileIOLoader:le.A}),(0,s.A)(_e,"Resource",new Map)},3321:(e,t,r)=>{r.d(t,{$r:()=>l,El:()=>u,FB:()=>p,TF:()=>d,VC:()=>c,_:()=>f,__:()=>o,zy:()=>h});var i=r(8590),s=r(2494),a=r(399);function o(e,t,r){if(!e)return;const{length:i}=e;if(i)if(r)for(let r=i-1;r>=0&&t(e[r],r)!==s.W8;r--);else for(let r=0;r<i&&t(e[r],r)!==s.W8;r++);}function n(e,t){e[e.length]=t}function c(e,t){!function(e,t,r){i.YO(t)?o(t,(function(t){r(e,t)})):r(e,t)}(e,t,n)}function d(e,t,r){let i=0;return o(e,(function(a,o){(r===s.W8?a==t:a===t)&&(e.splice(o,1),i++)}),s.rT),i}function h(e,t,r){return function(e,t,r){let i=s.Cy;return o(e,(function(e,a){if(r===s.W8?e==t:e===t)return i=a,s.W8})),i}(e,t,r)>=0}function l(e){return i.YO(e)?e:(0,a.A)(s.Ml.slice,e)}function u(e,t){let r=0,i=e.length-1,s=-1;for(;r<=i;){let a=(r+i)/2>>>0;const o=t(e[a]);if(0===o){s=a;break}1===o?r=a+1:(i=a-1,s=a)}return s}function f(e,t,r){const i=u(e,r);i>-1?e.splice(i,0,t):e.push(t)}function p(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}},3365:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(432);class a extends s.A{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),(0,i.A)(this,"readQueue",void 0),(0,i.A)(this,"consume",void 0),this.readQueue=[]}async readInterval(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;for(;this.readQueue.length&&r<e.length;){const t=this.readQueue.shift();t.length>e.length-r?(e.set(t.subarray(0,e.length-r),r),this.readQueue.unshift(t.subarray(e.length-r)),r=e.length):(e.set(t,r),r+=t.length)}return r>0||t?r+t:4===this.status||0===this.status?r>0?r+t:t>0?t:-1048576:3===this.status?r>0?r+t:t>0?t:-1048573:(await new Promise((e=>{this.consume=e})),this.consume=null,this.readInterval(e,t))}async read(e){return this.readInterval(e)}async write(e){return this.send(e)}}},3389:(e,t,r)=>{r.d(t,{II:()=>o,hb:()=>a,hf:()=>n});let i=4;function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=i;for(;r%t;)r+=1;return i=r+e,r}const a=s(4,4),o=s(4,4),n=s(4,4);s(8,8)},3394:(e,t,r)=>{r.d(t,{Cj:()=>M,FP:()=>v,UD:()=>k,_h:()=>b,gg:()=>I,rh:()=>_,to:()=>x,xj:()=>w});var i,s=r(3674),a=r(9983),o=r(2320),n=r(1755),c=r(1237),d=r(6229),h=r(9239),l=r(495),u=r(449),f=r(8842),p=r(3139),m=r(3082),g=r(3535),A=r(2479);function v(){const e=(0,n.Gy)(320);return b(e),e}function w(e){x(e),(0,n.Eb)(e)}function y(e){const t=a.f[20](e);(0,d.Q7)(t+16),(0,h.IH)(t+12),(0,n.aI)(e)}function b(e){a.f[20](e+64)!==e&&(0,n.aI)(e+64),(0,u.bl)(e+288),(0,s.sO)(e,0,320),o.M[17](e+104,c.Dh),o.M[17](e+112,c.Dh),o.M[17](e+232,c.Dh),o.M[17](e+240,c.Dh),o.M[15](e+256,-1),o.M[15](e+84,1),o.M[15](e+92,0),o.M[15](e+96,1),o.M[15](e+80,-1),o.M[20](e+64,e),o.M[15](e+212,2),o.M[15](e+216,2),o.M[15](e+220,2),o.M[15](e+208,0),o.M[15](e+224,0),o.M[15](e+204,0)}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(0,p.I)(a.f[15](e+80)))return l.UY;const r=A.z(16),i=A.z(16),s=Math.max(32,t);let n=0;if(!a.f[15](e+32)){t<=0&&(t=32);for(let r=1;r<t;r+=r){if(n=(0,m.O5)(e+32,a.f[15](e+80),(0,g.A)(a.f[15](e+68),r)),n<0)return f(),n;if(!(a.f[15](e+32)&t-1))break}for(let r=0;r<4&&a.f[15](e+32+4*r);r++)o.M[15](e+32+4*r,(0,g.A)(a.f[15](e+32+4*r),t))}for(let t=0;t<4;t++)o.M[15](r+4*t,a.f[15](e+32+4*t));const h=(0,g.A)(a.f[15](e+72),32);if((n=(0,m.S5)(i,a.f[15](e+80),h,r))<0)return f(),n;let u=4*s;for(let e=0;e<4;e++)a.f[25](i+4*e)>c.go-u&&l.UY,u+=a.f[25](i+4*e);if(o.M[20](e+156,(0,d.D$)(u)),!a.f[20](e+156))return x(e),f(),l.gR;if((n=(0,m.Xo)(e,a.f[15](e+80),h,a.f[20](a.f[20](e+156)+4),r))<0)return x(e),f(),n;for(let t=1;t<4;t++)a.f[20](e+4*t)&&o.M[20](e+4*t,a.f[20](e+4*t)+t*s);return o.M[20](e+64,e),f(),0;function f(){A.t(16),A.t(16)}}function _(e,t){const r=(0,f.K0)(a.f[15](e+80)),i=a.f[15](e+292),s=r?i:1;let h=0;if(!a.f[15](e+32)){if(h=(0,f.f8)(a.f[15](e+80),i,a.f[15](e+76),t),h<0)return h;o.M[15](e+32,h)}if(s>c.pu){if(o.M[20](e+64,(0,n.sY)(4*s)),o.M[20](e+188,(0,n.sY)(4*s)),!a.f[20](e+188)||!a.f[20](e+64))return(0,n.aI)(e+64),(0,n.aI)(e+188),l.gR;o.M[15](e+192,s-c.pu)}else o.M[20](e+64,e);for(let t=0;t<Math.min(s,c.pu);t++){if(o.M[20](e+156+4*t,(0,d.D$)(a.f[15](e+32))),!a.f[20](e+156+4*t))return x(e),l.gR;o.M[20](a.f[20](e+64)+4*t,a.f[20](a.f[20](e+156+4*t)+4)),o.M[20](e+4*t,a.f[20](a.f[20](e+156+4*t)+4))}for(let t=0;t<s-c.pu;t++){if(o.M[20](a.f[20](e+188)+4*t,(0,d.D$)(a.f[15](e+32))),!a.f[20](a.f[20](e+188)+4*t))return x(e),l.gR;o.M[20](a.f[20](e+64)+4*(t+c.pu),a.f[20](a.f[20](a.f[20](e+188)+4*t)+4))}}function I(e,t){o.M[15](e+80,a.f[15](t+80)),o.M[15](e+68,a.f[15](t+68)),o.M[15](e+72,a.f[15](t+72)),(0,s.Mr)(e+288,t+288,24),o.M[15](e+76,a.f[15](t+76));let r=M(e,t);if(r<0)return r;if(!a.f[20](t+156)){for(let r=0;r<8;r++){if(!a.f[20](t+4*r)||!a.f[15](t+32+4*r))continue;let i=a.f[15](t+32+4*r);if(o.M[20](e+4*r,(0,n.sY)(i)),!a.f[20](e+4*r))return x(e),l.gR;(0,s.Mr)(a.f[20](e+4*r),a.f[20](t+4*r),i)}return 0}for(let r=0;r<8;r++)if(a.f[20](t+156+4*r)&&(o.M[20](e+156+4*r,(0,d.VG)(a.f[20](t+156+4*r))),!a.f[20](e+156+4*r)))return x(e),l.gR;if(a.f[20](t+188)){if(o.M[20](e+188,(0,n.Gy)(4*a.f[15](t+192))),!a.f[20](e+188))return x(e),l.gR;o.M[15](e+192,a.f[15](t+192));for(let r=0;r<a.f[15](t+192);r++)if(o.M[20](a.f[20](e+188)+4*r,(0,d.VG)(a.f[20](a.f[20](t+188)+4*r))),!a.f[20](a.f[20](e+188)+4*r))return x(e),l.gR}if(a.f[20](t+64)!==t){let r=a.f[15](t+292);if(!r)return x(e),l.UY;if(o.M[20](e+64,(0,n.Gy)(4*r)),!a.f[20](e+64))return x(e),l.gR;(0,s.Mr)(a.f[20](e+64),a.f[20](t+64),4*r)}else o.M[20](e+64,e);return(0,s.Mr)(e,t,32),(0,s.Mr)(e+32,t+32,32),0}function x(e){if(e){!function(e){!function(e,t){const r=a.f[15](t),i=a.f[20](e);for(let e=0;e<r;e++)y(i+4*e);o.M[15](t,0),(0,n.aI)(e)}(e+196,e+200)}(e);for(let t=0;t<8;t++)(0,d.Q7)(e+156+4*t);for(let t=0;t<a.f[15](e+192);t++)(0,d.Q7)(a.f[20](e+188)+4*t);(0,n.aI)(e+188),(0,h.IH)(e+248),(0,d.Q7)(e+260),(0,d.Q7)(e+264),(0,d.Q7)(e+284),b(e)}}function M(e,t){o.M[15](e+84,a.f[15](t+84)),o.M[15](e+88,a.f[15](t+88)),(0,s.Mr)(e+92,t+92,8),o.M[25](e+268,a.f[25](t+268)),o.M[25](e+272,a.f[25](t+272)),o.M[25](e+276,a.f[25](t+276)),o.M[25](e+280,a.f[25](t+280)),o.M[17](e+104,a.f[17](t+104)),o.M[17](e+312,a.f[17](t+312)),o.M[15](e+136,a.f[15](t+136)),o.M[15](e+140,a.f[15](t+140)),o.M[15](e+144,a.f[15](t+144)),o.M[15](e+148,a.f[15](t+148)),o.M[15](e+152,a.f[15](t+152)),o.M[20](e+132,a.f[20](t+132)),o.M[17](e+112,a.f[17](t+112)),o.M[17](e+240,a.f[17](t+240)),o.M[15](e+256,a.f[15](t+256)),(0,s.Mr)(e+120,t+120,8),o.M[15](e+128,a.f[15](t+128)),o.M[17](e+232,a.f[17](t+232)),o.M[15](e+204,a.f[15](t+204)),o.M[15](e+252,a.f[15](t+252)),o.M[15](e+212,a.f[15](t+212)),o.M[15](e+216,a.f[15](t+216)),o.M[15](e+220,a.f[15](t+220)),o.M[15](e+208,a.f[15](t+208)),o.M[15](e+224,a.f[15](t+224)),(0,h.Zx)(e+248,a.f[20](t+248),0);for(let s=0;s<a.f[15](t+200);s++){const u=a.f[20](a.f[20](t+196)+4*s),f=(0,d.VG)(a.f[20](u+16)),p=(r=e+196,i=e+200,c=a.f[15](u),(l=f)?function(e,t,r,i,s,c){const d=(0,n.cz)(a.f[20](e),4*(a.f[15](t)+1));o.M[20](e,d);const h=(0,n.Gy)(20);return o.M[20](h+16,i),o.M[20](h+4,s),o.M[25](h+8,c),o.M[15](h,r),o.M[20](d+4*a.f[15](t),h),o.M[15](t,a.f[15](t)+1),h}(r,i,c,l,a.f[20](l+4),a.f[25](l+8)):0);(0,h.Zx)(p+12,a.f[20](u+12),0)}var r,i,c,l;let u=(0,d.us)(e+264,a.f[20](t+264));return u|=(0,d.us)(e+284,a.f[20](t+284)),u}!function(e){e[e.UNIQUE=1]="UNIQUE"}(i||(i={}))},3458:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(4467),s=r(9983),a=r(1755),o=r(2836);class n{constructor(){(0,i.A)(this,"inCodecpar",void 0),(0,i.A)(this,"inTimeBase",void 0),(0,i.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,a.Gy)(168),(0,o.Yi)(this.inCodecpar,e),this.inTimeBase={den:s.f[15](t+4),num:s.f[15](t)},0}destroy(){this.inCodecpar&&((0,o.dn)(this.inCodecpar),this.inCodecpar=0)}}},3463:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(2990),s=r(6332),a=r(8288),o=r(7084);const n=function(){let e="function"==typeof Blob,t="object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate,r="function"==typeof fetch,n="object"==typeof document&&document.createElement("canvas"),c=n&&!!n.getContext("webgl"),d="function"==typeof OffscreenCanvas,h="function"==typeof Worker,l="function"==typeof ArrayBuffer,u="object"==typeof Atomics&&"Atomics"===Atomics[Symbol.toStringTag],f="function"==typeof AudioContext||"function"==typeof webkitAudioContext,p="function"==typeof AudioWorklet,m="function"==typeof VideoDecoder,g="function"==typeof VideoEncoder,A="function"==typeof AudioDecoder,v="function"==typeof AudioEncoder,w="function"==typeof SharedArrayBuffer,y="function"==typeof MediaSource||"function"==typeof ManagedMediaSource,b="function"==typeof Proxy,k=(h||(0,s.A)()||(0,i.A)())&&w&&u&&b,_="function"==typeof WebAssembly.Suspending&&"function"==typeof WebAssembly.promising;(a.A.safari&&!a.A.checkVersion(a.A.majorVersion,"11",!0)||o.A.ios&&!a.A.checkVersion(o.A.version,"11",!0))&&(t=!1),a.A.chrome&&!a.A.checkVersion(a.A.majorVersion,"94",!0)&&(m=!1,A=!1),(a.A.safari&&!a.A.checkVersion(a.A.majorVersion,"17",!0)||o.A.ios&&!a.A.checkVersion(o.A.version,"17",!0))&&(m=!1);let I="object"==typeof navigator&&"object"==typeof navigator.gpu,x="function"==typeof MediaSourceHandle,M=t&&"function"==typeof WebAssembly.Global,P="function"==typeof MediaStreamTrackGenerator;return{blob:e,wasm:t,fetch:r,webgl:c,worker:h,mse:y,arrayBuffer:l,audioContext:f,audioWorklet:p,videoDecoder:m,videoEncoder:g,audioDecoder:A,audioEncoder:v,atomics:u,shareArrayBuffer:w,thread:k,webgpu:I,offscreenCanvas:d,workerMSE:x,webAssemblyGlobal:M,jspi:_,proxy:b,simd:(a.A.chrome||a.A.newEdge)&&a.A.checkVersion(a.A.majorVersion,"91",!0)||a.A.firefox&&a.A.checkVersion(a.A.majorVersion,"89",!0)||a.A.safari&&a.A.checkVersion(a.A.version,"16.4",!0)||o.A.ios&&a.A.checkVersion(o.A.version,"16.4",!0),wasmPlayerSupported:r&&t&&c&&f&&l&&M,wasmBaseSupported:t&&M&&l,trackGenerator:P}}()},3535:(e,t,r)=>{function i(e,t){return e+(t-1)&~(t-1)}r.d(t,{A:()=>i})},3548:(e,t,r)=>{r.d(t,{A:()=>i});const i="AGFzbQEAAAABEANgAX8Bf2ABfwBgAn9/AX8CWQYDZW52Bm1lbW9yeQIDAYCABANlbnYGbWFsbG9jAAADZW52BGZyZWUAAQNlbnYGY2FsbG9jAAIDZW52B3JlYWxsb2MAAgNlbnYNYWxpZ25lZF9hbGxvYwACAwYFAAECAgIHMwUGbWFsbG9jAAUEZnJlZQAGBmNhbGxvYwAHB3JlYWxsb2MACAxhbGlnbmVkQWxsb2MACQoqBQYAIAAQAAsGACAAEAELCAAgACABEAILCAAgACABEAMLCAAgACABEAML"},3554:(e,t,r)=>{r.d(t,{A:()=>h,t:()=>d});var i=r(4467),s=r(3394),a=r(2935),o=r(8590),n=r(3321),c=r(7683);class d extends a.Ay{constructor(e){super(e instanceof MessageChannel?e.port1:e),(0,i.A)(this,"channel",void 0),(0,i.A)(this,"next",void 0),this.channel=e}connect(e){this.off(),e.off(),this.on(a.S3,(async t=>{try{const r=await e.request(t.method,t.params);this.reply(t,r,void 0,(0,c.A)(r)||o.ai(r)||"pull"!==t.method?void 0:[r])}catch(e){this.reply(t,null,e)}})),this.on(a.Wo,(t=>{e.notify(t.method,t.params)})),e.on(a.S3,(async t=>{try{const r=await this.request(t.method,t.params);e.reply(t,r,void 0,(0,c.A)(r)||o.ai(r)||"pull"!==t.method?void 0:[r])}catch(r){e.reply(t,null,r)}})),e.on(a.Wo,(e=>{this.notify(e.method,e.params)})),this.next=e}disconnect(){this.off(),this.next&&this.next.off(),this.next=void 0}getInnerPort(){if(this.channel instanceof MessageChannel)return this.channel.port2}}class h{constructor(e,t,r){(0,i.A)(this,"options",void 0),(0,i.A)(this,"inputAVFilterNodePort",void 0),(0,i.A)(this,"outputAVFilterNodePort",void 0),(0,i.A)(this,"inputInnerNodePort",void 0),(0,i.A)(this,"outputInnerNodePort",void 0),(0,i.A)(this,"currentOutput",void 0),(0,i.A)(this,"consumedCount",void 0),(0,i.A)(this,"pending",void 0),(0,i.A)(this,"inputCount",void 0),(0,i.A)(this,"outputCount",void 0),(0,i.A)(this,"inputConnectedMap",void 0),(0,i.A)(this,"outputConnectedMap",void 0),this.options=e,this.inputCount=t,this.outputCount=r,this.inputAVFilterNodePort=[],this.outputAVFilterNodePort=[],this.inputInnerNodePort=[],this.outputInnerNodePort=[];for(let e=0;e<this.inputCount;e++){const e=new d(new MessageChannel);this.inputAVFilterNodePort.push(e),this.inputInnerNodePort.push(new a.Ay(e.getInnerPort()))}for(let e=0;e<this.outputCount;e++){const e=new d(new MessageChannel);this.outputAVFilterNodePort.push(e),this.outputInnerNodePort.push(new a.Ay(e.getInnerPort()))}this.consumedCount=0,this.pending=[],this.currentOutput=[];for(let e=0;e<this.outputCount;e++)this.handlePull(this.outputInnerNodePort[e],e);this.inputConnectedMap=new Map,this.outputConnectedMap=new Map}handlePull(e,t){e.on(a.S3,(async r=>{if("pull"===r.method)if(0===this.consumedCount){const i=[];this.currentOutput.length=0;for(let e=0;e<this.inputCount;e++)i.push(await this.inputInnerNodePort[e].request("pull",r.params));await this.process(i,this.currentOutput,r.params),i.forEach((e=>{o.ai(e)&&e<0||((0,c.A)(e)?e>0&&(this.options.avframePool?this.options.avframePool.release(e):(0,s.xj)(e)):e.close())})),e.reply(r,this.currentOutput[t],void 0,(0,c.A)(this.currentOutput[t])||o.ai(this.currentOutput[t])?void 0:[this.currentOutput[t]]),this.consumedCount++,this.pending.length&&(this.pending.forEach((e=>{e.resolve()})),this.pending.length=0),this.consumedCount===this.outputCount&&(this.consumedCount=0,this.currentOutput.length=0)}else this.consumedCount===this.outputCount-1?(e.reply(r,this.currentOutput[t],void 0,(0,c.A)(this.currentOutput[t])||o.ai(this.currentOutput[t])?void 0:[this.currentOutput[t]]),this.consumedCount=0,this.currentOutput.length=0):(await new Promise(((e,t)=>{this.pending.push({resolve:e,reject:t})})),e.reply(r,this.currentOutput[t],void 0,(0,c.A)(this.currentOutput[t])||o.ai(this.currentOutput[t])?void 0:[this.currentOutput[t]]),this.consumedCount++)}))}getInputNodePort(e){return this.inputAVFilterNodePort[e]}getOutputNodePort(e){return this.outputAVFilterNodePort[e]}getInputCount(){return this.inputCount}getOutputCount(){return this.outputCount}getFreeInputNodePort(){const e=[];this.inputConnectedMap.forEach(((t,r)=>{e.push(t)}));for(let t=0;t<this.inputCount;t++)if(!n.zy(e,t))return{index:t,port:this.getInputNodePort(t)}}getFreeOutputNodePort(){const e=[];this.outputConnectedMap.forEach(((t,r)=>{e.push(t)}));for(let t=0;t<this.outputCount;t++)if(!n.zy(e,t))return{index:t,port:this.getOutputNodePort(t)}}addInputPeer(e,t){this.inputConnectedMap.set(e,t)}removeInputPeer(e){this.inputConnectedMap.delete(e)}addOutputPeer(e,t){this.outputConnectedMap.set(e,t)}removeOutputPeer(e){this.outputConnectedMap.delete(e)}connect(e){if(this.outputConnectedMap.size===this.outputCount)throw new Error("all output has connected");const t=this.getFreeOutputNodePort(),r=e.getFreeInputNodePort();if(!r)throw new Error("next node all input has connected");t.port.connect(r.port),this.outputConnectedMap.set(e,t.index),e.addInputPeer(this,r.index)}disconnectNode(e){this.outputConnectedMap.has(e)&&(this.outputAVFilterNodePort[this.outputConnectedMap.get(e)].disconnect(),this.outputConnectedMap.delete(e),e instanceof h&&e.removeInputPeer(this))}disconnect(e){if(e)return this.disconnectNode(e);this.outputConnectedMap.forEach(((e,t)=>{this.disconnectNode(t)}))}}},3601:(e,t,r)=>{function i(e,t,r){throw new Error("unimplemented")}r.d(t,{A:()=>i})},3644:(e,t,r)=>{r.r(t),r.d(t,{default:()=>a});var i=r(2494);let s=i.TK;function a(e){let t;s.onmessage=r=>{const a=r.data,o=a.type,n=a.data;switch(o){case"init":if(i.TK.CHeap&&i.TK.CHeap.initThread&&i.TK.CHeap.Config.USE_THREADS)return void i.TK.CHeap.initThread(n).then((()=>{s.postMessage({type:"ready"})}));s.postMessage({type:"ready"});break;case"run":t=e(n.params);break;case"stop":t&&t.then?t.then((e=>{i.TK.__freeSmartPtr__&&i.TK.__freeSmartPtr__(),s.postMessage({type:"stopped",data:e})})):(i.TK.__freeSmartPtr__&&i.TK.__freeSmartPtr__(),s.postMessage({type:"stopped",data:t}))}}}},3669:(e,t,r)=>{r.d(t,{E_:()=>a});var i=r(3321);const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function a(e){const t="function"==typeof atob?atob(e):function(e){function t(e){const t=s.indexOf(e);return-1===t?0:t}let r="";for(let i=0;i<e.length;){const s=t(e[i++]),a=t(e[i++]),o=t(e[i++]),n=t(e[i++]),c=s<<2|a>>4,d=(15&a)<<4|o>>2,h=(3&o)<<6|n;r+=String.fromCharCode(c),64!==o&&(r+=String.fromCharCode(d)),64!==n&&(r+=String.fromCharCode(h))}return r}(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}const o={};i.__(["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],((e,t)=>{o[e]=t}))},3670:(e,t,r)=>{r.d(t,{l:()=>s});const i="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";function s(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=e.length;let s=0,a=0,o="";for(let t=0;t<r;t++)for(a=a<<8|e[t],s+=8;s>=5;)o+=i[a>>>s-5&31],s-=5;if(s>0&&(o+=i[a<<5-s&31]),t)for(;o.length%8!=0;)o+="=";return o}},3674:(e,t,r)=>{r.d(t,{JW:()=>u,Mr:()=>d,TL:()=>g,cC:()=>p,gd:()=>m,lH:()=>A,lW:()=>h,qW:()=>v,s3:()=>f,sO:()=>l});var i=r(4365),s=r(4405),a=r(2320),o=r(7138),n=r(7921),c=r(9983);function d(e,t,r){(0,i.eq)().set((0,i.eq)().subarray(t,t+r),e)}function h(e,t,r){(0,i.eq)().set(r.subarray(0,t),e)}function l(e,t,r){(0,i.eq)().subarray(e,e+r).fill(t)}function u(e,t){return n.USE_THREADS?f(e,t):new o.A(e,t)}function f(e,t){return new Uint8Array((0,i.Lv)(),e,t)}function p(e,t){return new Int16Array((0,i.Lv)(),e,t)}function m(e,t){return new Int32Array((0,i.Lv)(),e,t)}function g(e,t){return new Float32Array((0,i.Lv)(),e,t)}function A(e,t){let r=0;for(;c.f[4]((e+=1)-1)&&(r++,!(t&&r>=t)););const i=Math.min(r,null!=t?t:r);return s.decode(f(e,i))}function v(e,t,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const o=s.encode(t);let n=o.length,c=i?1:0;r&&n-c>r&&(n=r-c),h(e,n,o),i&&a.M[11](e+n,0)}},3690:(e,t,r)=>{r.d(t,{Ij:()=>d,XC:()=>c,kt:()=>n});var i=r(3262),s=r(5815),a=r(187);const o=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function n(e){let t=0,r=0,i=0;if(e.length<1)return 0;switch(t=e[0],r=o[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*r}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const r=new s.A(t,!1);r.skip(9),e.codecpar.chLayout.nbChannels=r.readUint8(),e.codecpar.initialPadding=r.readUint16(),e.codecpar.sampleRate=r.readUint32(),e.codecpar.seekPreroll=Number((0,i.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(e){const t=new Uint8Array(19),r=new a.A(t,!1);return r.writeString("OpusHead"),r.writeUint8(1),r.writeUint8(e.chLayout.nbChannels),r.writeUint16(e.initialPadding),r.writeUint32(e.sampleRate),t}},3737:(e,t,r)=>{function i(e,t){if(!t.length)return null;if(1===t.length)return t[0];let r,i=0;for(r of t)i+=r.length;let s=new e(i),a=0;for(r of t)s.set(r,a),a+=r.length;return s}r.d(t,{A:()=>i})},3830:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(4467),s=r(8590),a=r(432);const o=s.Pc(Blob.prototype.arrayBuffer),n="function"==typeof FileReaderSync;class c extends a.A{constructor(){super(...arguments),(0,i.A)(this,"info",void 0),(0,i.A)(this,"range",void 0),(0,i.A)(this,"readPos",void 0),(0,i.A)(this,"endPos",void 0),(0,i.A)(this,"reader",void 0),(0,i.A)(this,"readerResolve",void 0)}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{from:0,to:-1};return this.info=e,this.range=t,this.readPos=0,this.endPos=this.info.file.size,t.from>0&&(this.readPos=t.from),t.to>0&&(this.endPos=t.to),this.status=2,0}readBufferByReaderSync(e){return this.reader||(this.reader=new FileReaderSync),this.reader.readAsArrayBuffer(this.info.file.slice(this.readPos,this.readPos+e))}async readBufferByReader(e){return this.reader||(this.reader=new FileReader,this.reader.onloadend=e=>{this.readerResolve&&this.readerResolve(e.target.result)}),new Promise((t=>{this.readerResolve=t,this.reader.readAsArrayBuffer(this.info.file.slice(this.readPos,this.readPos+e))}))}async read(e){if(this.readPos>=this.endPos)return this.status=4,-1048576;const t=Math.min(e.length,this.endPos-this.readPos);return n?e.set(new Uint8Array(this.readBufferByReaderSync(t)),0):o?e.set(new Uint8Array(await this.info.file.slice(this.readPos,this.readPos+t).arrayBuffer()),0):e.set(new Uint8Array(await this.readBufferByReader(t)),0),this.readPos+=t,this.readPos>=this.endPos&&(this.status=4),t}async seek(e){return this.readPos=Number(e),4===this.status&&(this.status=2),0}async size(){return BigInt(Math.floor(this.info.file.size))}async stop(){this.status=0}}},3831:(e,t,r)=>{r.d(t,{Ui:()=>f,XC:()=>u,Yj:()=>p,k9:()=>l,zk:()=>c});var i=r(9983),s=r(39),a=r(3139),o=r(84),n=r(4916);const c={0:"Main",1:"High",2:"Professional"},d=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],h=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function l(e,t,r){const i=e*t;for(const e of d)if(i<=e.maxResolution)return e.level}function u(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const r=f(t);e.codecpar.profile=r.profile,e.codecpar.level=r.level}}function f(e){const t=new o.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const r=t.readU(3),i=t.readU(5),s=t.readU1();let a=t.readU1()?10:8;return t.readU1()&&(a=12),{profile:r,level:i,tier:s,bitDepth:a,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}function p(e,t){const r=new n.A(4);r.writeU1(1),r.writeU(7,1);const c=function(e){const t=new o.A;t.appendBuffer(e);const r=[];for(;t.remainingLength();){const i=t.getPointer();t.readU1(),t.readU(4);const a=t.readU1(),o=t.readU1();t.readU1(),a&&t.readU(8);const n=o?s.v(t):e.length-1-a,c=t.getPointer()-i;r.push(e.subarray(i,i+c+n)),t.skip(8*n)}return r}(t).find((e=>1==(e[0]>>>3&15)));if(c){const e=function(e){const t=new o.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(4);const r=t.readU1(),i=t.readU1();t.readU1(),r&&t.readU(8),i&&s.v(t);const a=s.f(t,3),n=(s.f(t,1),s.f(t,1));let c=0,d=0,l=[0],u=[0],f=[0],p=[0],m=[0],g=[0],A=0,v=[0],w=[0],y=[0];if(n)u[0]=s.f(t,5);else{c=s.f(t,1),c?(s.f(t,32),s.f(t,32),s.f(t,1)&&s.d(t),s.f(t,1)&&(A=s.f(t,5),s.f(t,32),s.f(t,5),s.f(t,5))):d=0;let e=s.f(t,1),r=s.f(t,5);for(let i=0;i<=r;i++){if(l[i]=s.f(t,12),u[i]=s.f(t,5),u[i]>7?f[i]=s.f(t,1):f[i]=0,d){if(p[i]=s.f(t,1),p[i]){let e=A+1;v[i]=s.f(t,e),w[i]=s.f(t,e),y[i]=s.f(t,1)}}else p[i]=0;e&&(m[i]=s.f(t,1),m[i]&&(g[i]=s.f(t,4)))}}let b=s.f(t,4),k=s.f(t,4),_=b+1,I=s.f(t,_);_=k+1;let x=s.f(t,_),M=0,P=0,T=0;M=n?0:s.f(t,1),M&&(s.f(t,4),s.f(t,3)),s.f(t,1),s.f(t,1),s.f(t,1);let E=0,B=0,C=0,S=0,U=0,D=0,R=2,L=2,$=0;n||(s.f(t,1),s.f(t,1),s.f(t,1),s.f(t,1),S=s.f(t,1),S?(U=s.f(t,1),D=s.f(t,1)):(U=0,D=0),R=s.f(t,1)?2:s.f(t,1),R>0?s.f(t,1)?2:s.f(t,1):2,S&&s.f(t,3)),s.f(t,1),s.f(t,1),s.f(t,1);let F=s.f(t,1),z=0,O=0,V=0;2==a&&F?(z=s.f(t,1),O=z?12:10):a<=2&&(O=F?10:8),V=1==a?0:s.f(t,1);let N=0,W=0,Q=0;s.f(t,1)?(N=s.f(t,8),W=s.f(t,8),Q=s.f(t,8)):(N=2,W=2,Q=2);let H=0,G=0,j=0,Y=0,q=0;return V?(H=s.f(t,1),G=1,j=1,Y=0,q=0):1==N&&13==W&&0==Q?(H=1,G=0,j=0,q=s.f(t,1)):(H=s.f(t,1),0==a?(G=1,j=1):1==a?(G=0,j=0):12==O?(G=s.f(t,1),j=G?s.f(t,1):0):(G=1,j=0),G&&j&&(Y=s.f(t,2)),q=s.f(t,1)),s.f(t,1),{width:I+1,height:x+1,profile:a,level:h[u[0]],tier:f[0],bitDepth:O,monoChrome:V,colorRange:H,colorPrimaries:N,transferCharacteristics:W,matrixCoefficients:Q,subsamplingX:G,subsamplingY:j,chromaSamplePosition:Y}}(c);r.writeU(3,e.profile),r.writeU(5,e.level),r.writeU(1,e.tier),r.writeU(1,e.bitDepth>8?1:0),r.writeU(1,12===e.bitDepth?1:0),r.writeU(1,e.monoChrome),r.writeU(1,e.subsamplingX),r.writeU(1,e.subsamplingY),r.writeU(1,e.chromaSamplePosition)}else{const t=(0,a.I)(i.f[15](e+28));r.writeU(3,i.f[15](e+48)),r.writeU(5,i.f[15](e+52)),r.writeU(1,0),r.writeU(1,t.comp[0].depth>8?1:0),r.writeU(1,12===t.comp[0].depth?1:0),r.writeU(1,0),r.writeU(1,1),r.writeU(1,1),r.writeU(1,0)}return r.writeU(8,0),r.padding(),r.getBuffer()}},3995:(e,t,r)=>{r.d(t,{A:()=>x});var i=r(4467),s=r(9983),a=r(5992),o=r(6890),n=r(495),c=r(4187),d=r(3262),h=r(1237),l=r(2171),u=r(2707),f=r(8477),p=r(3674),m=r(1497),g=r(4229),A=r(4096),v=r(4659),w=r(8288),y=r(7084),b=r(3321),k=r(9906),_=r(2107);const I="packages/avcodec/src/webcodec/VideoDecoder.ts";class x{constructor(e){(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"alphaDecoder",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"extradata",void 0),(0,i.A)(this,"currentError",null),(0,i.A)(this,"inputQueue",void 0),(0,i.A)(this,"outputQueue",void 0),(0,i.A)(this,"dtsQueue",void 0),(0,i.A)(this,"sort",void 0),(0,i.A)(this,"keyframeRequire",!1),(0,i.A)(this,"extradataRequire",!1),(0,i.A)(this,"alphaQueue",void 0),(0,i.A)(this,"alphaPending",void 0),this.options=e,this.inputQueue=[],this.outputQueue=[],this.dtsQueue=[],this.alphaQueue=[],this.alphaPending=new Map,this.sort=!(!w.A.safari&&!y.A.ios)}getAlphaFrame(e){if(this.alphaQueue.length){let t=this.alphaQueue.length-1;for(;t>=0;t--)if(this.alphaQueue[t].timestamp===e.timestamp)return this.alphaQueue.splice(t,1).shift()}}async output(e){if(2&s.f[15](this.parameters+160)&&this.dtsQueue.length){const t=e;e=new VideoFrame(t,{timestamp:this.dtsQueue.shift()}),t.close()}if(!this.alphaPending.has(e.timestamp)||(await this.alphaPending.get(e.timestamp).promise,this.decoder))if(this.sort){let t=0;for(;t<this.outputQueue.length;t++)if(this.outputQueue[t].timestamp>e.timestamp){this.outputQueue.splice(t,0,e);break}for(t===this.outputQueue.length&&this.outputQueue.push(e);this.outputQueue.length>2&&this.outputQueue[0].timestamp===this.inputQueue[0];){const e=this.outputQueue.shift(),t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close()),this.inputQueue.shift()}}else{const t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close())}else e.close()}async outputAlpha(e){this.alphaQueue.push(e),this.alphaPending.has(e.timestamp)&&(this.alphaPending.get(e.timestamp).resolve(),this.alphaPending.delete(e.timestamp))}error(e){this.currentError=e,this.options.onError(e)}errorAlpha(e){this.currentError=e,this.options.onError(e),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear()}changeExtraData(e){var t,r;if(b.FB(e,this.extradata))return 0;this.currentError=null,this.extradata=e.slice(),27===s.f[15](this.parameters+4)?m.XC({codecpar:(0,o.A)(this.parameters,a.A),sideData:{},metadata:{}},this.extradata):173===s.f[15](this.parameters+4)&&g.XC({codecpar:(0,o.A)(this.parameters,a.A),sideData:{},metadata:{}},this.extradata),this.decoder.reset();const i={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,f.A)(this.parameters,e),codedWidth:s.f[15](this.parameters+56),codedHeight:s.f[15](this.parameters+60),description:this.extradata,hardwareAcceleration:(0,v.C)(null===(r=this.options.enableHardwareAcceleration)||void 0===r||r)};return i.codedWidth||delete i.codedWidth,i.codedHeight||delete i.codedHeight,this.options.optimizeForLatency&&(i.optimizeForLatency=this.options.optimizeForLatency),this.options.colorSpace&&(i.colorSpace=this.options.colorSpace),this.options.rotation&&(i.rotation=this.options.rotation),this.options.flip&&(i.flip=this.options.flip),this.decoder.configure(i),this.alphaDecoder&&this.alphaDecoder.configure(i),this.currentError?(k.z3(`change extra data error, ${this.currentError}`,I,266),n.r8):(this.keyframeRequire=!0,0)}async open(e){var t,r;this.currentError=null,this.extradata=void 0,0!==s.f[20](e+12)&&(this.extradata=(0,p.s3)(s.f[20](e+12),s.f[15](e+16)).slice()),this.parameters=e;const i={codec:null!==(t=this.options.codec)&&void 0!==t?t:(0,f.A)(e),codedWidth:s.f[15](e+56),codedHeight:s.f[15](e+60),description:1&s.f[15](e+160)?void 0:this.extradata,hardwareAcceleration:(0,v.C)(null===(r=this.options.enableHardwareAcceleration)||void 0===r||r)};this.options.optimizeForLatency&&(i.optimizeForLatency=this.options.optimizeForLatency),this.options.colorSpace&&(i.colorSpace=this.options.colorSpace),this.options.rotation&&(i.rotation=this.options.rotation),this.options.flip&&(i.flip=this.options.flip),i.description||delete i.description,i.codedWidth||delete i.codedWidth,i.codedHeight||delete i.codedHeight;try{if(!(await VideoDecoder.isConfigSupported(i)).supported)return k.z3("not support",I,319),n.nr}catch(e){return k.z3(`${e}`,I,324),n.r8}return this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.alphaDecoder&&"closed"!==this.alphaDecoder.state&&this.alphaDecoder.close(),this.decoder=new VideoDecoder({output:this.output.bind(this),error:this.error.bind(this)}),this.decoder.reset(),this.decoder.configure(i),8&s.f[15](e+160)&&(139===s.f[15](e+4)||167===s.f[15](e+4)||225===s.f[15](e+4))&&"keep"===this.options.alpha&&(this.alphaDecoder=new VideoDecoder({output:this.outputAlpha.bind(this),error:this.errorAlpha.bind(this)}),this.alphaDecoder.reset(),this.alphaDecoder.configure(i)),this.currentError?(k.z3(`open video decoder error, ${this.currentError}`,I,359),n.r8):(this.keyframeRequire=!0,1&s.f[15](e+160)&&(this.extradataRequire=!0),2&s.f[15](this.parameters+160)&&(this.sort=!1),this.outputQueue.length&&this.outputQueue.forEach((e=>{e.close()})),this.alphaQueue.length&&this.alphaQueue.forEach((e=>{e.close()})),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear(),this.inputQueue.length=0,this.outputQueue.length=0,this.dtsQueue.length=0,this.alphaQueue.length=0,0)}decode(e){if(this.currentError)return k.z3(`decode error, ${this.currentError}`,I,398),n.LR;const t=(0,c.rU)(e,1);if(0!==t){let e=this.changeExtraData((0,p.s3)(s.f[20](t),s.f[25](t+4)));if(e)return e}const r=1&s.f[15](e+36);if(this.keyframeRequire){if(!r)return 0;if(1&s.f[15](this.parameters+160)&&this.extradata&&this.extradataRequire){if(27===s.f[15](this.parameters+4)){if(!m.sL((0,c.iI)(e))){const t=m.kM((0,c.iI)(e),this.extradata);t&&(0,c.NX)(e,t.bufferPointer,t.length)}}else if(173===s.f[15](this.parameters+4)){if(!g.sL((0,c.iI)(e))){const t=g.kM((0,c.iI)(e),this.extradata);t&&(0,c.NX)(e,t.bufferPointer,t.length)}}else if(196===s.f[15](this.parameters+4)&&!A.sL((0,c.iI)(e))){const t=A.kM((0,c.iI)(e),this.extradata);t&&(0,c.NX)(e,t.bufferPointer,t.length)}this.extradataRequire=!1}}const i=(0,u.A)(e),a=i.timestamp;if(this.sort){let e=0;for(;e<this.inputQueue.length;e++)if(this.inputQueue[e]>a){this.inputQueue.splice(e,0,a);break}e===this.inputQueue.length&&this.inputQueue.push(a)}try{if(this.alphaDecoder){const t=(0,c.rU)(e,15);if(t&&l.v4(s.f[20](t))===BigInt(1))if(i.timestamp!==h.N_){this.alphaDecoder.decode(new EncodedVideoChunk({type:i.type,timestamp:i.timestamp,duration:null!=i.duration?i.duration:void 0,data:(0,p.s3)(s.f[20](t)+8,s.f[25](t+4)-8)}));let{promise:e,resolve:r}=(0,_.A)();this.alphaPending.set(i.timestamp,{promise:e,resolve:r})}else k.R8("decode with alpha need avpacket's pts, ignore alpha channel data",I,488)}this.decoder.decode(i),2&s.f[15](this.parameters+160)&&this.dtsQueue.push(Number((0,d.Mr)(s.f[17](e+16),e+72,h.KR)))}catch(e){return k.z3(`decode error, ${e}`,I,500),n.LR}return r&&(this.keyframeRequire=!1),0}async flush(){if(this.currentError)return k.z3(`flush error, ${this.currentError}`,I,513),n.LR;try{this.alphaDecoder&&await this.alphaDecoder.flush(),await this.decoder.flush()}catch(e){return k.z3(`flush error, ${e}`,I,523),n.LR}if(this.sort)for(;this.outputQueue.length;){const e=this.outputQueue.shift(),t=this.getAlphaFrame(e);this.options.onReceiveVideoFrame?this.options.onReceiveVideoFrame(e,t):(e.close(),t&&t.close())}return this.keyframeRequire=!0,0}close(){this.decoder&&"closed"!==this.decoder.state&&this.decoder.close(),this.alphaDecoder&&"closed"!==this.alphaDecoder.state&&this.alphaDecoder.close(),this.alphaPending.forEach((e=>{e.resolve()})),this.alphaPending.clear(),this.decoder=void 0,this.alphaDecoder=void 0,this.currentError=null,this.outputQueue.length&&this.outputQueue.forEach((e=>{e.close()})),this.alphaQueue.length&&this.alphaQueue.forEach((e=>{e.close()})),this.inputQueue.length=0,this.outputQueue.length=0,this.alphaQueue.length=0}getQueueLength(){var e,t;return null!==(e=null===(t=this.decoder)||void 0===t?void 0:t.decodeQueueSize)&&void 0!==e?e:0}setSkipFrameDiscard(e){}static async isSupported(e,t){let r;0!==s.f[20](e+12)&&(r=(0,p.s3)(s.f[20](e+12),s.f[15](e+16)).slice());const i={codec:(0,f.A)(e),codedWidth:s.f[15](e+56),codedHeight:s.f[15](e+60),description:1&s.f[15](e+160)?void 0:r,hardwareAcceleration:(0,v.C)(null==t||t)};i.description||delete i.description;try{return(await VideoDecoder.isConfigSupported(i)).supported}catch(e){return!1}}}},4012:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(9983),s=r(3394),a=r(3262),o=r(1237),n=r(8590),c=r(7683),d=r(3554);class h extends d.A{constructor(e){super(e,1,1)}async ready(){}async destroy(){}async process(e,t){let r=e[0];if(n.ai(r)&&r<0)return void(t[0]=r);let d=(0,c.A)(r)?(0,a.Mr)(i.f[17](r+104),r+120,o.KR):BigInt(r.timestamp);if(d<this.options.start)for(;;){const e=await this.inputInnerNodePort[0].request("pull");if(n.ai(e)&&e<0)return void(t[0]=e);if(d=(0,c.A)(e)?(0,a.Mr)(i.f[17](e+104),e+120,o.KR):BigInt(e.timestamp),d>=this.options.start)return void(t[0]=e);(0,c.A)(e)?this.options.avframePool?this.options.avframePool.release(e):(0,s.xj)(e):e.close()}else{if(d>this.options.end&&this.options.end>=this.options.start)return void(t[0]=-1048576);if((0,c.A)(r)){const e=this.options.avframePool?this.options.avframePool.alloc():(0,s.FP)();(0,s.gg)(e,r),t[0]=e}else t[0]=r.clone()}}}},4026:(e,t,r)=>{r.d(t,{Ts:()=>d,XR:()=>m,fs:()=>g,mq:()=>u,of:()=>p,uk:()=>f,vP:()=>l,zr:()=>h});var i,s=r(4467),a=r(7127),o=r(7601),n=r(5419),c=r(9882);function d(e,t){return c.M_(e,0,16,2),0}function h(e){return c.M_(e,0,16,2),0}function l(e){return c.WQ(e,1,16,2),c.me(e,1),0}function u(e){return c.WQ(e,1,16,2),c.me(e,1073741824),0}function f(e,t){let r=c.Hh(e,16,2);return n.Tl(t),c.uk(e,r),n.s2(t),0}async function p(e,t){let r=c.Hh(e,16,2);return n.Tl(t),await c.of(e,r),await n.yh(t),0}function m(e,t,r){let i=c.Hh(e,16,2);n.Tl(t);let s=c.j4(e,i,r);return n.s2(t),2===s?110:0}async function g(e,t,r){let i=c.Hh(e,16,2);n.Tl(t);let s=await c.R_(e,i,r);return await n.yh(t),2===s?110:0}i=class{constructor(){(0,s.A)(this,"atomic",void 0)}},(()=>{const e=i.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,4),(0,o.A)(e,a.JY,t)})()},4081:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(9983),s=r(2320),a=r(3674),o=r(9906),n=r(2935),c=r(1292),d=r(3830),h=r(5979),l=r(2047),u=r(495),f=r(17);const p="packages/avpipeline/src/IOPipeline.ts";class m extends f.A{constructor(){super()}async createTask(e){let t;switch(e.type){case 0:t=new c.A(e.options);break;case 1:t=new d.A(e.options);break;case 2:t=new h.A(e.options);break;case 3:t=new l.A(e.options);break;case 4:t=new((await r.e(600).then(r.bind(r,1321))).default)(e.options);break;case 5:t=new((await r.e(312).then(r.bind(r,8312))).default)(e.options);break;case 6:t=new((await Promise.all([r.e(839),r.e(722)]).then(r.bind(r,2167))).default)(e.options)}if(!t)return u.UY;const f=new n.Ay(e.rightPort),m={...e,ioLoader:t,ipcPort:f};return f.on(n.S3,(async r=>{switch(r.method){case"open":try{const i=await t.open(e.info,e.range);if(i<0){o.z3(`loader open error, ${i}, taskId: ${e.taskId}`,p,148),f.reply(r,null,i);break}f.reply(r,i)}catch(t){o.z3(`loader open error, ${t}, taskId: ${e.taskId}`,p,155),f.reply(r,null,t)}break;case"read":{const n=r.params.pointer,c=r.params.length,d=r.params.ioloaderOptions,h=(0,a.JW)(n,c);try{const e=await t.read(h,d);s.M[17](m.stats+192,i.f[17](m.stats+192)+BigInt(0|e)),f.reply(r,e)}catch(t){if(!this.tasks.has(e.taskId))return;o.z3(`loader read error, ${t}, taskId: ${e.taskId}`,p,179),f.reply(r,u.LR)}break}case"write":{const n=r.params.pointer,c=r.params.length,d=(0,a.JW)(n,c);try{const e=await t.write(d);s.M[17](m.stats+200,i.f[17](m.stats+200)+BigInt(0|c)),f.reply(r,e)}catch(t){o.z3(`loader write error, ${t}, taskId: ${e.taskId}`,p,201),f.reply(r,u.LR)}break}case"seek":{const i=r.params.pos,s=r.params.ioloaderOptions;try{const a=await t.seek(i,s);if(a<0){o.z3(`loader seek error, ${a}, taskId: ${e.taskId}`,p,217),f.reply(r,null,a);break}f.reply(r,a)}catch(t){o.z3(`loader seek error, ${t}, taskId: ${e.taskId}`,p,224),f.reply(r,null,t)}break}case"size":f.reply(r,await t.size())}})),this.tasks.set(e.taskId,m),0}async open(e){const t=this.tasks.get(e);if(t)return await t.ioLoader.open(t.info,t.range),0}async getDuration(e){const t=this.tasks.get(e);if(t)return 4===t.type||5===t.type?t.ioLoader.getDuration():0}async hasAudio(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasAudio();if(4===t.type)return t.ioLoader.hasAudio()}return!1}async hasVideo(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasVideo();if(4===t.type)return t.ioLoader.hasVideo()}return!1}async hasSubtitle(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.hasSubtitle();if(4===t.type)return t.ioLoader.hasSubtitle()}return!1}async getVideoList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getVideoList();if(4===t.type)return t.ioLoader.getVideoList()}return{list:[],selectedIndex:0}}async getAudioList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getAudioList();if(4===t.type)return t.ioLoader.getAudioList()}return{list:[],selectedIndex:0}}async getSubtitleList(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getSubtitleList();if(4===t.type)return t.ioLoader.getSubtitleList()}return{list:[],selectedIndex:0}}async selectVideo(e,t){const r=this.tasks.get(e);if(r){if(5===r.type)return r.ioLoader.selectVideo(t);if(4===r.type)return r.ioLoader.selectVideo(t)}}async selectAudio(e,t){const r=this.tasks.get(e);if(r){if(5===r.type)return r.ioLoader.selectAudio(t);if(4===r.type)return r.ioLoader.selectAudio(t)}}async selectSubtitle(e,t){const r=this.tasks.get(e);if(r){if(5===r.type)return r.ioLoader.selectSubtitle(t);if(4===r.type)return r.ioLoader.selectSubtitle(t)}}async getCurrentProtection(e,t){const r=this.tasks.get(e);if(r&&5===r.type)return r.ioLoader.getCurrentProtection(t)}async getMinBuffer(e){const t=this.tasks.get(e);if(t){if(5===t.type)return t.ioLoader.getMinBuffer();if(4===t.type)return t.ioLoader.getMinBuffer()}return 0}async setStart(e,t){const r=this.tasks.get(e);return r&&4===r.type?r.ioLoader.setStart(t):0}async registerTask(e){return this.tasks.has(e.taskId)?u.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(await t.ioLoader.stop().catch((e=>{o.R8(`stop ioloader error: ${e}, we will ignore it`,p,454)})),t.ipcPort.destroy(),this.tasks.delete(e),o.Yz(`unregisterTask task, taskId: ${e}`,p,458))}}},4096:(e,t,r)=>{r.d(t,{HL:()=>A,OD:()=>I,S1:()=>w,Ui:()=>T,XC:()=>x,kM:()=>_,mW:()=>M,oT:()=>b,sL:()=>y,wA:()=>k,wf:()=>P});var i=r(9983),s=r(1958),a=r(1755),o=r(2149),n=r(2171),c=r(8636),d=r(3674),h=r(3321),l=r(84),u=r(4916),f=r(5815),p=r(187);const m=3;function g(e){const t=e.readU(9),r=e.readU(3),i=e.readU(2),s=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);const o=e.readU(6),n=e.readU(7),c=e.readU(1),d=e.readU(8),h=e.readU(1),l=e.readU(1),u=[],f=[];if(o){for(let t=0;t<o-1;t++)u[t]=e.readU(8);u[o-1]=e.readU(6)}else e.readU(6);if(r>1){let t=0;for(let i=r-2;i>=0;--i)t|=e.readU(1)<<i;for(let t=r;t<=8&&r>1;++t)e.readU(1);for(let i=r-2;i>=0;--i)t&1<<i&&(f[i]=e.readU(8))}const p=e.readU(8),m=[];if(p)for(let t=0;t<p;t++)m.push(e.readU(8));return{olsIdx:t,numSublayers:r,bitDepthMinus8:a,chromaFormatIdc:s,constantFrameRate:i,generalProfileIdc:n,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:l,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:m,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function A(e){const t=new f.A(e,!0);if(1&t.readUint8()){const r=new l.A;r.appendBuffer(e.subarray(1)),g(r),t.skip(r.getPointer())}let r=[],i=[],s=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=31&t.readUint8();let a=1;13!==e&&12!==e&&(a=t.readUint16());const o=[];for(let e=0;e<a;e++){const e=t.readUint16();o.push(t.readBuffer(e))}14===e?r=o:15===e?i=o:16===e&&(s=o)}return{vpss:r,spss:i,ppss:s}}function v(e,t,r){const i=t[0];let s;if(i){const e=P(i);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const r=new u.A;if(r.writeU(9,0),r.writeU(3,e.spsMaxSublayersMinus1+1),r.writeU(2,1),r.writeU(2,e.chromaFormatIdc),r.writeU(3,e.bitDepthMinus8),r.writeU(5,31),r.writeU(2,0),r.writeU(6,t.length),r.writeU(7,e.profile),r.writeU1(e.tierFlag),r.writeU(8,e.level),r.writeU1(e.ptlFrameOnlyConstraintFlag),r.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)r.writeU(8,t[e]);r.writeU(6,t[t.length-1])}else r.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let r=e.spsMaxSublayersMinus1-1;r>=0;r--)t=t<<1|e.ptlSublayerLevelPresentFlag[r];r.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)r.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&r.writeU(8,e.sublayerLevelIdc[t])}r.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)r.writeU(8,e.sublayerLevelIdc[t]);r.writeU(16,e.width),r.writeU(16,e.height),r.writeU(16,0),r.padding(),s=r.getBuffer().subarray(0,r.getPointer())}let a=2+(s?s.length:0);e.length&&(a+=3,a=e.reduce(((e,t)=>e+2+t.length),a)),t.length&&(a+=3,a=t.reduce(((e,t)=>e+2+t.length),a)),r.length&&(a+=3,a=r.reduce(((e,t)=>e+2+t.length),a));const o=new Uint8Array(a),n=new p.A(o,!0);n.writeUint8(m<<1|(s?1:0)|248),s&&n.writeBuffer(s);let c=0;return e.length&&c++,t.length&&c++,r.length&&c++,n.writeUint8(c),e.length&&(n.writeUint8(142),n.writeUint16(e.length),h.__(e,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),t.length&&(n.writeUint8(143),n.writeUint16(t.length),h.__(t,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),r.length&&(n.writeUint8(144),n.writeUint16(r.length),h.__(r,(e=>{n.writeUint16(e.length),n.writeBuffer(e)}))),o}function w(e){let t=s.py(e);if(t.length>=2){const e=[],r=[],i=[];if(t.forEach((t=>{const s=t[1]>>>3&31;14===s?e.push(t):15===s?r.push(t):16===s&&i.push(t)})),r.length&&i.length)return v(e,r,i)}}function y(e){let t=s.py(e);if(t.length>=2){const e=[],r=[],i=[];if(t.forEach((t=>{const s=t[1]>>>3&31;14===s?e.push(t):15===s?r.push(t):16===s&&i.push(t)})),r.length&&i.length){const t=[r[0],i[0]];return e.length&&t.unshift(e[0]),s.nW(t,0)}}}function b(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,o=s.py(e);if(o.length){const e=[],s=[],a=[];o.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?s.push(t):16===r&&a.push(t),8!==r&&7!==r&&9!==r&&10!==r||(i=!0)})),s.length&&a.length?(t=v(e,s,a),o=o.filter((e=>{const t=e[1]>>>3&31;return(r||14!==t&&15!==t&&16!==t)&&20!==t}))):o=o.filter((e=>20!=(e[1]>>>3&31)))}const n=o.reduce(((e,t)=>e+m+1+t.length),0),c=(0,a.sY)(n),h=(0,d.s3)(c,n);return s.S9(o,m,h),{bufferPointer:c,length:n,extradata:t,key:i}}function k(e,t,r,i,o){const n=[s.Le(e,0),s.Le(t,0),s.Le(r,0),s.Le(i,2)];let h=n.reduce(((e,t)=>e+t),0);const l=(0,a.sY)(h+7);let u=l;return c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),1),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),161),c.w8((u+=1,u-1),(o?1:0)<<7|40),e.length&&(s.nW(e,0,(0,d.s3)(u,n[0])),u+=n[0]),t.length&&(s.nW(t,0,(0,d.s3)(u,n[1])),u+=n[1]),r.length&&(s.nW(r,0,(0,d.s3)(u,n[2])),u+=n[2]),i.length&&s.nW(i,2,(0,d.s3)(u,n[3])),{bufferPointer:l,length:h+7}}function _(e,t){let r=s.py(e).concat(s.py(t));if(r.length){let e=[],t=[],i=[],s=[];return r.forEach((r=>{const a=r[1]>>>3&31;14===a?e.push(r):15===a?t.push(r):16===a?i.push(r):20!==a&&s.push(r)})),k(e,t,i,s,!0)}}function I(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;t&&(r=t[0]>>>1&3);let i=[],a=[],o=[],n=!1;if(t){const e=A(t);i=e.vpss,a=e.spss,o=e.ppss,n=!0}const c=s.wN(e,r).filter((e=>20!=(e[1]>>>3&31))),d=[];return c.forEach((e=>{const t=e[1]>>>3&31;15!==t||a.length?16!==t||o.length?20!==t&&d.push(e):o.push(e):a.push(e),8!==t&&7!==t||(n=!0)})),{...k(i,a,o,d,n),key:n}}function x(e,t){let r;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))h.__(s.py(t),(e=>{if(15==(e[1]>>>3&31))return r=e,!1}));else if(t&&t.length>=6){const{spss:e}=A(t);e.length&&(r=e[0])}r&&function(e,t){const{profile:r,level:i,width:s,height:a,videoDelay:o,chromaFormatIdc:n,bitDepthMinus8:c}=P(t);switch(e.codecpar.profile=r,e.codecpar.level=i,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,c){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}(e,r)}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&i.f[15](e+36))return s.py((0,d.s3)(i.f[20](e+24),i.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t||9===t}));{const r=i.f[15](e+28);let s=0;for(;s<r-t;){const r=n.r8(i.f[20](e+24)+(s+t+1))>>>3&31;if(8===r||7===r||9===r)return!0;s+=4===t?n.Sg(i.f[20](e+24)+s):3===t?n.ht(i.f[20](e+24)+s):2===t?n.yd(i.f[20](e+24)+s):n.r8(i.f[20](e+24)+s),s+=t}return!1}}function P(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let r=0,i=0,a=0,n=0,c=0,d=1,h=0,u=0,f=0;const p=[],m=[],g=[],A=[],v=s.BN(e.subarray(t)),w=new l.A(v.length);w.appendBuffer(v),w.readU1(),w.readU1(),w.readU(6),w.readU(5),w.readU(3),w.readU(8);const y=w.readU(3);d=w.readU(2);const b=w.readU(2);if(w.readU(1)){if(r=w.readU(7),h=w.readU(1),i=w.readU(8),u=w.readU(1),f=w.readU(1),w.readU(1)){for(let e=0;e<8;e++)p[e]=w.readU(8);p[8]=w.readU(7);const e=w.readU(8);w.readU(e)}w.skipPadding();for(let e=y-1;e>=0;e--)m[e]=w.readU(1);w.skipPadding();for(let e=y-1;e>=0;e--)m[e]&&(g[e]=w.readU(8));const e=w.readU(8);if(e)for(let t=0;t<e;t++)A[t]=w.readU(32)}w.readU1(),w.readU1()&&w.readU1();const k=a=o.xb(w),_=n=o.xb(w);if(w.readU1()&&(o.xb(w),o.xb(w),o.xb(w),o.xb(w)),w.readU1()){const e=o.xb(w),t=b+5,r=1<<t,i=k/(1<<t),s=_/(1<<t),a=Math.ceil(Math.log2(i)),n=Math.ceil(Math.log2(s));let c=0,d=0,h=0;e>0&&(h=w.readU1(),d=w.readU1());for(let t=0;e>0&&t<=e;t++)d&&0!=t||(t>0&&k>r&&w.readU(a),t>0&&_>r&&w.readU(n),t<e&&k>r&&w.readU(a),t<e&&_>r&&w.readU(n)),h||w.readU(2);if(c=o.xb(w)+1,w.readU(1)&&w.readU(1))for(let t=0;t<=e;t++)w.readU(c)}c=o.xb(w),w.readU(1),w.readU(1);const I=w.readU(4),x=w.readU(1);let M=0;x&&(M=o.xb(w));const P=[],T=w.readU(2);for(let e=0;e<8*T;e++)P[e]=w.readU(1);return{profile:r,level:i,width:a,height:n,videoDelay:y+1>2?2:y,chromaFormatIdc:d,bitDepthMinus8:c,generalProfileSpace:0,tierFlag:h,generalConstraintInfo:p,generalSubProfileIdc:A,ptlFrameOnlyConstraintFlag:u,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:y,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:g,sps_log2_max_pic_order_cnt_lsb_minus4:I,sps_poc_msb_cycle_flag:x,sps_poc_msb_cycle_len_minus1:M,sps_num_extra_ph_bytes:T,sps_extra_ph_bit_present_flag:P}}function T(e){s.Bs(e)&&(e=w(e));const t=new l.A;return t.appendBuffer(e),1&t.readU(8)?g(t):{}}},4125:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(6307),s=r(7921);function a(){return s.USE_THREADS?new MessageChannel:new i.A}},4138:(e,t,r)=>{r.d(t,{A:()=>f});var i=r(4467),s=r(4365),a=r(9983),o=r(2320),n=r(7921),c=r(3674),d=r(4026),h=r(5419),l=r(9882),u=r(2494);class f{constructor(e,t,r){(0,i.A)(this,"count",void 0),(0,i.A)(this,"url",void 0),(0,i.A)(this,"childImportUrl",void 0),(0,i.A)(this,"childThreads",void 0),this.count=e,this.url=t,this.childImportUrl=r,this.childThreads=[]}async createTheadPoolEntry(e){return new Promise(((t,r)=>{const i=(0,s.pv)(),l=new Worker(this.url,{name:u.TK.name?`${u.TK.name}-Thread-${i}`:""}),f=s.s_.alignedAlloc(n.STACK_ALIGNMENT,n.STACK_SIZE),p=s.s_.malloc(8);(0,c.sO)(p,0,8),o.M[15](p+4,0),o.M[15](p,2|a.f[15](p)),l.onmessage=e=>{if("ready"===e.data.type){const e=f;(0,c.sO)(e,0,20),h.Ts(e+16),d.Ts(e+12),l.postMessage({type:"wait"}),t({id:i,thread:{thread:0,worker:l,stackPointer:f,threadDescriptor:p},threadWait:e})}},this.childImportUrl&&l.postMessage({type:"import",data:{url:this.childImportUrl.href}}),l.postMessage({type:"ready",data:{cheap:{memory:s.ce,stackPointer:f,stackSize:n.STACK_SIZE,id:i},runner:{resource:{tableSize:e.tableSize,module:e.module,initFuncs:e.initFuncs},options:{memoryBase:e.memoryBase,tableBase:e.tableBase,threadDescriptor:p,childImports:e.childImports},imports:e.childImports}}})}))}async ready(e){this.childThreads=await Promise.all(new Array(this.count).fill(0).map((()=>this.createTheadPoolEntry(e))))}hasFree(){for(let e=0;e<this.childThreads.length;e++)if(0===a.f[15](this.childThreads[e].thread.threadDescriptor+4))return!0;return!1}isPoolThread(e){for(let t=0;t<this.childThreads.length;t++)if(this.childThreads[t].thread.thread===e)return!0;return!1}createThread(e,t,r,i){for(let t=0;t<this.childThreads.length;t++)if(0===a.f[15](this.childThreads[t].thread.threadDescriptor+4))return o.M[15](this.childThreads[t].thread.threadDescriptor+4,1),this.childThreads[t].thread.thread=e,o.M[15](e+8,2|a.f[15](e+8)),h.s2(this.childThreads[t].threadWait+16),o.M[20](this.childThreads[t].threadWait,e),o.M[20](this.childThreads[t].threadWait+4,r),o.M[20](this.childThreads[t].threadWait+8,i),h.Tl(this.childThreads[t].threadWait+16),void d.vP(this.childThreads[t].threadWait+12)}joinThread(e,t){let r;for(let t=0;t<this.childThreads.length;t++)if(this.childThreads[t].thread.thread===e){r=this.childThreads[t];break}return r?(1&a.f[15](e+8)||(l.uk(e+12,1),0!==t&&o.M[20](t,a.f[20](e+4)),o.M[15](r.thread.threadDescriptor+4,0)),0):-1}detachThread(e){let t;for(let r=0;r<this.childThreads.length;r++)if(this.childThreads[r].thread.thread===e){t=this.childThreads[r];break}return t?(o.M[15](t.thread.threadDescriptor,1|a.f[15](t.thread.threadDescriptor)),o.M[15](e+8,1|a.f[15](e+8)),0):-1}destroy(){for(let e=0;e<this.childThreads.length;e++)s.s_.free(this.childThreads[e].thread.stackPointer),s.s_.free(this.childThreads[e].thread.threadDescriptor),this.childThreads[e].thread.worker.terminate();this.childThreads=[]}}},4158:(e,t,r)=>{r.d(t,{A:()=>z});var i=r(7127),s=r(1228),a=r(6890),o=r(9983),n=r(2320),c=r(495),d=r(4187),h=r(1755),l=r(8588),u=r(3262),f=r(2364),p=r(2458),m=r(8696),g=r(1237),A=r(1497),v=r(4229),w=r(4096),y=r(3674),b=r(7683),k=r(7138),_=r(7921),I=r(3463),x=r(8590),M=r(3321),P=r(1605),T=r(9906),E=r(6332),B=r(3201),C=r(769),S=r(8150),U=r(2935),D=r(8761),R=r(381),L=r(17);const $="packages/avpipeline/src/DemuxPipeline.ts",F=-1;class z extends L.A{constructor(){super()}createTask(e){let t,r;if(e.mainTaskId){const i=this.tasks.get(e.mainTaskId);t=i.leftIPCPort,r=i.controlIPCPort}else t=new U.Ay(e.leftPort),e.controlPort&&(r=new U.Ay(e.controlPort));const i=e.bufferLength||1048576,o=(0,h.sY)(i);if(!o)return c.gR;const n=(0,h.sY)(i);if(!n)return c.gR;const d=new k.A(o,i),l=new B.A(i,!0,d),u=new k.A(n,i),p=new C.A(i,!0,u);e.isLive||(l.flags|=1),e.flags&&(l.flags|=e.flags),l.onFlush=async r=>{const i={pointer:r.byteOffset,length:r.length};e.ioloaderOptions&&(i.ioloaderOptions=e.ioloaderOptions);try{const e=await t.request("read",i);return x.ai(e)?e:((0,y.lW)(i.pointer,e.length,e),e.length)}catch(e){return-1048574}},l.onSeek=async r=>{try{const i={pos:r};return e.ioloaderOptions&&(i.ioloaderOptions=e.ioloaderOptions),t.request("seek",i)}catch(e){return-1048574}},l.onSize=async()=>{try{return t.request("size")}catch(e){return BigInt(-1048574)}},p.onFlush=async e=>{const r={pointer:e.byteOffset,length:e.length};try{return await t.request("write",r)}catch(e){return-1048574}};const g=(0,R.Xv)();return g.ioReader=l,g.ioWriter=p,I.A.wasmBaseSupported&&(g.getDecoderResource=async(e,t)=>{if(!r)return;const i=await r.request("getDecoderResource",{codecId:t,mediaType:e});return(0,f.A)(i,0===e)}),this.tasks.set(e.taskId,{...e,leftIPCPort:t,rightIPCPorts:new Map,controlIPCPort:r,formatContext:g,ioReader:l,iBuffer:o,oBuffer:n,cacheAVPackets:new Map,cacheRequests:new Map,streamIndexFlush:new Map,pendingAVPackets:new Map,realFormat:-1,demuxEnded:!1,loop:null,gopCounter:0,lastKeyFramePts:BigInt(0),lastAudioDts:BigInt(0),lastVideoDts:BigInt(0),avpacketPool:new m.A((0,a.A)(e.avpacketList,s.A),e.avpacketListMutex)}),0}async openStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3;const i=this.tasks.get(e);if(i){let e,s,a=await i.leftIPCPort.request("open");if(a<0)return T.z3(`open ioloader failed, ret: ${a}`,$,344),a;try{6!==i.format?(e=await(0,p.A)(i.ioReader,i.format),i.format=e):e=i.format}catch(e){return c.LR}switch(e){case 0:s=new((await Promise.all([r.e(839),r.e(783)]).then(r.bind(r,6783))).default)(i.formatOptions);break;case 1:s=new((await Promise.all([r.e(399),r.e(283)]).then(r.bind(r,4283))).default)(i.formatOptions);break;case 2:s=new((await Promise.all([r.e(741),r.e(809)]).then(r.bind(r,2809))).default);break;case 3:s=new((await Promise.all([r.e(741),r.e(437)]).then(r.bind(r,7437))).default);break;case 5:s=new((await r.e(244).then(r.bind(r,8244))).default);break;case 4:s=new((await Promise.all([r.e(668),r.e(724)]).then(r.bind(r,5724))).default);break;case 14:s=new((await Promise.all([r.e(296),r.e(717)]).then(r.bind(r,8717))).default);break;case 8:case 9:s=new((await r.e(415).then(r.bind(r,9415))).default);break;case 15:s=new((await r.e(268).then(r.bind(r,2268))).default);break;case 17:s=new((await Promise.all([r.e(299),r.e(611)]).then(r.bind(r,611))).default);break;case 16:s=new((await Promise.all([r.e(933),r.e(945)]).then(r.bind(r,2945))).default);break;case 18:s=new((await r.e(485).then(r.bind(r,2485))).default);break;case 19:s=new((await r.e(888).then(r.bind(r,5888))).default);break;case 20:s=new((await r.e(74).then(r.bind(r,9074))).default);break;case 21:s=new((await r.e(836).then(r.bind(r,8836))).default);break;case 11:s=new((await r.e(793).then(r.bind(r,1793))).default)(i.formatOptions);break;case 12:s=new((await r.e(29).then(r.bind(r,8029))).default)(i.formatOptions);break;case 13:s=new((await r.e(318).then(r.bind(r,3318))).default)(i.formatOptions);break;case 6:s=new((await r.e(411).then(r.bind(r,1792))).default)(i.formatOptions);break;case 10:s=new((await Promise.all([r.e(933),r.e(97)]).then(r.bind(r,2097))).default)(i.formatOptions);break;default:return T.z3("format not support",$,547),c.E$}return i.realFormat=e,i.formatContext.iformat=s,D.ho(i.formatContext,{maxAnalyzeDuration:t,fastOpen:i.isLive})}T.h2("task not found",$,562)}async getFormat(e){const t=this.tasks.get(e);if(t)return t.realFormat;T.h2("task not found",$,572)}async analyzeStreams(e){const t=this.tasks.get(e);if(t){let e=await D.Ib(t.formatContext);if(e)return e;const r=[],s=[];for(let e=0;e<t.formatContext.streams.length;e++){const s=t.formatContext.streams[e];r.push({index:s.index,id:s.id,codecpar:s.codecpar[i.o9],nbFrames:s.nbFrames,metadata:s.metadata,duration:s.duration,startTime:s.startTime,disposition:s.disposition,timeBase:{den:s.timeBase.den,num:s.timeBase.num},attachedPic:s.attachedPic})}for(let e=0;e<t.formatContext.streamGroups.length;e++){const i=t.formatContext.streamGroups[e];s.push({index:i.index,id:i.id,type:i.type,params:i.params,metadata:i.metadata,disposition:i.disposition,streams:i.streams.map((e=>r.find((t=>t.id===e.id))))})}return{metadata:t.formatContext.metadata,format:t.realFormat,chapters:t.formatContext.chapters,streams:r,streamGroups:s}}T.h2("task not found",$,629)}replyAVPacket(e,t,r,i){if((0,E.A)()&&!_.USE_THREADS&&(0,b.A)(i)){const s=(0,l.wm)(i),a=[s.data.buffer];return s.sideData.length&&s.sideData.forEach((e=>{a.push(e.data.buffer)})),t.reply(r,s,null,a),void e.avpacketPool.release(i)}t.reply(r,i)}async connectStreamTask(e,t,r){const i=this.tasks.get(e);if(i){const e=new U.Ay(r);i.cacheAVPackets.set(t,[]),e.streamIndex=t,e.on(U.S3,(async t=>{switch(t.method){case"pull":{const r=i.cacheAVPackets.get(e.streamIndex);if(r.length){const s=r.shift();0!==i.stats&&s>0&&(1===i.formatContext.streams[o.f[15](s+32)].codecpar.codecType?n.M[15](i.stats+32,o.f[15](i.stats+32)-1):0===i.formatContext.streams[o.f[15](s+32)].codecpar.codecType&&n.M[15](i.stats+120,o.f[15](i.stats+120)-1)),this.replyAVPacket(i,e,t,s)}else i.demuxEnded?e.reply(t,-1048576):(i.cacheRequests.set(e.streamIndex,t),i.loop&&i.loop.isStarted()&&i.loop.resetInterval());break}}})),i.rightIPCPorts.set(t,e),T.Yz(`connect stream ${t}, taskId: ${i.taskId}`,$,690)}else T.h2("task not found",$,693)}async addPendingStream(e,t){const r=this.tasks.get(e);r?r.pendingAVPackets.set(t,[]):T.h2("task not found",$,703)}async changeConnectStream(e,t,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this.tasks.get(e);if(a){if(t===r)return;let e=a.cacheAVPackets.get(r);const o=a.rightIPCPorts.get(r),c=a.cacheRequests.get(r);e||T.R8(`oldStreamIndex ${r} not found`,$,720),await a.loop.stopBeforeNextTick(),i?a.pendingAVPackets.has(t)||(M.__(e,(e=>{a.avpacketPool.release(e)})),e.length=0):a.streamIndexFlush.set(t,!0),a.pendingAVPackets.has(t)&&(a.pendingAVPackets.set(r,e),e=a.pendingAVPackets.get(t),a.pendingAVPackets.delete(t)),1===a.formatContext.streams[t].codecpar.codecType?n.M[15](a.stats+32,e.length):0===a.formatContext.streams[t].codecpar.codecType&&n.M[15](a.stats+120,e.length),o.streamIndex=t,a.cacheAVPackets.set(t,e),a.rightIPCPorts.set(t,o),a.cacheAVPackets.delete(r),a.rightIPCPorts.delete(r),c&&(a.cacheRequests.set(t,c),a.cacheRequests.delete(r)),i&&!s||a.loop.start(),T.Yz(`changed connect stream, new ${t}, old: ${r}, force: ${i}, taskId: ${a.taskId}`,$,766)}else T.h2("task not found",$,769)}async doDemux(e,t){const r=e.avpacketPool.alloc();let i=await D.Cj(e.formatContext,r);if(i){e.avpacketPool.release(r),-1048576!==i&&-1048572!==i&&(e.controlIPCPort.notify("demuxError",{code:i}),T.z3(`demux error, ret: ${i}, taskId: ${e.taskId}`,$,929));for(let t of e.cacheRequests.keys())e.cacheAVPackets.get(t).length||(e.rightIPCPorts.get(t).reply(e.cacheRequests.get(t),-1048576),e.cacheRequests.delete(t))}else{const i=o.f[15](r+32);if(0!==e.stats)if(1===e.formatContext.streams[i].codecpar.codecType&&e.cacheAVPackets.has(i)){if(n.M[17](e.stats+24,o.f[17](e.stats+24)+BigInt(1)),n.M[17](e.stats+16,o.f[17](e.stats+16)+BigInt(0|o.f[15](r+28))),o.f[17](e.stats+24)>1&&o.f[17](r+16)>e.lastAudioDts){const t=e.cacheAVPackets.get(i);t&&t.length?n.M[15](e.stats+244,Math.round(o.f[15](r+76)/o.f[15](r+72)/(Number(BigInt.asIntN(32,o.f[17](r+16)-o.f[17](t[0]+16)))/t.length))):n.M[15](e.stats+244,Math.round(o.f[15](r+76)/o.f[15](r+72)/Number(BigInt.asIntN(32,o.f[17](r+16)-e.lastAudioDts))))}e.lastAudioDts=o.f[17](r+16)}else if(0===e.formatContext.streams[i].codecpar.codecType&&e.cacheAVPackets.has(i)){if(n.M[17](e.stats+112,o.f[17](e.stats+112)+BigInt(1)),n.M[17](e.stats+104,o.f[17](e.stats+104)+BigInt(0|o.f[15](r+28))),1&o.f[15](r+36)?(n.M[17](e.stats+176,o.f[17](e.stats+176)+BigInt(1)),o.f[17](e.stats+176)>1&&o.f[17](r+8)>e.lastKeyFramePts&&(n.M[15](e.stats+96,e.gopCounter),e.gopCounter=1,n.M[15](e.stats+92,Number(BigInt.asIntN(32,(0,u.Mr)(o.f[17](r+8)-e.lastKeyFramePts,r+72,g.i0))))),e.lastKeyFramePts=o.f[17](r+8)):e.gopCounter++,o.f[17](e.stats+112)>1&&o.f[17](r+16)>e.lastVideoDts){const t=e.cacheAVPackets.get(i);t&&t.length?n.M[15](e.stats+232,Math.round(o.f[15](r+76)/o.f[15](r+72)/(Number(BigInt.asIntN(32,o.f[17](r+16)-o.f[17](t[0]+16)))/t.length))):n.M[15](e.stats+232,Math.round(o.f[15](r+76)/o.f[15](r+72)/Number(BigInt.asIntN(32,o.f[17](r+16)-e.lastVideoDts))))}e.lastVideoDts=o.f[17](r+16)}if(e.streamIndexFlush.get(i)){const t=e.formatContext.streams.find((e=>e.index===i));if(!(0,d.rU)(r,1)&&t&&t.codecpar.extradataSize){const e=(0,h.sY)(t.codecpar.extradataSize);(0,y.Mr)(e,t.codecpar.extradata,t.codecpar.extradataSize),(0,d.Ow)(r,1,e,t.codecpar.extradataSize)}e.streamIndexFlush.set(i,!1)}if(e.cacheRequests.has(i))this.replyAVPacket(e,e.rightIPCPorts.get(i),e.cacheRequests.get(i),r),e.cacheRequests.delete(i);else if(e.cacheAVPackets.has(i))e.cacheAVPackets.get(i).push(r),0!==e.stats&&(1===e.formatContext.streams[i].codecpar.codecType?n.M[15](e.stats+32,o.f[15](e.stats+32)+1):0===e.formatContext.streams[i].codecpar.codecType&&n.M[15](e.stats+120,o.f[15](e.stats+120)+1)),3===e.formatContext.streams[i].codecpar.codecType&&e.cacheAVPackets.get(i).length>t&&e.avpacketPool.release(e.cacheAVPackets.get(i).shift());else if(e.pendingAVPackets.has(i)){const s=e.pendingAVPackets.get(i);if(s.push(r),0!==e.stats){const r=e.formatContext.streams[i].codecpar.codecType;for(;s.length;){const i=s[0],a=(0,u.Mr)(o.f[17](i+8),i+72,g.i0),n=P.T9(o.f[17](e.stats+328),o.f[17](e.stats+336));if(1===r&&a>=n||0===r&&a>=n||1!==r&&0!==r&&s.length<=t)break;e.avpacketPool.release(s.shift())}}else s.length>t&&e.avpacketPool.release(s.shift())}else e.rightIPCPorts.has(F)?e.cacheRequests.has(F)?(this.replyAVPacket(e,e.rightIPCPorts.get(F),e.cacheRequests.get(F),r),e.cacheRequests.delete(F)):e.cacheAVPackets.get(F).push(r):e.avpacketPool.release(r)}return i}doAttachedPicture(e){e.cacheAVPackets.forEach(((t,r)=>{const i=e.formatContext.streams.find((e=>e.index===r));if(1024&i.disposition&&i.attachedPic){const r=e.avpacketPool.alloc();(0,d.rN)(r,i.attachedPic),t.push(r),t.push(-1048576),0!==e.stats&&n.M[15](e.stats+120,1)}}))}async startDemux(e,t,r){const i=this.tasks.get(e);if(i){if(r=Math.max(r,2===i.format?20:10),i.loop&&i.loop.destroy(),i.loop=new S.A((async()=>{if(!t){let e=!1,t=!1;if(i.cacheAVPackets.forEach(((s,a)=>{const o=i.formatContext.streams.find((e=>e.index===a));s.length<r&&(3!==o.codecpar.codecType&&!(1024&o.disposition)||1===i.cacheAVPackets.size)&&(e=!0),s.length>Math.max(2*r,5e3)&&(t=!0)})),!e||t)return void i.loop.emptyTask()}await this.doDemux(i,r)&&(i.demuxEnded=!0,T.pq(`demuxer ended, taskId: ${i.taskId}`,$,998),i.loop.stop())}),0,0,!0,!1),t&&i.cacheAVPackets.size)for(;;){let e=!1;if(i.cacheAVPackets.forEach(((t,i)=>{t.length>=r&&(e=!0)})),e)break;if(await this.doDemux(i,r))return void(i.demuxEnded=!0)}this.doAttachedPicture(i),i.loop.start(),T.Yz(`start demux loop, taskId: ${i.taskId}`,$,1028)}else T.h2("task not found",$,1031)}async seek(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;const s=this.tasks.get(e);if(s){if(s.loop){await s.loop.stopBeforeNextTick();let a=await D.jF(s.formatContext,i,t,r);if(a>=BigInt(0)){function c(e){M.__(e,(e=>{if(2&s.formatContext.ioReader.flags){const t=(0,d.rU)(e,1),r=s.formatContext.streams[o.f[15](e+32)];!r.sideData[1]&&t&&(r.sideData[1]=(0,y.s3)(o.f[20](t),o.f[25](t+4)).slice())}s.avpacketPool.release(e)})),e.length=0}s.cacheAVPackets.forEach(c),s.pendingAVPackets.forEach(c),0!==s.stats&&s.cacheAVPackets.forEach(((e,t)=>{const r=s.formatContext.streams.find((e=>e.index===t));1===r.codecpar.codecType?n.M[15](s.stats+32,0):0===r.codecpar.codecType&&n.M[15](s.stats+120,0)}));const h=s.avpacketPool.alloc();for(;a=await D.Cj(s.formatContext,h),!(a<0||s.cacheAVPackets.has(o.f[15](h+32))););if(a>=0){s.demuxEnded=!1;const l=o.f[15](h+32);return s.cacheAVPackets.get(l).push(h),0!==s.stats&&(1===s.formatContext.streams[o.f[15](h+32)].codecpar.codecType?n.M[15](s.stats+32,o.f[15](s.stats+32)+1):0===s.formatContext.streams[o.f[15](h+32)].codecpar.codecType&&n.M[15](s.stats+120,o.f[15](s.stats+120)+1)),this.doAttachedPicture(s),s.loop.start(),(0,u.Mr)(P.T9(o.f[17](h+8),BigInt(0)),h+72,g.i0)}return T.R8(`got first packet failed after seek, taskId: ${s.taskId}`,$,1102),s.avpacketPool.release(h),s.demuxEnded=!0,t}return s.loop.start(),a}{T.pq("seek before demux loop start",$,1116);let f=await D.jF(s.formatContext,-1,t,r);return f<0?f:t}}}async croppingAVPacketQueue(e,t){const r=this.tasks.get(e);if(r){let i=t;const s=new Map;function a(e,t){if(!(1&o.f[15](e+36)))return!1;let r=0!==(0,d.rU)(e,1);return!r&&64&o.f[15](e+36)&&(27===t?r=!!A.sL((0,d.iI)(e)):173===t?r=!!v.sL((0,d.iI)(e)):196===t&&(r=!!w.sL((0,d.iI)(e)))),r}const c=new Map;r.cacheAVPackets.forEach(((e,t)=>{c.set(t,e)})),r.pendingAVPackets.forEach(((e,t)=>{c.set(t,e)})),c.forEach(((e,n)=>{const c=r.formatContext.streams[n].codecpar.codecType,d=r.formatContext.streams[n].codecpar.codecId;if(0===c){const r=o.f[17](e[e.length-1]+16);let c=e.length-2;for(c=e.length-2;c>=0;c--)if(1&o.f[15](e[c]+36)&&(0,u.Mr)(r-o.f[17](e[c]+16),e[c]+72,g.i0)>=t){i=P.T9(i,(0,u.Mr)(r-o.f[17](e[c]+16),e[c]+72,g.i0));break}if((27===d||173===d||196===d)&&c>0&&!a(e[c],d))for(let t=c-1;t>0;t--)if(1&o.f[15](e[t]+36)&&a(e[t],d)){i=P.T9(i,(0,u.Mr)(r-o.f[17](e[t]+16),e[t]+72,g.i0)),c=t;break}c>0&&s.set(n,c)}})),c.forEach(((e,t)=>{if(0!==r.formatContext.streams[t].codecpar.codecType){const r=o.f[17](e[e.length-1]+16);let a=e.length-2;for(a=e.length-2;a>=0&&!((0,u.Mr)(r-o.f[17](e[a]+16),e[a]+72,g.i0)>=i);a--);a>=0&&s.set(t,a)}})),s.size===c.size&&s.forEach(((e,t)=>{const i=c.get(t);i.splice(0,e).forEach((e=>{r.avpacketPool.release(e)}));const s=r.formatContext.streams[t].codecpar.codecType;0!==r.stats&&(1===s?n.M[15](r.stats+32,i.length):0===s&&n.M[15](r.stats+120,i.length))}))}}async setAVStreamDiscard(e,t,r){const i=this.tasks.get(e);if(i){const e=i.formatContext.getStreamByIndex(t);e&&(e.discard=r)}}async stop(e){const t=this.tasks.get(e);t&&(t.formatContext.ioReader.flags|=8)}async registerTask(e){return this.tasks.has(e.taskId)?c.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.ioReader&&4&t.ioReader.flags&&t.ioReader.abort(),t.loop&&(await t.loop.stopBeforeNextTick(),t.loop.destroy()),t.cacheAVPackets.forEach((e=>{e.forEach((e=>{t.avpacketPool.release(e)}))})),t.pendingAVPackets.forEach((e=>{e.forEach((e=>{t.avpacketPool.release(e)}))})),t.cacheRequests.forEach(((e,r)=>{t.rightIPCPorts.get(r).reply(e,-1048576)})),t.cacheRequests.clear(),await t.formatContext.destroy(),t.mainTaskId||(t.leftIPCPort.destroy(),t.controlIPCPort&&t.controlIPCPort.destroy()),t.rightIPCPorts.forEach((e=>{e.destroy()})),t.rightIPCPorts.clear(),t.iBuffer&&((0,h.Eb)(t.iBuffer),t.iBuffer=0),t.oBuffer&&((0,h.Eb)(t.oBuffer),t.oBuffer=0),this.tasks.delete(e),T.Yz(`unregisterTask task, taskId: ${e}`,$,1320))}}},4169:(e,t,r)=>{r.r(t),r.d(t,{override:()=>U,wasm_cpu_core_count:()=>T,wasm_pthread_cond_broadcast:()=>k,wasm_pthread_cond_destroy:()=>v,wasm_pthread_cond_init:()=>A,wasm_pthread_cond_signal:()=>b,wasm_pthread_cond_timedwait:()=>y,wasm_pthread_cond_timedwait_async:()=>S,wasm_pthread_cond_wait:()=>w,wasm_pthread_cond_wait_async:()=>C,wasm_pthread_equal2:()=>M,wasm_pthread_exit:()=>x,wasm_pthread_mutex_destroy:()=>f,wasm_pthread_mutex_init:()=>u,wasm_pthread_mutex_lock:()=>p,wasm_pthread_mutex_lock_async:()=>B,wasm_pthread_mutex_trylock:()=>m,wasm_pthread_mutex_unlock:()=>g,wasm_pthread_once:()=>_,wasm_pthread_self2:()=>I,wasm_pthread_support:()=>P,wasm_threw_error:()=>E});var i=r(9983),s=r(2320),a=r(5419),o=r(4026),n=r(7921),c=r(4365),d=r(9882),h=r(2494),l=r(3674);let u,f,p,m,g,A,v,w,y,b,k,_;function I(){return h.TK.__SELF_THREAD__}function x(e){const t=h.TK.__SELF_THREAD__;s.M[20](t+4,e),s.M[15](t+8,4|i.f[15](t+8))}function M(e,t){return i.f[15](e)===i.f[15](t)?1:0}function P(){return n.USE_THREADS?1:0}function T(){return navigator.hardwareConcurrency}function E(e,t){throw new Error((0,l.lH)(t))}function B(e){return a.yh(e)}function C(e,t){return o.of(e,t)}function S(e,t,r){let s=1e3*Number(i.f[17](r))+i.f[15](r+8)/1e6;return o.fs(e,t,s)}function U(e){e.wasm_pthread_mutex_lock&&(p=e.wasm_pthread_mutex_lock),e.wasm_pthread_mutex_trylock&&(m=e.wasm_pthread_mutex_trylock),e.wasm_pthread_mutex_unlock&&(g=e.wasm_pthread_mutex_unlock),e.wasm_pthread_cond_wait&&(w=e.wasm_pthread_cond_wait),e.wasm_pthread_cond_timedwait&&(y=e.wasm_pthread_cond_timedwait),e.wasm_pthread_cond_signal&&(b=e.wasm_pthread_cond_signal),e.wasm_pthread_cond_broadcast&&(k=e.wasm_pthread_cond_broadcast)}u=function(e,t){return a.Ts(e)},f=function(e){return a.zr(e)},p=function(e){return a.s2(e)},m=function(e){return a.bh(e)},g=function(e){return a.Tl(e)},A=function(e,t){return o.Ts(e,t)},v=function(e){return o.zr(e)},w=function(e,t){return o.uk(e,t)},y=function(e,t,r){let s=1e3*Number(i.f[17](r))+i.f[15](r+8)/1e6;return o.XR(e,t,s)},b=function(e){return o.vP(e)},k=function(e){return o.mq(e)},_=function(e,t){return 0===d.WQ(e,1,16,2)&&c.XI.get(t)(),0}},4187:(e,t,r)=>{r.d(t,{$W:()=>m,E4:()=>g,Is:()=>v,NX:()=>T,NZ:()=>b,Ow:()=>A,Pd:()=>k,Qe:()=>y,Un:()=>l,Up:()=>M,Zx:()=>P,_5:()=>w,fQ:()=>p,iI:()=>h,rN:()=>x,rU:()=>u,sn:()=>f,zu:()=>_});var i=r(3674),s=r(9983),a=r(2320),o=r(1755),n=r(1237),c=r(6229);const d=64;function h(e,t){return t?(0,i.JW)(s.f[20](e+24),s.f[15](e+28)):(0,i.s3)(s.f[20](e+24),s.f[15](e+28))}function l(e,t,r){const i=s.f[15](t),a=s.f[20](e);for(let e=0;e<i;e++)if(s.f[15](a+12*e+8)===r)return a+12*e;return 0}function u(e,t){return l(e+40,e+44,t)}function f(e,t,r){const i=s.f[15](t),a=s.f[20](e);for(let e=0;e<i;e++)if(s.f[15](a+12*e+8)===r)return!0;return!1}function p(e,t){return f(e+40,e+44,t)}function m(e,t,r,n,c){const d=s.f[15](t),h=s.f[20](e);for(let e=0;e<d;e++)if(s.f[15](h+12*e+8)===r)return(0,o.Eb)(s.f[20](h+12*e)),a.M[20](h+12*e,n),void a.M[25](h+12*e+4,c);const l=12*(d+1),u=(0,o.Gy)(l);if(d)for(let e=0;e<d;e++)(0,i.Mr)(u+12*e,h+12*e,12);const f=u+12*d;return a.M[20](f,n),a.M[15](f+8,r),a.M[25](f+4,c),h&&(0,o.Eb)(h),a.M[20](e,u),a.M[15](t,d+1),f}function g(e,t,r,s){const a=(0,o.sY)(s+d);return(0,i.sO)(a+s,0,d),m(e,t,r,a,s)}function A(e,t,r,i){m(e+40,e+44,t,r,i)}function v(e,t){let r=-1;for(let i=0;i<s.f[15](e+44);i++)if(s.f[15](s.f[20](e+40)+12*i+8)===t){r=i;break}if(r>-1)if(1===s.f[15](e+44))(0,o.Eb)(s.f[20](s.f[20](e+40))),(0,o.Eb)(s.f[20](e+40)),a.M[20](e+40,0),a.M[15](e+44,0);else{const t=12*(s.f[15](e+44)-1),n=(0,o.Gy)(t);for(let t=0;t<s.f[15](e+44);t++)t!==r?(0,i.Mr)(n+12*t,s.f[20](e+40)+12*t,12):(0,o.Eb)(s.f[20](s.f[20](e+40)+12*t));(0,o.Eb)(s.f[20](e+40)),a.M[20](e+40,n),a.M[15](e+44,s.f[15](e+44)-1)}}function w(){const e=(0,o.Gy)(80);return k(e),e}function y(e){M(e),(0,o.Eb)(e)}function b(e,t){const r=s.f[20](e),i=s.f[15](t);if(r){for(let e=0;e<i;e++)(0,o.Eb)(s.f[20](r+12*e));(0,o.aI)(e),a.M[15](t,0)}}function k(e){a.M[20](e+24,0),a.M[15](e+28,0),a.M[20](e+40,0),a.M[15](e+44,0),a.M[15](e+32,n.N_),a.M[17](e+56,n.Dh),a.M[17](e+48,n.Dh),a.M[15](e+36,0),a.M[17](e+16,n.Dh),a.M[17](e+8,n.Dh),a.M[15](e+76,n.SF),a.M[15](e+72,1),a.M[20](e,0)}function _(e,t){return a.M[15](e+32,s.f[15](t+32)),a.M[17](e+56,s.f[17](t+56)),a.M[17](e+48,s.f[17](t+48)),a.M[15](e+36,s.f[15](t+36)),a.M[17](e+16,s.f[17](t+16)),a.M[17](e+8,s.f[17](t+8)),a.M[20](e+64,s.f[20](t+64)),a.M[15](e+76,s.f[15](t+76)),a.M[15](e+72,s.f[15](t+72)),a.M[20](e+68,0),(0,c.us)(e+68,s.f[20](t+68)),function(e,t){if(b(e+40,e+44),s.f[15](t+44)){let r=12;a.M[20](e+40,(0,o.Gy)(r*s.f[15](t+44)));for(let r=0;r<s.f[15](t+44);r++)a.M[25](s.f[20](e+40)+12*r+4,s.f[25](s.f[20](t+40)+12*r+4)),a.M[15](s.f[20](e+40)+12*r+8,s.f[15](s.f[20](t+40)+12*r+8)),a.M[20](s.f[20](e+40)+12*r,(0,o.sY)(s.f[25](s.f[20](t+40)+12*r+4))),(0,i.Mr)(s.f[20](s.f[20](e+40)+12*r),s.f[20](s.f[20](t+40)+12*r),s.f[25](s.f[20](t+40)+12*r+4));a.M[15](e+44,s.f[15](t+44))}}(e,t),0}function I(e,t){return(0,c.A6)(e,t+d),(0,i.sO)(s.f[20](s.f[20](e)+4)+t,0,d),0}function x(e,t){return s.f[20](e)&&(0,c.Q7)(e),a.M[20](e,0),_(e,t),!s.f[20](t)&&s.f[15](t+28)?(I(e,s.f[15](t+28)),s.f[15](t+28)&&(0,i.Mr)(s.f[20](s.f[20](e)+4),s.f[20](t+24),s.f[15](t+28)),a.M[20](e+24,s.f[20](s.f[20](e)+4))):s.f[20](t)&&(a.M[20](e,(0,c.VG)(s.f[20](t))),a.M[20](e+24,s.f[20](t+24))),a.M[15](e+28,s.f[15](t+28)),0}function M(e){b(e+40,e+44),(0,c.Q7)(e+68),s.f[20](e)?(0,c.Q7)(e):s.f[20](e+24)&&(0,o.Eb)(s.f[20](e+24)),k(e)}function P(e,t){s.f[20](e)&&(0,c.Q7)(e),a.M[20](e,0),!s.f[20](t)&&s.f[15](t+28)?(I(e,s.f[15](t+28)),s.f[15](t+28)&&(0,i.Mr)(s.f[20](s.f[20](e)+4),s.f[20](t+24),s.f[15](t+28)),a.M[20](e+24,s.f[20](s.f[20](e)+4))):s.f[20](t)&&(a.M[20](e,(0,c.VG)(s.f[20](t))),a.M[20](e+24,s.f[20](t+24))),a.M[15](e+28,s.f[15](t+28))}function T(e,t,r){s.f[20](e)?(0,c.Q7)(e):s.f[20](e+24)&&(0,o.Eb)(s.f[20](e+24)),a.M[20](e,(0,c.aw)(t,r+d)),a.M[20](e+24,t),a.M[15](e+28,r)}},4200:(e,t,r)=>{r.d(t,{A:()=>i});const i="AGFzbQEAAAABEwNgAX8Bf2ACf38Bf2ADf39/AX8CEgEDZW52Bm1lbW9yeQIDAYCABAMIBwAAAAECAAAHQwcEbG9jawAAB3RyeWxvY2sAAQZ1bmxvY2sAAgR3YWl0AAMJdGltZWR3YWl0AAQGc2lnbmFsAAUJYnJvYWRjYXN0AAYKnAIHVgEBfyAAQQBBAf5IAgAhASABQQBHBEADQCABQQJGBH9BAQUgAEEBQQL+SAIAQQBHCwRAIABBAkJ//gECABoLIABBAEEC/kgCACEBIAFBAEcNAAsLQQALFwAgAEEAQQH+SAIAQQBGBH9BAAVBEAsLIwAgAEEB/iUCAEEBRwRAIABBAP4XAgAgAEEB/gACABoLQQALHQAgACAA/hACACABEAIaQn/+AQIAGiABEAAaQQALNwAgACAA/hACACABEAIaIAIpAwBCgJTr3AN+IAIoAgitfP4BAgAgARAAGkECRgR/QfAABUEACwsWACAAQQH+HgIAGiAAQQH+AAIAGkEACxoAIABBAf4eAgAaIABBgICAgAT+AAIAGkEACw=="},4229:(e,t,r)=>{r.d(t,{HL:()=>w,OD:()=>M,S1:()=>b,XC:()=>P,ZU:()=>B,dT:()=>m,k9:()=>A,kM:()=>x,mW:()=>T,oT:()=>_,sL:()=>k,wA:()=>I,wf:()=>E});var i=r(9983),s=r(1958),a=r(1755),o=r(2149),n=r(2171),c=r(8636),d=r(3674),h=r(3321),l=r(84),u=r(5815),f=r(187);const p=16,m={1:"Main",2:"Main10",3:"MainStillPicture",4:"Main444"},g=[{level:10,maxLumaSamplesPerSecond:552960,maxLumaPictureSize:36864,maxBitRate:{main:128,main10:150}},{level:20,maxLumaSamplesPerSecond:3686400,maxLumaPictureSize:122880,maxBitRate:{main:1500,main10:1875}},{level:21,maxLumaSamplesPerSecond:7372800,maxLumaPictureSize:245760,maxBitRate:{main:3e3,main10:3750}},{level:30,maxLumaSamplesPerSecond:16588800,maxLumaPictureSize:552960,maxBitRate:{main:6e3,main10:7500}},{level:31,maxLumaSamplesPerSecond:33177600,maxLumaPictureSize:983040,maxBitRate:{main:1e4,main10:12500}},{level:40,maxLumaSamplesPerSecond:66846720,maxLumaPictureSize:2228224,maxBitRate:{main:12e3,main10:15e3}},{level:41,maxLumaSamplesPerSecond:133693440,maxLumaPictureSize:2228224,maxBitRate:{main:2e4,main10:25e3}},{level:50,maxLumaSamplesPerSecond:267386880,maxLumaPictureSize:8912896,maxBitRate:{main:25e3,main10:4e4}},{level:51,maxLumaSamplesPerSecond:534773760,maxLumaPictureSize:8912896,maxBitRate:{main:4e4,main10:6e4}},{level:52,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:60,maxLumaSamplesPerSecond:1069547520,maxLumaPictureSize:35651584,maxBitRate:{main:6e4,main10:1e5}},{level:61,maxLumaSamplesPerSecond:2139095040,maxLumaPictureSize:89128960,maxBitRate:{main:12e4,main10:24e4}},{level:62,maxLumaSamplesPerSecond:4278190080,maxLumaPictureSize:356515840,maxBitRate:{main:24e4,main10:48e4}}];function A(e,t,r,i,s){s/=1e3;const a=1===e?"main":"main10",o=t*r*i;for(const e of g)if(o<=e.maxLumaSamplesPerSecond&&t*r<=e.maxLumaPictureSize&&s<=e.maxBitRate[a])return e.level}const v=3;function w(e){const t=new u.A(e,!0);t.skip(22);let r=[],i=[],s=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=63&t.readUint8(),a=t.readUint16(),o=[];for(let e=0;e<a;e++){const e=t.readUint16();o.push(t.readBuffer(e))}32===e?r=o:33===e?i=o:34===e&&(s=o)}return{vpss:r,spss:i,ppss:s}}function y(e,t,r){const i=t[0];let s=23;e.length&&(s+=3,s=e.reduce(((e,t)=>e+2+t.length),s)),t.length&&(s+=3,s=t.reduce(((e,t)=>e+2+t.length),s)),r.length&&(s+=3,s=r.reduce(((e,t)=>e+2+t.length),s));const a=new Uint8Array(s),o=new f.A(a,!0),n=E(i);o.writeUint8(1),o.writeUint8(i[1]),o.writeUint8(i[2]),o.writeUint8(i[3]),o.writeUint8(i[4]),o.writeUint8(i[5]),o.writeUint8(i[6]),o.writeUint8(i[7]),o.writeUint8(i[8]),o.writeUint8(i[9]),o.writeUint8(i[10]),o.writeUint8(i[11]),o.writeUint8(n.level),o.writeUint8(1020),o.writeUint8(0),o.writeUint8(16320),o.writeUint8(16320|n.chroma_format_idc),o.writeUint8(8160|n.bit_depth_luma_minus8),o.writeUint8(8160|n.bit_depth_chroma_minus8),o.writeUint16(0),o.writeUint8(8|(1&i[0])<<2|v);let c=0;return e.length&&c++,t.length&&c++,r.length&&c++,o.writeUint8(c),e.length&&(o.writeUint8(160),o.writeUint16(e.length),h.__(e,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),t.length&&(o.writeUint8(161),o.writeUint16(t.length),h.__(t,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),r.length&&(o.writeUint8(162),o.writeUint16(r.length),h.__(r,(e=>{o.writeUint16(e.length),o.writeBuffer(e)}))),a}function b(e){let t=s.py(e);if(t.length>=2){const e=[],r=[],i=[];if(t.forEach((t=>{const s=t[0]>>>1&63;32===s?e.push(t):33===s?r.push(t):34===s&&i.push(t)})),r.length&&i.length)return y(e,r,i)}}function k(e){let t=s.py(e);if(t.length>=2){const e=[],r=[],i=[];if(t.forEach((t=>{const s=t[0]>>>1&63;32===s?e.push(t):33===s?r.push(t):34===s&&i.push(t)})),r.length&&i.length){const t=[r[0],i[0]];return e.length&&t.unshift(e[0]),s.nW(t,0)}}}function _(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!1,o=s.py(e);if(o.length){const e=[],s=[],a=[];o.forEach((t=>{const r=t[0]>>>1&63;32===r?e.push(t):33===r?s.push(t):34===r&&a.push(t),19!==r&&20!==r&&21!==r||(i=!0)})),s.length&&a.length?(t=y(e,s,a),o=o.filter((e=>{const t=e[0]>>>1&63;return(r||32!==t&&33!==t&&34!==t)&&35!==t}))):o=o.filter((e=>35!=(e[0]>>>1&63)))}const n=o.reduce(((e,t)=>e+v+1+t.length),0),c=(0,a.sY)(n),h=(0,d.s3)(c,n);return s.S9(o,v,h),{bufferPointer:c,length:n,extradata:t,key:i}}function I(e,t,r,i){const o=[s.Le(e,0),s.Le(t,0),s.Le(r,0),s.Le(i,2)];let n=o.reduce(((e,t)=>e+t),0);const h=(0,a.sY)(n+7);let l=h;return c.w8((l+=1,l-1),0),c.w8((l+=1,l-1),0),c.w8((l+=1,l-1),0),c.w8((l+=1,l-1),1),c.w8((l+=1,l-1),70),c.w8((l+=1,l-1),1),c.w8((l+=1,l-1),80),e.length&&(s.nW(e,0,(0,d.s3)(l,o[0])),l+=o[0]),t.length&&(s.nW(t,0,(0,d.s3)(l,o[1])),l+=o[1]),r.length&&(s.nW(r,0,(0,d.s3)(l,o[2])),l+=o[2]),i.length&&s.nW(i,2,(0,d.s3)(l,o[3])),{bufferPointer:h,length:n+7}}function x(e,t){let r=s.py(e).concat(s.py(t));if(r.length){let e=[],t=[],i=[],s=[];return r.forEach((r=>{const a=r[0]>>>1&63;32===a?e.push(r):33===a?t.push(r):34===a?i.push(r):35!==a&&s.push(r)})),I(e,t,i,s)}}function M(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v;t&&(r=3&t[21]);let i=[],a=[],o=[],n=!1;if(t){const e=w(t);i=e.vpss,a=e.spss,o=e.ppss,n=!0}const c=s.wN(e,r).filter((e=>35!=(e[0]>>>1&63))),d=[];return c.forEach((e=>{const t=e[0]>>>1&63;33!==t||a.length?34!==t||o.length?35!==t&&d.push(e):o.push(e):a.push(e),19!==t&&20!==t||(n=!0)})),{...I(i,a,o,d),key:n}}function P(e,t){let r;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&s.Bs(t))h.__(s.py(t),(e=>{if(33==(e[0]>>>1&63))return r=e,!1}));else if(t&&t.length>=6){const{spss:e}=w(t);e.length&&(r=e[0])}if(r){const{profile:t,level:i,width:s,height:a,video_delay:o,chroma_format_idc:n,bit_depth_luma_minus8:c}=E(r);switch(e.codecpar.profile=t,e.codecpar.level=i,e.codecpar.width=s,e.codecpar.height=a,e.codecpar.videoDelay=o,c){case 0:e.codecpar.format=3===n?5:2===n?4:0;break;case 2:e.codecpar.format=3===n?68:2===n?64:62}}}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&i.f[15](e+36))return s.py((0,d.s3)(i.f[20](e+24),i.f[15](e+28))).some((e=>{const t=e[0]>>>1&63;return 20===t||19===t||21===t}));{const r=i.f[15](e+28);let s=0;for(;s<r-t;){const r=n.r8(i.f[20](e+24)+(s+t))>>>1&63;if(20===r||19===r||21===r)return!0;s+=4===t?n.Sg(i.f[20](e+24)+s):3===t?n.ht(i.f[20](e+24)+s):2===t?n.yd(i.f[20](e+24)+s):n.r8(i.f[20](e+24)+s),s+=t}return!1}}function E(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let r=0,i=0,a=0,n=0,c=0,d=0,h=1,u=0,f=0,m=0,g=0;const A=s.BN(e.subarray(t)),v=new l.A(A.length);v.appendBuffer(A),v.readU1(),v.readU(6),v.readU(6),v.readU(3),v.readU(4);const w=v.readU(3);v.readU1();let y=0;if(w<=6){u=v.readU(2),f=v.readU1(),r=v.readU(5),m=v.readU(32),g=v.readU(48),i=v.readU(8);const e=new Array(6),t=new Array(6);for(let r=0;r<w;r++)e[r]=v.readU1(),t[r]=v.readU1();if(w>0)for(let e=w;e<8;e++)v.readU(2);for(let r=0;r<w;r++)e[r]&&(v.readU(2),v.readU(1),v.readU(5),v.readU(32),v.readU(1),v.readU(1),v.readU(1),v.readU(1),v.readU(44)),t[r]&&v.readU(8);o.xb(v),h=o.xb(v),3===h&&(y=v.readU(1)),a=o.xb(v),n=o.xb(v);let s=0,l=0,p=0,A=0;v.readU1()&&(s=o.xb(v),l=o.xb(v),p=o.xb(v),A=o.xb(v)),c=o.xb(v),d=o.xb(v);let b=2,k=2;0===h?b=k=0:2===h?(b=2,k=1):3===h&&(b=k=1),a-=b*(1<<c+1)*(s+l),n-=k*(1<<c+1)*(p+A)}const b=o.xb(v)+4;let k=0;for(let e=v.readU1()?0:w;e<w+1;e++)o.xb(v),k=Math.max(k,Math.min(o.xb(v),p)),o.xb(v);const _=o.xb(v)+3,I=o.xb(v),x=o.xb(v)+2,M=o.xb(v),P=_+I,T=_-1,E=a+(1<<P)-1>>P,B=n+(1<<P)-1>>P;return{profile:r,level:i,width:a,height:n,chroma_format_idc:h,bit_depth_luma_minus8:c,bit_depth_chroma_minus8:d,general_profile_space:u,general_tier_flag:f,general_profile_compatibility_flags:m,constraint_flags:g,separate_colour_plane_flag:y,log2_min_cb_size:_,log2_diff_max_min_coding_block_size:I,log2_min_tb_size:x,log2_diff_max_min_transform_block_size:M,log2_max_trafo_size:M+x,log2_ctb_size:P,log2_min_pu_size:T,ctb_width:E,ctb_height:B,ctb_size:E*B,min_cb_width:a>>_,min_cb_height:n>>_,min_tb_width:a>>x,min_tb_height:n>>x,min_pu_width:a>>T,min_pu_height:n>>T,log2_max_poc_lsb:b,video_delay:k}}function B(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);const r=s.BN(e.subarray(t)),i=new l.A(r.length);return i.appendBuffer(r),{pps_pic_parameter_set_id:o.xb(i),pps_seq_parameter_set_id:o.xb(i),dependent_slice_segment_flag:i.readU1(),output_flag_present_flag:i.readU1(),num_extra_slice_header_bits:i.readU(3)}}},4310:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(4467);class s{constructor(e){(0,i.A)(this,"timeout",void 0),(0,i.A)(this,"timer",void 0),(0,i.A)(this,"resolve",void 0),(0,i.A)(this,"reject",void 0),(0,i.A)(this,"startTime",void 0),this.timeout=e}then(e,t){this.resolve=e,this.reject=t,this.startTime=Date.now(),this.timer=setTimeout((()=>{this.resolve(Date.now()-this.startTime),this.timer=null}),1e3*this.timeout)}stop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.timer&&(clearTimeout(this.timer),this.timer=null,this.resolve&&e?this.resolve(Date.now()-this.startTime):this.reject&&!e&&this.reject(Date.now()-this.startTime))}reset(e){e&&(this.timeout=e),this.timer&&(clearTimeout(this.timer),this.timer=setTimeout((()=>{this.resolve(Date.now()-this.startTime),this.timer=null}),1e3*this.timeout))}}},4365:(e,t,r)=>{r.d(t,{GE:()=>k,Lv:()=>z,XI:()=>x,ce:()=>P,eq:()=>g,pv:()=>H,s_:()=>M,wE:()=>_});var i=r(5763),s=r(1621),a=r(2494),o=r(7921),n=r(3389),c=r(652),d=r(3064),h=r(882),l=r(5981),u=r(8288),f=r(7084),p=r(2990),m=r(6332);let g,A,v,w=-1,y=!0,b="",k=null,_=null,I=0,x=null,M=null,P=null,T=null,E=null,B=null,C=null,S=null,U=null,D=null,R=null,L=null,$={5:S,3:S,7:U,9:D,22:R,12:T,14:E,16:B,21:C};function F(){return!(!P||P.buffer===S.buffer)}function z(){return P.buffer}function O(){return F()&&Q(P.buffer),S}function V(){return F()&&Q(P.buffer),L}function N(e){return F()&&Q(P.buffer),$[e]}function W(){o.USE_THREADS?(g=O,A=V,v=N):(g=()=>S,A=()=>L,v=e=>$[e])}function Q(e){T=new Int8Array(e),E=new Int16Array(e),B=new Int32Array(e),C=new BigInt64Array(e),S=new Uint8Array(e),U=new Uint16Array(e),D=new Uint32Array(e),R=new BigUint64Array(e),L=new DataView(e),$={5:S,3:S,7:U,9:D,22:R,12:T,14:E,16:B,21:C}}function H(){return Atomics.add(D,n.hb>>>2,1)}!(0,m.A)()&&!(0,p.A)()||(0,m.A)()&&!o.USE_THREADS?function(){var e,t,r,p,m,g,T,E;if(W(),(0,l.A)((()=>M),A),(0,c.A)(v),P=null!==(e=a.TK.CHeap)&&void 0!==e&&e.Memory?a.TK.CHeap.Memory:new WebAssembly.Memory({initial:o.HEAP_INITIAL,maximum:o.HEAP_MAXIMUM,shared:o.USE_THREADS,address:"i32",index:"i32"}),"function"==typeof BigInt&&BigInt!==Number&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&o.USE_THREADS&&d.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),o.USE_THREADS&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&h.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),M=null!==(t=a.TK.CHeap)&&void 0!==t&&t.Allocator?a.TK.CHeap.Allocator:new i.A({buffer:P.buffer,memory:P,byteOffset:o.HEAP_OFFSET,maxHeapSize:64*o.HEAP_MAXIMUM*1024,growAllowed:!0,onResize:(e,t)=>(P.grow(t-e.byteLength>>>16),{buffer:P.buffer,byteOffset:o.HEAP_OFFSET})}),M.addUpdateHandle(Q),Q(M.getBuffer()),I=null!==(r=a.TK.CHeap)&&void 0!==r&&r.StackSize?a.TK.CHeap.StackSize:o.STACK_SIZE,_=null!==(p=a.TK.CHeap)&&void 0!==p&&p.StackTop?a.TK.CHeap.StackTop:M.malloc(I),k=null!==(m=a.TK.CHeap)&&void 0!==m&&m.StackPointer?a.TK.CHeap.StackPointer:new WebAssembly.Global({value:"i32",mutable:!0},_+I),x=null!==(g=a.TK.CHeap)&&void 0!==g&&g.Table?a.TK.CHeap.Table:new s.z,w=null!==(T=a.TK.CHeap)&&void 0!==T&&T.ThreadId?a.TK.CHeap.ThreadId:0,b=null!==(E=a.TK.CHeap)&&void 0!==E&&E.ThreadName?a.TK.CHeap.ThreadName:"main",!a.TK.CHeap)if(o.USE_THREADS)Atomics.store(D,n.hb>>>2,w+1),Atomics.store(B,n.II>>>2,0);else{D[n.hb>>>2]=w+1;let e=n.II>>>2;B[e]=0}a.TK.CHeap||(a.TK.CHeap={Allocator:M,Table:x,ThreadId:w,ThreadName:b,Memory:P,Config:o,StackSize:I,StackTop:_,StackPointer:k,isMainThread:!0}),y=!0}():(a.TK.CHeap={initThread:async function e(t){var r;W(),(0,l.A)((()=>M),A),(0,c.A)(v),P=t.memory,t.disableAsm||("function"==typeof BigInt&&BigInt!==Number&&(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&d.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM),(u.A.chrome&&u.A.checkVersion(u.A.majorVersion,"85",!0)||u.A.firefox&&u.A.checkVersion(u.A.majorVersion,"78",!0)||u.A.safari&&u.A.checkVersion(u.A.majorVersion,"15",!0)||f.A.ios&&u.A.checkVersion(f.A.version,"15",!0)||u.A.newEdge)&&h.Ts(P,o.HEAP_INITIAL,o.HEAP_MAXIMUM));var p;p=new i.A({buffer:P.buffer,memory:P,byteOffset:o.HEAP_OFFSET,maxHeapSize:64*o.HEAP_MAXIMUM*1024,growAllowed:!0,onResize:(e,t)=>(P.grow(t-e.byteLength>>>16),{buffer:P.buffer,byteOffset:o.HEAP_OFFSET})},!1),M&&M.removeUpdateHandle(Q),M=p,a.TK.CHeap&&(a.TK.CHeap.Allocator=M),M.addUpdateHandle(Q),Q(M.getBuffer()),t.stackPointer&&(I=t.stackSize,_=t.stackPointer,k=new WebAssembly.Global({value:"i32",mutable:!0},_+I),x=new s.z),w="number"==typeof t.id?t.id:Atomics.add(D,n.hb>>>2,1),b=null!==(r=t.name)&&void 0!==r?r:"anonymous",a.TK.CHeap={initThread:e,Allocator:M,Table:x,ThreadId:w,ThreadName:b,Memory:P,Config:o,StackSize:I,StackTop:_,StackPointer:k,isMainThread:!1},y=!1},isMainThread:!1,Config:o},y=!1)},4405:(e,t,r)=>{r.r(t),r.d(t,{decode:()=>n,encode:()=>a});const i="function"==typeof TextEncoder?new TextEncoder:null,s="function"==typeof TextDecoder?new TextDecoder:null;function a(e){if(i)return i.encode(e);const t=[];for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++r)),i<=127?t.push(i):i<=2047?(t.push(192|i>>6),t.push(128|63&i)):i<=65535?(t.push(224|i>>12),t.push(128|i>>6&63),t.push(128|63&i)):(t.push(240|i>>18),t.push(128|i>>12&63),t.push(128|i>>6&63),t.push(128|63&i))}return new Uint8Array(t)}function o(e){let t="";for(let r=0;r<e.length;){let i=e[r++>>>0];if(!(128&i)){t+=String.fromCharCode(i);continue}let s=63&e[r++>>>0];if(192==(224&i)){t+=String.fromCharCode((31&i)<<6|s);continue}let a=63&e[r++>>>0];if(i=224==(240&i)?(15&i)<<12|s<<6|a:(7&i)<<18|s<<12|a<<6|63&e[r++>>>0],i<65536)t+=String.fromCharCode(i);else{let e=i-65536;t+=String.fromCharCode(55296|e>>10,56320|1023&e)}}return t}function n(e){if(e instanceof Uint8Array&&s&&!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))try{return s.decode(e)}catch(t){return o(e)}return o(e)}},4467:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(9922);function s(e,t,r){return(t=(0,i.A)(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},4566:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(2494);function s(e,t){return e!=i.Cq&&e.toString?e.toString():t!==i.ZH?t:i.u1}},4624:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(3389),s=r(9882);function a(){return s.WQ(i.hf,1,9,2)}},4659:(e,t,r)=>{r.d(t,{C:()=>s});var i=r(8288);function s(e){return e?!i.A.chrome||i.A.checkVersion(i.A.majorVersion,"94",!0)?"prefer-hardware":"allow":!i.A.chrome||i.A.checkVersion(i.A.majorVersion,"94",!0)?"prefer-software":"deny"}},4824:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(9983),s=r(3139);function a(e){if(0!==i.f[15](e))return!1;const t=(0,s.I)(i.f[15](e+28));return!(!t||t.comp[0].depth<=8||18!==i.f[15](e+92)&&16!==i.f[15](e+92))}},4875:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(3262);const s=399;function a(e){return e<360?1001*(e+1):(e-=360)<30?1001*(e+31)*12:(e-=30)<3?1001*[80,120,240][e]*12:1e3*[24,30,60,12,15,48][e-=3]*12}function o(e){let t=0,r=.01;for(let o=0;o<s;o++){const s=Math.abs((0,i.lb)(e)/(0,i.lb)({num:a(o),den:12012})-1);s<r&&(r=s,t=a(o))}if(t){const r={num:t,den:12012};(0,i.iU)(r),e.num=r.num,e.den=r.den}}},4897:(e,t,r)=>{r.d(t,{Ko:()=>h,LK:()=>c,Ts:()=>l});var i=r(4200),s=r(3669),a=r(9658),o=r(9906);const n="packages/cheap/src/webassembly/runtime/asm/thread.ts";let c,d=!0;function h(){return d}function l(e,t,r,h){try{if(!("function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer))return void(d=!1);{const o=a.bx(s.E_(i.A),{shared:!0,initial:t,maximum:r});c=new WebAssembly.Instance(new WebAssembly.Module(o),{env:{memory:e}})}h({wasm_pthread_mutex_lock:c.exports.lock,wasm_pthread_mutex_trylock:c.exports.trylock,wasm_pthread_mutex_unlock:c.exports.unlock,wasm_pthread_cond_wait:c.exports.wait,wasm_pthread_cond_timedwait:c.exports.timedwait,wasm_pthread_cond_signal:c.exports.signal,wasm_pthread_cond_broadcast:c.exports.broadcast})}catch(e){d=!1,o.R8("thread asm not support, cannot use asm thread function",n,67)}}},4916:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(4467);class s{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576;(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"bitPointer",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),this.pointer=0,this.bitPointer=0,this.size=e,this.error=0,this.pos=BigInt(0),this.buffer=new Uint8Array(this.size)}writeU1(e){(this.remainingLength()<1||1===this.remainingLength()&&this.bitPointer>=8)&&this.flush(),1&e?this.buffer[this.pointer]|=1<<7-this.bitPointer:this.buffer[this.pointer]&=~(1<<7-this.bitPointer),this.bitPointer++,8===this.bitPointer&&(this.pointer++,this.pos++,this.bitPointer=0)}writeU(e,t){for(let r=0;r<e;r++)this.writeU1(t>>e-r-1&1)}remainingLength(){return this.size-this.pointer}flush(){if(!this.onFlush)throw this.error=-1048574,Error("BSWriter error, flush failed because of no flush callback");if(this.pointer)if(this.bitPointer&&this.pointer>0){const e=this.onFlush(this.buffer.subarray(0,this.pointer).slice());if(0!==e)throw this.error=e,Error("BSWriter error, flush failed");this.buffer[0]=this.buffer[this.pointer]}else if(0===this.bitPointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("BSWriter error, flush failed")}this.pointer=0}padding(){for(;0!==this.bitPointer;)this.writeU1(0)}reset(){this.pointer=0,this.bitPointer=0,this.error=0,this.pos=BigInt(0)}getBuffer(){return this.buffer}getPointer(){return this.pointer}getPos(){return this.pos}}},5041:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(2494);class a{constructor(e,t){(0,i.A)(this,"type",void 0),(0,i.A)(this,"phase",void 0),(0,i.A)(this,"ns",void 0),(0,i.A)(this,"target",void 0),(0,i.A)(this,"originalEvent",void 0),(0,i.A)(this,"isPrevented",void 0),(0,i.A)(this,"isStopped",void 0),(0,i.A)(this,"listener",void 0),this.type=e,this.phase=a.PHASE_CURRENT,t&&(this.originalEvent=t)}preventDefault(){const e=this;if(!e.isPrevented){const{originalEvent:t}=e;t&&t.preventDefault(),e.isPrevented=s.rT}return e}stopPropagation(){const e=this;if(!e.isStopped){const{originalEvent:t}=e;t&&t.stopPropagation(),e.isStopped=s.rT}return e}prevent(){return this.preventDefault()}stop(){return this.stopPropagation()}}(0,i.A)(a,"PHASE_CURRENT",0),(0,i.A)(a,"PHASE_UPWARD",1),(0,i.A)(a,"PHASE_DOWNWARD",s.Cy)},5055:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(9983),s=r(2320),a=r(4187),o=r(1755),n=r(3674),c=r(1237),d=r(8636);function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;0===t&&(t=(0,a._5)()),s.M[17](t+8,BigInt(Math.floor(e.timestamp))),s.M[15](t+76,c.SF),s.M[15](t+72,1),s.M[17](t+48,null==e.duration?c.Dh:BigInt(Math.floor(e.duration)));const h=(0,o.sY)(e.byteLength);if(e.copyTo((0,n.s3)(h,e.byteLength)),(0,a.NX)(t,h,e.byteLength),r){var l;if(null!==(l=r.decoderConfig)&&void 0!==l&&l.description){let e;e=r.decoderConfig.description instanceof ArrayBuffer?new Uint8Array(r.decoderConfig.description):new Uint8Array(r.decoderConfig.description.buffer);const i=(0,o.sY)(e.length);(0,n.lW)(i,e.length,e),(0,a.Ow)(t,1,i,e.length)}if(r.alphaSideData){const e=(0,o.sY)(r.alphaSideData.byteLength+8);let i;i=r.alphaSideData instanceof ArrayBuffer?new Uint8Array(r.alphaSideData):new Uint8Array(r.alphaSideData.buffer),d.Cv(h,BigInt(1)),(0,n.lW)(e+8,i.length,i),(0,a.Ow)(t,15,e,i.length)}}"key"===e.type&&s.M[15](t+36,1|i.f[15](t+36))}},5074:(e,t,r)=>{r.d(t,{pt:()=>m});var i=r(9983),s=r(3139),a=r(3262),o=r(1237),n=r(4365),c=r(665),d=r(1730);const h=c.BE(d.GR),l=c.BE(d.OG),u=c.BE(d.SY),f=c.BE(d.re);function p(e){var t,r,s;const a={fullRange:!1,matrix:null!==(t=u[i.f[15](e+220)])&&void 0!==t?t:null,primaries:null!==(r=l[i.f[15](e+212)])&&void 0!==r?r:null,transfer:null!==(s=f[i.f[15](e+216)])&&void 0!==s?s:null};return 2===i.f[15](e+208)&&(a.fullRange=!0),a}function m(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=i.f[15](e+72);const l=(0,s.I)(i.f[15](e+80)),u=[];for(let t=0;t<l.comp.length;t++)u.push({offset:i.f[20](e+4*t),stride:i.f[15](e+32+4*t)});const f=c.X$({codedWidth:i.f[15](e+68),codedHeight:d,timestamp:Number(t||(0,a.Mr)(i.f[17](e+104),e+120,o.KR)),format:(m=i.f[15](e+80),null!==(g=h[m])&&void 0!==g?g:null),duration:Number((0,a.Mr)(i.f[17](e+312),e+120,o.KR)),layout:u,colorSpace:p(e),visibleRect:{x:i.f[25](e+276),y:i.f[25](e+268),width:i.f[15](e+68)-(i.f[25](e+276)+i.f[25](e+280)),height:i.f[15](e+72)-(i.f[25](e+268)+i.f[25](e+272))}},r);var m,g;return new VideoFrame((0,n.Lv)(),f)}},5134:(e,t,r)=>{function i(){let e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){let r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:3&r|8).toString(16)}))}r.d(t,{A:()=>i})},5238:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(4467),s=r(495),a=r(1058),o=r(9906);class n{constructor(e){(0,i.A)(this,"resampler",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"inputParameters",void 0),(0,i.A)(this,"outputParameters",void 0),this.options=e,this.resampler=new a.A(this.options.resource)}async open(e,t){this.inputParameters=e,this.outputParameters=t,await this.resampler.run(),this.resampler.invoke("resample_set_input_parameters",e.sampleRate,e.channels,e.format,e.layout||0),this.resampler.invoke("resample_set_output_parameters",t.sampleRate,t.channels,t.format,t.layout||0);let r=this.resampler.invoke("resample_init");return r<0?(o.z3(`open resampler failed, ret: ${r}`,"packages/audioresample/src/Resampler.ts",82),s.nr):0}resample(e,t,r){return this.resampler.invoke("resample_process",e,t,r)}getOutputSampleCount(e){return this.resampler.invoke("resample_nb_sample",e)}close(){this.resampler.invoke("resample_destroy"),this.resampler.destroy()}getInputPCMParameters(){return this.inputParameters}getOutputPCMParameters(){return this.outputParameters}}},5256:(e,t,r)=>{r.d(t,{A:()=>P});var i=r(9983),s=r(2320),a=r(1228),o=r(6890),n=r(7145),c=r(2935),d=r(495),h=r(3262),l=r(714),u=r(2364),f=r(1003),p=r(8696),m=r(7683),g=r(3463),A=r(8590),v=r(3321),w=r(665),y=r(9906),b=r(6332),k=r(4310),_=r(8413),I=r(1959),x=r(17);const M="packages/avpipeline/src/VideoEncodePipeline.ts";class P extends x.A{constructor(){super()}createWebcodecEncoder(e){var t;let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new I.A({onError:t=>{e.targetEncoder===e.hardwareEncoder?(e.targetEncoder=e.softwareEncoder,e.hardwareEncoder.close(),e.hardwareEncoder=null,e.encoderFallbackReady=this.openSoftwareEncoder(e),y.R8(`video encode error by hardware encoder, taskId: ${e.taskId}, error: ${t}, try to fallback to software encoder`,M,151)):y.z3(`video encode error by hardware encoder, taskId: ${e.taskId}, error: ${t}`,M,154)},onReceiveAVPacket(t){e.avpacketCaches.push(t),s.M[17](e.stats+152,i.f[17](e.stats+152)+BigInt(1))},enableHardwareAcceleration:r,avpacketPool:e.avpacketPool,avframePool:e.avframePool,copyTs:null!==(t=e.copyTs)&&void 0!==t&&t})}createWasmcodecEncoder(e,t){var r;return new _.A({resource:e.resource,onReceiveAVPacket(t){e.avpacketCaches.push(t),s.M[17](e.stats+152,i.f[17](e.stats+152)+BigInt(1))},avpacketPool:e.avpacketPool,copyTs:null!==(r=e.copyTs)&&void 0!==r&&r})}async createTask(e){const t=new c.Ay(e.leftPort),r=new c.Ay(e.rightPort),n=[],h=new f.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),v=new p.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex),b=await(0,u.A)(e.resource,!0);e.resourceExtraData&&w.X$(b,e.resourceExtraData);const x={...e,resource:b,leftIPCPort:t,rightIPCPort:r,softwareEncoder:null,hardwareEncoder:null,avpacketCaches:n,inputEnd:!1,encodeEnd:!1,targetEncoder:null,parameters:0,timeBase:null,encoderFallbackReady:null,softwareEncoderOpened:!1,gopCounter:0,firstEncoded:!1,avframePool:h,avpacketPool:v};if(x.softwareEncoder=x.resource?this.createWasmcodecEncoder(x,x.resource):g.A.videoEncoder?this.createWebcodecEncoder(x,!1):null,!x.softwareEncoder)return y.z3("software encoder not support",M,225),d.lh;g.A.videoEncoder&&e.enableHardware&&(x.hardwareEncoder=this.createWebcodecEncoder(x)),x.targetEncoder=x.hardwareEncoder||x.softwareEncoder,this.tasks.set(e.taskId,x);const P=[];let T;async function E(){if(!x.inputEnd){if(!P.length){T&&await T;const e=await t.request("pull",{preferVideoFrame:x.targetEncoder instanceof I.A&&x.firstEncoded});A.ai(e)&&e<0&&(x.inputEnd=!0),P.push(e)}P.length<4&&!T&&x.firstEncoded&&(T=t.request("pull",{preferVideoFrame:x.targetEncoder instanceof I.A&&x.firstEncoded}).then((e=>{A.ai(e)&&e<0&&(x.inputEnd=!0),P.push(e),T=null})))}return P.length?P.shift():-1048576}return r.on(c.S3,(async t=>{switch(t.method){case"pull":if(n.length){const e=n.shift();r.reply(t,e);break}if(!x.encodeEnd){for(;;){if(n.length){const e=n.shift();r.reply(t,e);break}if(x.encoderFallbackReady){let e=await x.encoderFallbackReady;if(e&&(x.targetEncoder===x.hardwareEncoder&&(x.targetEncoder=x.softwareEncoder,x.hardwareEncoder.close(),x.hardwareEncoder=null,e=await this.openSoftwareEncoder(x),y.R8(`video encode error by hardware encoder, taskId: ${x.taskId}, error: ${e}, try to fallback to software encoder`,M,295)),e)){y.pq(`video encoder open error, taskId: ${x.taskId}`,M,298),r.reply(t,d.r8);break}x.encoderFallbackReady=null}let a=await E();if(x.targetEncoder instanceof _.A&&a instanceof VideoFrame){const e=x.avframePool.alloc();await(0,l.lL)(a,e),a.close(),a=e}if(!((0,m.A)(a)||a instanceof VideoFrame)){if(x.encodeEnd=!0,-1048576===a){if(x.targetEncoder===x.hardwareEncoder?await Promise.race([new k.A(2),x.targetEncoder.flush()])&&y.R8(`video hardware encoder flush failed, ignore it, taskId: ${x.taskId}`,M,435):await x.targetEncoder.flush(),x.targetEncoder===x.hardwareEncoder&&await new k.A(0),n.length){const e=n.shift();r.reply(t,e);break}y.pq(`video encoder ended, taskId: ${x.taskId}`,M,451),r.reply(t,-1048576);break}y.z3(`video encoder pull avframe error, taskId: ${e.taskId}, ret: ${a}`,M,457),r.reply(t,a);break}{let o=!x.firstEncoded&&x.targetEncoder instanceof _.A?await x.targetEncoder.encodeAsync(a,0===x.gopCounter):x.targetEncoder.encode(a,0===x.gopCounter);if(o<0){if(s.M[15](x.stats+140,i.f[15](x.stats+140)+1),x.targetEncoder instanceof I.A&&x.softwareEncoder){if(y.R8(`video encode error from hardware, taskId: ${x.taskId}, error: ${o}, try to fallback to software decoder`,M,322),x.targetEncoder===x.hardwareEncoder)x.hardwareEncoder.close(),x.hardwareEncoder=null;else{if(!x.resource){y.z3(`cannot fallback to wasm video encoder because of resource not found , taskId: ${e.taskId}`,M,345),r.reply(t,d.r8);break}for(x.softwareEncoder.close(),x.softwareEncoder=this.createWasmcodecEncoder(x,x.resource),x.softwareEncoderOpened=!1,x.firstEncoded=!1;P.length&&P[0]instanceof VideoFrame&&(0,l.WA)(P[0].format)!==i.f[15](x.parameters+28);)P.shift().close()}try{await this.openSoftwareEncoder(x),x.targetEncoder=x.softwareEncoder}catch(i){y.z3(`video software encoder open error, taskId: ${e.taskId}`,M,354),r.reply(t,d.r8);break}if(x.gopCounter=0,o=x.targetEncoder instanceof _.A?await x.targetEncoder.encodeAsync(a,!0):x.targetEncoder.encode(a,!0),o<0&&x.targetEncoder instanceof I.A&&x.resource){y.R8(`video encode error from webcodecs soft encoder, taskId: ${x.taskId}, error: ${o}, try to fallback to wasm software encoder`,M,366),x.softwareEncoder.close(),x.softwareEncoder=this.createWasmcodecEncoder(x,x.resource),x.softwareEncoderOpened=!1,x.firstEncoded=!1,x.gopCounter=0;try{await this.openSoftwareEncoder(x),x.targetEncoder=x.softwareEncoder}catch(i){y.z3(`video software encoder open error, taskId: ${e.taskId}`,M,377),r.reply(t,d.r8);break}o=await x.targetEncoder.encodeAsync(a,!0)}}if(o<0){(0,m.A)(a)?x.avframePool.release(a):a.close(),y.z3(`video encode error, taskId: ${e.taskId}, ret: ${o}`,M,391),r.reply(t,o);break}}for(x.firstEncoded||!(x.targetEncoder instanceof I.A)&&x.resourceExtraData.enableThreadPool&&g.A.jspi&&!x.targetEncoder.getChildThreadCount()||(x.firstEncoded=!0),x.gopCounter++,x.gopCounter===x.gop&&(x.gopCounter=0),(0,m.A)(a)?x.avframePool.release(a):a.close();x.targetEncoder instanceof I.A&&x.targetEncoder.getQueueLength()>10;)await new k.A(0)}}break}y.pq(`video encoder ended, taskId: ${x.taskId}`,M,465),r.reply(t,-1048576)}})),0}async openSoftwareEncoder(e){if(e.softwareEncoder&&!e.softwareEncoderOpened){const t=e.parameters;let r=1;(0,b.A)()&&(r=Math.max(r,navigator.hardwareConcurrency));let i=await e.softwareEncoder.open(t,e.timeBase,r,e.wasmEncoderOptions);if(i){if(!(e.softwareEncoder instanceof I.A&&e.resource))return i;if(y.R8(`webcodecs software encoder open failed, error: ${i}, try to fallback to wasm software encoder`,M,486),e.softwareEncoder.close(),e.softwareEncoder=this.createWasmcodecEncoder(e,e.resource),i=await e.softwareEncoder.open(t,e.timeBase,r,e.wasmEncoderOptions),i)return i;e.targetEncoder=e.softwareEncoder}e.softwareEncoderOpened=!0,e.softwareEncoder instanceof _.A&&(e.firstEncoded=!1)}return 0}async open(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=this.tasks.get(e);if(s){if(s.wasmEncoderOptions=i,s.preferWebCodecs&&g.A.videoEncoder&&I.A.isSupported(t,!1)&&s.softwareEncoder instanceof _.A){s.softwareEncoder.close();const e=this.createWebcodecEncoder(s,!1);s.softwareEncoder===s.targetEncoder&&(s.targetEncoder=e),s.softwareEncoder=e}return new Promise((async(e,i)=>{if(s.hardwareEncoder){let e=await s.hardwareEncoder.open(t,r);e&&(y.z3(`cannot open hardware encoder, error: ${e}`,M,531),s.hardwareEncoder.close(),s.hardwareEncoder=null,s.targetEncoder=s.softwareEncoder)}if(s.parameters=t,s.timeBase=r,s.targetEncoder===s.softwareEncoder){let t=await this.openSoftwareEncoder(s);if(t&&(y.z3(`open video software encoder failed, error: ${t}`,M,544),!s.hardwareEncoder))return void e(d.r8)}e(0)}))}y.h2("task not found",M,554)}async resetTask(e){const t=this.tasks.get(e);t&&(t.targetEncoder===t.softwareEncoder?await t.targetEncoder.flush():t.targetEncoder===t.hardwareEncoder&&(t.hardwareEncoder.close(),t.hardwareEncoder=this.createWebcodecEncoder(t),await t.hardwareEncoder.open(t.parameters,t.timeBase),t.targetEncoder=t.hardwareEncoder),v.__(t.avpacketCaches,(e=>{t.avpacketPool.release(e)})),t.avpacketCaches.length=0,t.inputEnd=!1,t.encodeEnd=!1,y.pq(`reset video encode, taskId: ${t.taskId}`,M,577))}async getExtraData(e){const t=this.tasks.get(e);if(t)return t.targetEncoder.getExtraData();y.h2("task not found",M,586)}async getColorSpace(e){const t=this.tasks.get(e);if(t)return t.targetEncoder.getColorSpace();y.h2("task not found",M,594)}async registerTask(e){return this.tasks.has(e.taskId)?d.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.softwareEncoder&&t.softwareEncoder.close(),t.hardwareEncoder&&t.hardwareEncoder.close(),v.__(t.avpacketCaches,(e=>{t.avpacketPool.release(e)})),this.tasks.delete(e))}async getTasksInfo(){const e=[];return this.tasks.forEach((t=>{e.push({codecId:i.f[15](t.parameters+4),width:i.f[15](t.parameters+56),height:i.f[15](t.parameters+60),framerate:(0,h.lb)((0,o.A)(t.parameters+72,n.Q)),hardware:t.targetEncoder===t.hardwareEncoder})})),e}}},5267:(e,t,r)=>{r.d(t,{A:()=>A});var i=r(4467),s=r(9983),a=r(2320),o=r(495),n=r(3394),c=r(1237),d=r(714),h=r(2364),l=r(8590),u=r(9906),f=r(7683),p=r(6670),m=r(3554);const g="packages/avfilter/src/video/ScaleFilterNode.ts";class A extends m.A{constructor(e){super(e,1,1),(0,i.A)(this,"scaler",void 0)}async ready(){}async destroy(){this.scaler&&(this.scaler.close(),this.scaler=void 0)}async process(e,t,r){let i=e[0];if(l.ai(i)&&i<0)return void(t[0]=i);const m=(0,f.A)(i)?s.f[15](i+68):i.displayWidth,A=(0,f.A)(i)?s.f[15](i+72):i.displayHeight,v=(0,f.A)(i)?s.f[15](i+80):(0,d.WA)(i.format);if(m===this.options.output.width&&A===this.options.output.height&&(v===this.options.output.format||this.options.output.format===c.N_||-1===v||r&&r.preferVideoFrame&&!(0,f.A)(i)))if((0,f.A)(i)){const e=this.options.avframePool?this.options.avframePool.alloc():(0,n.FP)();(0,n.gg)(e,i),t[0]=e}else t[0]=i.clone();else{if(-1===v)return u.z3("src avframe format not support",g,77),void(t[0]=o.E$);const r=this.options.avframePool?this.options.avframePool.alloc():(0,n.FP)();if(this.scaler){const e=this.scaler.getInputScaleParameters();e.width===m&&e.height===A&&e.format===v||(this.scaler.close(),this.scaler=void 0)}if(!this.scaler){let e=this.options.resource;l.sv(e)&&(e=await(0,h.A)(e)),this.scaler=new p.A({resource:e});const r=await this.scaler.open({width:m,height:A,format:v},{width:this.options.output.width,height:this.options.output.height,format:this.options.output.format!==c.N_?this.options.output.format:23!==v||(0,f.A)(i)?v:0});if(r)return u.z3(`open scaler failed, error ${r}`,g,120),void(t[0]=o.E$)}(0,f.A)(i)||(i=await(0,d.lL)(e[0],this.options.avframePool?this.options.avframePool.alloc():(0,n.FP)())),this.scaler.scale(i,r),(0,n.Cj)(r,i),a.M[15](r+68,this.options.output.width),a.M[15](r+72,this.options.output.height),a.M[15](r+80,this.options.output.format),t[0]=r,(0,f.A)(e[0])||(this.options.avframePool?this.options.avframePool.release(i):(0,n.xj)(i))}}}},5280:(e,t,r)=>{r.d(t,{A:()=>$});var i=r(9983),s=r(2320),a=r(1228),o=r(6890),n=r(7145),c=r(2935),d=r(495),h=r(4187),l=r(1755),u=r(8588),f=r(3262),p=r(1237),m=r(2836),g=r(2171),A=r(2364),v=r(1003),w=r(8696),y=r(1497),b=r(4229),k=r(4096),_=r(3674),I=r(7683),x=r(3463),M=r(8590),P=r(3321),T=r(9906),E=r(1762),B=r(6332),C=r(4310),S=r(245),U=r(3995),D=r(17),R=r(1787);const L="packages/avpipeline/src/VideoDecodePipeline.ts";class $ extends D.A{constructor(){super()}createWebCodecDecoder(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new U.A({onError:t=>{e.hardwareRetryCount>3||!e.firstDecoded?e.targetDecoder===e.hardwareDecoder?(e.targetDecoder=e.softwareDecoder,e.hardwareDecoder.close(),e.hardwareDecoder=null,e.decoderFallbackReady=this.openSoftwareDecoder(e),T.R8(`video decode error by hardware decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}, error: ${t}, try to fallback to software decoder`,L,176)):e.targetDecoder===e.softwareDecoder&&(e.softwareDecoder.close(),e.softwareDecoder=this.createWasmcodecDecoder(e,e.resource),e.softwareDecoderOpened=!1,e.decoderFallbackReady=this.openSoftwareDecoder(e),T.R8(`video decode error by software(webcodecs) decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}, error: ${t}, try to fallback to software(wasm) decoder`,L,183)):(e.hardwareRetryCount++,e.targetDecoder===e.hardwareDecoder?(T.pq(`retry open hardware decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}`,L,189),e.decoderFallbackReady=e.hardwareDecoder.open(e.parameters)):e.targetDecoder===e.softwareDecoder&&(T.pq(`retry open software(webcodecs) decoder(${e.hardwareRetryCount}), taskId: ${e.taskId}`,L,193),e.decoderFallbackReady=e.softwareDecoder.open(e.parameters))),e.needKeyFrame=!0,e.leftIPCPort.request("requestKeyframe")},onReceiveVideoFrame(t,r){r&&(t.alpha=r),e.firstDecoded=!0,e.frameCaches.push(t),s.M[17](e.stats+144,i.f[17](e.stats+144)+BigInt(1)),e.lastDecodeTimestamp!==p.N_&&(s.M[15](e.stats+256,Math.max((0,E.A)()-e.lastDecodeTimestamp,i.f[15](e.stats+256))),e.lastDecodeTimestamp=p.N_)},enableHardwareAcceleration:t,optimizeForLatency:e.preferLatency,alpha:e.keepAlpha?"keep":"discard"})}createWasmcodecDecoder(e,t){return new S.A({resource:t,onReceiveAVFrame(t){e.firstDecoded=!0,e.frameCaches.push(t),s.M[17](e.stats+144,i.f[17](e.stats+144)+BigInt(1)),e.lastDecodeTimestamp!==p.N_&&(s.M[15](e.stats+256,Math.max((0,E.A)()-e.lastDecodeTimestamp,i.f[15](e.stats+256))),e.lastDecodeTimestamp=p.N_)},avframePool:e.avframePool})}async pullAVPacketInternal(e,t){const r=await t.request("pull");if(M.ai(r)||(0,I.A)(r))return r;{const t=e.avpacketPool.alloc();return(0,u.r0)(r,t),t}}async createTask(e){const t=new c.Ay(e.leftPort),r=new c.Ay(e.rightPort),n=[],u=new v.A((0,o.A)(e.avframeList,a.A),e.avframeListMutex),f={...e,resource:await(0,A.A)(e.resource,!0),leftIPCPort:t,rightIPCPort:r,softwareDecoder:null,hardwareDecoder:null,frameCaches:n,inputEnd:!1,targetDecoder:null,needKeyFrame:!0,parameters:0,hardwareRetryCount:0,lastDecodeTimestamp:0,firstDecoded:!1,decoderFallbackReady:null,softwareDecoderOpened:!1,discard:0,playRate:1,avframePool:u,avpacketPool:new w.A((0,o.A)(e.avpacketList,a.A),e.avpacketListMutex)};if(f.softwareDecoder=f.resource?this.createWasmcodecDecoder(f,f.resource):x.A.videoDecoder?this.createWebCodecDecoder(f,!1):null,!f.softwareDecoder)return T.z3("software decoder not support",L,292),d.lh;function m(e,t){M.ai(t)||(0,I.A)(t)?r.reply(e,t):(0,R.z)(t)?r.reply(e,{ref:t,alpha:t.alpha},null,[t,t.alpha]):r.reply(e,t,null,[t])}return x.A.videoDecoder&&e.enableHardware&&(f.hardwareDecoder=this.createWebCodecDecoder(f)),f.targetDecoder=f.hardwareDecoder||f.softwareDecoder,this.tasks.set(e.taskId,f),r.on(c.S3,(async a=>{switch(a.method){case"pull":if(n.length){m(a,n.shift());break}if(!f.inputEnd){for(;;){if(n.length){m(a,n.shift());break}if(f.decoderFallbackReady){let e=await f.decoderFallbackReady;if(e&&(f.targetDecoder===f.hardwareDecoder&&(f.targetDecoder=f.softwareDecoder,f.hardwareDecoder.close(),f.hardwareDecoder=null,T.R8(`video decode error by hardware decoder(${f.hardwareRetryCount}), taskId: ${f.taskId}, error: ${e}, try to fallback to software decoder`,L,337),e=await this.openSoftwareDecoder(f)),e)){T.pq(`video decoder open error, taskId: ${f.taskId}`,L,341),r.reply(a,d.r8);break}f.decoderFallbackReady=null}f.lastDecodeTimestamp===p.N_&&(f.lastDecodeTimestamp=(0,E.A)());const o=await this.pullAVPacketInternal(f,t);if(-1048576===o){if(f.targetDecoder===f.hardwareDecoder?await Promise.race([new C.A(2),f.targetDecoder.flush()])&&T.R8(`video hardware decoder flush failed, ignore it, taskId: ${f.taskId}`,L,361):await f.targetDecoder.flush(),f.inputEnd=!0,f.targetDecoder===f.hardwareDecoder&&await new C.A(0),n.length){m(a,n.shift());break}T.pq(`video decoder ended, taskId: ${f.taskId}`,L,377),r.reply(a,-1048576);break}if(!(o>0)){T.z3(`video decode pull avpacket error, taskId: ${e.taskId}, ret: ${o}`,L,522),r.reply(a,o);break}{if(f.needKeyFrame){if(!(1&i.f[15](o+36)&&27!==i.f[15](f.parameters+4)||27===i.f[15](f.parameters+4)&&y.mW(o,i.f[20](f.parameters+12)?1+(3&g.r8(i.f[20](f.parameters+12)+4)):4)||173===i.f[15](f.parameters+4)&&b.mW(o,i.f[20](f.parameters+12)?1+(3&g.r8(i.f[20](f.parameters+12)+21)):4)||196===i.f[15](f.parameters+4)&&k.mW(o,i.f[20](f.parameters+12)?1+(g.r8(i.f[20](f.parameters+12))>>>1&3):4))){f.avpacketPool.release(o);continue}f.needKeyFrame=!1,s.M[15](o+36,1|i.f[15](o+36))}let t=f.targetDecoder.decode(o);if(1&i.f[15](o+36)){const e=(0,h.rU)(o,1);0!==e&&(i.f[20](f.parameters+12)&&(0,l.Eb)(i.f[20](f.parameters+12)),s.M[15](f.parameters+16,0|i.f[25](e+4)),s.M[20](f.parameters+12,(0,l.sY)(i.f[25](e+4))),(0,_.Mr)(i.f[20](f.parameters+12),i.f[20](e),i.f[25](e+4)))}if(t<0){if(s.M[15](f.stats+136,i.f[15](f.stats+136)+1),f.targetDecoder instanceof U.A&&f.softwareDecoder){if(T.R8(`video decode error from hardware, taskId: ${f.taskId}, error: ${t}, try to fallback to software decoder`,L,443),f.targetDecoder===f.hardwareDecoder)f.hardwareDecoder.close(),f.hardwareDecoder=null;else{if(!f.resource){T.z3(`cannot fallback to wasm video decoder because of resource not found , taskId: ${e.taskId}`,L,455),r.reply(a,d.r8);break}f.softwareDecoder.close(),f.softwareDecoder=this.createWasmcodecDecoder(f,f.resource),f.softwareDecoderOpened=!1}try{await this.openSoftwareDecoder(f),f.targetDecoder=f.softwareDecoder}catch(t){T.z3(`video software decoder open error, taskId: ${e.taskId}`,L,465),r.reply(a,d.r8);break}if(!(1&i.f[15](o+36))){f.avpacketPool.release(o),f.needKeyFrame=!0,f.leftIPCPort.request("requestKeyframe");continue}if(t=f.targetDecoder.decode(o),t>=0){f.avpacketPool.release(o);continue}if(f.targetDecoder instanceof U.A&&f.resource){T.R8(`video decode error by webcodecs soft decoder, taskId: ${f.taskId}, error: ${t}, try to fallback to wasm software decoder`,L,479),f.softwareDecoder.close(),f.softwareDecoder=this.createWasmcodecDecoder(f,f.resource),f.softwareDecoderOpened=!1;try{await this.openSoftwareDecoder(f),f.targetDecoder=f.softwareDecoder}catch(t){T.z3(`video wasm software decoder open error, taskId: ${e.taskId}`,L,489),r.reply(a,d.r8);break}if(t=f.targetDecoder.decode(o),t>=0){f.avpacketPool.release(o);continue}}}f.avpacketPool.release(o),T.z3(`video decode error, taskId: ${e.taskId}, ret: ${t}`,L,508),r.reply(a,t);break}for(f.avpacketPool.release(o);f.targetDecoder instanceof U.A&&f.targetDecoder.getQueueLength()>20;)await new C.A(0)}}break}T.pq(`video decoder ended, taskId: ${f.taskId}`,L,529),r.reply(a,-1048576)}})),0}async openSoftwareDecoder(e){if(e.softwareDecoder&&!e.softwareDecoderOpened){const t=e.parameters;let r=1;if((0,B.A)()){let e=i.f[15](t+56)*i.f[15](t+60),s=(0,f.lb)((0,o.A)(t+72,n.Q));e>=2073600&&e<=2211840?(173!==i.f[15](t+4)&&196!==i.f[15](t+4)&&225!==i.f[15](t+4)||(r=2),s>30?(r=2,173!==i.f[15](t+4)&&196!==i.f[15](t+4)&&225!==i.f[15](t+4)||(r=4)):s>60&&(r=4,173!==i.f[15](t+4)&&196!==i.f[15](t+4)&&225!==i.f[15](t+4)||(r=6))):e>2211840&&e<=8294400?(r=4,173!==i.f[15](t+4)&&196!==i.f[15](t+4)&&225!==i.f[15](t+4)||(r=6)):e>8294400&&(r=6,173!==i.f[15](t+4)&&196!==i.f[15](t+4)&&225!==i.f[15](t+4)||(r=8)),r=Math.min(r,navigator.hardwareConcurrency)}T.Yz(`open software(${e.softwareDecoder instanceof U.A?"webcodecs":"wasm"}) decoder`,L,594);let s=await e.softwareDecoder.open(t,r,e.wasmDecoderOptions);if(s){if(!(e.softwareDecoder instanceof U.A&&e.resource))return s;if(T.R8(`webcodecs software decoder open failed, ${s}, try to fallback to wasm software decoder`,L,600),e.softwareDecoder.close(),e.softwareDecoder=this.createWasmcodecDecoder(e,e.resource),s=await e.softwareDecoder.open(t,r),s)return s;e.targetDecoder=e.softwareDecoder}e.softwareDecoderOpened=!0}return 0}async reopenDecoder(e,t,r,i){const s=this.tasks.get(e);if(s){const e=(0,l.Gy)(168);let a;(0,I.A)(t)?(0,m.Yi)(e,t):(0,u.T8)(t,e),s.parameters&&(0,m.dn)(s.parameters),s.parameters=e,i&&(s.wasmDecoderOptions=i),r&&(r=await(0,A.A)(r,!0)),a=s.preferWebCodecs&&x.A.videoDecoder&&U.A.isSupported(e,!1)?this.createWebCodecDecoder(s,!1):r?this.createWasmcodecDecoder(s,r):x.A.videoDecoder?this.createWebCodecDecoder(s,!1):null;let o=x.A.videoDecoder&&s.enableHardware?this.createWebCodecDecoder(s,!0):null;return new Promise((async(t,i)=>{if(s.softwareDecoder&&s.softwareDecoder.close(),s.hardwareDecoder&&s.hardwareDecoder.close(),s.softwareDecoder=a,s.hardwareDecoder=o,s.targetDecoder=s.hardwareDecoder||s.softwareDecoder,s.hardwareRetryCount=0,s.hardwareDecoder){const t=await s.hardwareDecoder.open(e);t?(T.z3(`cannot reopen hardware decoder, ${t}, taskId: ${s.taskId}`,L,676),s.hardwareDecoder.close(),s.hardwareDecoder=null,s.targetDecoder=s.softwareDecoder):T.Yz(`reopen video hardware decoder, taskId: ${s.taskId}`,L,682)}if(r&&(s.resource=r),s.targetDecoder===s.softwareDecoder){const e=await this.openSoftwareDecoder(s);if(e){if(T.z3(`reopen video software decoder failed, error: ${e}`,L,693),!s.hardwareDecoder)return void t(d.r8)}else T.Yz(`reopen video soft decoder, taskId: ${s.taskId}`,L,700)}t(0)}))}T.h2("task not found",L,706)}async open(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=this.tasks.get(e);if(i){i.wasmDecoderOptions=r;const e=(0,l.Gy)(168);if((0,I.A)(t)?(0,m.Yi)(e,t):(0,u.T8)(t,e),i.parameters&&(0,m.dn)(i.parameters),i.parameters=e,i.preferWebCodecs&&x.A.videoDecoder&&U.A.isSupported(e,!1)&&i.softwareDecoder instanceof S.A){i.softwareDecoder.close();const e=this.createWebCodecDecoder(i,!1);i.softwareDecoder===i.targetDecoder&&(i.targetDecoder=e),i.softwareDecoder=e}return new Promise((async(t,r)=>{if(i.hardwareDecoder){T.Yz("open hardware decoder",L,741);const t=await i.hardwareDecoder.open(e);t&&(T.R8(`cannot open hardware decoder, ${t}, try to open software decoder`,L,744),i.hardwareDecoder.close(),i.hardwareDecoder=null,i.targetDecoder=i.softwareDecoder)}if(i.targetDecoder===i.softwareDecoder){const e=await this.openSoftwareDecoder(i);if(e&&(T.z3(`open video software decoder failed, error: ${e}`,L,754),!i.hardwareDecoder))return void t(d.r8)}t(0)}))}T.h2("task not found",L,764)}async setPlayRate(e,t){const r=this.tasks.get(e);if(r&&r.softwareDecoder){let e=0,i=(0,f.lb)((0,o.A)(r.parameters+72,n.Q));e=i>=120?t<=1?0:t<1.5||t<3?8:32:i>=60?t<1.5?0:t<3?8:t<8?24:32:t>=8?32:t>=4?24:0,r.softwareDecoder.setSkipFrameDiscard(e),r.playRate<t?r.discard=e:r.discard=Math.max(r.discard,e),r.playRate=t}}async setNextDiscard(e){const t=this.tasks.get(e);t&&t.softwareDecoder&&t.discard<32&&(t.discard+=8,t.softwareDecoder.setSkipFrameDiscard(t.discard),T.pq(`set next discard, taskId: ${t.taskId}, discard: ${t.discard}`,L,831))}async setPrevDiscard(e){const t=this.tasks.get(e);t&&t.softwareDecoder&&t.discard>0&&(t.discard-=8,t.softwareDecoder.setSkipFrameDiscard(t.discard),T.pq(`set prev discard, taskId: ${t.taskId}, discard: ${t.discard}`,L,843))}async resetTask(e){const t=this.tasks.get(e);t&&(t.targetDecoder===t.softwareDecoder?await t.targetDecoder.flush():t.targetDecoder===t.hardwareDecoder&&(t.hardwareDecoder.close(),t.hardwareDecoder=this.createWebCodecDecoder(t),await t.hardwareDecoder.open(t.parameters)&&T.h2("reopen hardware decoder failed",L,860),t.targetDecoder=t.hardwareDecoder),P.__(t.frameCaches,(e=>{(0,I.A)(e)?t.avframePool.release(e):(e.close(),(0,R.z)(e)&&e.alpha.close())})),t.frameCaches.length=0,t.needKeyFrame=!0,t.inputEnd=!1,t.lastDecodeTimestamp=(0,E.A)(),T.pq(`reset video decoder, taskId: ${t.taskId}`,L,880))}async registerTask(e){return this.tasks.has(e.taskId)?d.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.rightPort.close(),t.leftPort.close(),t.softwareDecoder&&t.softwareDecoder.close(),t.hardwareDecoder&&t.hardwareDecoder.close(),t.frameCaches.forEach((e=>{(0,I.A)(e)?t.avframePool.release(e):(e.close(),(0,R.z)(e)&&e.alpha.close())})),t.parameters&&(0,m.dn)(t.parameters),this.tasks.delete(e),T.Yz(`unregisterTask task, taskId: ${e}`,L,917))}async getTasksInfo(){const e=[];return this.tasks.forEach((t=>{e.push({codecId:i.f[15](t.parameters+4),width:i.f[15](t.parameters+56),height:i.f[15](t.parameters+60),framerate:(0,f.lb)((0,o.A)(t.parameters+72,n.Q)),hardware:t.targetDecoder===t.hardwareDecoder})})),e}}},5316:(e,t,r)=>{let i;function s(e){i.getRandomValues(e)}r.d(t,{A:()=>s}),"undefined"!=typeof crypto&&(i=crypto)},5419:(e,t,r)=>{r.d(t,{Tl:()=>p,Ts:()=>h,bh:()=>u,eu:()=>d,s2:()=>l,yh:()=>f,zr:()=>m});var i,s=r(4467),a=r(7127),o=r(7601),n=r(9882),c=r(6332);class d{constructor(){(0,s.A)(this,"atomic",void 0)}}function h(e){return n.M_(e,0,16,2),0}function l(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(0!==(t=n.p_(e,0,1,16,2)))do{2!=t&&0===n.p_(e,1,2,16,2)||!r&&(0,c.A)()&&n.uk(e,2)}while(0!==(t=n.p_(e,0,2,16,2)));return 0}function u(e){return 0===n.p_(e,0,1,16,2)?0:16}async function f(e){let t;if(0!==(t=n.p_(e,0,1,16,2)))do{2!=t&&0===n.p_(e,1,2,16,2)||await n.of(e,2)}while(0!==(t=n.p_(e,0,2,16,2)));return 0}function p(e){return 1!==n.jb(e,1,16,2)&&(n.M_(e,0,16,2),n.me(e,1)),0}function m(e){return n.M_(e,0,16,2),0}i=d,(()=>{const e=i.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,4),(0,o.A)(e,a.JY,t)})()},5465:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(8590);class a{constructor(){(0,i.A)(this,"proxy",void 0),this.proxy=new Proxy(this,{get:(e,t,r)=>s.sH(t)?e.getIndexValue(+t):e[t],set:(e,t,r,i)=>(s.sH(t)?e.setIndexValue(+t,r):e[t]=r,!0)})}}},5633:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(3669);let s=WebAssembly.validate(i.E_("AGFzbQEAAAABBgFgAX8BfwISAQNlbnYGbWVtb3J5AgMBgIACAwIBAAcJAQVsb2FkOAAACgoBCAAgAP4SAAAL")),a=WebAssembly.validate(i.E_("AGFzbQEAAAABBQFgAAF7AhIBA2VudgZtZW1vcnkCAwGAgAIDAgEACgoBCABBAP0ABAAL"));function o(e,t,r){let i=a?"-simd":s?"-atomic":"";switch(t){case"decoder":if(r>65536&&r<=65572)return`${e}/decode/pcm${i}.wasm`;if(r>=69632&&r<=69683)return`${e}/decode/adpcm${i}.wasm`;switch(r){case 2:return`${e}/decode/mpeg2video${i}.wasm`;case 27:return`${e}/decode/h264${i}.wasm`;case 30:return`${e}/decode/theora${i}.wasm`;case 86018:return`${e}/decode/aac${i}.wasm`;case 86019:return`${e}/decode/ac3${i}.wasm`;case 86056:return`${e}/decode/eac3${i}.wasm`;case 86020:return`${e}/decode/dca${i}.wasm`;case 86017:return`${e}/decode/mp3${i}.wasm`;case 173:return`${e}/decode/hevc${i}.wasm`;case 196:return`${e}/decode/vvc${i}.wasm`;case 12:return`${e}/decode/mpeg4${i}.wasm`;case 225:return`${e}/decode/av1${i}.wasm`;case 86051:return`${e}/decode/speex${i}.wasm`;case 86076:return`${e}/decode/opus${i}.wasm`;case 86028:return`${e}/decode/flac${i}.wasm`;case 86021:return`${e}/decode/vorbis${i}.wasm`;case 139:return`${e}/decode/vp8${i}.wasm`;case 167:return`${e}/decode/vp9${i}.wasm`;case 86022:return`${e}/decode/dvaudio${i}.wasm`;case 24:return`${e}/decode/dvvideo${i}.wasm`;case 3:return`${e}/decode/h261${i}.wasm`;case 4:case 20:case 19:return`${e}/decode/h263${i}.wasm`;case 14:case 15:case 16:case 5:case 6:case 68:case 69:return`${e}/decode/msmpeg4${i}.wasm`;case 86036:case 86057:case 86073:return`${e}/decode/ra${i}.wasm`;case 86023:case 86024:case 86052:case 86054:case 86053:return`${e}/decode/wma${i}.wasm`;case 17:case 18:case 71:return`${e}/decode/wmv${i}.wasm`;case 7:return`${e}/decode/mjpeg${i}.wasm`;case 61:return`${e}/decode/png${i}.wasm`;case 171:return`${e}/decode/webp${i}.wasm`;case 97:return`${e}/decode/gif${i}.wasm`;case 96:return`${e}/decode/tiff${i}.wasm`;case 78:return`${e}/decode/bmp${i}.wasm`;default:return null}case"encoder":if(r>65536&&r<=65572)return`${e}/encode/pcm${i}.wasm`;switch(r){case 27:return`${e}/encode/x264${i}.wasm`;case 30:return`${e}/encode/theora${i}.wasm`;case 86018:return`${e}/encode/aac${i}.wasm`;case 86019:return`${e}/encode/ac3${i}.wasm`;case 86056:return`${e}/encode/eac3${i}.wasm`;case 86020:return`${e}/encode/dca${i}.wasm`;case 86017:return`${e}/encode/mp3lame${i}.wasm`;case 173:return`${e}/encode/x265${i}.wasm`;case 12:return`${e}/encode/mpeg4${i}.wasm`;case 225:return`${e}/encode/av1${i}.wasm`;case 86051:return`${e}/encode/speex${i}.wasm`;case 86076:return`${e}/encode/opus${i}.wasm`;case 86028:return`${e}/encode/flac${i}.wasm`;case 86021:return`${e}/encode/vorbis${i}.wasm`;case 139:return`${e}/encode/vp8${i}.wasm`;case 167:return`${e}/encode/vp9${i}.wasm`;default:return null}case"resampler":return`${e}/resample/resample${i}.wasm`;case"scaler":return`${e}/scale/scale${i}.wasm`;case"stretchpitcher":return`${e}/stretchpitch/stretchpitch${i}.wasm`}}},5725:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(3554);class a{constructor(e){(0,i.A)(this,"nodePort",void 0),(0,i.A)(this,"inputNode",void 0),this.nodePort=new s.t(e)}getFreeInputNodePort(){return{index:0,port:this.nodePort}}addInputPeer(e){this.inputNode=e}}},5763:(e,t,r)=>{r.d(t,{A:()=>f});var i=r(4467),s=r(5419),a=r(3389),o=r(3321),n=r(665),c=r(9906);const d="packages/cheap/src/allocator/AllocatorJS.ts",h=A(16),l=32,u=68;class f{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var r,s,a,o;(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"byteOffset",void 0),(0,i.A)(this,"heapOffset",void 0),(0,i.A)(this,"heapLength",void 0),(0,i.A)(this,"int32Array",void 0),(0,i.A)(this,"updates",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"shared",void 0),(0,i.A)(this,"handles",void 0),this.options=n.X$({growSize:1048576,maxHeapSize:2097152e3},e),this.handles=[],this.buffer=e.buffer,this.shared=!1,this.options.memory||this.buffer instanceof ArrayBuffer||this.buffer instanceof SharedArrayBuffer?(this.byteOffset=null!==(r=e.byteOffset)&&void 0!==r?r:0,this.heapOffset=w(this.byteOffset+g(l),null!==(s=e.byteLength)&&void 0!==s?s:this.buffer.byteLength),this.heapLength=y((null!==(a=e.byteLength)&&void 0!==a?a:this.buffer.byteLength)-this.heapOffset),this.int32Array=new Int32Array(this.buffer,this.heapOffset,A(this.heapLength)),this.updates=new Int32Array(this.buffer,this.byteOffset,l),"function"==typeof SharedArrayBuffer&&this.buffer instanceof SharedArrayBuffer&&(this.shared=!0)):c.h2("Expected buffer to be an instance of Buffer or ArrayBuffer",d,112),t&&(this.updates.fill(1),function(e){return 65===e[0]&&65===e[66]}(o=this.int32Array)||function(e){const t=e.length-69;_(e,65,1),e[1]=1,e[3]=68;for(let t=1;t<l;t++)e[3+t]=1;_(e,t,68),e[68]=1,e[70]=1}(o),function(e){let t=u;for(;t<e.length-1;){const r=k(e,t);r<2||r>=e.length-u?c.h2(`Got invalid sized chunk at ${g(t)} (${g(r)} bytes).`,d,568):M(e,t)?p(e,t,r):m(e,t,r),t+=r+2}}(this.int32Array))}addUpdateHandle(e){o.zy(this.handles,e)||this.handles.push(e)}removeUpdateHandle(e){o.TF(this.handles,e)}malloc_(e){(e=v(e,7))<16&&(e=16);const t=A(e),r=this.findFreeBlock(this.int32Array,t);if(r<=1)return 0;const i=k(this.int32Array,r);return i-(t+2)>=h?function(e,t,r,i,s){const a=t+r+2,o=i-(a-t);x(e,t,i,s),e[t-1]=-r,e[t+r]=-r,e[a-1]=-o,e[a+o]=-o,E(e,a,o,s)}(this.int32Array,r,t,i,this.updates):x(this.int32Array,r,i,this.updates),g(r)+this.heapOffset}malloc(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const t=this.malloc_(e);return this.shared&&(0,s.Tl)(a.II),t}calloc_(e,t){let r=e*t;r=r<16?16:v(r,7);const i=this.malloc_(r);if(0===i)return 0;const s=A(i-this.heapOffset);return this.int32Array.subarray(s,s+A(r)).fill(0),i}calloc(e,t){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const r=this.calloc_(e,t);return this.shared&&(0,s.Tl)(a.II),r}realloc_(e,t){if(0===e)return this.malloc_(t);const r=e;if(0===t)return this.free_(r),0;let i=A(e-=this.heapOffset),s=i,a=0;P(this.int32Array,i)&&(s=this.int32Array[i-1],a=i-s);const o=k(this.int32Array,s)-a;if(o>=A(v(t,7)))return r;{const e=this.malloc_(t);return 0===e?(this.free_(r),0):(this.int32Array.set(this.int32Array.subarray(i,i+o),A(e-this.heapOffset)),this.free_(r),e)}}realloc(e,t){return this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer()),e=this.realloc_(e,t),this.shared&&(0,s.Tl)(a.II),e}alignedAlloc_(e,t){if(e<=8)return this.malloc_(t);const r=this.malloc_(t+e-1+4);if(0===r)return 0;const i=r+e-1+4&~(e-1);return this.int32Array[A(i-this.heapOffset)-1]=A(r-this.heapOffset),i}alignedAlloc(e,t){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const r=this.alignedAlloc_(e,t);return this.shared&&(0,s.Tl)(a.II),r}free_(e){if(0===e)return;let t=A(e-=this.heapOffset);if(P(this.int32Array,t)&&(t=this.int32Array[t-1]),M(this.int32Array,t))return;const r=k(this.int32Array,t),i=T(this.int32Array,t),s=function(e,t){const r=k(e,t);if(t+r+2>=e.length-2)return 0;const i=t+r+2;return e[i-1]<2?0:i}(this.int32Array,t);0!==i?0!==s?function(e,t,r,i,s,a){const o=k(e,t),n=k(e,s),c=s-t+n;x(e,t,o,a),x(e,s,n,a),e[t-1]=-c,e[s+n]=-c,E(e,t,c,a)}(this.int32Array,i,0,0,s,this.updates):B(this.int32Array,i,t,r,this.updates):0!==s?function(e,t,r,i,s){const a=k(e,t);x(e,t,a,s);const o=i+a+2;e[r-1]=-o,e[t+a]=-o,E(e,r,o,s)}(this.int32Array,s,t,r,this.updates):E(this.int32Array,t,r,this.updates)}free(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer()),this.free_(e),this.shared&&(0,s.Tl)(a.II)}sizeof(e){if(0===e)return 0;let t=A(e-=this.heapOffset);return P(this.int32Array,t)&&(t=this.int32Array[t-1]),g(k(this.int32Array,t))}inspect(){return this.checkBuffer(),function(e,t){const r=[],i=b(e,1,t);let s=u,a=0;for(;s<e.length-1;){const i=k(e,s);(i<2||i>=e.length)&&c.h2(`Got invalid sized chunk at ${g(s)} (${g(i)})`,d,624),M(e,s)?r.push(b(e,s,t)):(a+=g(i),r.push({type:"used",block:s,offset:g(s)+t,size:g(i)})),s+=i+2}return{header:i,blocks:r,total:g(e.length),used:a}}(this.int32Array,this.heapOffset)}findFreeBlock(e,t){let r=function(e,t){let r=1;for(let i=e[1];i>0;i--){let s=e[r+2+(i-1)];for(;1!==s&&e[s-1]<t;)r=s,s=e[r+2+(i-1)]}return r=e[r+2],r}(e,t);if(1===r){if(this.options.growAllowed&&this.heapLength<this.options.maxHeapSize){const e=this.int32Array.length+1;let r,n,c=0,d=0,h=0;if(this.options.onResize){var i,s,a;const e=this.options.onResize(this.int32Array,this.int32Array.byteLength+v(Math.max(this.options.growSize,g(t)),7));c=null!==(i=e.byteOffset)&&void 0!==i?i:0,h=w(c+g(l),null!==(s=e.byteLength)&&void 0!==s?s:e.buffer.byteLength),d=y((null!==(a=e.byteLength)&&void 0!==a?a:e.buffer.byteLength)-h),r=new Int32Array(e.buffer,h,A(d)),n=new Int32Array(e.buffer,c,l)}else{const e=new ArrayBuffer(this.int32Array.length+A(this.options.growSize));h=w(c+g(l),e.byteLength),d=y(e.byteLength-h),r=new Int32Array(e,h,A(d)),r.set(this.int32Array,0),n=new Int32Array(e,c,l)}this.byteOffset=c,this.heapOffset=h,this.buffer=r.buffer,this.heapLength=d,this.int32Array=r,this.updates=n;const u=r.length-(e-1)-2;_(r,u,e);const f=T(r,e);return 0!==f?B(r,f,e,u,this.updates):E(r,e,u,this.updates),this.handles.length&&o.__(this.handles,(e=>{e(this.buffer)})),this.findFreeBlock(this.int32Array,t)}return r}return r}getBuffer(){return this.buffer}isAlloc(e){this.shared&&((0,s.s2)(a.II,!0),this.checkBuffer());const t=A(e-this.heapOffset);let r=this.int32Array[3];for(;r&&1!==r;){if(t>=r&&t<r+this.int32Array[r-1])return this.shared&&(0,s.Tl)(a.II),!1;r=this.int32Array[r+2]}return this.shared&&(0,s.Tl)(a.II),!0}checkBuffer(){this.options.memory&&this.options.memory.buffer!==this.buffer&&(this.buffer=this.options.memory.buffer,this.heapLength=y(this.buffer.byteLength-this.heapOffset),this.int32Array=new Int32Array(this.buffer,this.heapOffset,A(this.heapLength)))}}function p(e,t,r){e[t-1]!==e[t+r]&&c.h2(`Block length header does not match footer (${g(e[t-1])} vs ${g(e[t+r])}).`,d,584);const i=e[t+0];(i<1||i>l)&&c.h2(`Block ${g(t)} height must be between 1 and 32, got ${i}.`,d,589);for(let r=0;r<i;r++){const i=e[t+2+r];i>=u&&!M(e,i)&&c.h2(`Block ${g(t)} has a pointer to a non-free block (${g(i)}).`,d,595)}return!0}function m(e,t,r){if(e[t-1]===e[t+r])return!0;c.h2(`Block length header does not match footer (${g(e[t-1])} vs ${g(e[t+r])}).`,d,604)}function g(e){return e<<2>>>0}function A(e){return e>>>2}function v(e,t){return(e+t&~t)>>>0}function w(e,t){const r=t-e;return e+(v(r,7)===r?0:r-v(r,7)+8)}function y(e){return e-4}function b(e,t,r){const i=e[t+0],s=[];for(let r=0;r<i;r++)s.push(e[t+2+r]);return{type:"free",block:t,offset:g(t)+r,height:i,pointers:s,size:g(e[t-1])}}function k(e,t){const r=e[t-1],i=r>>31;return r+i^i}function _(e,t,r){e[r-1]=t,e[r+t]=t}function I(e,t,r){let i=1;for(let s=e[1];s>0;s--){let a=i+2+(s-1);for(;e[a]>=u&&e[e[a]-1]<t;)i=e[a],a=i+2+(s-1);r[s-1]=i}}function x(e,t,r,i){I(e,r,i);let s=e[i[0]+2];for(;s!==t&&1!==s&&e[s-1]<=r;){for(let r=e[s+0]-1;r>=0;r--)e[s+2+r]===t&&(i[r]=s);s=e[s+2]}let a=e[1];for(let r=0;r<a&&e[i[r]+2+r]===t;r++)e[i[r]+2+r]=e[t+2+r];for(;a>0&&1===e[a-1+3];)a--,e[1]=a;e[t-1]=-r,e[t+r]=-r}function M(e,t){return!(t<65)&&!(e[t-1]<0)}function P(e,t){return!(t<65)&&!(e[t-1]<0)}function T(e,t){if(t<=u)return 0;const r=e[t-2];return r<2?0:t-(2+r)}function E(e,t,r,i){I(e,r,i);const s=function(e,t,r,i){const s=e[1];let a=function(){let e=1;for(;Math.random()<.5&&e<l;)e+=1;return e}();if(r-1<a+1&&(a=r-2),a>s){const r=s+1;return e[1]=r,e[r-1+3]=1,i[r]=1,e[t+0]=r,r}return e[t+0]=a,a}(e,t,r,i);for(let r=1;r<=s;r++){const s=i[r-1]+2+(r-1);e[t+2+(r-1)]=e[s],e[s]=t,i[r-1]=1}return e[t-1]=r,e[t+r]=r,r}function B(e,t,r,i,s){const a=r-t+i;return x(e,t,r-t-2,s),e[t-1]=-a,e[r+i]=-a,E(e,t,a,s),i}},5782:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(3321);function s(e){if(e.length<2)return 0;const t=e.slice().sort(((e,t)=>e>t?1:-1));let r=0,s=0,a=[];for(let o=0;o<e.length;o++){for(i._(a,e[o],(t=>t<e[o]?1:-1));a.length&&a[0]===t[s];)a.shift(),s++;r=Math.max(r,a.length)}return r}},5815:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(3737),a=r(4405);class o{constructor(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"byteStart",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}readUint8(){return this.data.getUint8(this.pos+++this.byteStart)}peekUint8(){return this.data.getUint8(this.pos+this.byteStart)}readUint16(){const e=this.data.getUint16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,e}peekUint16(){return this.data.getUint16(this.pos+this.byteStart,this.littleEndian)}readUint24(){const e=this.readUint16(),t=this.readUint8();return this.littleEndian?t<<16|e:e<<8|t}peekUint24(){const e=this.readUint16(),t=this.readUint8();return this.pos-=3,this.littleEndian?t<<16|e:e<<8|t}readUint32(){const e=this.data.getUint32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekUint32(){return this.data.getUint32(this.pos+this.byteStart,this.littleEndian)}readUint64(){const e=BigInt(this.readUint32()),t=BigInt(this.readUint32());return this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}peekUint64(){const e=BigInt(this.readUint32()),t=BigInt(this.readUint32());return this.pos-=8,this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}readInt8(){return this.data.getInt8(this.pos+++this.byteStart)}peekInt8(){return this.data.getInt8(this.pos+this.byteStart)}readInt16(){const e=this.data.getInt16(this.pos+this.byteStart,this.littleEndian);return this.pos+=2,e}peekInt16(){return this.data.getInt16(this.pos+this.byteStart,this.littleEndian)}readInt24(){const e=this.readUint24();return 8388608&e?e-16777216:e}peekInt24(){const e=this.peekUint24();return 8388608&e?e-16777216:e}readInt32(){const e=this.data.getInt32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekInt32(){return this.data.getInt32(this.pos+this.byteStart,this.littleEndian)}readInt64(){const e=BigInt(this.readInt32()),t=BigInt(this.readInt32());return this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}peekInt64(){const e=BigInt(this.readInt32()),t=BigInt(this.readInt32());return this.pos-=8,this.littleEndian?t<<BigInt(32)|e:e<<BigInt(32)|t}readFloat(){const e=this.data.getFloat32(this.pos+this.byteStart,this.littleEndian);return this.pos+=4,e}peekFloat(){return this.data.getFloat32(this.pos+this.byteStart,this.littleEndian)}readDouble(){const e=this.data.getFloat64(this.pos+this.byteStart,this.littleEndian);return this.pos+=8,e}peekDouble(){return this.data.getFloat64(this.pos+this.byteStart,this.littleEndian)}readHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";for(let r=0;r<e;r++){const e=this.readUint8().toString(16);t+=1===e.length?"0"+e:e}return t}peekHex(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.pos,r=this.readHex(e);return this.pos=t,r}readString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t="";if(e){let r=this.pos;for(let t=0;t<e&&0===this.buffer[this.pos+t];t++)r++;t=a.decode(this.buffer.subarray(r,r+e))}return this.pos+=e,t}peekString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.pos,r=this.readString(e);return this.pos=t,r}readLine(){let e="";for(let t=this.pos;t<this.size;t++)if(10===this.buffer[t]||13===this.buffer[t]){e+=this.readString(t-this.pos);break}for(let e=this.pos;e<this.size&&(10===this.buffer[e]||13===this.buffer[e]);e++)this.readUint8();return e}peekLine(){const e=this.pos,t=this.readLine();return this.pos=e,t}getPos(){return BigInt(this.pos)}seek(e){e>this.size&&(e=this.size),this.pos=Math.max(0,e)}skip(e){this.seek(this.pos+e)}back(e){this.seek(this.pos-e)}remainingSize(){return this.size-this.pos}readBuffer(e){e=Math.min(e,this.remainingSize());const t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t}appendBuffer(e){this.buffer=(0,s.A)(Uint8Array,[this.buffer.slice(),e.slice()]),this.data=new DataView(this.buffer.buffer),this.size+=e.byteLength,this.byteStart=0}resetBuffer(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffer=e,this.data=e instanceof Uint8Array?new DataView(e.buffer):e.view,this.byteStart=e instanceof Uint8Array?e.byteOffset:0,this.pos=0,this.size=e.byteLength,this.littleEndian=!t}}},5922:(e,t,r)=>{r.d(t,{A:()=>I});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(495),c=r(4187),d=r(3394),h=r(1755),l=r(3262),u=r(1237),f=r(9239),p=r(8842),m=r(9210),g=r(3674),A=r(7683),v=r(1058),w=r(3463),y=r(8590),b=r(665),k=r(9906);class _{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.A)(this,"parameters",void 0),(0,i.A)(this,"data",void 0),(0,i.A)(this,"planes",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"posEnd",void 0),(0,i.A)(this,"bufferLength",void 0),(0,i.A)(this,"bytesPerSample",void 0),(0,i.A)(this,"planar",void 0),(0,i.A)(this,"channels",void 0),(0,i.A)(this,"frameSize",void 0),(0,i.A)(this,"pts",void 0),(0,i.A)(this,"copyTs",!1),this.parameters=e,this.frameSize=t,this.copyTs=r,this.planar=p.K0(s.f[15](e+28)),this.planes=this.planar?s.f[15](e+116):1,this.channels=s.f[15](e+116),this.bufferLength=512e3,this.data=[];for(let e=0;e<this.planes;e++)this.data[e]=new Uint8Array(this.bufferLength);this.pos=0,this.posEnd=0,this.bytesPerSample=p.Dw(s.f[15](e+28)),this.pts=BigInt(0)}sendAVFrame(e){this.copyTs&&s.f[17](e+104)!==u.Dh&&0!==s.f[15](e+124)&&0!==s.f[15](e+120)&&this.posEnd-this.pos==0&&(this.pts=(0,l.Mr)(s.f[17](e+104),e+120,{num:1,den:s.f[15](this.parameters+136)}));const t=s.f[15](e+76)*this.bytesPerSample*(this.planar?1:this.channels);if(this.posEnd+t>=this.bufferLength){const e=this.posEnd-this.pos;for(let e=0;e<this.planes;e++)this.data[e].set(this.data[e].subarray(this.pos,this.posEnd),0);this.pos=0,this.posEnd=e}for(let r=0;r<this.planes;r++)this.data[r].set((0,g.s3)(s.f[20](e+4*r),t),this.posEnd);this.posEnd+=t}remainFrameSize(){const e=this.bytesPerSample*(this.planar?1:this.channels);return(this.posEnd-this.pos)/e}handleData(e,t){(0,d.to)(e),a.M[15](e+152,s.f[15](this.parameters+136)),a.M[15](e+76,this.frameSize),a.M[15](e+292,s.f[15](this.parameters+116)),a.M[15](e+80,s.f[15](this.parameters+28)),a.M[17](e+104,this.pts),a.M[15](e+124,s.f[15](this.parameters+136)),a.M[15](e+120,1),(0,d.rh)(e);for(let r=0;r<this.planes;r++)(0,g.lW)(s.f[20](e+4*r),s.f[15](e+32),this.data[r].subarray(this.pos,this.pos+t));this.pos+=t,this.pts+=BigInt(0|this.frameSize)}receiveAVFrame(e){const t=this.frameSize*this.bytesPerSample*(this.planar?1:this.channels);return this.posEnd-this.pos<t?-1:(this.handleData(e,t),0)}flush(e){const t=this.posEnd-this.pos,r=t/(this.bytesPerSample*(this.planar?1:this.channels));return this.handleData(e,t),p.wj(e,r,s.f[15](this.parameters+28),this.frameSize-r,s.f[15](this.parameters+116)),0}}class I{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"encoder",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"timeBase",void 0),(0,i.A)(this,"avpacket",0),(0,i.A)(this,"avframe",0),(0,i.A)(this,"pts",BigInt(0)),(0,i.A)(this,"frameSize",0),(0,i.A)(this,"audioFrameResizer",void 0),(0,i.A)(this,"encoderOptions",0),(0,i.A)(this,"ptsQueue",[]),this.options=e,this.encoder=new v.A(this.options.resource)}getAVPacket(){return this.avpacket?this.avpacket:this.avpacket=this.options.avpacketPool?this.options.avpacketPool.alloc():(0,c._5)()}outputAVPacket(){if(this.avpacket){let e=this.ptsQueue.shift();void 0!==e&&e!==u.Dh||(e=this.pts),a.M[17](this.avpacket+8,e),a.M[17](this.avpacket+16,e),this.pts=e+s.f[17](this.avpacket+48),a.M[15](this.avpacket+76,this.timeBase.den),a.M[15](this.avpacket+72,this.timeBase.num),this.options.onReceiveAVPacket(this.avpacket),this.avpacket=0}}receiveAVPacket(){return this.encoder.invoke("encoder_receive",this.getAVPacket())}async open(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};await this.encoder.run();const i=o.s_.malloc(8),c=o.s_.malloc(4);a.M[15](i,t.num),a.M[15](i+4,t.den),a.M[20](c,0),this.encoder.invoke("encoder_set_flags",4194304),b.HP(r).length&&(this.encoderOptions&&(f.AO(this.encoderOptions),o.s_.free(this.encoderOptions),this.encoderOptions=0),this.encoderOptions=(0,h.Gy)(8),b.__(r,((e,t)=>{(y.Yj(e)||y.Yj(t))&&f.a5(this.encoderOptions,t,e)})),a.M[20](c,this.encoderOptions));let d=0;return w.A.jspi?d=await this.encoder.invokeAsync("encoder_open",e,i,1,c):(d=this.encoder.invoke("encoder_open",e,i,1,c),await this.encoder.childThreadsReady()),this.frameSize=this.encoder.invoke("encoder_get_framesize_size"),this.encoderOptions=s.f[20](c),o.s_.free(c),o.s_.free(i),d<0?(k.z3(`open audio encoder failed, ret: ${d}`,"packages/avcodec/src/wasmcodec/AudioEncoder.ts",283),n.r8):(this.parameters=e,this.timeBase=t,this.pts=BigInt(0),this.ptsQueue=[],0)}encode_(e){let t=this.encoder.invoke("encoder_encode",e);if(t)return t;for(s.f[17](e+104)===u.Dh||0===s.f[15](e+124)||0===s.f[15](e+120)?this.ptsQueue.push(u.Dh):this.ptsQueue.push((0,l.Mr)(s.f[17](e+104),e+120,this.timeBase));;){if(t=this.receiveAVPacket(),1!==t){if(t<0)return t;this.ptsQueue.length>1&&this.ptsQueue.pop();break}this.outputAVPacket()}return 0}encode(e){if(this.avframe?(0,d.to)(this.avframe):this.avframe=(0,d.FP)(),(0,A.A)(e)?((0,d.gg)(this.avframe,e),e=this.avframe):e=(0,m.t)(e,this.avframe),!(this.frameSize>0&&s.f[15](e+76)!==this.frameSize||this.audioFrameResizer))return this.encode_(e);for(this.audioFrameResizer||(this.audioFrameResizer=new _(this.parameters,this.frameSize,this.options.copyTs)),this.audioFrameResizer.sendAVFrame(e);;){let t=this.audioFrameResizer.receiveAVFrame(e);if(t<0)return 0;if(t=this.encode_(e),t)return t}}async flush(){if(this.audioFrameResizer&&this.audioFrameResizer.remainFrameSize()>0){const e=(0,d.FP)();this.audioFrameResizer.flush(e),a.M[17](e+104,(0,l.Mr)(s.f[17](e+104),e+120,this.timeBase)),this.encode_(e),(0,d.xj)(e)}for(this.encoder.invoke("encoder_flush",0);;){const e=this.receiveAVPacket();if(e<1)return e;this.outputAVPacket()}return 0}getExtraData(){const e=this.encoder.invoke("encoder_get_extradata"),t=this.encoder.invoke("encoder_get_extradata_size");return e&&t?(0,g.s3)(e,t).slice():null}close(){this.encoder.invoke("encoder_close"),this.encoder.destroy(),this.avpacket&&(this.options.avpacketPool?this.options.avpacketPool.release(this.avpacket):(0,c.Qe)(this.avpacket),this.avpacket=0),this.avframe&&((0,d.xj)(this.avframe),this.avframe=0),this.encoderOptions&&(f.AO(this.encoderOptions),o.s_.free(this.encoderOptions),this.encoderOptions=0)}}},5946:(e,t,r)=>{r.d(t,{A:()=>g});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(495),c=r(3394),d=r(1755),h=r(9239),l=r(1058),u=r(3463),f=r(8590),p=r(665),m=r(9906);class g{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"frame",0),(0,i.A)(this,"decoderOptions",0),(0,i.A)(this,"timeBase",void 0),this.options=e,this.decoder=new l.A(e.resource)}getAVFrame(){return this.frame?this.frame:this.frame=this.options.avframePool?this.options.avframePool.alloc():(0,c.FP)()}outputAVFrame(){this.frame&&(this.options.onReceiveAVFrame?(a.M[15](this.frame+124,this.timeBase.den),a.M[15](this.frame+120,this.timeBase.num),this.options.onReceiveAVFrame(this.frame)):this.options.avframePool?this.options.avframePool.release(this.frame):(0,c.xj)(this.frame),this.frame=0)}receiveAVFrame(){return this.decoder.invoke("decoder_receive",this.getAVFrame())}async open(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await this.decoder.run();const r=o.s_.malloc(4);a.M[20](r,0),p.HP(t).length&&(this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0),this.decoderOptions=(0,d.Gy)(8),p.__(t,((e,t)=>{(f.Yj(e)||f.Yj(t))&&h.a5(this.decoderOptions,t,e)})),a.M[20](r,this.decoderOptions));let i=0;return u.A.jspi?i=await this.decoder.invokeAsync("decoder_open",e,0,1,r):(i=this.decoder.invoke("decoder_open",e,0,1,r),await this.decoder.childThreadsReady()),this.decoderOptions=s.f[20](r),o.s_.free(r),i<0?(m.z3(`open audio decoder failed, ret: ${i}`,"packages/avcodec/src/wasmcodec/AudioDecoder.ts",133),n.r8):(this.timeBase=void 0,0)}decode(e){this.timeBase||(this.timeBase={den:s.f[15](e+76),num:s.f[15](e+72)});let t=this.decoder.invoke("decoder_decode",e);if(t)return t;for(;;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.invoke("decoder_flush");;){const e=this.receiveAVFrame();if(e<1)return e;this.outputAVFrame()}return 0}close(){this.decoder.invoke("decoder_close"),this.decoder.destroy(),this.frame&&(this.options.avframePool?this.options.avframePool.release(this.frame):(0,c.xj)(this.frame),this.frame=0),this.decoderOptions&&(h.AO(this.decoderOptions),o.s_.free(this.decoderOptions),this.decoderOptions=0)}}},5951:(e,t,r)=>{r.d(t,{X:()=>P,l:()=>M});var i=r(8085),s=r(9983),a=r(2320),o=r(7127),n=r(7332),c=r(8590),d=r(3321),h=r(665),l=r(4566);function u(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,configurable:!0,enumerable:!0})}function f(e){return function(){return s.f[20](e())}}function p(e,t,r,i){return function(){return e[`__$__${t}`]||(e[`__$__${t}`]=M(r(),i))}}function m(e,t){return function(){return s.f[t](e())}}function g(e,t,r,i){const a=8*n.i[t]-i-r,o=Math.pow(2,r)-1;return function(){return s.f[t](e())>>>a&o}}function A(e){return function(t){a.M[20](e(),t)}}function v(e,t,r,i){const s=`__$__${t}`;return function(t){const a=e[s]||(e[s]=M(r(),i));h.__(t,((e,t)=>{a[t]=e})),e[s]=a}}function w(e,t){return function(r){a.M[t](e(),r)}}function y(e,t,r,i){let o=0,c=8*n.i[t];for(let e=0;e<r;e++)o|=1<<c-1-(e+i);const d=Math.pow(2,r)-1,h=c-i-r;return function(r){const i=e(),n=s.f[t](i);a.M[t](i,n&~o|(r&d)<<h)}}function b(e,t,r){const s={};let a=(0,i.A)(r);for(let i=0;i<t;i++){const t=(0,l.A)(i);u(s,t,p(s,t,(()=>e()+a*i),r),v(s,t,(()=>e()+a*i),r))}return s}function k(e,t,r){const s={};let a=(0,i.A)(r);for(let i=0;i<t;i++)u(s,(0,l.A)(i),m((()=>e()+a*i),r),w((()=>e()+a*i),r));return s}function _(e,t,r,i,s){return function(){let a=t[`__$__${r}`];return a||(a=c.Pc(s)||c.Ik(s)?b(e,i,s):k(e,i,s),t[`__$__${r}`]=a),a[o.o9]=e(),a}}function I(e,t,r,i,s){const a=`__$__${t}`;return function(t){let n=e[a]||b(r,i,s);n[o.o9]=r(),d.__(t,((e,t)=>{n[t]=e})),e[a]=n}}function x(e,t,r,i,s){const a=`__$__${t}`;return function(t){let n=e[a]||k(r,i,s);n[o.o9]=r(),d.__(t,((e,t)=>{n[t]=e})),e[a]=n}}function M(e,t){let r=c.Pc(t)?t.prototype:t;const i={};for(i[o.o9]=e,Object.setPrototypeOf(i,r);;){let e=r[o.JY];if(e&&e.forEach(((e,t)=>{e[3]?e[1]?u(i,t,_((()=>i[o.o9]+e[7]),i,t,e[4],e[0]),x(i,t,(()=>i[o.o9]+e[7]),e[4],20)):c.Pc(e[0])||c.Ik(e[0])?u(i,t,_((()=>i[o.o9]+e[7]),i,t,e[4],e[0]),I(i,t,(()=>i[o.o9]+e[7]),e[4],e[0])):u(i,t,_((()=>i[o.o9]+e[7]),i,t,e[4],e[0]),x(i,t,(()=>i[o.o9]+e[7]),e[4],e[0])):e[1]?u(i,t,f((()=>i[o.o9]+e[7])),A((()=>i[o.o9]+e[7]))):c.Pc(e[0])||c.Ik(e[0])?u(i,t,p(i,t,(()=>i[o.o9]+e[7]),e[0]),v(i,t,(()=>i[o.o9]+e[7]),e[0])):e[5]?u(i,t,g((()=>i[o.o9]+e[7]),e[0],e[6],e[8]),y((()=>i[o.o9]+e[7]),e[0],e[6],e[8])):u(i,t,m((()=>i[o.o9]+e[7]),e[0]),w((()=>i[o.o9]+e[7]),e[0]))})),r=Object.getPrototypeOf(r),!r)break}return i}function P(e){let t=Object.getPrototypeOf(e);for(;;){let r=t[o.JY];if(r&&r.forEach(((t,r)=>{delete e[r]})),t=Object.getPrototypeOf(t),!t)break}}},5967:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(2494);function s(e){return e!==i.ZH}},5979:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(3365);class a extends s.A{constructor(){super(...arguments),(0,i.A)(this,"info",void 0),(0,i.A)(this,"socket",void 0)}async send(e){return this.socket?(this.socket.send(e.slice()),0):-1048574}open(e){return this.info=e,this.status=1,new Promise((t=>{var r;this.socket=new WebSocket(e.url,null===(r=e.websocketOptions)||void 0===r?void 0:r.protocols),this.socket.binaryType="arraybuffer",this.socket.onopen=()=>{this.status=2,t(0)},this.socket.onerror=()=>{this.status=3,t(-1048573),this.consume&&this.consume()},this.socket.onclose=()=>{this.status=4,t(-1048576),this.consume&&this.consume()},this.socket.onmessage=e=>{let t=e.data;this.readQueue.push(new Uint8Array(t)),this.consume&&this.consume()}}))}seek(e,t){throw new Error("Method not implemented.")}size(){throw new Error("Method not implemented.")}async stop(){this.socket&&(this.socket.close(),this.socket=null),this.status=4,this.consume&&this.consume()}}},5981:(e,t,r)=>{r.d(t,{A:()=>C});var i=r(9983),s=r(2320);let a,o;const n=(0,r(7313).A)();function c(e,t){o().setUint8(e,t)}function d(e){return o().getUint8(e)}function h(e,t){o().setUint16(e,t,n)}function l(e){return o().getUint16(e,n)}function u(e,t){o().setUint32(e,t,n)}function f(e){return o().getUint32(e,n)}function p(e,t){o().setBigUint64(e,t,n)}function m(e){return o().getBigUint64(e,n)}function g(e,t){o().setInt8(e,t)}function A(e){return o().getInt8(e)}function v(e,t){o().setInt16(e,t,n)}function w(e){return o().getInt16(e,n)}function y(e,t){o().setInt32(e,t,n)}function b(e){return o().getInt32(e,n)}function k(e,t){o().setBigInt64(e,t,n)}function _(e){return o().getBigInt64(e,n)}function I(e,t){o().setFloat32(e,t,n)}function x(e){return o().getFloat32(e,n)}function M(e,t){o().setFloat64(e,t,n)}function P(e){return o().getFloat64(e,n)}function T(e){return o().getUint32(e,n)}function E(e,t){return o().setUint32(e,t,n)}function B(e,t){o().setUint32(e,t,n)}function C(e,t){a=e,o=t,(0,i.$)({4:d,5:d,2:d,3:d,6:l,7:l,8:f,9:f,10:m,11:A,12:A,13:w,14:w,15:b,16:b,17:_,18:x,19:P,20:T,23:e=>!!A(e),24:e=>!!A(e),25:e=>function(e){return o().getUint32(e,n)}(e)}),(0,s.$)({4:c,5:c,2:c,3:c,6:h,7:h,8:u,9:u,10:p,11:g,12:g,13:v,14:v,15:y,16:y,17:k,18:I,19:M,20:E,23:(e,t)=>{g(e,t?1:0)},24:(e,t)=>{g(e,t?1:0)},25:B})}},5992:(e,t,r)=>{r.d(t,{A:()=>f});var i,s=r(4467),a=r(7127),o=r(7601),n=r(6112),c=r(7145),d=r(8687),h=r(1237),l=r(2836),u=r(8517);class f{constructor(){(0,s.A)(this,"codecType",-1),(0,s.A)(this,"codecId",0),(0,s.A)(this,"codecTag",0),(0,s.A)(this,"extradata",0),(0,s.A)(this,"extradataSize",0),(0,s.A)(this,"codedSideData",0),(0,s.A)(this,"nbCodedSideData",0),(0,s.A)(this,"format",h.N_),(0,s.A)(this,"bitrate",BigInt(0)),(0,s.A)(this,"bitsPerCodedSample",0),(0,s.A)(this,"bitsPerRawSample",0),(0,s.A)(this,"profile",h.N_),(0,s.A)(this,"level",h.N_),(0,s.A)(this,"width",0),(0,s.A)(this,"height",0),(0,s.A)(this,"sampleAspectRatio",new c.Q({den:1,num:1})),(0,s.A)(this,"framerate",new c.Q({den:1,num:0})),(0,s.A)(this,"fieldOrder",0),(0,s.A)(this,"colorRange",0),(0,s.A)(this,"colorPrimaries",2),(0,s.A)(this,"colorTrc",2),(0,s.A)(this,"colorSpace",2),(0,s.A)(this,"chromaLocation",0),(0,s.A)(this,"videoDelay",0),(0,s.A)(this,"chLayout",void 0),(0,s.A)(this,"sampleRate",h.N_),(0,s.A)(this,"blockAlign",0),(0,s.A)(this,"frameSize",0),(0,s.A)(this,"initialPadding",0),(0,s.A)(this,"trailingPadding",0),(0,s.A)(this,"seekPreroll",0),(0,s.A)(this,"flags",0)}destroy(){(0,l.dn)(this[a.o9]),(0,u.A)(this)}}i=f,(()=>{const e=i.prototype,t=new Map;t.set("codecType",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("codecId",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("codecTag",{0:8,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("extradata",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("extradataSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("codedSideData",{0:n.lg,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("nbCodedSideData",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("format",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),t.set("bitrate",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("bitsPerCodedSample",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("bitsPerRawSample",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:44,8:0}),t.set("profile",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("level",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:52,8:0}),t.set("width",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("height",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:60,8:0}),t.set("sampleAspectRatio",{0:c.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("framerate",{0:c.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),t.set("fieldOrder",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),t.set("colorRange",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:84,8:0}),t.set("colorPrimaries",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:88,8:0}),t.set("colorTrc",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:92,8:0}),t.set("colorSpace",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:96,8:0}),t.set("chromaLocation",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:100,8:0}),t.set("videoDelay",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:104,8:0}),t.set("chLayout",{0:d.r,1:0,2:0,3:0,4:0,5:0,6:0,7:112,8:0}),t.set("sampleRate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:136,8:0}),t.set("blockAlign",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:140,8:0}),t.set("frameSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:144,8:0}),t.set("initialPadding",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:148,8:0}),t.set("trailingPadding",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:152,8:0}),t.set("seekPreroll",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:156,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:160,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,8),(0,o.A)(e,a.g7,168),(0,o.A)(e,a.JY,t)})()},6038:(e,t,r)=>{r.d(t,{A:()=>d});var i,s,a=r(4467),o=r(7127),n=r(7601);class c{constructor(){(0,a.A)(this,"min",void 0),(0,a.A)(this,"max",void 0)}}i=c,(()=>{const e=i.prototype,t=new Map;t.set("min",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("max",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,8),(0,n.A)(e,o.JY,t)})();class d{constructor(){(0,a.A)(this,"channels",void 0),(0,a.A)(this,"sampleRate",void 0),(0,a.A)(this,"audioFrameSize",void 0),(0,a.A)(this,"audioPacketBytes",void 0),(0,a.A)(this,"audioPacketCount",void 0),(0,a.A)(this,"audioPacketQueueLength",void 0),(0,a.A)(this,"audioDropPacketCount",void 0),(0,a.A)(this,"audioDecodeErrorPacketCount",void 0),(0,a.A)(this,"audioEncodeErrorFrameCount",void 0),(0,a.A)(this,"audioFrameDecodeCount",void 0),(0,a.A)(this,"audioPacketEncodeCount",void 0),(0,a.A)(this,"audioFrameRenderCount",void 0),(0,a.A)(this,"audioFrameDropCount",void 0),(0,a.A)(this,"width",void 0),(0,a.A)(this,"height",void 0),(0,a.A)(this,"keyFrameInterval",void 0),(0,a.A)(this,"gop",void 0),(0,a.A)(this,"videoPacketBytes",void 0),(0,a.A)(this,"videoPacketCount",void 0),(0,a.A)(this,"videoPacketQueueLength",void 0),(0,a.A)(this,"videoDropPacketCount",void 0),(0,a.A)(this,"videoDecodeErrorPacketCount",void 0),(0,a.A)(this,"videoEncodeErrorFrameCount",void 0),(0,a.A)(this,"videoFrameDecodeCount",void 0),(0,a.A)(this,"videoPacketEncodeCount",void 0),(0,a.A)(this,"videoFrameRenderCount",void 0),(0,a.A)(this,"videoFrameDropCount",void 0),(0,a.A)(this,"keyFrameCount",void 0),(0,a.A)(this,"bufferDropBytes",void 0),(0,a.A)(this,"bufferReceiveBytes",void 0),(0,a.A)(this,"bufferSendBytes",void 0),(0,a.A)(this,"bufferOutputBytes",void 0),(0,a.A)(this,"audioBitrate",void 0),(0,a.A)(this,"videoBitrate",void 0),(0,a.A)(this,"videoDecodeFramerate",void 0),(0,a.A)(this,"videoRenderFramerate",void 0),(0,a.A)(this,"videoEncodeFramerate",void 0),(0,a.A)(this,"audioDecodeFramerate",void 0),(0,a.A)(this,"audioRenderFramerate",void 0),(0,a.A)(this,"audioEncodeFramerate",void 0),(0,a.A)(this,"audioFrameDecodeIntervalMax",void 0),(0,a.A)(this,"audioFrameRenderIntervalMax",void 0),(0,a.A)(this,"videoFrameDecodeIntervalMax",void 0),(0,a.A)(this,"videoFrameRenderIntervalMax",void 0),(0,a.A)(this,"bandwidth",void 0),(0,a.A)(this,"jitter",void 0),(0,a.A)(this,"jitterBuffer",void 0),(0,a.A)(this,"audioStutter",void 0),(0,a.A)(this,"videoStutter",void 0),(0,a.A)(this,"audiocodec",void 0),(0,a.A)(this,"videocodec",void 0),(0,a.A)(this,"firstAudioMuxDts",void 0),(0,a.A)(this,"lastAudioMuxDts",void 0),(0,a.A)(this,"firstVideoMuxDts",void 0),(0,a.A)(this,"lastVideoMuxDts",void 0),(0,a.A)(this,"audioCurrentTime",void 0),(0,a.A)(this,"videoCurrentTime",void 0),(0,a.A)(this,"audioNextTime",void 0),(0,a.A)(this,"videoNextTime",void 0)}}s=d,(()=>{const e=s.prototype,t=new Map;t.set("channels",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("sampleRate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("audioFrameSize",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("audioPacketBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("audioPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("audioPacketQueueLength",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("audioDropPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("audioDecodeErrorPacketCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("audioEncodeErrorFrameCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:52,8:0}),t.set("audioFrameDecodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("audioPacketEncodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("audioFrameRenderCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),t.set("audioFrameDropCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),t.set("width",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:84,8:0}),t.set("height",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:88,8:0}),t.set("keyFrameInterval",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:92,8:0}),t.set("gop",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:96,8:0}),t.set("videoPacketBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:104,8:0}),t.set("videoPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:112,8:0}),t.set("videoPacketQueueLength",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:120,8:0}),t.set("videoDropPacketCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:128,8:0}),t.set("videoDecodeErrorPacketCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:136,8:0}),t.set("videoEncodeErrorFrameCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:140,8:0}),t.set("videoFrameDecodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:144,8:0}),t.set("videoPacketEncodeCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:152,8:0}),t.set("videoFrameRenderCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:160,8:0}),t.set("videoFrameDropCount",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:168,8:0}),t.set("keyFrameCount",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:176,8:0}),t.set("bufferDropBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:184,8:0}),t.set("bufferReceiveBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:192,8:0}),t.set("bufferSendBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:200,8:0}),t.set("bufferOutputBytes",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:208,8:0}),t.set("audioBitrate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:216,8:0}),t.set("videoBitrate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:220,8:0}),t.set("videoDecodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:224,8:0}),t.set("videoRenderFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:228,8:0}),t.set("videoEncodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:232,8:0}),t.set("audioDecodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:236,8:0}),t.set("audioRenderFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:240,8:0}),t.set("audioEncodeFramerate",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:244,8:0}),t.set("audioFrameDecodeIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:248,8:0}),t.set("audioFrameRenderIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:252,8:0}),t.set("videoFrameDecodeIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:256,8:0}),t.set("videoFrameRenderIntervalMax",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:260,8:0}),t.set("bandwidth",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:264,8:0}),t.set("jitter",{0:19,1:0,2:0,3:0,4:0,5:0,6:0,7:272,8:0}),t.set("jitterBuffer",{0:c,1:0,2:0,3:0,4:0,5:0,6:0,7:280,8:0}),t.set("audioStutter",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:288,8:0}),t.set("videoStutter",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:292,8:0}),t.set("firstAudioMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:296,8:0}),t.set("lastAudioMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:304,8:0}),t.set("firstVideoMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:312,8:0}),t.set("lastVideoMuxDts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:320,8:0}),t.set("audioCurrentTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:328,8:0}),t.set("videoCurrentTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:336,8:0}),t.set("audioNextTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:344,8:0}),t.set("videoNextTime",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:352,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,360),(0,n.A)(e,o.JY,t)})()},6112:(e,t,r)=>{r.d(t,{lg:()=>f});var i,s,a,o,n=r(4467),c=r(7127),d=r(7601),h=r(8042),l=r(7145),u=r(1237);class f{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"type",-1)}}i=f,(()=>{const e=i.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("type",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,4),(0,d.A)(e,c.g7,12),(0,d.A)(e,c.JY,t)})(),s=class{constructor(){(0,n.A)(this,"wallclock",void 0),(0,n.A)(this,"flags",void 0)}},(()=>{const e=s.prototype,t=new Map;t.set("wallclock",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,8),(0,d.A)(e,c.g7,16),(0,d.A)(e,c.JY,t)})();class p{constructor(){(0,n.A)(this,"buf",0),(0,n.A)(this,"pts",u.Dh),(0,n.A)(this,"dts",u.Dh),(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"streamIndex",u.N_),(0,n.A)(this,"flags",0),(0,n.A)(this,"sideData",0),(0,n.A)(this,"sideDataElems",0),(0,n.A)(this,"duration",u.Dh),(0,n.A)(this,"pos",u.Dh),(0,n.A)(this,"opaque",0),(0,n.A)(this,"opaqueRef",0),(0,n.A)(this,"timeBase",new l.Q({den:u.SF,num:1}))}}a=p,(()=>{const e=a.prototype,t=new Map;t.set("buf",{0:h.BU,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("pts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("dts",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("size",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:28,8:0}),t.set("streamIndex",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:32,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:36,8:0}),t.set("sideData",{0:f,1:1,2:1,3:0,4:0,5:0,6:0,7:40,8:0}),t.set("sideDataElems",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:44,8:0}),t.set("duration",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:48,8:0}),t.set("pos",{0:17,1:0,2:0,3:0,4:0,5:0,6:0,7:56,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:64,8:0}),t.set("opaqueRef",{0:h.BU,1:1,2:1,3:0,4:0,5:0,6:0,7:68,8:0}),t.set("timeBase",{0:l.Q,1:0,2:0,3:0,4:0,5:0,6:0,7:72,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,8),(0,d.A)(e,c.g7,80),(0,d.A)(e,c.JY,t)})(),o=class extends p{constructor(){super(...arguments),(0,n.A)(this,"refCount",void 0)}},(()=>{const e=o.prototype,t=new Map;t.set("refCount",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:80,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,8),(0,d.A)(e,c.g7,88),(0,d.A)(e,c.JY,t)})()},6229:(e,t,r)=>{r.d(t,{A6:()=>A,D$:()=>u,Q7:()=>m,VG:()=>f,aw:()=>l,us:()=>g});var i=r(3674),s=r(9983),a=r(2320),o=r(1755),n=r(9882),c=r(5419),d=r(2479);const h=1;function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const c=(0,o.Gy)(28);if(!c)return 0;const d=function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;a.M[20](e,t),a.M[25](e+4,r),a.M[20](e+12,i),a.M[20](e+16,s),n.M_(e+8,1,9,2),a.M[15](e+20,c);const d=(0,o.Gy)(12);return d?(a.M[20](d,e),a.M[20](d+4,t),a.M[25](d+8,r),d):0}(c,e,t,r,i,s);return d||((0,o.Eb)(c),0)}function u(e){return l((0,o.sY)(e),e)}function f(e){const t=(0,o.Gy)(12);return(0,i.Mr)(t,e,12),n.WQ(s.f[20](e)+8,1,9,2),t}function p(e,t){const r=s.f[20](s.f[20](e));if(t?((0,i.Mr)(s.f[20](e),s.f[20](t),12),(0,o.aI)(t)):(0,o.aI)(e),1===n.jb(r+8,1,9,2)){const e=!(2&s.f[15](r+24));s.f[20](r+16)?v(s.f[20](r+16),s.f[20](r)):(0,o.Eb)(s.f[20](r)),e&&(0,o.Eb)(r)}}function m(e){e&&s.f[20](e)&&p(e,0)}function g(e,t){const r=s.f[20](e);if(!t)return m(e),0;if(r&&s.f[20](r+4)===s.f[20](t+4))return a.M[20](r+4,s.f[20](t+4)),a.M[25](r+8,s.f[25](t+8)),0;const i=f(t);return m(e),a.M[20](e,i),0}function A(e,t){if(!s.f[20](e)){const r=l((0,o.cz)(0,t),t);return a.M[20](e,r),a.M[15](s.f[20](r)+24,s.f[15](s.f[20](r)+24)|h),0}const r=s.f[20](e),c=s.f[20](r);if(s.f[25](r+8)===t)return 0;if(!(s.f[15](c+24)&h&&function(e){return 1&s.f[15](s.f[20](e)+20)?0:1===n.Hh(s.f[20](e)+8,9,2)?1:0}(r)&&s.f[20](r+4)===s.f[20](c))){let r=d.z(4);a.M[20](r,0);const o=A(r,t);return o<0?(d.t(4),o):((0,i.Mr)(s.f[20](s.f[20](r)+4),s.f[20](c),Math.min(t,s.f[25](c+4))),p(e,r),d.t(4),0)}const u=(0,o.cz)(s.f[20](c),t);return a.M[20](r+4,u),a.M[20](c,u),a.M[25](r+8,t),a.M[25](c+4,t),0}function v(e,t){const r=e,i=s.f[20](r+12);c.s2(i),a.M[20](r+16,s.f[20](i+4)),a.M[20](i+4,r),c.Tl(i),1===n.jb(i+8,1,9,2)&&function(e){!function(e){for(;s.f[20](e+4);){const t=s.f[20](e+4);a.M[20](e+4,s.f[20](t+16)),s.f[20](t+4)?v(s.f[20](t+4),s.f[20](t)):(0,o.Eb)(s.f[20](t)),(0,o.Eb)(t)}}(e),c.zr(e),(0,o.Eb)(e)}(i)}},6262:(e,t,r)=>{r.d(t,{Ay:()=>h,Tr:()=>u,de:()=>l});var i=r(4467),s=r(5992),a=r(2259),o=r(7145),n=r(872),c=r(1237),d=r(4187);class h{constructor(){(0,i.A)(this,"index",c.N_),(0,i.A)(this,"id",c.N_),(0,i.A)(this,"privData",null),(0,i.A)(this,"privateData2",null),(0,i.A)(this,"codecpar",(0,a.A)(new s.A,s.A)),(0,i.A)(this,"sideData",{}),(0,i.A)(this,"nbFrames",BigInt(0)),(0,i.A)(this,"metadata",{}),(0,i.A)(this,"duration",c.Dh),(0,i.A)(this,"startTime",c.Dh),(0,i.A)(this,"firstDTS",c.Dh),(0,i.A)(this,"disposition",0),(0,i.A)(this,"discard",-16),(0,i.A)(this,"timeBase",(0,a.A)(o.Q)),(0,i.A)(this,"sampleIndexes",[]),(0,i.A)(this,"sampleIndexesPosMap",new Map),(0,i.A)(this,"attachedPic",0)}destroy(){this.codecpar&&(this.codecpar.destroy(),(0,n.A)(this.codecpar),this.codecpar=null),this.timeBase&&((0,n.A)(this.timeBase),this.timeBase=null),this.attachedPic&&((0,d.Qe)(this.attachedPic),this.attachedPic=0),this.sampleIndexes.length=0,this.sampleIndexesPosMap.clear()}}class l{constructor(){(0,i.A)(this,"codedWidth",0),(0,i.A)(this,"codedHeight",0),(0,i.A)(this,"offsets",[]),(0,i.A)(this,"background",null),(0,i.A)(this,"horizontalOffset",c.N_),(0,i.A)(this,"verticalOffset",c.N_),(0,i.A)(this,"width",0),(0,i.A)(this,"height",0),(0,i.A)(this,"sideData",{})}}class u{constructor(){(0,i.A)(this,"privData",null),(0,i.A)(this,"index",c.N_),(0,i.A)(this,"id",c.N_),(0,i.A)(this,"type",0),(0,i.A)(this,"params",null),(0,i.A)(this,"metadata",{}),(0,i.A)(this,"streams",[]),(0,i.A)(this,"disposition",0)}destroy(){this.streams.length=0,this.params=null}}},6307:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467);class s extends EventTarget{constructor(){super(...arguments),(0,i.A)(this,"peer",void 0),(0,i.A)(this,"onmessage",void 0),(0,i.A)(this,"onmessageerror",void 0)}postMessage(e,t){var r;null!==(r=this.peer)&&void 0!==r&&r.onmessage&&this.peer.onmessage({data:e})}close(){this.peer=null}start(){}}class a{constructor(){(0,i.A)(this,"port1",void 0),(0,i.A)(this,"port2",void 0),this.port1=new s,this.port2=new s,this.port1.peer=this.port2,this.port2.peer=this.port1}}},6332:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(5967),s=r(2990);function a(){return!("object"==typeof window&&(0,i.A)(window.document)||(0,s.A)())}},6347:(e,t,r)=>{r.d(t,{$:()=>o});var i=r(3321),s=r(3262),a=r(1237);function o(e){let t=!0;return i.__(e.streams,(e=>{switch(e.codecpar.codecType){case 1:e.codecpar.chLayout.nbChannels!==a.N_&&e.codecpar.sampleRate!==a.N_&&e.codecpar.frameSize!==a.N_&&e.codecpar.bitrate!==BigInt(0)||(t=!1);break;case 0:0!==(0,s.lb)(e.codecpar.framerate)&&e.codecpar.width!==a.N_&&e.codecpar.height!==a.N_&&e.codecpar.bitrate!==BigInt(0)||(t=!1),27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId&&12!==e.codecpar.codecId||e.codecpar.profile!==a.N_&&e.codecpar.level!==a.N_||(t=!1)}})),t}},6513:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(7921),s=r(3050),a=r(8288),o=r(7084),n=r(8590),c=r(665),d=r(9658),h=r(3737),l=r(3201),u=r(769),f=r(187);async function p(e){let t,r,p,m,g,A,v,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w=c.X$({enableThread:i.USE_THREADS,initFuncs:w.child?[]:["__wasm_apply_data_relocs","_initialize"]},w),n.ai(e.dataSize)&&n.ai(e.tableSize))if(r=e.dataSize,m=e.dataSize,p=e.dataAlign,g=e.dataAlign,A=e.bssSize,n.Yj(e.source)){const r={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(n.Pc(WebAssembly.compileStreaming))t=await WebAssembly.compileStreaming(fetch(e.source,r));else{const i=await fetch(e.source,r);v=await i.arrayBuffer(),t=await WebAssembly.compile(v)}}else t=await WebAssembly.compile(e.source),v=n.sv(e.source)?e.source:e.source.buffer;else{const s={ioReader:new l.A(1048576),ioWriter:new u.A(1048576),bufferEnded:!1,compileStopped:!1,error:"",abortController:null,pullResolve:null,bufferResolve:null,buffers:[],data:{},options:w},c=new Response(new ReadableStream({async start(t){if(n.Yj(e.source)){var r;"function"==typeof AbortController&&(s.abortController=new AbortController);const i={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:null===(r=s.abortController)||void 0===r?void 0:r.signal},a=await fetch(e.source,i);let o;a.ok&&a.status>=200&&a.status<=299?o=a.body.getReader():t.error(`Http code invalid, ${a.status} ${a.statusText}`);const n=[];s.ioReader.onFlush=async e=>{let t=0;for(;n.length&&t<e.length;){const r=n.shift();r.length>e.length-t?(e.set(r.subarray(0,e.length-t),t),n.unshift(r.subarray(e.length-t)),t=e.length):(e.set(r,t),t+=r.length)}if(t>=e.length)return e.length;const{value:r,done:i}=await o.read();return i?t>0?t:-1048576:(s.buffers.push(r),r.length>e.length-t?(e.set(r.subarray(0,e.length-t),t),n.push(r.subarray(e.length-t)),e.length):(e.set(r,t),t+=r.length,t))}}else{let t=0,r=e.source.byteLength;const i=n.sv(e.source)?new Uint8Array(e.source):e.source;s.ioReader.onFlush=async e=>{if(t>=r)return-1048576;const s=Math.min(e.length,r-t);return e.set(i.subarray(t,t+s),0),t+=s,s}}s.ioWriter.onFlush=async e=>{if(s.pullResolve)return s.pullResolve(e.slice()),s.pullResolve=null,0;const t=await new Promise((e=>{s.bufferResolve=e}));return t.enqueue(e.slice()),s.bufferEnded&&t.close(),0},async function(e){try{for(await e.ioWriter.writeUint32(await e.ioReader.readUint32()),await e.ioWriter.writeUint32(await e.ioReader.readUint32());;){if(e.compileStopped){e.abortController&&e.abortController.abort();break}const t=await e.ioReader.readUint8();if(e.options.child&&11===t){await e.ioWriter.writeUint8(t),await d.$z(e.ioWriter,7),await d.$z(e.ioWriter,1),await d.$z(e.ioWriter,0),await e.ioWriter.writeUint8(65),await e.ioWriter.writeUint8(0),await e.ioWriter.writeUint8(11),await d.$z(e.ioWriter,1),await e.ioWriter.writeUint8(0);const r=await d.GW(e.ioReader);await e.ioReader.skip(r);continue}await e.ioWriter.writeUint8(t);const r=await d.GW(e.ioReader),s=e.ioReader.getPos();if(0===t){await d.$z(e.ioWriter,r);const t=e.ioReader.getPos(),i=await d.GW(e.ioReader),s=await e.ioReader.readString(i);if(await d.$z(e.ioWriter,i),await e.ioWriter.writeString(s),"dylink.0"===s){const i=e.ioReader.getPos()+(BigInt(Math.floor(r))-(e.ioReader.getPos()-t));for(;e.ioReader.getPos()<i;){const t=await e.ioReader.readUint8();await e.ioWriter.writeUint8(t);const r=await d.GW(e.ioReader);await d.$z(e.ioWriter,r),1===t?(e.data.dataSize=await d.GW(e.ioReader),e.data.dataAlign=await d.GW(e.ioReader),e.data.tableSize=await d.GW(e.ioReader),e.data.tableAlign=await d.GW(e.ioReader),await d.$z(e.ioWriter,e.data.dataSize),await d.$z(e.ioWriter,e.data.dataAlign),await d.$z(e.ioWriter,e.data.tableSize),await d.$z(e.ioWriter,e.data.tableAlign)):await e.ioWriter.writeBuffer(await e.ioReader.readBuffer(r))}}}else if(11===t){await d.$z(e.ioWriter,r);const t=await d.GW(e.ioReader);if(await d.$z(e.ioWriter,t),t){for(await d.$z(e.ioWriter,await d.GW(e.ioReader));;){const t=await e.ioReader.readUint8();if(await e.ioWriter.writeUint8(t),11===t)break}const t=await d.GW(e.ioReader);e.data.dataSize?e.data.bssSize=e.data.dataSize-t:e.data.dataSize=t,await d.$z(e.ioWriter,t)}}else if(2===t){const t=new f.A(new Uint8Array(r+100));let n=await d.GW(e.ioReader);d.tt(t,n);let c=0;for(;n--;){const r=await d.GW(e.ioReader);d.tt(t,r),t.writeBuffer(await e.ioReader.readBuffer(r));const s=await d.GW(e.ioReader);d.tt(t,s),t.writeBuffer(await e.ioReader.readBuffer(s));const n=await e.ioReader.readUint8();switch(t.writeUint8(n),n){case 0:d.tt(t,await d.GW(e.ioReader));break;case 3:d.p2(t,await d.WP(e.ioReader)),d.tt(t,await d.GW(e.ioReader));break;case 2:{let r=await d.GW(e.ioReader);e.options.enableThread?r|=2:r&=-3,d.tt(t,r);const s=await d.GW(e.ioReader);if(d.tt(t,i.HEAP_INITIAL||s),1&r){let r=await d.GW(e.ioReader);o.A.ios&&!a.A.checkVersion(o.A.version,"17",!0)&&e.options.enableThread||(r=i.HEAP_MAXIMUM),d.tt(t,r)}c++;break}case 1:{d.p2(t,await d.WP(e.ioReader));const r=await d.GW(e.ioReader);d.tt(t,r);const i=await d.GW(e.ioReader);d.tt(t,i),e.data.tableSize=i,1&r&&d.tt(t,await d.GW(e.ioReader)),c++;break}}if(2===c)break}const h=t.getWroteBuffer(),l=r-Number(e.ioReader.getPos()-s);await d.$z(e.ioWriter,h.length+l),await e.ioWriter.writeBuffer(h)}else await d.$z(e.ioWriter,r);r-Number(e.ioReader.getPos()-s)&&await e.ioReader.pipe(e.ioWriter,r-Number(e.ioReader.getPos()-s))}}catch(t){-1048576===e.ioReader.error?e.bufferEnded=!0:e.error=t,e.ioReader.remainingLength()&&await e.ioWriter.writeBuffer(await e.ioReader.readBuffer(e.ioReader.remainingLength())),await e.ioWriter.flush()}}(s)},async pull(e){if(s.error)e.close();else{if(s.bufferResolve)return s.bufferResolve(e),void(s.bufferResolve=null);e.enqueue(await new Promise(((e,t)=>{s.pullResolve=e}))),s.bufferEnded?e.close():s.error&&e.error(s.error)}},cancel(e){s.compileStopped=!0}}),{headers:{"Content-Type":"application/wasm"}});t=n.Pc(WebAssembly.compileStreaming)?await WebAssembly.compileStreaming(c):await WebAssembly.compile(await c.arrayBuffer()),v=n.Yj(e.source)?(0,h.A)(Uint8Array,s.buffers).buffer:n.sv(e.source)?e.source:e.source.buffer,r=s.data.tableSize,m=s.data.dataSize,p=s.data.tableAlign,g=s.data.dataAlign,A=s.data.bssSize}return w.child?{module:t,initFuncs:w.initFuncs||[],tableSize:0,tableAlign:p||0,dataSize:1,dataAlign:g?Math.max((0,s.A)(g),8):8,bssSize:0,buffer:v}:{module:t,tableSize:r,tableAlign:p||0,dataSize:m,dataAlign:g?Math.max((0,s.A)(g),8):8,bssSize:A||0,initFuncs:w.initFuncs||[],buffer:v}}},6616:(e,t,r)=>{r.d(t,{A:()=>A});var i=r(4467),s=r(9983),a=r(2320),o=r(495),n=r(4187),c=r(3394),d=r(3262),h=r(1237),l=r(9186),u=r(9322),f=r(8738),p=r(7683),m=r(9906);const g="packages/avcodec/src/webcodec/AudioEncoder.ts";class A{constructor(e){(0,i.A)(this,"encoder",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"timeBase",void 0),(0,i.A)(this,"currentError",null),(0,i.A)(this,"pts",BigInt(0)),(0,i.A)(this,"ptsQueue",[]),(0,i.A)(this,"avframeCache",void 0),(0,i.A)(this,"extradata",null),this.options=e,this.avframeCache=[]}async output(e,t){const r=this.options.avpacketPool?this.options.avpacketPool.alloc():(0,n._5)();if(this.extradata)(0,u.A)(e,r,t);else{var i;if(null!=t&&null!==(i=t.decoderConfig)&&void 0!==i&&i.description){let e;e=t.decoderConfig.description instanceof ArrayBuffer?new Uint8Array(t.decoderConfig.description):new Uint8Array(t.decoderConfig.description.buffer),this.extradata=e}(0,u.A)(e,r)}let o=this.ptsQueue.shift();void 0!==o&&o!==h.Dh&&this.options.copyTs||(o=this.pts),a.M[17](r+8,o),a.M[17](r+16,o),a.M[17](r+48,(0,d.Mr)(s.f[17](r+48),r+72,this.timeBase)),a.M[15](r+76,this.timeBase.den),a.M[15](r+72,this.timeBase.num),this.pts+=s.f[17](r+48),this.options.onReceiveAVPacket(r);const l=this.avframeCache.shift();l&&(this.options.avframePool?this.options.avframePool.release(l):(0,c.xj)(l))}error(e){this.options.onError(e)}async open(e,t){var r;this.currentError=null;const i={codec:(0,f.A)(e),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),bitrate:Number(s.f[17](e+32)),bitrateMode:null!==(r=this.options.bitrateMode)&&void 0!==r?r:"constant"};this.options.opus&&(i.opus=this.options.opus);try{if(!(await AudioEncoder.isConfigSupported(i)).supported)return m.z3("not support",g,155),o.nr}catch(e){return m.z3(`${e}`,g,160),o.r8}return this.encoder&&"closed"!==this.encoder.state&&this.encoder.close(),this.encoder=new AudioEncoder({output:this.output.bind(this),error:this.error.bind(this)}),this.encoder.reset(),this.encoder.configure(i),this.currentError?(m.z3(`open audio encoder error, ${this.currentError}`,g,177),o.r8):(this.pts=BigInt(0),this.ptsQueue=[],this.parameters=e,this.timeBase=t,0)}encode(e){if(this.currentError)return m.z3(`encode error, ${this.currentError}`,g,191),o.r8;if((0,p.A)(e)){const t=this.options.avframePool?this.options.avframePool.alloc():(0,c.FP)();(0,c.gg)(t,e),this.avframeCache.push(t),a.M[17](t+104,BigInt(0)),e=(0,l.T)(t)}try{return e.timestamp===h.N_?this.ptsQueue.push(h.Dh):this.ptsQueue.push((0,d.k)(BigInt(Math.floor(e.timestamp)),h.KR,this.timeBase)),this.encoder.encode(e),0}catch(e){return m.z3(`encode error, ${e}`,g,212),o.LR}}async flush(){if(this.currentError)return m.z3(`flush error, ${this.currentError}`,g,219),o.LR;try{return await this.encoder.flush(),0}catch(e){return m.z3(`flush error, ${e}`,g,227),o.LR}}close(){this.encoder&&"closed"!==this.encoder.state&&this.encoder.close(),this.avframeCache.length&&this.avframeCache.forEach((e=>{this.options.avframePool?this.options.avframePool.release(e):(0,c.xj)(e)})),this.encoder=void 0}getExtraData(){return this.extradata}getQueueLength(){var e,t;return null!==(e=null===(t=this.encoder)||void 0===t?void 0:t.encodeQueueSize)&&void 0!==e?e:0}static async isSupported(e){const t={codec:(0,f.A)(e),sampleRate:s.f[15](e+136),numberOfChannels:s.f[15](e+116),bitrate:Number(s.f[17](e+32)),bitrateMode:"constant"};try{return(await AudioEncoder.isConfigSupported(t)).supported}catch(e){return!1}}}},6670:(e,t,r)=>{r.d(t,{A:()=>n});var i=r(4467),s=r(1058),a=r(9906),o=r(495);class n{constructor(e){(0,i.A)(this,"scaler",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"inputParameters",void 0),(0,i.A)(this,"outputParameters",void 0),this.options=e,this.scaler=new s.A(this.options.resource)}async open(e,t){var r,i,s,n;let c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.inputParameters=e,this.outputParameters=t,await this.scaler.run(),this.scaler.invoke("scale_set_input_parameters",e.width,e.height,e.format),this.scaler.invoke("scale_set_output_parameters",t.width,t.height,t.format),this.scaler.invoke("scale_set_input_color",null!==(r=e.colorSpace)&&void 0!==r?r:2,null!==(i=e.colorRange)&&void 0!==i?i:0),this.scaler.invoke("scale_set_output_color",null!==(s=t.colorSpace)&&void 0!==s?s:2,null!==(n=t.colorRange)&&void 0!==n?n:0);let h=0;return h=d>1?await this.scaler.invokeAsync("scale_init",c,d):this.scaler.invoke("scale_init",c,d),h<0?(a.z3(`open scaler failed, ret: ${h}`,"packages/videoscale/src/VideoScaler.ts",112),o.nr):0}scale(e,t){return this.scaler.invoke("scale_process",e,t)}async scaleAsync(e,t){return this.scaler.invokeAsync("scale_process",e,t)}close(){this.scaler.invoke("scale_destroy"),this.scaler.destroy()}getInputScaleParameters(){return this.inputParameters}getOutputScaleParameters(){return this.outputParameters}}},6756:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(4467);class s{constructor(e,t,r){(0,i.A)(this,"task",void 0),(0,i.A)(this,"timeout",void 0),(0,i.A)(this,"interval",void 0),(0,i.A)(this,"timer",void 0),this.task=e,this.timeout=t,this.interval=r}start(){const e=this;e.stop();let t=e.timeout;const r=e.interval,i=function(){!1!==e.task()&&e.timer?e.timer=setTimeout(i,e.interval):e.stop()};null==t&&(t=r),e.timer=setTimeout(i,t)}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null)}updateInterval(e){this.interval=e}isStarted(){return!!this.timer}destroy(){this.stop(),this.task=this.timeout=this.interval=null}}},6760:(e,t,r)=>{r.d(t,{Ui:()=>m,XC:()=>p,Yj:()=>g,k9:()=>f,wN:()=>l});var i=r(9983),s=r(7145),a=r(6890),o=r(1237),n=r(3139),c=r(3262),d=r(84),h=r(187);const l={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},u=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function f(e,t,r){const i=e*t;for(const e of u)if(i<=e.maxResolution&&r<=e.maxFrameRate)return e.level}function p(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const r=m(t);e.codecpar.profile=r.profile,e.codecpar.level=r.level}}function m(e){const t=new d.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}function g(e){const t=new h.A(new Uint8Array(8)),r=function(e){let t=i.f[15](e+48),r=i.f[15](e+52);r===o.N_&&(r=f(i.f[15](e+56),i.f[15](e+60),(0,c.lb)((0,a.A)(e+72,s.Q))));const d=(0,n.I)(i.f[15](e+28));let h=i.f[15](e+40),l=1;d&&(h=d.comp[0].depth,1===d.log2ChromaW&&1===d.log2ChromaH?1===i.f[15](e+100)&&(l=0):1===d.log2ChromaW&&0===d.log2ChromaH?l=2:0===d.log2ChromaW&&0===d.log2ChromaH&&(l=3));const u=2===i.f[15](e+84)?1:0;return t===o.N_&&h&&(t=0==l||1==l?8==h?0:2:8==h?1:3),{profile:t,level:r,bitDepth:h,chromaSubsampling:l,fullRange:u}}(e);return t.writeUint8(r.profile),t.writeUint8(r.level),t.writeUint8(r.bitDepth<<4|r.chromaSubsampling<<1|r.fullRange),t.writeUint8(i.f[15](e+88)),t.writeUint8(i.f[15](e+92)),t.writeUint8(i.f[15](e+96)),t.writeUint16(0),t.getWroteBuffer()}},6766:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(4467),s=r(9983),a=r(3394),o=r(3262),n=r(1237),c=r(7683),d=r(8590),h=r(3554);class l extends h.A{constructor(e){super(e,1,1),(0,i.A)(this,"lastPts",-BigInt(1)),(0,i.A)(this,"delta",BigInt(0)),(0,i.A)(this,"timeBase",n.KR),(0,i.A)(this,"step",BigInt(0))}async ready(){this.lastPts=-BigInt(1),this.delta=BigInt(0),this.timeBase=n.KR,this.step=(0,o.k)(BigInt(1),{den:this.options.framerate.num,num:this.options.framerate.den},this.timeBase)}async destroy(){}async process(e,t){let r=e[0];if(d.ai(r)&&r<0)return void(t[0]=r);let i=(0,c.A)(r)?(0,o.Mr)(s.f[17](r+104),r+120,this.timeBase):BigInt(Math.floor(r.timestamp)),n=i-this.lastPts+this.delta;if(n<this.step&&this.lastPts>-BigInt(1))for(;;){const e=await this.inputInnerNodePort[0].request("pull");if(d.ai(e)&&e<0)return void(t[0]=e);if(i=(0,c.A)(e)?(0,o.Mr)(s.f[17](e+104),e+120,this.timeBase):BigInt(Math.floor(e.timestamp)),n=i-this.lastPts,n>=this.step)return this.delta+=n-this.step,this.lastPts=i,void(t[0]=e);(0,c.A)(e)?this.options.avframePool?this.options.avframePool.release(e):(0,a.xj)(e):e.close()}else if(this.lastPts>-BigInt(1)&&(this.delta=n-this.step),this.lastPts=i,(0,c.A)(r)){const e=this.options.avframePool?this.options.avframePool.alloc():(0,a.FP)();(0,a.gg)(e,r),t[0]=e}else t[0]=r.clone()}}},6890:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(7127),s=r(3214),a=r(5951),o=r(3463),n=r(8590),c=r(8560);function d(e,t){return arguments[2]&&n.Yj(arguments[2])&&(t=t.prototype,c.__(arguments[2],(e=>{const r=t[i.JY];t=r.get(e)[0]}))),o.A.proxy?(0,s.I_)(e,t):(0,a.l)(e,t)}},7061:(e,t,r)=>{function i(e){const t=e,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],i=/:\/\/([^\/@]*@?)\[(\S+)\]/;let s="";i.test(e)&&(e=e.replace(i,((e,t,r)=>(s=r,`://${t||""}a.b`))));const a={},o=/^(?:(?![^:@\/]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(e);let n=14;for(;n--;){var c;a[r[n]]=null!==(c=o[n])&&void 0!==c?c:""}return s&&(a.host=s,a.source=t,a.authority=s+(a.port?":"+a.port:"")),{protocol:a.protocol,file:a.file,host:a.host,port:a.port,user:a.user,password:a.password,origin:`${a.protocol}://${a.authority}`,pathname:a.path,search:`?${a.query}`,hash:a.anchor?`#${a.anchor}`:""}}r.d(t,{ll:()=>l,qg:()=>i});const s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o=/^(?=([^\/?#]*))\1([^]*)$/,n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/;function c(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}function d(e){const t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null}function h(e){for(e=e.split("").reverse().join("").replace(s,"");e.length!==(e=e.replace(a,"")).length;);return e.split("").reverse().join("")}function l(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;let t=d(e);if(!t)throw new Error("Error trying to parse base URL.");return t.path=h(t.path),c(t)}let i=d(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=h(i.path),c(i)):t;let s=d(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){let e=o.exec(s.path);s.netLoc=e[1],s.path=e[2]}s.netLoc&&!s.path&&(s.path="/");const a={scheme:s.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(a.netLoc=s.netLoc,"/"!==i.path[0]))if(i.path){let e=s.path,t=e.substring(0,e.lastIndexOf("/")+1)+i.path;a.path=h(t)}else a.path=s.path,i.params||(a.params=s.params,i.query||(a.query=s.query));return null===a.path&&(a.path=r.alwaysNormalize?h(i.path):i.path),c(a)}},7084:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(3321);const s=[["harmony",/harmonyos ([\d_.]+)/],["harmony",/openharmony ([\d_.]+)/],["iphone",/iphone os ([\d_.]+)/],["ipad",/ipad; cpu os ([\d_.]+)/],["itouch",/itouch; cpu os ([\d_.]+)/],["android",/android ([\d_.]+)/],["wp",/windows phone ([\d_.]+)/],["windows",/windows nt ([\d_.]+)/],["linux",/linux/],["mac",/mac os x ([\d_.]+)/]],a=function(e){let t,r;return(0,i.__)(s,(i=>{let s=i[1].exec(e);if(s)return t=i[0],r=s[1],r&&(r=r.replace(/_/g,".")),!1})),{name:t||"",version:r||"",mobile:e.indexOf("mobile")>-1}}(("object"==typeof navigator&&navigator.userAgent||"").toLowerCase());a.name&&(a[a.name]=!0,{iphone:1,ipad:1,itouch:1}[a.name]&&(a.ios=!0));const o=a},7127:(e,t,r)=>{r.d(t,{JY:()=>n,Og:()=>i,dc:()=>a,g7:()=>s,kE:()=>c,o9:()=>o});const i=Symbol("Struct"),s=Symbol("StructLength"),a=Symbol("StructMaxBaseTypeByteLength"),o=Symbol("StructAddress"),n=(Symbol("StructKeysQueue"),Symbol("StructKeysMeta")),c=(Symbol("StructKeysInstance"),Symbol("StructProxyRevoke"))},7138:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(5465),c=r(7921);class d{constructor(e,t){(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"len",void 0),(0,i.A)(this,"view",void 0),this.pointer=e,this.len=t}get byteLength(){return this.len}get buffer(){return o.Lv}get byteOffset(){return this.pointer}getView(){return this.view&&this.view.buffer===o.ce.buffer||(this.view=new DataView((0,o.Lv)(),this.pointer,this.len)),this.view}getFloat32(e,t){return this.getView().getFloat32(e,t)}getFloat64(e,t){return this.getView().getFloat64(e,t)}getInt8(e){return this.getView().getInt8(e)}getInt16(e,t){return this.getView().getInt16(e,t)}getInt32(e,t){return this.getView().getInt32(e,t)}getUint8(e){return this.getView().getUint8(e)}getUint16(e,t){return this.getView().getUint16(e,t)}getUint32(e,t){return this.getView().getUint32(e,t)}setFloat32(e,t,r){this.getView().setFloat32(e,t,r)}setFloat64(e,t,r){this.getView().setFloat64(e,t,r)}setInt8(e,t){this.getView().setInt8(e,t)}setInt16(e,t,r){this.getView().setInt16(e,t,r)}setInt32(e,t,r){this.getView().setInt32(e,t,r)}setUint8(e,t){this.getView().setUint8(e,t)}setUint16(e,t,r){this.getView().setUint16(e,t,r)}setUint32(e,t,r){this.getView().setUint32(e,t,r)}getBigInt64(e,t){return this.getView().getBigInt64(e,t)}getBigUint64(e,t){return this.getView().getBigUint64(e,t)}setBigInt64(e,t,r){this.getView().setBigInt64(e,t,r)}setBigUint64(e,t,r){this.getView().setBigUint64(e,t,r)}}class h extends n.A{constructor(e,t){return super(),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"len",void 0),this.pointer=e,this.len=t,this.proxy}getIndexValue(e){return s.f[2](this.pointer+e)}setIndexValue(e,t){a.M[2](this.pointer+e,t)}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;new Uint8Array((0,o.Lv)(),this.pointer,this.len).set(e,t)}subarray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return(arguments.length>2?arguments[2]:void 0)&&!c.USE_THREADS?new h(this.pointer+e,(t||this.len)-e):new Uint8Array((0,o.Lv)(),this.pointer+e,(null!=t?t:this.len)-e)}slice(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return new Uint8Array((0,o.Lv)(),this.pointer+e,(null!=t?t:this.len)-e).slice()}get length(){return this.len}get byteLength(){return this.len}get buffer(){return(0,o.Lv)()}get byteOffset(){return this.pointer}get view(){return new d(this.pointer,this.len)}}},7145:(e,t,r)=>{r.d(t,{Q:()=>n});var i,s=r(4467),a=r(7127),o=r(7601);class n{constructor(e){(0,s.A)(this,"num",1),(0,s.A)(this,"den",1),e&&(this.den=e.den,this.num=e.num)}}i=n,(()=>{const e=i.prototype,t=new Map;t.set("num",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("den",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,8),(0,o.A)(e,a.JY,t)})()},7194:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(8293),s=r(3321),a=r(665),o=r(7061),n=r(4405),c=r(3737);const d=["php","asp","aspx","jsp","do","pl"];async function h(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l="",u={url:e};if(/^rtsp/.test(e)||/^rtmp/.test(e)){/^rtsp/.test(e)?l="rtsp":/^rtmp/.test(e)&&(l="rtmp"),t=2;const r=o.qg(e).protocol.split("+")[1]||"wss";"wss"===r||"ws"===r?t=2:"webtransport"===r&&(t=3),u.url=u.url.replace(/^\S+:\/\//,r+"://"),"rtmp"===l&&(u.subProtocol=t,t=6)}else{var f;const u=o.qg(e).protocol;l=r||o.qg(e).file.split(".").pop(),l&&!s.zy(d,l)||!/^https?/.test(u)||(l=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};let i;t.headers&&a.__(t.headers,((e,t)=>{r.headers[t]=e})),t.credentials&&(r.credentials=t.credentials),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),"function"==typeof AbortController&&(i=new AbortController,r.signal=i.signal);const s=await fetch(e,r);if(s.ok&&s.status>=200&&s.status<=299){const e=s.body.getReader(),t=[];let r=0;for(;;){let i=await e.read();if(i.done)break;if(r+=i.value.length,t.push(i.value),r>=100)break}if(i&&i.abort(),t.length){const e=t.length>1?(0,c.A)(Uint8Array,t):t[0];if(e.length){const t=n.decode(e.subarray(0,100));if(/<\?xml/.test(t)){if(t.indexOf("<MPD")>-1)return"mpd"}else if(/#EXTM3U/.test(t))return"m3u8"}}}return""}(e,h));let p=0;"wss"===u||"ws"===u?p=2:"webtransport"===u&&(p=3),t=null!==(f=i.$$[l])&&void 0!==f?f:p}return{type:t,ext:l,info:u}}},7313:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(5967);let s;function a(){if((0,i.A)(s))return s;const e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),s=256===new Int16Array(e)[0],s}},7314:(e,t,r)=>{r.d(t,{Bq:()=>u,En:()=>c,Hm:()=>o,Ij:()=>l,XC:()=>h,_5:()=>d,f7:()=>f,hY:()=>n,uF:()=>a});var i=r(1237),s=r(84);const a={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},o={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],c=[i.N_,1,2,3,4,5,6,7];function d(e){let t=i.N_,r=i.N_,s=i.N_;return e.length>=2&&(t=e[0]>>3&31,r=n[(7&e[0])<<1|e[1]>>7],s=c[e[1]>>3&15]),{profile:t,sampleRate:r,channels:s}}function h(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:r,sampleRate:i,channels:s}=d(t);e.codecpar.profile=r,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=s,e.codecpar.frameSize=5===r?2048:1024,e.codecpar.format=8}}function l(e){const t=o[e.sampleRate],r=e.chLayout.nbChannels,s=e.profile===i.N_?2:e.profile,a=new Uint8Array(2);return a[0]=(31&s)<<3|(14&t)>>1,a[1]=(1&t)<<7|(15&r)<<3,a}function u(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const r=1&e[1],i=(192&e[2])>>>6,s=(60&e[2])>>>2,a=(1&e[2])<<2|(192&e[3])>>>6,o=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let h=1===r?7:9,l=o-h;return{syncWord:t,profile:i+1,sampleRate:n[s],channels:c[a],aacFrameLength:o,numberOfRawDataBlocksInFrame:d,headerLength:h,framePayloadLength:l}}function f(e,t){function r(){const e=t.readU(2);let r=0;for(let i=0;i<=e;i++)r<<=8,r|=t.readU(8);return r}t||(t=new s.A).appendBuffer(e);const i=t.getPointer(),a={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},o=t.readU(11);if(695!==o)return-1;a.syncWord=o,a.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(a.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&r(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?r():0;const s=t.readU(5);i-=5;const o=t.readU(4);i-=4;const d=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)r();else{let e=0;for(;;){e<<=8;const r=1===t.readU1();if(e+=t.readU(8),!r)break}}1===t.readU1()&&t.readU(8),a.profile=s+1,a.sampleRate=n[o],a.channels=c[d]}let h=0;for(;;){const e=t.readU(8);if(h+=e,255!==e)break}return a.framePayloadLength=h,a.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),a}},7332:(e,t,r)=>{r.d(t,{_:()=>s,i:()=>i});const i={2:1,3:1,4:1,5:1,6:2,7:2,8:4,9:4,10:8,11:1,12:1,13:2,14:2,15:4,16:4,17:8,18:4,19:8,20:4,0:4,1:4,22:8,21:8,23:1,24:1,25:4},s={2:0,3:0,4:0,5:0,6:1,7:1,8:2,9:2,10:4,11:0,12:0,13:1,14:1,15:2,16:2,17:4,18:2,19:4,20:2,1:2,0:2,22:4,21:4,23:0,24:0,25:2}},7526:(e,t,r)=>{r.d(t,{Ay:()=>U,L_:()=>P,eG:()=>M,iV:()=>_});var i=r(7127),s=r(9983),a=r(8687),o=r(6890),n=r(7145),c=r(381),d=r(8293),h=r(4824),l=r(3262),u=r(1237),f=r(7314),p=r(3831),m=r(1497),g=r(4229),A=r(9935),v=r(6760),w=r(8590),y=r(8927),b=r(665),k=r(4566);function _(e){e<0&&(e=BigInt(0));const t=Number(BigInt.asIntN(32,e%BigInt(1e3))),r=Number(BigInt.asIntN(32,e/BigInt(1e3)%BigInt(60))),i=Number(BigInt.asIntN(32,e/BigInt(1e3)/BigInt(60)%BigInt(60))),s=Number(BigInt.asIntN(32,e/BigInt(1e3)/BigInt(3600)));return y.GP("%02d:%02d:%02d.%03d",s,i,r,t)}function I(e){return e<BigInt(1e4)?(0,k.A)(Number(BigInt.asIntN(32,e)))+" bps/s":Number(BigInt.asIntN(32,e/BigInt(1e3)))+" kbps/s"}function x(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return b.__(e,((e,i)=>{if(t===e)return r=i,!1})),r}function M(e,t){return 1===e?x(d.n1,t):0===e?x(d._R,t):3===e?x(d.Xp,t):"unknown"}function P(e){return x(d.iW,e)}function T(e,t){switch(e){case 86018:return f.uF[t]||"LC";case 86017:return A.He[t]||"Layer3";case 27:return m.tZ[t]||"High";case 173:return g.dT[t]||"Main";case 225:return p.zk[t]||"Main";case 167:return v.wN[t]||"Profile0"}}function E(e){let t="";return e&&(t=" ",1&e&&(t+=`(${x(d.Ki,1)}) `),2&e&&(t+=`(${x(d.Ki,2)}) `),4&e&&(t+=`(${x(d.Ki,4)}) `),8&e&&(t+=`(${x(d.Ki,8)}) `),16&e&&(t+=`(${x(d.Ki,16)}) `),32&e&&(t+=`(${x(d.Ki,32)}) `),64&e&&(t+=`(${x(d.Ki,64)}) `),128&e&&(t+=`(${x(d.Ki,128)}) `),256&e&&(t+=`(${x(d.Ki,256)}) `),512&e&&(t+=`(${x(d.Ki,512)}) `),1024&e&&(t+=`(${x(d.Ki,1024)}) `),2048&e&&(t+=`(${x(d.Ki,2048)}) `),65536&e&&(t+=`(${x(d.Ki,65536)}) `),131072&e&&(t+=`(${x(d.Ki,131072)}) `),262144&e&&(t+=`(${x(d.Ki,262144)}) `),524288&e&&(t+=`(${x(d.Ki,524288)}) `),1048576&e&&(t+=`(${x(d.Ki,1048576)}) `),8192&e&&(t+=`(${x(d.Ki,8192)}) `)),t}function B(e,t){const r=T(s.f[15](e.codecpar+4),s.f[15](e.codecpar+48)),i=x(d._R,s.f[15](e.codecpar+4));if(t.push(`${i}${r?` (${r})`:""}`),s.f[15](e.codecpar+28)!==u.N_){const r=x(d.qO,s.f[15](e.codecpar+28),`unknown(${s.f[15](e.codecpar+28)})`),i=x(d.mX,s.f[15](e.codecpar+84),"tv"),a=x(d._m,s.f[15](e.codecpar+96)),o=x(d.Eh,s.f[15](e.codecpar+88)),n=x(d.d8,s.f[15](e.codecpar+92)),c=(0,h.A)(e.codecpar);a===o&&o===n?t.push(`${r}(${i}, ${a}, ${c?"HDR":"SDR"})`):t.push(`${r}(${i}, ${a}/${o}/${n}, ${c?"HDR":"SDR"})`);const u={num:s.f[15](e.codecpar+56)*s.f[15](e.codecpar+64),den:s.f[15](e.codecpar+60)*s.f[15](e.codecpar+68)};(0,l.iU)(u),t.push(`${s.f[15](e.codecpar+56)}x${s.f[15](e.codecpar+60)} [SAR: ${s.f[15](e.codecpar+64)}:${s.f[15](e.codecpar+68)} DAR ${u.num}:${u.den}]`)}}function C(e,t){const r=T(s.f[15](e.codecpar+4),s.f[15](e.codecpar+48)),i=x(d.n1,s.f[15](e.codecpar+4));t.push(`${i}${r?` (${r})`:""}`),t.push(`${s.f[15](e.codecpar+136)} Hz`);let n=`${s.f[15](e.codecpar+116)} channels`;if(1===s.f[15](e.codecpar+112)){const t=x(d.IY,Number((0,o.A)(e.codecpar+120,a.r,"u").mask),"");t&&(n=t)}t.push(n),t.push(x(d.Sz,s.f[15](e.codecpar+28)))}function S(e,t,r){const i=x(d.Mb,s.f[15](e.codecpar)),a=[];if(1===s.f[15](e.codecpar))C(e,a),s.f[17](e.codecpar+32)>BigInt(0)&&e.nbFrames!==BigInt(1)&&a.push(`${I(s.f[17](e.codecpar+32))}`);else if(0===s.f[15](e.codecpar))B(e,a),s.f[17](e.codecpar+32)>BigInt(0)&&e.nbFrames!==BigInt(1)&&a.push(`${I(s.f[17](e.codecpar+32))}`),(0,l.lb)((0,o.A)(e.codecpar+72,n.Q))>0&&(a.push(`${(0,l.lb)((0,o.A)(e.codecpar+72,n.Q)).toFixed(2)} fps`),a.push(`${(0,l.lb)((0,o.A)(e.codecpar+72,n.Q)).toFixed(2)} tbr`)),a.push(`${c=BigInt(Math.floor((0,l.lb)({num:e.timeBase.den,den:e.timeBase.num}))),c<BigInt(1e4)?(0,k.A)(Number(BigInt.asIntN(32,c))):Number(BigInt.asIntN(32,c/BigInt(1e3)))+"k"} tbn`);else if(3===s.f[15](e.codecpar)){const t=x(d.Xp,s.f[15](e.codecpar+4));a.push(t),s.f[17](e.codecpar+32)>BigInt(0)&&a.push(`${I(s.f[17](e.codecpar+32))}`)}else{const t=x(d.Ld,s.f[15](e.codecpar+4));a.push(t),s.f[17](e.codecpar+32)>BigInt(0)&&a.push(`${I(s.f[17](e.codecpar+32))}`)}var c;let h=`${r}Stream #${t}:${e.index}[0x${y.GP("%02x",e.id)}] ${i}: ${a.join(", ")}${E(e.disposition)}\n`;return Object.keys(e.metadata).length&&(h+=`${r}  Metadata:\n`,b.__(e.metadata,((t,i)=>{w.Ik(t)||w.YO(t)||w.sv(t)||ArrayBuffer.isView(t)?"matrix"===i&&0===s.f[15](e.codecpar)&&(h+=`${r}    ${i}: [${t.toString()}]\n`):(w.Yj(t)&&(t=y.yh(t,"\n","\n"+" ".repeat(6+i.length))),h+=`${r}    ${i}: ${t}\n`)}))),h}function U(e,t){let r="";return e.forEach(((e,a)=>{if(e instanceof c.oD){const t=[],r=[];for(let r=0;r<e.streams.length;r++){const s=e.streams[r];t.push({index:s.index,id:s.id,codecpar:s.codecpar[i.o9],nbFrames:s.nbFrames,metadata:s.metadata,duration:s.duration,startTime:s.startTime,disposition:s.disposition,timeBase:s.timeBase,attachedPic:s.attachedPic})}for(let i=0;i<e.streamGroups.length;i++){const s=e.streamGroups[i];r.push({index:s.index,id:s.id,type:s.type,params:s.params,metadata:s.metadata,disposition:s.disposition,streams:s.streams.map((e=>t.find((t=>t.id===e.id))))})}e={metadata:e.metadata,format:e.format,chapters:e.chapters,streams:t,streamGroups:r}}r+=function(e,t,r){var i;let a=`${r.tag} #${t}, ${r.isLive?"live":"vod"}, ${x(d.iW,e.format)}, from '${r.from}':\n`;Object.keys(e.metadata).length&&(a+="  Metadata:\n",b.__(e.metadata,((e,t)=>{w.Ik(e)||w.YO(e)||w.sv(e)||ArrayBuffer.isView(e)||(w.Yj(e)&&(e=y.yh(e,"\n","\n"+" ".repeat(6+t.length))),a+=`    ${t}: ${e}\n`)})));let o=u.Dh,n=BigInt(0),c=u.Dh;e.streams.forEach((e=>{const t=e.duration!==u.Dh?(0,l.k)(e.duration,e.timeBase,u.i0):u.Dh,r=e.startTime!==u.Dh?(0,l.k)(e.startTime,e.timeBase,u.i0):u.Dh;t>o&&(o=t),(r!==u.Dh&&r<c||c===u.Dh)&&(c=r),n+=s.f[17](e.codecpar+32)})),a+=`  Duration: ${o!==u.Dh?_(o):"N/A"}, start: ${c!==u.Dh?_(c):"N/A"}, bitrate: ${n?I(n):"N/A"}\n`,null!==(i=e.chapters)&&void 0!==i&&i.length&&(a+="  Chapters:\n",e.chapters.forEach(((e,r)=>{a+=function(e,t,r,i){let s="N/A",a="N/A";e.start!==u.Dh&&(s=_((0,l.k)(e.start,e.timeBase,u.i0))),e.end!==u.Dh&&(a=_((0,l.k)(e.end,e.timeBase,u.i0)));let o=`${i}Chapter #${t}:${r} start: ${s}, end: ${a}\n`;return Object.keys(e.metadata).length&&(o+=`${i}  Metadata:\n`,b.__(e.metadata,((e,t)=>{w.Ik(e)||w.YO(e)||w.sv(e)||ArrayBuffer.isView(e)||(w.Yj(e)&&(e=y.yh(e,"\n","\n"+" ".repeat(6+t.length))),o+=`${i}    ${t}: ${e}\n`)}))),o}(e,t,r,"    ")})));const h={};return e.streamGroups.forEach((e=>{a+=function(e,t,r,i){const a=x(d.u6,e.type),o=[];if(3===e.type){const t=e.streams[0];t&&(1===s.f[15](t.codecpar)?C(t,o):0===s.f[15](t.codecpar)&&(B(t,o),o.push(`${e.params.width}x${e.params.height}`)))}let n=`  Stream Group #${t}:${e.index} ${a}: ${o.join(", ")}${E(e.disposition)}\n`;return e.streams.length&&e.streams.forEach((e=>{n+=S(e,t,"    "),i[e.id]=!0})),n}(e,t,0,h)})),e.streams.forEach((e=>{h[e.id]||(a+=S(e,t,"  "))})),a}(e,a,t[a])})),r}},7601:(e,t,r)=>{function i(e,t,r){Object.defineProperty(e,t,{value:r,writable:!1,enumerable:!1,configurable:!1})}r.d(t,{A:()=>i})},7656:(e,t,r)=>{r.r(t),r.d(t,{atomic_add_i16:()=>p,atomic_add_i32:()=>_,atomic_add_i64:()=>S,atomic_add_i8:()=>a,atomic_and_i16:()=>g,atomic_and_i32:()=>x,atomic_and_i64:()=>D,atomic_and_i8:()=>n,atomic_compare_exchange_i16:()=>b,atomic_compare_exchange_i32:()=>B,atomic_compare_exchange_i64:()=>z,atomic_compare_exchange_i8:()=>u,atomic_exchange_i16:()=>k,atomic_exchange_i32:()=>C,atomic_exchange_i64:()=>O,atomic_exchange_i8:()=>f,atomic_load_i16:()=>y,atomic_load_i32:()=>E,atomic_load_i64:()=>F,atomic_load_i8:()=>l,atomic_or_i16:()=>A,atomic_or_i32:()=>M,atomic_or_i64:()=>R,atomic_or_i8:()=>c,atomic_store_i16:()=>w,atomic_store_i32:()=>T,atomic_store_i64:()=>$,atomic_store_i8:()=>h,atomic_sub_i16:()=>m,atomic_sub_i32:()=>I,atomic_sub_i64:()=>U,atomic_sub_i8:()=>o,atomic_xor_i16:()=>v,atomic_xor_i32:()=>P,atomic_xor_i64:()=>L,atomic_xor_i8:()=>d,atomics_notify:()=>V,atomics_wait:()=>N,atomics_wait_timeout:()=>W,override:()=>Q});var i=r(9882),s=r(7332);let a=function(e,t){return i.WQ(e,t,12,s._[12])},o=function(e,t){return i.jb(e,t,12,s._[12])},n=function(e,t){return i.Uo(e,t,12,s._[12])},c=function(e,t){return i.or(e,t,12,s._[12])},d=function(e,t){return i.I8(e,t,12,s._[12])},h=function(e,t){return i.M_(e,t,12,s._[12])},l=function(e){return i.Hh(e,12,s._[12])},u=function(e,t,r){return i.p_(e,t,r,12,s._[12])},f=function(e,t){return i.cv(e,t,12,s._[12])},p=function(e,t){return i.WQ(e,t,14,s._[14])},m=function(e,t){return i.jb(e,t,14,s._[14])},g=function(e,t){return i.Uo(e,t,14,s._[14])},A=function(e,t){return i.or(e,t,14,s._[14])},v=function(e,t){return i.I8(e,t,14,s._[14])},w=function(e,t){return i.M_(e,t,14,s._[14])},y=function(e){return i.Hh(e,14,s._[14])},b=function(e,t,r){return i.p_(e,t,r,14,s._[14])},k=function(e,t){return i.cv(e,t,14,s._[14])},_=function(e,t){return i.WQ(e,t,16,s._[16])},I=function(e,t){return i.jb(e,t,16,s._[16])},x=function(e,t){return i.Uo(e,t,16,s._[16])},M=function(e,t){return i.or(e,t,16,s._[16])},P=function(e,t){return i.I8(e,t,16,s._[16])},T=function(e,t){return i.M_(e,t,16,s._[16])},E=function(e){return i.Hh(e,16,s._[16])},B=function(e,t,r){return i.p_(e,t,r,16,s._[16])},C=function(e,t){return i.cv(e,t,16,s._[16])},S=function(e,t){return i.WQ(e,t,21,s._[21])},U=function(e,t){return i.jb(e,t,21,s._[21])},D=function(e,t){return i.Uo(e,t,21,s._[21])},R=function(e,t){return i.or(e,t,21,s._[21])},L=function(e,t){return i.I8(e,t,21,s._[21])},$=function(e,t){return i.M_(e,t,21,s._[21])},F=function(e){return i.Hh(e,21,s._[21])},z=function(e,t,r){return i.p_(e,t,r,21,s._[21])},O=function(e,t){return i.cv(e,t,21,s._[21])},V=function(e,t){return i.me(e,t)},N=function(e,t){return i.uk(e,t)},W=function(e,t,r){return i.j4(e,t,Number(BigInt.asIntN(32,r)))};function Q(e){e.atomic_add_i8&&(a=e.atomic_add_i8),e.atomic_sub_i8&&(o=e.atomic_sub_i8),e.atomic_and_i8&&(n=e.atomic_and_i8),e.atomic_or_i8&&(c=e.atomic_or_i8),e.atomic_xor_i8&&(d=e.atomic_xor_i8),e.atomic_store_i8&&(h=e.atomic_store_i8),e.atomic_load_i8&&(l=e.atomic_load_i8),e.atomic_compare_exchange_i8&&(u=e.atomic_compare_exchange_i8),e.atomic_exchange_i8&&(f=e.atomic_exchange_i8),e.atomic_add_i16&&(p=e.atomic_add_i16),e.atomic_sub_i16&&(m=e.atomic_sub_i16),e.atomic_and_i16&&(g=e.atomic_and_i16),e.atomic_or_i16&&(A=e.atomic_or_i16),e.atomic_xor_i16&&(v=e.atomic_xor_i16),e.atomic_store_i16&&(w=e.atomic_store_i16),e.atomic_load_i16&&(y=e.atomic_load_i16),e.atomic_compare_exchange_i16&&(b=e.atomic_compare_exchange_i16),e.atomic_exchange_i16&&(k=e.atomic_exchange_i16),e.atomic_add_i32&&(_=e.atomic_add_i32),e.atomic_sub_i32&&(I=e.atomic_sub_i32),e.atomic_and_i32&&(x=e.atomic_and_i32),e.atomic_or_i32&&(M=e.atomic_or_i32),e.atomic_xor_i32&&(P=e.atomic_xor_i32),e.atomic_store_i32&&(T=e.atomic_store_i32),e.atomic_load_i32&&(E=e.atomic_load_i32),e.atomic_compare_exchange_i32&&(B=e.atomic_compare_exchange_i32),e.atomic_exchange_i32&&(C=e.atomic_exchange_i32),e.atomic_add_i64&&(S=e.atomic_add_i64),e.atomic_sub_i64&&(U=e.atomic_sub_i64),e.atomic_and_i64&&(D=e.atomic_and_i64),e.atomic_or_i64&&(R=e.atomic_or_i64),e.atomic_xor_i64&&(L=e.atomic_xor_i64),e.atomic_store_i64&&($=e.atomic_store_i64),e.atomic_load_i64&&(F=e.atomic_load_i64),e.atomic_compare_exchange_i64&&(z=e.atomic_compare_exchange_i64),e.atomic_exchange_i64&&(O=e.atomic_exchange_i64),e.atomics_notify&&(V=e.atomics_notify),e.atomics_wait&&(N=e.atomics_wait),e.atomics_wait_timeout&&(W=e.atomics_wait_timeout)}},7683:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(8590);function s(e){return i.ai(e)&&e>=0}},7684:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(4467);class s{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,i.A)(this,"handler",void 0),(0,i.A)(this,"file",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"writer",void 0),(0,i.A)(this,"append",void 0),(0,i.A)(this,"reader",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"blobSlice",void 0),(0,i.A)(this,"readied",void 0),(0,i.A)(this,"readHold",void 0),this.handler=e,this.append=t,this.readied=!1}async ready(){this.readied||(this.file=await this.handler.getFile(),this.writer=await this.handler.createWritable(),this.pos=this.append?this.file.size:0,this.size=this.pos,this.reader=new FileReader,this.blobSlice=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,this.reader.onloadend=e=>{this.readHold&&(this.readHold.resolve(e.target.result),this.readHold=null)},this.readied=!0)}async write_(e){await this.writer.write(e),this.pos+=e.byteLength,this.pos>this.size&&(this.size+=e.byteLength)}async write(e){await this.write_(e)}async seek_(e){await this.writer.seek(e),this.pos=e}async seek(e){await this.seek_(e)}async seekToEnd(){await this.seek_(this.size)}async resize_(e){e!==this.file.size&&(e<this.file.size&&(this.pos=this.file.size),await this.writer.truncate(e),this.size=e)}async resize(e){await this.resize_(e)}async read_(e,t){return new Promise(((r,i)=>{this.readHold={resolve:r,reject:i},this.reader.readAsArrayBuffer(this.blobSlice.call(this.file,e,t))}))}async read(e,t){return await this.read_(e,t)}async appendBufferByPosition(e,t){await this.writer.close(),this.file=await this.handler.getFile(),this.writer=await this.handler.createWritable({keepExistingData:!0});const r=this.file.size,i=e.byteLength;if(t>=this.file.size)await this.resize_(t+i),await this.seek_(t),await this.write_(e);else{let i=t;for(await this.seek_(t),await this.write_(e);i<r;){const e=await this.read_(i,Math.min(i+5242880,r));await this.write_(e),i+=e.byteLength}}}async close_(){this.readied&&(await this.writer.close(),this.file=await this.handler.getFile(),this.readied=!1)}async close(){await this.close_()}getFile(){return this.file}getHandle(){return this.handler}getPos(){return this.pos}getSize(){return this.size}async destroy(){await this.close_(),this.handler=null,this.file=null}}},7698:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(8590),s=r(2494);function a(e,t){return i.sH(e)?+e:t!==s.ZH?t:0}},7827:(e,t,r)=>{r.d(t,{A:()=>I});var i=r(7127),s=r(1228),a=r(6890),o=r(9983),n=r(2320),c=r(495),d=r(4187),h=r(3262),l=r(1237),u=r(2836),f=r(8696),p=r(3321),m=r(665),g=r(9906),A=r(8370),v=r(8150),w=r(2935),y=r(700),b=r(381),k=r(17);const _="packages/avpipeline/src/MuxPipeline.ts";class I extends k.A{constructor(){super()}createTask(e){const t=new w.Ay(e.rightPort),r=(0,b.fG)(),i=new A.A(5242880);return i.onFlush=(e,r)=>{const i=e.slice();return t.notify("write",{data:i,pos:r},[i.buffer]),0},i.onSeek=e=>(t.notify("seek",{pos:e}),0),r.ioWriter=i,this.tasks.set(e.taskId,{...e,rightIPCPort:t,formatContext:r,loop:null,ended:!1,streams:[],avpacketPool:new f.A((0,a.A)(e.avpacketList,s.A),e.avpacketListMutex)}),0}async open(e){const t=this.tasks.get(e);if(t){let e;switch(t.format){case 0:e=new((await Promise.all([r.e(839),r.e(105)]).then(r.bind(r,2105))).default)(t.formatOptions);break;case 1:e=new((await Promise.all([r.e(399),r.e(33)]).then(r.bind(r,5033))).default)(t.formatOptions);break;case 2:e=new((await r.e(31).then(r.bind(r,9031))).default)(t.formatOptions);break;case 5:e=new((await r.e(694).then(r.bind(r,8694))).default);break;case 4:e=new((await Promise.all([r.e(668),r.e(18)]).then(r.bind(r,7637))).default);break;case 14:e=new((await Promise.all([r.e(296),r.e(507)]).then(r.bind(r,8507))).default)(t.formatOptions);break;case 16:e=new((await r.e(179).then(r.bind(r,7179))).default)(t.formatOptions);break;case 17:e=new((await Promise.all([r.e(299),r.e(713)]).then(r.bind(r,8713))).default)(t.formatOptions);break;case 15:e=new((await r.e(458).then(r.bind(r,9458))).default)(t.formatOptions);break;case 8:case 9:{const i={isLive:t.isLive,docType:9===t.format?"webm":"matroska"};e=new((await r.e(787).then(r.bind(r,4477))).default)(m.X$(t.formatOptions,i))}break;case 11:case 12:case 13:e=new((await r.e(267).then(r.bind(r,267))).default);break;default:return g.z3("format not support",_,269),c.E$}t.formatContext.oformat=e;for(let e=0;e<t.streams.length;e++){if(t.streams[e].ended||1!==t.streams[e].stream.codecpar.codecType&&0!==t.streams[e].stream.codecpar.codecType)continue;const r=await t.streams[e].pullIPC.request("pull");if(-1048576===r)t.streams[e].ended=!0;else{if(r<0)return g.z3(`pull stream ${e} avpacket error, ret: ${r}`,_,290),t.streams[e].ended=!0,c.LR;{n.M[15](r+32,t.streams[e].stream.index),t.streams[e].avpacketQueue.push(r);const i=(0,h.Mr)(o.f[17](r+16),r+72,l.i0);1===t.streams[e].stream.codecpar.codecType?n.M[17](t.stats+296,i):0===t.streams[e].stream.codecpar.codecType&&n.M[17](t.stats+312,i)}}}return 0}g.h2("task not found",_,309)}async addStream(e,t,r){const s=this.tasks.get(e);if(s){const e=s.formatContext.createStream();e.id=t.id,(0,u.Yi)(e.codecpar[i.o9],t.codecpar),e.timeBase.num=t.timeBase.num,e.timeBase.den=t.timeBase.den,e.disposition=t.disposition,e.metadata=t.metadata,t.attachedPic&&(e.attachedPic=(0,d._5)(),(0,d.rN)(e.attachedPic,t.attachedPic)),s.streams.push({stream:e,pullIPC:new w.Ay(r),avpacketQueue:[],ended:4===o.f[15](t.codecpar)||2===o.f[15](t.codecpar)||!!(1024&t.disposition),pulling:null})}else g.h2("task not found",_,339)}async addFormatContextMetadata(e,t){const r=this.tasks.get(e);r?m.X$(r.formatContext.metadata,t):g.h2("task not found",_,349)}async addFormatContextChapters(e,t){const r=this.tasks.get(e);r?r.formatContext.chapters.push(...t):g.h2("task not found",_,359)}async updateAVCodecParameters(e,t,r){const s=this.tasks.get(e);if(s){const e=s.formatContext.getStreamById(t);e&&(0,u.Yi)(e.codecpar[i.o9],r)}else g.h2("task not found",_,372)}async start(e){const t=this.tasks.get(e);if(t){var r,i;if(t.loop)return g.z3("task has started",_,381),c.lh;if(y.ho(t.formatContext,{nonnegative:1!==t.format&&8!==t.format||null!==(r=t.nonnegative)&&void 0!==r&&r,zeroStart:null!==(i=t.zeroStart)&&void 0!==i&&i})<0)return g.z3("mux task open error",_,393),c.E$;if(y.bx(t.formatContext),!t.streams.length)return g.z3("task streams not found",_,400),c.lh;function s(e,r){-1048576===r?t.streams[e].ended=!0:r<0?(g.z3(`pull stream ${e} avpacket error, ret: ${r}`,_,409),t.streams[e].ended=!0,t.loop.stop(),t.ended=!0,t.rightIPCPort.notify("error")):(n.M[15](r+32,t.streams[e].stream.index),t.streams[e].avpacketQueue.push(r))}function a(e){t.streams[e].pulling||(t.streams[e].pulling=t.streams[e].pullIPC.request("pull").then((r=>{s(e,r),t.streams[e].pulling=null})))}return t.loop=new v.A((async()=>{for(let e=0;e<t.streams.length;e++)if(!t.streams[e].ended&&t.streams[e].avpacketQueue.length<30){const r=t.streams[e].stream.codecpar.codecType;1!==r&&0!==r||t.streams[e].avpacketQueue.length?a(e):t.streams[e].pulling?await t.streams[e].pulling:s(e,await t.streams[e].pullIPC.request("pull"))}let e=0,r=l.Dh,i=0,c=-1;for(let s=0;s<t.streams.length;s++)if(t.streams[s].avpacketQueue.length){const a=(0,h.Mr)(o.f[17](t.streams[s].avpacketQueue[0]+16),t.streams[s].avpacketQueue[0]+72,l.i0);(r===l.Dh||a<r)&&(e=t.streams[s].avpacketQueue[0],r=a,i=s,c=t.streams[s].stream.codecpar.codecType)}if(e){const s=t.formatContext.ioWriter.getPos();y.XA(t.formatContext,e),n.M[17](t.stats+208,o.f[17](t.stats+208)+(t.formatContext.ioWriter.getPos()-s)),t.avpacketPool.release(e),t.streams[i].avpacketQueue.shift(),1===c?n.M[17](t.stats+304,r):0===c&&n.M[17](t.stats+320,r)}else t.streams.some((e=>!e.ended))||(y.dJ(t.formatContext),y.bX(t.formatContext),t.rightIPCPort.notify("end"),t.loop.stop(),t.ended=!0)}),0,0,!1,!1),t.loop.start(),0}return g.z3("task not found",_,494),c.lh}async pause(e){const t=this.tasks.get(e);t?t.loop&&await t.loop.stopBeforeNextTick():g.h2("task not found",_,507)}async unpause(e){const t=this.tasks.get(e);t?!t.loop||t.loop.isStarted()||t.ended||t.loop.start():g.h2("task not found",_,519)}async registerTask(e){return this.tasks.has(e.taskId)?c.lh:this.createTask(e)}async unregisterTask(e){const t=this.tasks.get(e);t&&(t.loop&&(await t.loop.stopBeforeNextTick(),t.loop.destroy()),p.__(t.streams,(e=>{e.avpacketQueue.length&&(e.avpacketQueue.forEach((e=>{t.avpacketPool.release(e)})),e.avpacketQueue.length=0),e.pullIPC.destroy()})),await t.formatContext.destroy(),this.tasks.delete(e))}}},7921:(e,t,r)=>{r.r(t),r.d(t,{HEAP_INITIAL:()=>p,HEAP_MAXIMUM:()=>m,HEAP_OFFSET:()=>f,STACK_ALIGNMENT:()=>l,STACK_SIZE:()=>u,USE_THREADS:()=>h});var i,s,a=r(2494),o=r(3463),n=r(8288),c=r(7084);const d=a.TK,h=!!o.A.thread&&!d.CHEAP_DISABLE_THREAD;let l=16,u=1048576;const f=1024,p=null!==(i=d.CHEAP_HEAP_INITIAL)&&void 0!==i?i:265,m=null!==(s=d.CHEAP_HEAP_MAXIMUM)&&void 0!==s?s:h&&c.A.ios&&!n.A.checkVersion(c.A.version,"17",!0)?8192:65536},8039:(e,t,r)=>{r.d(t,{Ui:()=>a,XC:()=>s});var i=r(84);function s(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const r=a(t);e.codecpar.profile=r.profile,e.codecpar.level=r.level}}function a(e){const t=new i.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},8042:(e,t,r)=>{r.d(t,{BU:()=>u});var i,s,a,o,n=r(4467),c=r(7127),d=r(7601),h=r(5419);class l{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"size",0),(0,n.A)(this,"refcount",0),(0,n.A)(this,"free",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"flags",0),(0,n.A)(this,"flagsInternal",0)}}i=l,(()=>{const e=i.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("refcount",{0:9,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("free",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("flags",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("flagsInternal",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:24,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,4),(0,d.A)(e,c.g7,28),(0,d.A)(e,c.JY,t)})();class u{constructor(){(0,n.A)(this,"buffer",0),(0,n.A)(this,"data",0),(0,n.A)(this,"size",0)}}s=u,(()=>{const e=s.prototype,t=new Map;t.set("buffer",{0:l,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,4),(0,d.A)(e,c.g7,12),(0,d.A)(e,c.JY,t)})();class f{constructor(){(0,n.A)(this,"mutex",void 0),(0,n.A)(this,"pool",0),(0,n.A)(this,"refcount",0),(0,n.A)(this,"size",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"alloc",0),(0,n.A)(this,"alloc2",0),(0,n.A)(this,"poolFree",0)}}a=f,(()=>{const e=a.prototype,t=new Map;t.set("mutex",{0:h.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("pool",{get 0(){return p},1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("refcount",{0:9,1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("size",{0:25,1:0,2:0,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("alloc",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),t.set("alloc2",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:24,8:0}),t.set("poolFree",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:28,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,4),(0,d.A)(e,c.g7,32),(0,d.A)(e,c.JY,t)})();class p{constructor(){(0,n.A)(this,"data",0),(0,n.A)(this,"opaque",0),(0,n.A)(this,"free",0),(0,n.A)(this,"pool",0),(0,n.A)(this,"next",0),(0,n.A)(this,"buffer",void 0)}}o=p,(()=>{const e=o.prototype,t=new Map;t.set("data",{0:2,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("free",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("pool",{0:f,1:1,2:1,3:0,4:0,5:0,6:0,7:12,8:0}),t.set("next",{0:o,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),t.set("buffer",{0:l,1:0,2:0,3:0,4:0,5:0,6:0,7:20,8:0}),(0,d.A)(e,c.Og,!0),(0,d.A)(e,c.dc,4),(0,d.A)(e,c.g7,48),(0,d.A)(e,c.JY,t)})()},8085:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(7127),s=r(8590),a=r(7332);function o(e){return s.ai(e)?a.i[e]||0:s.Pc(e)&&e.prototype[i.Og]?e.prototype[i.g7]:0}},8105:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(7684),a=r(1942);class o extends s.A{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]&&arguments[1]),(0,i.A)(this,"commandQueue",void 0),this.commandQueue=new a.A}async write(e){return this.commandQueue.push((async()=>super.write(e)))}async seek(e){return this.commandQueue.push((async()=>super.seek(e)))}async seekToEnd(){return this.commandQueue.push((async()=>super.seekToEnd()))}async resize(e){return this.commandQueue.push((async()=>super.resize(e)))}async read(e,t){return this.commandQueue.push((async()=>super.read(e,t)))}async appendBufferByPosition(e,t){return this.commandQueue.push((async()=>super.appendBufferByPosition(e,t)))}async close(){return this.commandQueue.push((async()=>super.close()))}async destroy(){await super.destroy(),this.commandQueue.clear(),this.commandQueue=null}get writeQueueSize(){var e,t;return null!==(e=null===(t=this.commandQueue)||void 0===t?void 0:t.length)&&void 0!==e?e:0}}},8150:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(4467),s=r(499),a=r(1762);class o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];(0,i.A)(this,"task",void 0),(0,i.A)(this,"count",void 0),(0,i.A)(this,"emptyCount",void 0),(0,i.A)(this,"started",void 0),(0,i.A)(this,"clock",void 0),(0,i.A)(this,"timestamp",void 0),(0,i.A)(this,"timeout",void 0),(0,i.A)(this,"interval",void 0),(0,i.A)(this,"startTimer",void 0),(0,i.A)(this,"autoInterval",void 0),(0,i.A)(this,"sync",void 0),(0,i.A)(this,"tickAfter",void 0),(0,i.A)(this,"processing",void 0),this.task=e,this.timeout=t,this.interval=r,this.autoInterval=a,this.sync=o,this.count=0,this.emptyCount=0,this.timestamp=0,this.started=!1,this.processing=!1,this.clock=new s.A(this.interval),this.clock.onClock=e=>{if(this.started)if(this.count++,this.sync)this.tickAfter&&(this.tickAfter(),this.tickAfter=null),!1===this.task()?this.stop():this.next(e);else{if(this.processing)return;this.processing=!0,this.task().then((t=>{this.processing=!1,this.tickAfter&&(this.tickAfter(),this.tickAfter=null),!1===t?this.stop():this.next(e)}))}}}next(e){if(!this.started)return;const t=(0,a.A)();if(this.autoInterval&&t-this.timestamp>50){const e=this.emptyCount/this.count;0===this.emptyCount?this.clock.setInterval(Math.max(this.clock.getInterval()>>1,this.interval)):e<.1?this.clock.setInterval(this.clock.getInterval()-1):e>.2?this.clock.setInterval(Math.min(this.clock.getInterval()+1,20)):e>.5&&this.clock.setInterval(this.clock.getInterval()<<1),this.count=0,this.emptyCount=0,this.timestamp=t}e()}start(){this.started=!0,this.timeout?this.startTimer=setTimeout((()=>{this.count=0,this.emptyCount=0,this.timestamp=(0,a.A)(),this.clock.start(),this.startTimer=null}),this.timeout):(this.count=0,this.emptyCount=0,this.timestamp=(0,a.A)(),this.clock.start())}stop(){this.started=!1,this.processing=!1,this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.clock.stop()}async stopBeforeNextTick(){if(this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.clock.isStarted())return this.sync?(this.started=!1,this.processing=!1,void this.clock.stop()):new Promise((e=>{this.tickAfter=()=>{this.started=!1,this.processing=!1,this.clock.stop(),e()}}))}isStarted(){return this.started}emptyTask(){this.emptyCount++}isZeroTimeout(){var e;return null===(e=this.clock)||void 0===e?void 0:e.isZeroTimeout()}restart(){this.clock&&(this.stop(),this.clock.setInterval(this.interval),this.start())}resetInterval(){this.clock.setInterval(Math.max(this.clock.getInterval()>>1,this.interval)),this.emptyCount=0,this.count=0,this.timestamp=(0,a.A)()}destroy(){this.stop(),this.task=null,this.timeout=null,this.interval=null}}},8288:(e,t,r)=>{r.d(t,{A:()=>u});var i=r(3321),s=r(8590),a=r(2734),o=r(7084);function n(e){return s.Yj(e)&&e.split(".").shift()||""}const c=[["alipay",/alipay/],["wechat",/micromessenger/],["dingtalk",/dingtalk[ \/]([\d_.]+)/],["baiduApp",/baiduboxapp/],["baidu",/baidubrowser/],["baidu",/bdbrowser/],["uc",/ucbrowser/],["uc",/ucweb/],["qq",/qqbrowser/],["qqApp",/qq/],["ie",/iemobile[ \/]([\d_.]+)/],["ie",/msie[ \/]([\d_.]+)/],["ie",/trident[ \/]([\d_.]+)/,4],["edge",/edge[ \/]([\d_.]+)/],["newEdge",/edg[ \/]([\d_.]+)/],["chrome",/chrome[ \/]([\d_.]+)/],["firefox",/firefox[ \/]([\d_.]+)/],["opera",/opera(?:.*version)?[ \/]([\d_.]+)/],["safari",/version[ \/]([\d_.]+) safari/],["safari",/version[ \/]([\d_.]+) \S* safari/],["safari",/safari/]],d={},h={},l=function(e){let t,r;return(0,i.__)(c,(i=>{let s=i[1].exec(e);if(s)return t=i[0],r=s[1],r&&(r=r.replace(/_/g,"."),i[2]&&(r=parseInt(r,10)+i[2]+".0")),!1})),"safari"!==t||r||(r=o.A.version),{name:t||"",version:r||"",majorVersion:(d[t]||n)(r),checkVersion:h[t]||a.A}}(("object"==typeof navigator&&navigator.userAgent||"").toLowerCase());l.name&&(l[l.name]=!0);const u=l},8293:(e,t,r)=>{r.d(t,{$$:()=>a,Eh:()=>m,HR:()=>s,IY:()=>y,Ki:()=>w,Ld:()=>d,Mb:()=>A,Sz:()=>l,Xp:()=>c,_R:()=>o,_m:()=>p,d8:()=>g,iW:()=>u,mX:()=>f,n1:()=>n,os:()=>i,qO:()=>h,u6:()=>v});const i={86017:"mp3",86018:"mp4a.40",86021:"vorbis",86028:"flac",86076:"opus",65542:"ulaw",65543:"alaw",86019:"ac-3",86056:"ec-3",86020:"dtsc",65541:"pcm-u8",65540:"pcm-s8",65536:"pcm-s16",65537:"pcm-s16be",65548:"pcm-s24",65549:"pcm-s24be",65544:"pcm-s32",65545:"pcm-s32be",65557:"pcm-f32",65556:"pcm-f32be",65559:"pcm-f64",65558:"pcm-f64be",225:"av01",27:"avc1",173:"hev1",196:"vvc1",139:"vp8",167:"vp09",12:"mp4v"},s={flv:0,mp4:1,m4s:1,mov:1,ts:2,mts:2,m2ts:2,ivf:5,opus:4,oggs:4,ogg:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,mka:8,webm:9,aac:15,flac:17,wav:16,srt:19,vtt:18,ssa:20,ass:20,xml:21,ttml:21,h264:11,264:11,avc:11,h265:12,265:12,hevc:12,h266:13,266:13,vvc:13,mpeg:3,mpg:3,rtsp:6,rtmp:7,avi:10,avif:1,heic:1},a={m3u8:4,m3u:4,mpd:5},o={copy:0,h264:27,h261:3,h263:4,h263i:20,h263p:19,mjpeg:7,wmv1:17,wmv2:18,wmv3:71,avc:27,hevc:173,h265:173,vvc:196,h266:196,av1:225,vp9:167,vp8:139,mpeg4:12,theora:30,mpeg2video:2,rv10:5,rv20:6,rv30:68,rv40:69,png:61,bmp:78,webp:171,tiff:96,gif:97},n={copy:0,aac:86018,ac3:86019,eac3:86056,dts:86020,mp3:86017,opus:86076,flac:86028,speex:86051,vorbis:86021,pcm_alaw:65543,pcm_mulaw:65542,wmav1:86023,wmav2:86024,cook:86036,sipr:86057,ralf:86073,pcm_u8:65541,pcm_s16le:65536,pcm_s24le:65548,pcm_s32le:65544,pcm_s64le:65567,pcm_f32le:65557,pcm_f64le:65559},c={webvtt:94226,subrip:94225,ass:94230,ttml:94232,mov_text:94213,hdmv_pgs:94214,hdmv_text:94231,dvd:94208,dvb:94209,eia_608:94218},d={bin_data:98314},h={yuv420p:0,yuv422p:4,yuv444p:5,yuva420p:33,yuva422p:78,yuva444p:79,yuvj420p:12,yuvj422p:13,yuvj444p:14,yuv420p10le:62,yuv422p10le:64,yuv444p10le:68,yuva420p10le:87,yuva422p10le:89,yuva444p10le:91,yuv420p10be:61,yuv422p10be:63,yuv444p10be:67,yuva420p10be:86,yuva422p10be:88,yuva444p10be:90,rgba:26,rgb24:2,bgr24:3,gray:8},l={u8:0,"u8-planar":5,s16:1,"s16-planar":6,s32:2,"s32-planar":7,s64:10,"s64-planar":11,float:3,"float-planar":8,double:4,"double-planar":9},u={flv:0,isobmff:1,mp4:1,mov:1,ts:2,mpegts:2,mpeg:3,ivf:5,ogg:4,opus:4,m3u8:2,m3u:2,mpd:1,mp3:14,mkv:8,matroska:8,mka:8,webm:9,aac:15,flac:17,wav:16,raw_h264:11,raw_h265:12,raw_vvc:13,rtsp:6,rtmp:7,avi:10,h264:11,h265:12,h266:13},f={tv:1,pc:2},p={bt709:1,fcc:4,bt470bg:5,smpte170m:6,smpte240m:7,ycgco:8,gbr:0,bt2020nc:9},m={bt709:1,bt470m:4,bt470bg:5,smpte170m:6,smpte240m:7,smpte428:10,film:8,smpte431:11,smpte432:12,bt2020:9,"jedec-p22":22,ebu3213:22},g={bt709:1,gamma22:4,gamma28:5,smpte170m:6,smpte240m:7,srgb:13,xvycc:11,"bt2020-10":14,"bt2020-12":15,smpte2084:16,"arib-std-b67":18},A={Audio:1,Video:0,Subtitle:3,Attachment:4,Data:2},v={"Tile Grid":3,"Audio Element":1,"Mix Presentation":2},w={default:1,dub:2,original:4,comment:8,lyrics:16,karaoke:32,forced:64,"hearing impaired":128,"visual impaired":256,"clean effects":512,"attached pic":1024,"timed thumbnails":2048,captions:65536,descriptions:131072,metadata:262144,dependent:524288,"still image":1048576,thumbnail:8192},y={mono:4,stereo:3,2.1:11,"3.0":7,"3.0(back)":259,"4.0":263,quad:51,"quad(side)":1539,3.1:15,"5.0":55,"5.0(side)":1543,4.1:271,5.1:63,"5.1(side)":1551,"6.0":1799,"6.0(front)":1731,"3.1.2":20495,hexagonal:311,6.1:1807,"6.1(back)":319,"6.1(front)":1739,"7.0":1591,"7.0(front)":1735,7.1:1599,"7.1(wide)":255,"7.1(wide-side)":1743,"5.1.2":20543,octagonal:1847,cube:184371,"5.1.4":184383,"7.1.2":22079,"7.1.4":185919,"7.2.3":34359825983,"9.1.4":186111,hexadecagonal:6442710839,downmix:1610612736,22.2:2164663779327}},8335:(e,t,r)=>{r.d(t,{A:()=>h});const i='\nfunction webpackBootstrapFunc (modules) {\n  var installedModules = {};\n  function __webpack_require__(moduleId) {\n    if(installedModules[moduleId])\n    return installedModules[moduleId].exports;\n    var module = installedModules[moduleId] = {\n      i: moduleId,\n      l: false,\n      exports: {}\n    };\n    if (!modules[moduleId]) {\n      console.error(\'can not found module:\', moduleId)\n    }\n    modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n    module.l = true;\n    return module.exports;\n  }\n  __webpack_require__.m = modules;\n  __webpack_require__.c = installedModules;\n  __webpack_require__.i = function(value) { return value; };\n  __webpack_require__.d = function(exports, definition, getter) {\n    if (typeof definition === \'string\') {\n      if(!__webpack_require__.o(exports, definition)) {\n        Object.defineProperty(exports, definition, {\n          enumerable: true,\n          get: getter\n        });\n      }\n    }\n    else {\n      for(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n          Object.defineProperty(exports, key, {\n            enumerable: true,\n            get: definition[key]\n          });\n        }\n      }\n    }\n  };\n  __webpack_require__.r = function(exports) {\n    if(typeof Symbol !== \'undefined\' && Symbol.toStringTag) {\n    \tObject.defineProperty(exports, Symbol.toStringTag, { value: \'Module\' });\n    }\n    Object.defineProperty(exports, \'__esModule\', { value: true });\n  };\n  __webpack_require__.f = {};\n  __webpack_require__.e = function(chunkId) {\n    return Promise.all(Object.keys(__webpack_require__.f).reduce(function (promises, key) {\n      __webpack_require__.f[key](chunkId, promises);\n        return promises;\n    \t}, []));\n\t};\n  __webpack_require__.u = function(chunkId) {\n    return chunkId + "LIB_NAME";\n  };\n  __webpack_require__.n = function(module) {\n    var getter = module && module.__esModule ?\n      function getDefault() { return module[\'default\']; } :\n      function getModuleExports() { return module; };\n    __webpack_require__.d(getter, \'a\', getter);\n    return getter;\n  };\n  (function() {\n    var installedChunks = {\n      "main": 0\n    };\n    __webpack_require__.f.j = function(chunkId, promises) {\n      var installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n      if (installedChunkData !== 0) {\n        if(installedChunkData) {\n          promises.push(installedChunkData[2]);\n        } else {\n          if (true) {\n            var promise = new Promise(function(resolve, reject){installedChunkData = installedChunks[chunkId] = [resolve, reject]});\n            promises.push(installedChunkData[2] = promise);\n            var url = __webpack_require__.p + __webpack_require__.u(chunkId);\n            var error = new Error();\n            var loadingEnded = function(event) {\n              if(__webpack_require__.o(installedChunks, chunkId)) {\n                installedChunkData = installedChunks[chunkId];\n                if(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n                if(installedChunkData) {\n                  var errorType = event && (event.type === \'load\' ? \'missing\' : event.type);\n                  var realSrc = url;\n                  error.message = "Loading chunk " + chunkId + " failed.\\n(" + errorType + ": " + realSrc + ")";\n                  error.name = "ChunkLoadError";\n                  error.type = errorType;\n                  error.request = realSrc;\n                  installedChunkData[1](error);\n                }\n              }\n            };\n            __webpack_require__.l(url, loadingEnded);\n          }\n        }\n      }\n    };\n    var webpackJsonpCallback = function(parentChunkLoadingFunction, data) {\n    var [chunkIds, moreModules, runtime] = data;\n    var moduleId, chunkId, i = 0;\n    if (chunkIds.some(function(id){return installedChunks[id] !== 0})) {\n      for(moduleId in moreModules) {\n        if(__webpack_require__.o(moreModules, moduleId)) {\n          __webpack_require__.m[moduleId] = moreModules[moduleId];\n        }\n      }\n      if(runtime) runtime(__webpack_require__);\n    }\n    if (parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n      for (;i < chunkIds.length; i++) {\n        chunkId = chunkIds[i];\n        if (__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n          installedChunks[chunkId][0]();\n        }\n        installedChunks[chunkId] = 0;\n      }\n    }\n    var self = typeof globalThis !== undefined ? globalThis : self\n    var exportName = \'LIBRARY_EXPORT_NAME\'\n    var chunkLoadingGlobal = self["webpackChunk" + exportName] = self["webpackChunk" + exportName] || [];\n    chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\n    chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));\n  })();\n  (function() {\n    var inProgress = {};\n    __webpack_require__.l = function(url, done) {\n      if (inProgress[url]) { inProgress[url].push(done); return; }\n        inProgress[url] = [done];\n        var onComplete = function(event) {\n          clearTimeout(timeout);\n          var doneFns = inProgress[url];\n          delete inProgress[url];\n          doneFns && doneFns.forEach(function(fn){fn(event)});\n        }\n        var timeout = setTimeout(onComplete.bind(null, undefined, { type: "timeout" }), 120000);\n      if (typeof importScripts === \'function\') {\n        try {\n          importScripts(url);onComplete({type: "load"});\n        }\n        catch(e) {\n          onComplete({type: "missing"});\n        }\n      }\n      else {\n        import(url).then(function() {\n          onComplete({\n            type: "load"\n          });\n        }, function (error) {\n          onComplete({\n            type: "missing"\n          });\n        })\n      }\n    };\n  })();\n  __webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n  __webpack_require__.p = "ROOT_URL";\n  __webpack_require__.oe = function(err) { console.error(err); throw err; };\n  var f = __webpack_require__(__webpack_require__.s = ENTRY_MODULE);\n  return f;\n}\n',s="[\\.|\\-|\\+|\\w|/|@|!]+",a="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)";function o(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function n(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(e,t,i,c,d){const h={};h[i]=[];let l=t.toString(),u="",f="",p=l.match(/^(function)?\s?[\w$]*\([\w$]+,\s*([\w$]+),\s*([\w$]+)\)/);if(p)u=p[3],f=p[2];else{if(p=l.match(new RegExp(`^("?${n(d+"")}"?)\\s*(\\/\\*[\\s\\S]*?\\*\\/)?\\s*\\([\\w$]+,\\s*([\\w$]+),\\s*([\\w$]+)\\)`)),!p)return h;u=p[4],f=p[3]}c.__webpack_exports_process__||(c.__webpack_require__=u,c.__webpack_exports__=f,c.__webpack_exports_process__=!0);let m,g=new RegExp("(\\\\n|\\W)"+o(u)+a,"g");for(;m=g.exec(l);)"dll-reference"!==m[3]&&h[i].push(m[3]);for(g=new RegExp("(\\\\n|\\W)"+o(u)+"\\.bind\\("+u+",\\s*(/\\*.*?\\*/)?\\s*.*?("+s+").*?\\)","g");m=g.exec(l);)"dll-reference"!==m[3]&&h[i].push(m[3]);for(g=new RegExp("\\("+o(u)+'\\("(dll-reference\\s('+s+'))"\\)\\)'+a,"g");m=g.exec(l);)e[m[2]]||(h[i].push(m[1]),e[m[2]]=r(m[1]).m),h[m[2]]=h[m[2]]||[],h[m[2]].push(m[4]);const A=Object.keys(h);for(let e=0;e<A.length;e++)for(let t=0;t<h[A[e]].length;t++)v=+h[A[e]][t],isNaN(v)||(h[A[e]][t]=+h[A[e]][t]);var v;return h}function d(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}function h(e,t){const s={main:r.m},a=function(e,t){const r={main:[t]},i={main:[],__webpack_exports__:"__webpack_exports__",__webpack_require__:"__webpack_require__",__webpack_exports_process__:!1},s={main:{}};for(;d(r);){const t=Object.keys(r);for(let a=0;a<t.length;a++){let o=t[a],n=r[o].pop();if(s[o]=s[o]||{},s[o][n]||!e[o][n])continue;s[o][n]=!0,i[o]=i[o]||[],i[o].push(n);let d=c(e,e[o][n],o,i,n),h=Object.keys(d);for(let e=0;e<h.length;e++)r[h[e]]=r[h[e]]||[],r[h[e]]=r[h[e]].concat(d[h[e]])}}return i}(s,e);let o=JSON.stringify(e);return"var "+t.varName+"=("+i.replace("ENTRY_MODULE",o).replace("ROOT_URL",r.p||"").replace("LIBRARY_EXPORT_NAME","AVTranscoder").replace("LIB_NAME",r.u&&r.u("")||"")+")({"+a.main.map((function(e){const r=JSON.stringify(e),i=s.main[e].toString();let c="";if(c=new RegExp(`^s*"?${n(e+"")}"?`).test(i)?i:r+": "+i,r===o&&t.exportName&&t.pointName){const e=`;${a.__webpack_require__}.d(\n          ${a.__webpack_exports__},\n          "${t.exportName}",\n          function() {\n            if (${t.exportIsClass}) {\n              for (var key in ${a.__webpack_exports__}) {\n                if (key === '${t.exportName}') {\n                  continue;\n                }\n                var v = ${a.__webpack_exports__}[key];\n                if (typeof v === 'function' && v.name === '${t.pointName}') {\n                  return v;\n                }\n              }\n            }\n            return ${t.pointName};\n          }\n        );`;c=c.slice(0,c.length-1)+e+"}"}return c})).join(",")+"});"}},8370:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(4467),s=r(4405);class a{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,r&&r.view)this.size=r.length,this.buffer=r,this.data=r.view;else if(r&&!r.byteOffset)this.size=r.length,this.buffer=r,this.data=new DataView(this.buffer.buffer);else{if(r)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,r=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(r),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(r),this.writeUint8(i))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let r=0;for(;t>0;){this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(r,r+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),r+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=s.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}},8387:(e,t,r)=>{function i(){let e;"object"==typeof __WebAssemblyRunner__?e=__WebAssemblyRunner__.__WebAssemblyRunner__:"object"==typeof __CHeap_WebAssemblyRunner__&&(e=__CHeap_WebAssemblyRunner__.default);let t,r,i=self,s=0;i.onmessage=a=>{const o=a.data,n=o.type,c=o.data;switch(n){case"run":i.postMessage({type:"run"}),self.CHeap&&self.CHeap.initThread&&self.CHeap.initThread(c.cheap).then((()=>{self.__SELF_THREAD__=c.runner.thread,c.runner.options.imports=self.imports,t=new e(c.runner.resource,c.runner.options),t.runAsChild(),e.getTable().get(c.runner.func)(c.runner.args),t.destroy()}));break;case"ready":r=c.runner,s=c.cheap.stackPointer,self.CHeap&&self.CHeap.initThread&&self.CHeap.initThread(c.cheap).then((()=>{i.postMessage({type:"ready"})}));break;case"wait":{async function d(){for(;;){for(e.mutexLock(s+16);0===e.readPointer(s);)e.condWait(s+12,s+16);self.__SELF_THREAD__=e.readPointer(s),r.options.thread=e.readPointer(s),r.thread=e.readPointer(s),r.func=e.readPointer(s+4),r.args=e.readPointer(s+8),t=new e(r.resource,r.options),t.runAsChild(),e.getTable().get(r.func)(r.args),t.destroy(),e.writePointer(s,0),e.mutexUnlock(s+16)}}r.options.imports=self.imports,d();break}}}}r.r(t),r.d(t,{default:()=>i})},8413:(e,t,r)=>{r.d(t,{A:()=>I});var i=r(4467),s=r(9983),a=r(2320),o=r(4365),n=r(495),c=r(4187),d=r(3394),h=r(1755),l=r(3262),u=r(1237),f=r(9239),p=r(3831),m=r(6760),g=r(3674),A=r(1058),v=r(2479),w=r(3463),y=r(8590),b=r(665),k=r(9906),_=r(8547);class I{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"encoder",void 0),(0,i.A)(this,"parameters",0),(0,i.A)(this,"timeBase",void 0),(0,i.A)(this,"framerateTimebase",void 0),(0,i.A)(this,"inputCounter",BigInt(0)),(0,i.A)(this,"avpacket",0),(0,i.A)(this,"avframe",0),(0,i.A)(this,"encodeQueueSize",0),(0,i.A)(this,"bitrateFilter",void 0),(0,i.A)(this,"extradata",null),(0,i.A)(this,"encoderOptions",0),this.options=e,this.encoder=new A.A(this.options.resource)}getAVPacket(){return this.avpacket?this.avpacket:this.avpacket=this.options.avpacketPool?this.options.avpacketPool.alloc():(0,c._5)()}outputAVPacket(){if(this.avpacket){if(27===s.f[15](this.parameters+4)||173===s.f[15](this.parameters+4)||196===s.f[15](this.parameters+4)){if(a.M[15](this.avpacket+36,64|s.f[15](this.avpacket+36)),!(1&s.f[15](this.parameters+160))){if(!this.bitrateFilter){this.bitrateFilter=new _.A;const e=v.z(8);a.M[15](e,this.timeBase.num),a.M[15](e+4,this.timeBase.den),this.bitrateFilter.init(this.parameters,e),v.t(8)}this.bitrateFilter.sendAVPacket(this.avpacket),this.bitrateFilter.receiveAVPacket(this.avpacket)}if(!this.extradata){const e=(0,c.rU)(this.avpacket,1);e&&(this.extradata=(0,g.s3)(s.f[20](e),s.f[25](e+4)).slice())}}else 225===s.f[15](this.parameters+4)?this.extradata||(this.extradata=p.Yj(this.parameters,(0,c.iI)(this.avpacket))):167===s.f[15](this.parameters+4)&&(this.extradata||(this.extradata=m.Yj(this.parameters)));a.M[15](this.avpacket+76,this.timeBase.den),a.M[15](this.avpacket+72,this.timeBase.num),a.M[17](this.avpacket+48,(0,l.k)(BigInt(1),this.framerateTimebase,this.timeBase)),this.options.onReceiveAVPacket(this.avpacket),this.avpacket=0,this.encodeQueueSize--}}receiveAVPacket(){return this.encoder.invoke("encoder_receive",this.getAVPacket())}receiveAVPacketAsync(){return this.encoder.invokeAsync("encoder_receive",this.getAVPacket())}async open(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await this.encoder.run(void 0,r);const c=o.s_.malloc(8),d=o.s_.malloc(4);a.M[15](c,t.num),a.M[15](c+4,t.den),a.M[20](d,0),12!==s.f[15](e+4)||1&s.f[15](e+160)||this.encoder.invoke("encoder_set_flags",4194304),this.encoder.invoke("encoder_set_max_b_frame",s.f[15](e+104)),b.HP(i).length&&(this.encoderOptions&&(f.AO(this.encoderOptions),o.s_.free(this.encoderOptions),this.encoderOptions=0),this.encoderOptions=(0,h.Gy)(8),b.__(i,((e,t)=>{(y.Yj(e)||y.Yj(t))&&f.a5(this.encoderOptions,t,e)})),a.M[20](d,this.encoderOptions));let l=0;return w.A.jspi?l=await this.encoder.invokeAsync("encoder_open",e,c,r,d):(l=this.encoder.invoke("encoder_open",e,c,r,d),await this.encoder.childThreadsReady()),this.encoderOptions=s.f[20](d),o.s_.free(d),o.s_.free(c),l<0?(k.z3(`open video encoder failed, ret: ${l}`,"packages/avcodec/src/wasmcodec/VideoEncoder.ts",223),n.r8):(this.parameters=e,this.timeBase=t,this.inputCounter=BigInt(0),this.framerateTimebase={den:s.f[15](e+72),num:s.f[15](e+76)},this.encodeQueueSize=0,0)}preEncode(e,t){return this.avframe?(0,d.to)(this.avframe):this.avframe=(0,d.FP)(),(0,d.gg)(this.avframe,e),e=this.avframe,t&&a.M[15](e+88,1),this.options.copyTs&&s.f[17](e+104)!==u.Dh&&0!==s.f[15](e+124)&&0!==s.f[15](e+120)?a.M[17](e+104,(0,l.Mr)(s.f[17](e+104),e+120,this.timeBase)):a.M[17](e+104,(0,l.k)(this.inputCounter,this.framerateTimebase,this.timeBase)),this.inputCounter++,a.M[15](e+124,this.timeBase.den),a.M[15](e+120,this.timeBase.num),e}encode(e,t){e=this.preEncode(e,t);let r=this.encoder.invoke("encoder_encode",e);if(r)return r;for(this.encodeQueueSize++;;){let e=this.receiveAVPacket();if(1!==e){if(e<0)return e;break}this.outputAVPacket()}return 0}async encodeAsync(e,t){e=this.preEncode(e,t);let r=await this.encoder.invokeAsync("encoder_encode",e);if(r)return r;for(this.encodeQueueSize++;;){let e=await this.receiveAVPacketAsync();if(1!==e){if(e<0)return e;break}this.outputAVPacket()}return 0}async flush(){for(this.encoder.invoke("encoder_flush");;){const e=this.receiveAVPacket();if(e<1)return e;this.outputAVPacket()}return 0}async flushAsync(){for(await this.encoder.invokeAsync("encoder_flush");;){const e=await this.receiveAVPacketAsync();if(e<1)return e;this.outputAVPacket()}return 0}getExtraData(){if(this.extradata)return this.extradata;const e=this.encoder.invoke("encoder_get_extradata"),t=this.encoder.invoke("encoder_get_extradata_size");return e&&t?(0,g.s3)(e,t).slice():null}getColorSpace(){return{colorSpace:this.encoder.invoke("encoder_get_color_space"),colorPrimaries:this.encoder.invoke("encoder_get_color_primaries"),colorTrc:this.encoder.invoke("encoder_get_color_trc")}}close(){this.encoder.invoke("encoder_close"),this.encoder.destroy(),this.avpacket&&(this.options.avpacketPool?this.options.avpacketPool.release(this.avpacket):(0,c.Qe)(this.avpacket),this.avpacket=0),this.avframe&&((0,d.xj)(this.avframe),this.avframe=0),this.bitrateFilter&&(this.bitrateFilter.destroy(),this.bitrateFilter=void 0),this.encoderOptions&&(f.AO(this.encoderOptions),o.s_.free(this.encoderOptions),this.encoderOptions=0)}getQueueLength(){return this.encodeQueueSize}getChildThreadCount(){return this.encoder?this.encoder.getChildThreadCount():0}}},8477:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(9983),s=r(8293),a=r(3831),o=r(8039),n=r(6760),c=r(4096),d=r(4229),h=r(1237),l=r(3674),u=r(8927),f=r(3670),p=r(1958);function m(e,t){const r=i.f[15](e+4);let m=i.f[15](e+48),g=i.f[15](e+52);!t&&0!==i.f[20](e+12)&&i.f[15](e+16)&&(t=(0,l.s3)(i.f[20](e+12),i.f[15](e+16)));let A=s.os[r],v="";if(27===r)110===m&&(m=100),v=u.GP("%s.%02x00%02x",A,255&m,255&g);else if(173===r){let e=0,r=0,i=0,s=0;t&&(p.Bs(t)&&(t=d.S1(t)),t.length>13&&(e=t[1]>>>6&3,i=t[1]>>>5&1,r=t[2]|t[3]<<8|t[4]<<16|t[5]<<24,s=240&t[6]));const a={0:"",1:"A",2:"B",3:"C"};v=u.GP("%s.%s%d.%x.%s%d.%x",A,a[e],m,r,0===i?"L":"H",g,s)}else if(196===r){var w;let e=0;if((null===(w=t)||void 0===w?void 0:w.length)>13&&(e=1&t[5]),v=u.GP("%s.%d.%s%d",A,m,0===e?"L":"H",g),t){p.Bs(t)&&(t=c.S1(t));const e=c.Ui(t);if(e.generalConstraintInfo.length){let t=e.generalConstraintInfo.length-1;for(;t>0&&0===e.generalConstraintInfo[t];)t--;const r=e.generalConstraintInfo.slice(0,t+1);r.length&&(v+=`.C${f.l(new Uint8Array(r),!1)}`)}e.generalSubProfileIdc.length&&(v+=`.S${e.generalSubProfileIdc.map((e=>e.toString(16))).join("+")}`),v+=`.O${e.olsIdx}+${e.numSublayers}`}}else if(225===r)if(t){const e=a.Ui(t);v=u.GP("%s.%d.%02d%s.%02d.%d.%d%d%d",A,e.profile,e.level,e.tier?"H":"M",e.bitDepth,e.monochrome,e.chromaSubsamplingX,e.chromaSubsamplingY,e.chromaSamplePosition)}else v=u.GP("%s.%d.%02dM.08",A,m,g);else if(139===r)if(t){const e=o.Ui(t);v=u.GP("%s.%02d.%02d.%02d",A,e.profile,e.level,e.bitDepth)}else v=m!==h.N_&&g!==h.N_?u.GP("%s.%02d.%02d.08",A,m,g):A;else if(167===r)if(t){const e=n.Ui(t);v=u.GP("%s.%02d.%02d.%02d.%02d.%02d.%02d.%02d.%02d",A,e.profile,e.level,e.bitDepth,e.chromaSubsampling,e.colorPrimaries,e.colorTrc,e.colorSpace,e.fullRangeFlag)}else v=m!==h.N_&&g!==h.N_?u.GP("%s.%02d.%02d.08.00",A,m,g):u.GP("%s.%02d.%02d.08.00",A,0,40);else v=A||"unknown";return v}},8517:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(7127);function s(e){e[i.o9]=0}},8547:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(4467),s=r(9983),a=r(2320),o=r(3458),n=r(3674),c=r(9906),d=r(495),h=r(4187),l=r(1755),u=r(1497),f=r(4229),p=r(4096);class m extends o.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),(0,i.A)(this,"cache",void 0),(0,i.A)(this,"cached",void 0),(0,i.A)(this,"reverseSps",void 0),this.reverseSps=e}init(e,t){return super.init(e,t),this.cache=(0,h._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,h.Qe)(this.cache),this.cache=0}sendAVPacket(e){if(64&s.f[15](e+36)){let t;(0,h.zu)(this.cache,e);const r=(0,n.JW)(s.f[20](e+24),s.f[15](e+28));if(27===s.f[15](this.inCodecpar+4)?t=u.oT(r,this.reverseSps):173===s.f[15](this.inCodecpar+4)?t=f.oT(r,this.reverseSps):196===s.f[15](this.inCodecpar+4)?t=p.oT(r,this.reverseSps):c.h2(`not support for codecId: ${s.f[15](this.inCodecpar+4)}`,"packages/avformat/src/bsf/h2645/Annexb2AvccFilter.ts",114),a.M[15](this.cache+36,-65&s.f[15](this.cache+36)),(0,h.NX)(this.cache,t.bufferPointer,t.length),t.key&&a.M[15](this.cache+36,1|s.f[15](this.cache+36)),t.extradata){const e=(0,l.sY)(t.extradata.length);(0,n.lW)(e,t.extradata.length,t.extradata),(0,h.Ow)(this.cache,1,e,t.extradata.length)}}else(0,h.rN)(this.cache,e);return this.cached=!0,0}receiveAVPacket(e){return this.cached?((0,h.Up)(e),(0,h.rN)(e,this.cache),this.cached=!1,0):d.LR}reset(){return 0}}},8560:(e,t,r)=>{r.d(t,{__:()=>a});var i=r(2494);const s={};function a(e,t){const r=s.hasOwnProperty(e)?s[e]:s[e]=e.split(i.ZG);for(let e=0,s=r.length-1;e<=s&&t(r[e],e===s)!==i.W8;e++);}},8588:(e,t,r)=>{r.d(t,{T8:()=>h,r0:()=>d,wm:()=>c});var i=r(9983),s=r(2320),a=r(3674),o=r(4187),n=r(1755);function c(e){const t={pts:i.f[17](e+8),dts:i.f[17](e+16),data:(0,o.iI)(e).slice(),streamIndex:i.f[15](e+32),flags:i.f[15](e+36),sideData:[],duration:i.f[17](e+48),pos:i.f[17](e+56),timeBase:{den:i.f[15](e+76),num:i.f[15](e+72)}};for(let r=0;r<i.f[15](e+44);r++){const s={type:i.f[15](i.f[20](e+40)+12*r+8),data:(0,a.s3)(i.f[20](i.f[20](e+40)+12*r),i.f[25](i.f[20](e+40)+12*r+4)).slice()};t.sideData.push(s)}return t}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t||(t=(0,o._5)()),s.M[17](t+8,e.pts),s.M[17](t+16,e.dts);const r=(0,n.sY)(e.data.length);if((0,a.lW)(r,e.data.length,e.data),(0,o.NX)(t,r,e.data.length),s.M[15](t+32,e.streamIndex),s.M[15](t+36,e.flags),s.M[17](t+48,e.duration),s.M[17](t+56,e.pos),s.M[15](t+76,e.timeBase.den),s.M[15](t+72,e.timeBase.num),e.sideData.length)for(let r=0;r<e.sideData.length;r++){const i=(0,n.sY)(e.sideData[r].data.length);(0,a.lW)(i,e.sideData[r].data.length,e.sideData[r].data),(0,o.Ow)(t,e.sideData[r].type,i,e.sideData[r].data.length)}else(0,o.NZ)(t+40,t+44);return t}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t||(t=(0,n.sY)(168),(0,a.sO)(t,0,168)),s.M[15](t,e.codecType),s.M[15](t+4,e.codecId),s.M[8](t+8,e.codecTag),e.extradata&&(i.f[20](t+12)&&(0,n.Eb)(i.f[20](t+12)),s.M[20](t+12,(0,n.sY)(e.extradata.length)),(0,a.lW)(i.f[20](t+12),e.extradata.length,e.extradata),s.M[15](t+16,e.extradata.length)),e.codedSideData.length)for(let r=0;r<e.codedSideData.length;r++){const i=(0,n.sY)(e.codedSideData[r].data.length);(0,a.lW)(i,e.codedSideData[r].data.length,e.codedSideData[r].data),(0,o.$W)(t+20,t+24,e.codedSideData[r].type,i,e.codedSideData[r].data.length)}else(0,o.NZ)(t+20,t+24);return s.M[15](t+28,e.format),s.M[17](t+32,e.bitrate),s.M[15](t+40,e.bitsPerCodedSample),s.M[15](t+44,e.bitsPerRawSample),s.M[15](t+48,e.profile),s.M[15](t+52,e.level),s.M[15](t+56,e.width),s.M[15](t+60,e.height),s.M[15](t+68,e.sampleAspectRatio.den),s.M[15](t+64,e.sampleAspectRatio.num),s.M[15](t+76,e.framerate.den),s.M[15](t+72,e.framerate.num),s.M[15](t+80,e.fieldOrder),s.M[15](t+84,e.colorRange),s.M[15](t+88,e.colorPrimaries),s.M[15](t+92,e.colorTrc),s.M[15](t+96,e.colorSpace),s.M[15](t+100,e.chromaLocation),s.M[15](t+104,e.videoDelay),s.M[15](t+112,e.chLayout.order),s.M[15](t+116,e.chLayout.nbChannels),s.M[10](t+120,e.chLayout.u),s.M[15](t+136,e.sampleRate),s.M[15](t+140,e.blockAlign),s.M[15](t+144,e.frameSize),s.M[15](t+148,e.initialPadding),s.M[15](t+152,e.trailingPadding),s.M[15](t+156,e.seekPreroll),s.M[15](t+160,e.flags),t}},8590:(e,t,r)=>{r.d(t,{Ik:()=>o,Pc:()=>s,YO:()=>a,Yj:()=>n,ai:()=>c,o:()=>d,sH:()=>l,sv:()=>u,zM:()=>h});var i=r(2494);function s(e){return typeof e===i.s0}function a(e){return Array.isArray(e)}function o(e){return e!==i.Cq&&"object"==typeof e}function n(e){return"string"==typeof e}function c(e){return"number"==typeof e&&!isNaN(e)}function d(e){return"bigint"==typeof e}function h(e){return"boolean"==typeof e}function l(e){return c(e)||n(e)&&!isNaN(parseFloat(e))&&isFinite(+e)}function u(e){return e instanceof ArrayBuffer}},8636:(e,t,r)=>{r.d(t,{Cv:()=>n,w8:()=>s});var i=r(2320);function s(e,t){i.M[2](e,255&t)}function a(e,t){s(e,t>>>8),s(e+1,t)}function o(e,t){a(e,t>>>16),a(e+2,65535&t)}function n(e,t){o(e,Number(BigInt.asUintN(32,t>>BigInt(32)))),o(e+4,Number(BigInt.asUintN(32,t)))}},8687:(e,t,r)=>{r.d(t,{r:()=>d});var i,s,a=r(4467),o=r(7127),n=r(7601);class c{constructor(){(0,a.A)(this,"id",void 0),(0,a.A)(this,"name",void 0),(0,a.A)(this,"opaque",void 0)}}i=c,(()=>{const e=i.prototype,t=new Map;t.set("id",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("name",{0:4,1:0,2:0,3:1,4:16,5:0,6:0,7:4,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:20,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,4),(0,n.A)(e,o.g7,24),(0,n.A)(e,o.JY,t)})();class d{constructor(){(0,a.A)(this,"order",void 0),(0,a.A)(this,"nbChannels",void 0),(0,a.A)(this,"u",void 0),(0,a.A)(this,"opaque",void 0)}}s=d,(()=>{const e=s.prototype,t=new Map;t.set("order",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("nbChannels",{0:15,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),t.set("u",{0:function(e){const t=new Map;return t.set("mask",{0:10,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("map",{0:c,1:1,2:1,3:0,4:0,5:0,6:0,7:0,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,8),(0,n.A)(e,o.JY,t),e}({}),1:0,2:0,3:0,4:0,5:0,6:0,7:8,8:0}),t.set("opaque",{0:1,1:1,2:1,3:0,4:0,5:0,6:0,7:16,8:0}),(0,n.A)(e,o.Og,!0),(0,n.A)(e,o.dc,8),(0,n.A)(e,o.g7,24),(0,n.A)(e,o.JY,t)})()},8696:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(4467),s=r(1755),a=r(4187),o=r(9882),n=r(5419);class c{constructor(e,t){(0,i.A)(this,"list",void 0),(0,i.A)(this,"mutex",void 0),this.list=e,this.mutex=t}alloc(){let e=this.list.find((e=>-1===o.p_(e+80,-1,1,16,2)),20);return e||(e=(0,s.Gy)(88),(0,a.Pd)(e),o.M_(e+80,1,16,2),n.s2(this.mutex),this.list.push(e,20),n.Tl(this.mutex)),e}release(e){o.Hh(e+80,16,2)<=0||1===o.jb(e+80,1,16,2)&&((0,a.Up)(e),o.M_(e+80,-1,16,2))}}},8710:(e,t,r)=>{r.d(t,{Ts:()=>l,XR:()=>g,Zr:()=>m,bE:()=>f,uk:()=>p,zr:()=>u});var i,s=r(4467),a=r(7127),o=r(7601),n=r(5419),c=r(9983),d=r(2320),h=r(9882);function l(e,t){return h.M_(e,0|t,16,2),n.Ts(e+4),0}function u(e){return n.zr(e+4),0}function f(e){return h.WQ(e,1,16,2),h.me(e,1),0}function p(e){for(;h.uk(e,0),h.jb(e,1,16,2)<=0;)h.WQ(e,1,16,2);return 0}function m(e){return n.s2(e+4),c.f[16](e)>0?(d.M[16](e,c.f[16](e)-1),n.Tl(e+4),0):(n.Tl(e+4),11)}function g(e,t){return 2!==h.j4(e,0,t)&&h.jb(e,1,16,2)<=0?(h.WQ(e,1,16,2),110):0}i=class{constructor(){(0,s.A)(this,"atomic",void 0),(0,s.A)(this,"mutex",void 0)}},(()=>{const e=i.prototype,t=new Map;t.set("atomic",{0:16,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0}),t.set("mutex",{0:n.eu,1:0,2:0,3:0,4:0,5:0,6:0,7:4,8:0}),(0,o.A)(e,a.Og,!0),(0,o.A)(e,a.dc,4),(0,o.A)(e,a.g7,8),(0,o.A)(e,a.JY,t)})()},8738:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(9983),s=r(8293);function a(e){const t=i.f[15](e+4);let r=i.f[15](e+48),a=s.os[t];return 86018===t&&(a=`${a}.${r}`),a||"unknown"}},8742:(e,t,r)=>{r.r(t),r.d(t,{TASK_ENDED:()=>i,TASK_ERROR:()=>s});const i="task-ended",s="task-error"},8761:(e,t,r)=>{r.d(t,{Cj:()=>S,Ib:()=>E,ho:()=>T,jF:()=>U});var i=r(7127),s=r(9983),a=r(2320),o=r(7145),n=r(6890),c=r(8687),d=r(6347),h=r(2150),l=r(4875),u=r(5782),f=r(8952),p=r(3674),m=r(495),g=r(4187),A=r(3394),v=r(3262),w=r(1237),y=r(3321),b=r(665),k=r(9906),_=r(5946),I=r(245);const x="packages/avformat/src/demux.ts",M=16,P={fastOpen:!1,maxAnalyzeDuration:15e3};async function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=b.X$({},P,t);return e.ioReader||k.h2("need IOReader",x,117),e.iformat||k.h2("need iformat",x,120),2===e.iformat.type&&(r.maxAnalyzeDuration=Math.max(r.maxAnalyzeDuration,2e3)),e.iformat.init(e),e.options=r,e.iformat.readHeader(e)}async function E(e){const t={},r={},p={},m={},k={},x={},P={},T=e.iformat.getAnalyzeStreamsCount();let E=0;const B=[];let C=0;function U(){if(!e.getDecoderResource)return!0;for(let t=0;t<e.streams.length;t++)if(x[e.streams[t].index]&&!P[e.streams[t].index])return!1;return!0}function D(e,t){let i=r[e.index];const o=p[e.index];let n=e.codecpar.videoDelay;if(null!=o&&o.length&&(n=Math.min(Math.max((0,u.A)(o),e.codecpar.videoDelay),16),t&&(e.codecpar.videoDelay=n)),!i&&null!=o&&o.length){i=n?(0,f.A)(n,o):o.slice();const t={delay:n,dtsQueue:i};i=[],k[e.index]=t;for(let r=0;r<B.length;r++)if(e.index===s.f[15](B[r]+32)){const o=t.dtsQueue.shift();a.M[17](B[r]+16,o),i.push(o);const n=e.sampleIndexes.find((e=>e.pts===s.f[17](B[r]+8)));n&&(n.dts=s.f[17](B[r]+16))}}if(i&&i.length>1){let t=BigInt(0);for(let e=1;e<i.length;e++)t+=i[e]-i[e-1];if(1===e.codecpar.codecType&&e.codecpar.sampleRate>0&&!e.codecpar.frameSize){let r=Number(t)/(i.length-1);e.codecpar.frameSize=Math.round(r/e.timeBase.den*e.timeBase.num*e.codecpar.sampleRate)}else if(0===e.codecpar.codecType){const r=(0,v.j2)(e.timeBase.den*(i.length-1)/(Number(t)*e.timeBase.num),w.go);e.codecpar.framerate.num=r.num,e.codecpar.framerate.den=r.den,(0,l.A)(e.codecpar.framerate)}const r=Number(i[i.length-1]-e.startTime)*e.timeBase.num/e.timeBase.den;r&&(e.codecpar.bitrate=BigInt(Math.floor(8*m[e.index]/r)))}}async function R(){for(let t=0;t<e.streams.length;t++){const r=e.streams[t];if(1024&r.disposition){if(r.attachedPic&&e.getDecoderResource){const t=await e.getDecoderResource(r.codecpar.codecType,r.codecpar.codecId);if(!t)continue;t.threadModule&&delete t.threadModule;const a=new I.A({resource:t,onReceiveAVFrame:e=>{r.codecpar.format=s.f[15](e+80),r.codecpar.colorRange=s.f[15](e+208),r.codecpar.colorSpace=s.f[15](e+220),r.codecpar.colorPrimaries=s.f[15](e+212),r.codecpar.colorTrc=s.f[15](e+216),r.codecpar.chromaLocation=s.f[15](e+224),s.f[15](e+92)&&s.f[15](e+96)&&(r.codecpar.sampleAspectRatio=(0,n.A)(e+92,o.Q)),r.codecpar.width=s.f[15](e+68),r.codecpar.height=s.f[15](e+72),(0,A.xj)(e)}});await a.open(r.codecpar[i.o9])||(a.decode(r.attachedPic),await a.flush()),a.close()}}else D(r,!0),1===r.codecpar.codecType&&(1===r.codecpar.chLayout.nbChannels?(r.codecpar.chLayout.u.mask=BigInt(4),r.codecpar.chLayout.order=1):2===r.codecpar.chLayout.nbChannels&&(r.codecpar.chLayout.u.mask=BigInt(3),r.codecpar.chLayout.order=1))}}for(;;){if(e.streams.length>=T&&e.options.fastOpen&&(0,d.$)(e)){await R();break}E||(E=(0,g._5)());let a=!1;if(C=await S(e,E),0!==C){await R();break}const h=e.getStreamByIndex(s.f[15](E+32));let l=s.f[17](E+8);if(l===w.Dh&&(l=s.f[17](E+16)),s.f[15](E+28)&&(a=!0,B.push(E),t[h.index]?l<h.startTime&&(h.startTime=l):(h.firstDTS=s.f[17](E+16),h.startTime=l,t[h.index]=!0),s.f[17](E+16)!==w.Dh&&(r[h.index]?r[h.index].push(s.f[17](E+16)):r[h.index]=[s.f[17](E+16)]),p[h.index]?p[h.index].push(l):p[h.index]=[l],m[h.index]?m[h.index]+=s.f[15](E+28):m[h.index]=s.f[15](E+28),!P[h.index]&&e.getDecoderResource&&!e.options.fastOpen&&!h.metadata.encryption)){let t=x[h.index];if(!t){const r=await e.getDecoderResource(h.codecpar.codecType,h.codecpar.codecId);r&&(1===h.codecpar.codecType?t=new _.A({resource:r,onReceiveAVFrame:e=>{h.codecpar.format=s.f[15](e+80),h.codecpar.frameSize=s.f[15](e+76),h.codecpar.sampleRate=s.f[15](e+152),h.codecpar.chLayout=(0,n.A)(e+288,c.r),(0,A.xj)(e),P[h.index]=!0}}):0===h.codecpar.codecType&&(r.threadModule&&delete r.threadModule,t=new I.A({resource:r,onReceiveAVFrame:e=>{h.codecpar.format=s.f[15](e+80),h.codecpar.colorRange=s.f[15](e+208),h.codecpar.colorSpace=s.f[15](e+220),h.codecpar.colorPrimaries=s.f[15](e+212),h.codecpar.colorTrc=s.f[15](e+216),h.codecpar.chromaLocation=s.f[15](e+224),s.f[15](e+92)&&s.f[15](e+96)&&(h.codecpar.sampleAspectRatio=(0,n.A)(e+92,o.Q)),h.codecpar.width=s.f[15](e+68),h.codecpar.height=s.f[15](e+72),(0,A.xj)(e),P[h.index]=!0}})),await t.open(h.codecpar[i.o9])?(t.close(),P[h.index]=!0):x[h.index]=t)}t&&t.decode(E)&&(P[h.index]=!0)}if(p[h.index]&&p[h.index].length===M&&D(h,!1),h.startTime!==w.Dh&&l-h.startTime>(0,v.k)(BigInt(Math.floor(e.options.maxAnalyzeDuration)),w.i0,h.timeBase)&&(e.streams.length>=T&&(0,d.$)(e)||l-h.startTime>(0,v.k)(BigInt(15e3),w.i0,h.timeBase)&&(!p[h.index]||p[h.index].length>450))&&U()){await R(),a&&(E=0);break}a&&(E=0)}return E&&(0,g.Qe)(E),B.length&&(e.interval.packetBuffer=B.concat(e.interval.packetBuffer)),b.__(x,(e=>{e&&e.close()})),b.__(k,((t,r)=>{const i=e.getStreamByIndex(+r);i.privateData2?b.X$(i.privateData2,t):i.privateData2=t})),-1048576===C||-1048572===C?0:0!==C?C:(2===e.iformat.type&&1&e.ioReader.flags&&!(2&e.ioReader.flags)&&await async function(e){const t=await e.ioReader.fileSize();if(t<=BigInt(0))return;const r=e.interval.packetBuffer;e.interval.packetBuffer=[];let i=e.ioReader.getPos(),a=0;for(;a<4;){const r=t-BigInt(Math.floor(h.v<<a)),o=await e.iformat.seek(e,null,r,2);if(o<0)break;!a&&o>0&&(i=o);const n={},c=(0,g._5)();for(;!(await S(e,c)<0);){let t=s.f[17](c+8);t===w.Dh&&(t=s.f[17](c+16));const r=e.getStreamByIndex(s.f[15](c+32));r.startTime!==w.Dh?t-=r.startTime:t-=r.firstDTS,t>BigInt(0)&&((r.duration===w.Dh||!n[s.f[15](c+32)]||r.duration<t&&Math.abs(Number(t-r.duration))<60*r.timeBase.den/r.timeBase.num)&&(r.duration=t),n[c.streamIndex]=t)}(0,g.Qe)(c);let d=!0;if(y.__(e.streams,(e=>{if(e.duration===w.Dh)return d=!1,!1})),d)break;a++}y.__(e.interval.packetBuffer,(e=>{(0,g.Qe)(e)})),e.interval.packetBuffer=r.filter((e=>!(s.f[17](e+56)>=i&&((0,g.Qe)(e),1)))),await e.iformat.seek(e,null,i,2)}(e),0)}function B(e,t){let r=s.f[17](t+8);r===w.Dh&&(r=s.f[17](t+16));const i=y.El(e.sampleIndexes,(e=>e.pts<r?1:-1)),a={dts:s.f[17](t+16),pts:r,pos:s.f[17](t+56),size:s.f[15](t+28),duration:s.f[17](t+48),flags:s.f[15](t+36)};i>-1?(e.sampleIndexesPosMap.set(s.f[17](t+56),i),e.sampleIndexes.splice(i,0,a)):(e.sampleIndexesPosMap.set(s.f[17](t+56),e.sampleIndexes.length),e.sampleIndexes.push(a))}async function C(e,t){const r=e.getStreamByIndex(s.f[15](t+32));if(s.f[17](t+16)===w.Dh){const e=r.privateData2;e&&(e.delay?(y._(e.dtsQueue,s.f[17](t+8),(e=>e<s.f[17](t+8)?1:-1)),e.dtsQueue.length>e.delay&&a.M[17](t+16,e.dtsQueue.shift())):a.M[17](t+16,s.f[17](t+8)))}let i=0;if(r&&(27===r.codecpar.codecId||173===r.codecpar.codecId||196===r.codecpar.codecId||86018===r.codecpar.codecId))if(!s.f[15](t+28)&&(0,g.fQ)(t,1))for(;;){const r=(0,g._5)();if(i=await e.iformat.readAVPacket(e,r),0!==i){if(e.interval.packetBuffer.length){let r=e.interval.packetBuffer.shift();return(0,g.Up)(t),(0,g.rN)(t,r),(0,g.Qe)(r),C(e,t)}return i}if(s.f[15](r+32)!==s.f[15](t+32)){let t=e.interval.packetBuffer.length-1,i=!0;for(;t>=0;t--)if(s.f[15](e.interval.packetBuffer[t]+32)===s.f[15](r+32)){s.f[15](e.interval.packetBuffer[t]+28)||s.f[15](r+28)?!s.f[15](e.interval.packetBuffer[t]+28)&&s.f[15](r+28)&&((0,g.Zx)(e.interval.packetBuffer[t],r),(0,g.Qe)(r),i=!1):((0,g.Qe)(e.interval.packetBuffer[t]),e.interval.packetBuffer.splice(t,1,r),i=!1);break}i&&e.interval.packetBuffer.push(r)}else{if(s.f[15](r+28))return(0,g.Zx)(t,r),a.M[17](t+16,s.f[17](r+16)),a.M[17](t+8,s.f[17](r+8)),(0,g.Qe)(r),0;(0,g.Up)(t),(0,g.rN)(t,r),(0,g.Qe)(r)}}else if(32&s.f[15](t+36))return S(e,t);if(1&e.ioReader.flags&&!r.sampleIndexesPosMap.has(s.f[17](t+56)))if(0===r.codecpar.codecType)1&s.f[15](t+36)&&B(r,t);else if(1===r.codecpar.codecType){const e=y.El(r.sampleIndexes,(e=>e.pts<s.f[17](t+8)?1:-1));(!r.sampleIndexes.length||e<0&&(0,v.Mr)(s.f[17](t+8)-r.sampleIndexes[r.sampleIndexes.length-1].pts,t+72,w.i0)>=h.V||e>0&&e<r.sampleIndexes.length-1&&(0,v.Mr)(s.f[17](t+8)-r.sampleIndexes[e-1].pts,t+72,w.i0)>=h.V||0===e&&(0,v.Mr)(r.sampleIndexes[0].pts-s.f[17](t+8),t+72,w.i0)>=h.V)&&B(r,t)}return 0}async function S(e,t){let r=0;if((0,g.Up)(t),e.interval.packetBuffer.length){const r=e.interval.packetBuffer.shift();return(0,g.rN)(t,r),(0,g.Qe)(r),C(e,t)}return r=await e.iformat.readAVPacket(e,t),0!==r?((0,g.Up)(t),r):C(e,t)}async function U(e,t,r,i){let o=t>-1?e.streams.find((e=>e.index===t)):null;if(o||(o=e.getStreamByMediaType(0),o||(o=e.getStreamByMediaType(1)),o||(o=e.getStreamByMediaType(3))),!o)return k.z3(`not found any stream to seek, streamIndex: ${o.index}`,x,803),BigInt(m.LR);k.Yz(`seek in ${0===o.codecpar.codecType?"video":"audio"} stream, streamIndex: ${o.index}, timestamp: ${r}, flags: ${i}`,x,807),r=(0,v.k)(r,w.i0,o.timeBase);const n=await e.iformat.seek(e,o,r,i);if(n>=BigInt(0)){y.__(e.interval.packetBuffer,(t=>{if(2&e.ioReader.flags){const r=(0,g.rU)(t,1),i=e.streams[s.f[15](t+32)];!i.sideData[1]&&r&&(i.sideData[1]=(0,p.s3)(s.f[20](r),s.f[25](r+4)).slice())}(0,g.Qe)(t)})),e.interval.packetBuffer.length=0;const t={};e.streams.forEach((e=>{const r=e.privateData2;null!=r&&r.dtsQueue&&(r.dtsQueue.length=0,r.delay&&(t[e.index]=r.delay,r.delay=M))}));const r=[];for(;e.streams.some((e=>{const t=e.privateData2;return t&&t.dtsQueue&&t.dtsQueue.length<t.delay}));){const t=(0,g._5)();if(await S(e,t)){(0,g.Qe)(t);break}r.push(t)}return e.streams.forEach((e=>{const i=e.privateData2;if(null!=i&&i.delay){i.delay=t[e.index],i.dtsQueue=(0,f.A)(i.delay,i.dtsQueue);for(let t=0;t<r.length;t++)if(e.index===s.f[15](r[t]+32)){a.M[17](r[t]+16,i.dtsQueue.shift());const o=e.sampleIndexes.find((e=>e.pts===s.f[17](r[t]+8)));o&&(o.dts=s.f[17](r[t]+16))}}})),e.interval.packetBuffer=r.concat(e.interval.packetBuffer),BigInt(0)}return n}},8770:(e,t,r)=>{r.r(t),r.d(t,{default:()=>n});var i=r(2494),s=r(8590),a=r(2935);let o=i.TK;function n(e){let t,r;o.onmessage=n=>{const c=n.data,d=c.type,h=c.data;switch(d){case"init":if(i.TK.CHeap&&i.TK.CHeap.initThread&&i.TK.CHeap.Config.USE_THREADS)return void i.TK.CHeap.initThread(h).then((()=>{o.postMessage({type:"ready"})}));o.postMessage({type:"ready"});break;case"run":o.postMessage({type:"running"}),r=e(h.params),l=h.port,t=new a.Ay(l),t.on(a.S3,(async e=>{const i=e.method,a=e.params;if(s.Pc(r[i]))try{r[i].transfer||(r[i].transfer=[]);const s=await r[i](...a.params);t.reply(e,s,null,r[i].transfer),r[i].transfer.length=0}catch(r){t.reply(e,-2097152,{message:r.message})}}));break;case"stop":t&&t.destroy(),i.TK.__freeSmartPtr__&&i.TK.__freeSmartPtr__(),o.postMessage({type:"stopped"})}var l}}},8842:(e,t,r)=>{r.d(t,{Dw:()=>c,K0:()=>d,f8:()=>h,wj:()=>l});var i=r(9983),s=r(3674),a=r(1237),o=r(1277),n=r(3535);function c(e){return e<0||e>=12?0:o.J[e].bits>>3}function d(e){return!(e<0||e>=12)&&o.J[e].planar}function h(e,t,r,i){const s=c(e),o=d(e);return!s||r<=0||t<=0?-1:(i||(i=1,r=(0,n.A)(r,32)),t>a.go/i||t*r>(a.go-i*t)/s?-1:o?(0,n.A)(r*s,i):(0,n.A)(r*s*t,i))}function l(e,t,r,a,o){const n=d(r),h=n?o:1,l=c(r)*(n?1:o),u=a*l,f=0===r||5===r?128:0;t*=l;for(let r=0;r<h;r++)(0,s.sO)(i.f[20](e+4*r)+t,f,u)}},8927:(e,t,r)=>{r.d(t,{GP:()=>d,di:()=>o,qh:()=>n,yh:()=>h,zy:()=>c});var i=r(8590),s=r(2494),a=r(4566);function o(e,t,r){return i.ai(r)?t===r?s.u1:e.slice(t,r):e.slice(t)}function n(e,t,r){return e.indexOf(t,r!==s.ZH?r:0)}function c(e,t){return n(e,t)>=0}function d(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];let s=0;const o=r.length;return e.replace(/(%[sdvx%])|(%0(\d)+[dx])/g,(e=>{if(s>=o)return e;const t=r[s++];if(/%0(\d)+[dx]/g.test(e)){const r=parseInt(e.substring(1));let i="d"===e[e.length-1]?(0,a.A)(Number(t)):Number(t).toString(16);return r>i.length&&(i=new Array(r-i.length).fill("0").join("")+i),i}switch(e){case"%%":return"%";case"%s":return String(t);case"%d":return(0,a.A)(Number(t));case"%v":return"";case"%x":return Number(t).toString(16)}return e}))}function h(e,t,r){if(t instanceof RegExp){if(!t.global)throw new TypeError("String.prototype.replaceAll called with a non-global RegExp argument");return e.replace(t,r)}return e.split(t).join(r)}},8952:(e,t,r)=>{function i(e,t){if(t.length<e)return t.slice().sort(((e,t)=>e>t?1:-1));const r=[],i=t.slice().sort(((e,t)=>e>t?1:-1));if(e){const t=i[i.length-1]-i[i.length-2];for(let s=e;s>0;s--)r.push((r.length?r[r.length-1]:BigInt(0))+(s>=i.length?t:i[s]-i[s-1]));r.reverse()}const s=[];for(let t=0;t<e;t++)s.push(i[0]-r[t]);return s.concat(i)}r.d(t,{A:()=>i})},9179:(e,t,r)=>{r.d(t,{A:()=>i});const i="AGFzbQEAAAABLAdgAX8Bf2ABfwF+YAJ/fwF/YAJ/fgF+YAN/f38Bf2ADf35+AX5gA39/fgF/AhIBA2VudgZtZW1vcnkCAwGAgAQDKCcAAAABAgICAwICAgMCAgIDAgICAwICAgMCAgIDAgICAwQEBAUCAgYHhgMnBWxvYWQ4AAAGbG9hZDE2AAEGbG9hZDMyAAIGbG9hZDY0AAMGc3RvcmU4AAQHc3RvcmUxNgAFB3N0b3JlMzIABgdzdG9yZTY0AAcEYWRkOAAIBWFkZDE2AAkFYWRkMzIACgVhZGQ2NAALBHN1YjgADAVzdWIxNgANBXN1YjMyAA4Fc3ViNjQADwRhbmQ4ABAFYW5kMTYAEQVhbmQzMgASBWFuZDY0ABMDb3I4ABQEb3IxNgAVBG9yMzIAFgRvcjY0ABcEeG9yOAAYBXhvcjE2ABkFeG9yMzIAGgV4b3I2NAAbCWV4Y2hhbmdlOAAcCmV4Y2hhbmdlMTYAHQpleGNoYW5nZTMyAB4KZXhjaGFuZ2U2NAAfEWNvbXBhcmVfZXhjaGFuZ2U4ACASY29tcGFyZV9leGNoYW5nZTE2ACESY29tcGFyZV9leGNoYW5nZTMyACISY29tcGFyZV9leGNoYW5nZTY0ACMGbm90aWZ5ACQEd2FpdAAlC3dhaXRUaW1lb3V0ACYKugMnCAAgAP4SAAALCAAgAP4TAQALCAAgAP4QAgALCAAgAP4RAwALDAAgACAB/hkAACABCwwAIAAgAf4aAQAgAQsMACAAIAH+FwIAIAELDAAgACAB/hgDACABCwoAIAAgAf4gAAALCgAgACAB/iEBAAsKACAAIAH+HgIACwoAIAAgAf4fAwALCgAgACAB/icAAAsKACAAIAH+KAEACwoAIAAgAf4lAgALCgAgACAB/iYDAAsKACAAIAH+LgAACwoAIAAgAf4vAQALCgAgACAB/iwCAAsKACAAIAH+LQMACwoAIAAgAf41AAALCgAgACAB/jYBAAsKACAAIAH+MwIACwoAIAAgAf40AwALCgAgACAB/jwAAAsKACAAIAH+PQEACwoAIAAgAf46AgALCgAgACAB/jsDAAsKACAAIAH+QwAACwoAIAAgAf5EAQALCgAgACAB/kECAAsKACAAIAH+QgMACwwAIAAgASAC/koAAAsMACAAIAEgAv5LAQALDAAgACABIAL+SAIACwwAIAAgASAC/kkDAAsKACAAIAH+AAIACwwAIAAgAUJ//gECAAsMACAAIAEgAv4BAgAL"},9186:(e,t,r)=>{r.d(t,{T:()=>d});var i=r(9983),s=r(3674),a=r(8842),o=r(3262),n=r(1237);function c(e){switch(i.f[15](e+80)){case 0:return"u8";case 1:return"s16";case 2:return"s32";case 3:return"f32";case 5:return"u8-planar";case 6:return"s16-planar";case 7:return"s32-planar";case 8:return"f32-planar";default:throw new Error("not support")}}function d(e,t){const r=(0,a.K0)(i.f[15](e+80)),d=r?i.f[15](e+292):1;let h;const l=(0,a.Dw)(i.f[15](e+80));if(r){const t=i.f[15](e+76)*l,r=new Uint8Array(d*t);let a=0;for(let o=0;o<d;o++)r.set((0,s.s3)(i.f[20](e+4*o),t),a),a+=t;h=function(e,t){switch(e){case 0:case 5:return t;case 1:case 6:return new Int16Array(t.buffer);case 2:case 7:return new Int32Array(t.buffer);case 3:case 8:return new Float32Array(t.buffer);default:throw new Error("not support")}}(i.f[15](e+80),r)}else h=function(e,t,r){switch(e){case 0:case 5:return(0,s.s3)(t,r);case 1:case 6:return(0,s.cC)(t,r>>>1);case 2:case 7:return(0,s.gd)(t,r>>>2);case 3:case 8:return(0,s.TL)(t,r>>>2);default:throw new Error("not support")}}(i.f[15](e+80),i.f[20](e),l*i.f[15](e+76)*i.f[15](e+292));return new AudioData({data:h,format:c(e),sampleRate:i.f[15](e+152),numberOfFrames:i.f[15](e+76),numberOfChannels:i.f[15](e+292),timestamp:t?Number(t):i.f[17](e+104)===n.Dh?-1:Number((0,o.Mr)(i.f[17](e+104),e+120,n.KR))})}},9210:(e,t,r)=>{r.d(t,{t:()=>d});var i=r(9983),s=r(2320),a=r(3394),o=r(8842),n=r(1237),c=r(3674);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0===t&&(t=(0,a.FP)()),s.M[15](t+152,e.sampleRate),s.M[15](t+76,e.numberOfFrames),s.M[15](t+292,e.numberOfChannels),s.M[15](t+80,function(e){switch(e){case"u8":return 0;case"s16":return 1;case"s32":return 2;case"f32":return 3;case"u8-planar":return 5;case"s16-planar":return 6;case"s32-planar":return 7;case"f32-planar":return 8;default:throw new Error("not support")}}(e.format)),s.M[17](t+104,e.timestamp<0?n.Dh:BigInt(Math.floor(e.timestamp))),s.M[17](t+312,BigInt(Math.floor(e.duration))),s.M[15](t+124,n.SF),s.M[15](t+120,1),(0,a.rh)(t);const r=(0,o.K0)(i.f[15](t+80))?i.f[15](t+292):1;for(let s=0;s<r;s++)e.copyTo((0,c.s3)(i.f[20](i.f[20](t+64)+4*s),i.f[15](t+32)),{planeIndex:s});return t}},9239:(e,t,r)=>{r.d(t,{AO:()=>l,IH:()=>h,Zx:()=>m,a5:()=>f});var i=r(9983),s=r(2320),a=r(4365),o=r(1755),n=r(8590),c=r(4566),d=r(3674);function h(e){l(i.f[20](e)),(0,o.aI)(e)}function l(e){if(e){for(;s.M[15](e,i.f[15](e)-1),i.f[15](e)+1;)(0,o.aI)(i.f[20](e+4)+8*i.f[15](e)),(0,o.aI)(i.f[20](e+4)+8*i.f[15](e)+4);(0,o.aI)(e+4)}}function u(e,t){let r=0;return e?(t&&(r=1+(t-i.f[20](e+4)>>3)),r>=i.f[15](e)?0:i.f[20](e+4)+8*r):0}function f(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)throw new Error("m is nullptr");let h=0;if(64&o&&(h=function(e,t){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!e)return 0;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t)return 0;for(;s=u(e,s);){let e=(0,d.lH)(i.f[20](s));if(1&r&&(e.toLocaleLowerCase(),t.toLocaleLowerCase()),e===t||2&r&&0===e.indexOf(t))return s}}(e,t,0,o)),h){if(16&o)return 0;32&o&&(r=`${(0,d.lH)(i.f[20](h+4))},${r}`),a.s_.free(i.f[20](h+4)),s.M[20](h+4,a.s_.malloc(r.length+1)),(0,d.qW)(i.f[20](h+4),r,r.length)}else{n.Yj(r)||(r=(0,c.A)(r));let o=a.s_.realloc(i.f[20](e+4),8*(i.f[15](e)+1));s.M[20](e+4,o),s.M[20](i.f[20](e+4)+8*i.f[15](e),a.s_.malloc(t.length+1)),s.M[20](i.f[20](e+4)+8*i.f[15](e)+4,a.s_.malloc(r.length+1)),(0,d.qW)(i.f[20](i.f[20](e+4)+8*i.f[15](e)),t,t.length),(0,d.qW)(i.f[20](i.f[20](e+4)+8*i.f[15](e)+4),r,r.length),s.M[15](e,i.f[15](e)+1)}return 0}function p(e,t,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=i.f[20](e);return n||(n=(0,o.Gy)(8),s.M[20](e,n)),f(n,t,r,a)}function m(e,t,r){if(!t)return-1;let s=0;for(;s=u(t,s);){let t=p(e,(0,d.lH)(i.f[20](s)),(0,d.lH)(i.f[20](s+4)),r);if(t<0)return t}return 0}},9257:(e,t,r)=>{r.d(t,{A:()=>i});const i="AGFzbQEAAAABLwlgAn9/AGACf34AYAJ/fQBgAn98AGABfwF/YAF/AX5gAX8BfWABfwF8YAN/f38AAhIBA2VudgZtZW1vcnkCAwGAgAQDERAAAAABAgMEBAQEBAUGBwgIB5YBEAZ3cml0ZTgAAAd3cml0ZTE2AAEHd3JpdGUzMgACB3dyaXRlNjQAAwh3cml0ZWYzMgAECHdyaXRlZjY0AAUFcmVhZDgABgZyZWFkVTgABwZyZWFkMTYACAdyZWFkVTE2AAkGcmVhZDMyAAoGcmVhZDY0AAsHcmVhZGYzMgAMB3JlYWRmNjQADQRmaWxsAA4EY29weQAPCpYBEAkAIAAgAToAAAsJACAAIAE7AQALCQAgACABNgIACwkAIAAgATcDAAsJACAAIAE4AgALCQAgACABOQMACwcAIAAsAAALBwAgAC0AAAsHACAALgEACwcAIAAvAQALBwAgACgCAAsHACAAKQMACwcAIAAqAgALBwAgACsDAAsLACAAIAEgAvwLAAsMACAAIAEgAvwKAAAL"},9322:(e,t,r)=>{r.d(t,{A:()=>d});var i=r(9983),s=r(2320),a=r(4187),o=r(1755),n=r(3674),c=r(1237);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;0===t&&(t=(0,a._5)()),s.M[17](t+8,BigInt(Math.floor(e.timestamp))),s.M[17](t+16,BigInt(Math.floor(e.timestamp))),s.M[17](t+48,null==e.duration?c.Dh:BigInt(Math.floor(e.duration))),s.M[15](t+76,c.SF),s.M[15](t+72,1),s.M[15](t+36,1|i.f[15](t+36));const d=(0,o.sY)(e.byteLength);var h;if(e.copyTo((0,n.s3)(d,e.byteLength)),(0,a.NX)(t,d,e.byteLength),r&&null!==(h=r.decoderConfig)&&void 0!==h&&h.description){let e;e=r.decoderConfig.description instanceof ArrayBuffer?new Uint8Array(r.decoderConfig.description):new Uint8Array(r.decoderConfig.description.buffer);const i=(0,o.sY)(e.length);(0,n.lW)(i,e.length,e),(0,a.Ow)(t,1,i,e.length)}}},9377:(e,t,r)=>{function i(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,(e+=e>>8)+(e>>16)&63}function s(e){return i(Number(BigInt.asUintN(32,e)))+i(Number(BigInt.asUintN(32,e>>BigInt(32))))}r.d(t,{Xb:()=>s})},9658:(e,t,r)=>{r.d(t,{$z:()=>f,GW:()=>c,WP:()=>h,bx:()=>p,p2:()=>l,tt:()=>u});var i=r(187),s=r(5815),a=r(8288),o=r(7084);function n(e){let t=0,r=0;for(;;){const i=e.readUint8();if(t|=(127&i)<<r,r+=7,!(128&i))break}return t}async function c(e){let t=0,r=0;for(;;){const i=await e.readUint8();if(t|=(127&i)<<r,r+=7,!(128&i))break}return t}function d(e){let t,r=0,i=0;for(;t=e.readUint8(),r|=(127&t)<<i,i+=7,128&t;);return 64&t&&(r|=-1<<i),r}async function h(e){let t,r=0,i=0;for(;t=await e.readUint8(),r|=(127&t)<<i,i+=7,128&t;);return 64&t&&(r|=-1<<i),r}function l(e,t){let r=!0;for(;r;){let i=127&t;0==(t>>=7)&&!(64&i)||-1===t&&64&i?r=!1:i|=128,e.writeUint8(i)}}function u(e,t){do{let r=127&t;0!=(t>>=7)&&(r|=128),e.writeUint8(r)}while(0!==t)}async function f(e,t){do{let r=127&t;0!=(t>>=7)&&(r|=128),await e.writeUint8(r)}while(0!==t)}function p(e,t){const r=new s.A(e,!0),c=new i.A(new Uint8Array(e.length+100),!0);for(c.writeBuffer(r.readBuffer(8));r.remainingSize();){const e=r.readUint8();c.writeUint8(e);const s=n(r);if(2===e){const e=new i.A(new Uint8Array(s+100));let h=n(r);for(u(e,h);h--;){const i=n(r);u(e,i),e.writeBuffer(r.readBuffer(i));const s=n(r);u(e,s),e.writeBuffer(r.readBuffer(s));const c=r.readUint8();switch(e.writeUint8(c),c){case 0:u(e,n(r));break;case 3:l(e,d(r)),u(e,n(r));break;case 2:{let i=n(r);t.shared?u(e,2|i):u(e,-3&i);const s=n(r);if(u(e,t.initial||s),1&i){let i=n(r);!t.maximum||o.A.ios&&!a.A.checkVersion(o.A.version,"17",!0)&&t.shared||(i=t.maximum),u(e,i)}break}case 1:{l(e,d(r));const t=n(r);u(e,t),u(e,n(r)),1&t&&u(e,n(r));break}}}const f=e.getWroteBuffer();u(c,f.length),c.writeBuffer(f)}else u(c,s),c.writeBuffer(r.readBuffer(s))}return c.getWroteBuffer()}},9882:(e,t,r)=>{let i,s,a,o,n,c,d,h,l,u,f,p,m,g;function A(e){e.add&&(i=e.add),e.sub&&(s=e.sub),e.and&&(a=e.and),e.or&&(o=e.or),e.xor&&(n=e.xor),e.store&&(c=e.store),e.load&&(d=e.load),e.compareExchange&&(h=e.compareExchange),e.exchange&&(l=e.exchange),e.notify&&(u=e.notify),e.wait&&(f=e.wait),e.waitTimeout&&(p=e.waitTimeout),e.waitAsync&&(m=e.waitAsync),e.waitTimeoutAsync&&(g=e.waitTimeoutAsync)}r.d(t,{$Z:()=>A,Hh:()=>d,I8:()=>n,M_:()=>c,R_:()=>g,Uo:()=>a,WQ:()=>i,cv:()=>l,j4:()=>p,jb:()=>s,me:()=>u,of:()=>m,or:()=>o,p_:()=>h,uk:()=>f})},9906:(e,t,r)=>{r.d(t,{R8:()=>y,V$:()=>A,Yz:()=>v,h2:()=>k,pq:()=>w,rD:()=>n,z3:()=>b});var i=r(2494),s=r(4566);const a=0,o=1,n=2,c=3,d=4,h=5,l=typeof console!==i.aV?console:i.Cq,u=/common/.test((0,s.A)(i.x7))?n:c,f=l?function(e,t){l.log(e,t)}:i.x7,p=l?function(e,t){l.warn(e,t)}:i.x7,m=l?function(e,t){l.error(e,t)}:i.x7;function g(){if(i.M_){const e=i.TK.COMMON_LOG_LEVEL;if(e>=a&&e<=h)return e}return u}function A(e){i.TK.COMMON_LOG_LEVEL=e}function v(e,t,r){g()<=o&&f(`[${arguments[1]}][line ${arguments[2]}] [debug]`,e)}function w(e,t,r){g()<=n&&f(`[${arguments[1]}][line ${arguments[2]}] [info]`,e)}function y(e,t,r){g()<=c&&p(`[${arguments[1]}][line ${arguments[2]}] [warn]`,e)}function b(e,t,r){g()<=d&&m(`[${arguments[1]}][line ${arguments[2]}] [error]`,e)}function k(e,t,r){if(g()<=h)throw b(e,t,r),new Error(`[${arguments[1]}][line ${arguments[2]}] [fatal]: ${e}`)}},9922:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(2284),s=r(2327);function a(e){var t=(0,s.A)(e,"string");return"symbol"==(0,i.A)(t)?t:t+""}},9935:(e,t,r)=>{r.d(t,{Au:()=>v,He:()=>w,XC:()=>y,Y2:()=>m,hG:()=>g,oz:()=>A});var i=r(1237);const s=[44100,48e3,32e3,0],a=[22050,24e3,16e3,0],o=[11025,12e3,8e3,0],n=[0,1152,1152,384],c=[0,576,1152,384],d=[0,576,1152,384],h=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],l=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],u=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],f=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],p=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return o[t];case 2:return a[t];case 3:return s[t]}return i.N_}function g(e,t){switch(e){case 0:return d[t];case 2:return c[t];case 3:return n[t]}return i.N_}function A(e,t,r){switch(t){case 1:switch(e){case 0:case 2:return p[r];case 3:return u[r]}break;case 2:switch(e){case 0:case 2:return p[r];case 3:return l[r]}case 3:switch(e){case 0:case 2:return f[r];case 3:return h[r]}}return i.N_}function v(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return i.N_}const w={32:"Layer1",33:"Layer2",34:"Layer3"};function y(e,t){if(t&&t.length>=4){const r=t[1]>>>3&3,i=(6&t[1])>>1,s=(12&t[2])>>>2,a=3&~(t[3]>>>6)?2:1,o=v(i),n=m(r,s);e.codecpar.profile=o,e.codecpar.sampleRate=n,e.codecpar.chLayout.nbChannels=a}}},9973:(e,t,r)=>{r.d(t,{Ko:()=>l,LK:()=>d,Ts:()=>u});var i=r(4365),s=r(3548),a=r(3669),o=r(9658),n=r(9906);const c="packages/cheap/src/webassembly/runtime/asm/libc.ts";let d,h=!0;function l(){return h}function u(e,t,r){try{const n=o.bx(a.E_(s.A),{shared:"function"==typeof SharedArrayBuffer&&e.buffer instanceof SharedArrayBuffer,initial:t,maximum:r});d=new WebAssembly.Instance(new WebAssembly.Module(n),{env:{memory:e,malloc:function(e){return i.s_.malloc(e)},calloc:function(e,t){return i.s_.calloc(e,t)},realloc:function(e,t){return i.s_.realloc(e,t)},aligned_alloc:(e,t)=>i.s_.alignedAlloc(e,t),free:function(e){i.s_.free(e)}}}),i.XI.set(2,d.exports.malloc),i.XI.set(1,d.exports.free),i.XI.set(3,d.exports.calloc),i.XI.set(4,d.exports.realloc),i.XI.set(5,d.exports.alignedAlloc)}catch(e){h=!1,n.R8("libc asm not support, cannot use asm thread function",c,58)}}},9983:(e,t,r)=>{r.d(t,{$:()=>o,f:()=>a});var i=r(665),s=r(3601);const a={4:s.A,5:s.A,2:s.A,3:s.A,6:s.A,7:s.A,8:s.A,9:s.A,10:s.A,11:s.A,12:s.A,13:s.A,14:s.A,15:s.A,16:s.A,17:s.A,18:s.A,19:s.A,20:s.A,0:s.A,1:s.A,22:s.A,21:s.A,23:s.A,24:s.A,25:s.A};function o(e){i.X$(a,e)}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var a=i[e]={exports:{}};return r[e](a,a.exports,s),a.exports}s.m=r,s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,r)=>(s.f[r](e,t),t)),[])),s.u=e=>e+".avtranscoder.js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="AVTranscoder:",s.l=(r,i,a,o)=>{if(e[r])e[r].push(i);else{var n,c;if(void 0!==a)for(var d=document.getElementsByTagName("script"),h=0;h<d.length;h++){var l=d[h];if(l.getAttribute("src")==r||l.getAttribute("data-webpack")==t+a){n=l;break}}n||(c=!0,(n=document.createElement("script")).charset="utf-8",s.nc&&n.setAttribute("nonce",s.nc),n.setAttribute("data-webpack",t+a),n.src=r),e[r]=[i];var u=(t,i)=>{n.onerror=n.onload=null,clearTimeout(f);var s=e[r];if(delete e[r],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((e=>e(i))),t)return t(i)},f=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),c&&document.head.appendChild(n)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=r[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={792:0};s.f.j=(t,r)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var a=new Promise(((r,s)=>i=e[t]=[r,s]));r.push(i[2]=a);var o=s.p+s.u(t),n=new Error;s.l(o,(r=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;n.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",n.name="ChunkLoadError",n.type=a,n.request=o,i[1](n)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,a,[o,n,c]=r,d=0;if(o.some((t=>0!==e[t]))){for(i in n)s.o(n,i)&&(s.m[i]=n[i]);c&&c(s)}for(t&&t(r);d<o.length;d++)a=o[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0},r=self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=s(3316);return a.default})()));