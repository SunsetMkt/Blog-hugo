"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[783],{39:(e,t,a)=>{function i(e,t){let a=0;for(let i=0;i<t;i++)a=2*a+e.readU1();return a}function r(e){let t=0;for(;!i(e,1);)t++;return t>=32?0:i(e,t)+(1<<t)-1}function o(e){let t=0;for(let a=0;a<8;a++){let r=i(e,8);if(t|=(127&r)<<7*a,!(128&r))break}return t}a.d(t,{d:()=>r,f:()=>i,v:()=>o})},810:(e,t,a)=>{a.d(t,{FJ:()=>r,FV:()=>i,Tf:()=>n,U5:()=>o});const i={65541:0,65536:3,86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,12:9,4:2,86:3,92:4,106:5,131:6},r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},o={7:27,12:173,9:12,2:4,3:86,4:92,5:106,6:131},n={27:"avc1",173:"hvc1",196:"vvc1",139:"vp08",167:"vp09",225:"av01",86019:"ac-3",86056:"ec-3",86076:"Opus",86028:"fLaC",86017:".mp3",86018:"mp4a"}},1135:(e,t,a)=>{a.d(t,{C$:()=>l,M5:()=>c,Q4:()=>h,zk:()=>f});var i=a(810),r=a(9515),o=a(3262),n=a(1237),s=a(8590);function d(e,t,a){const i=e.getPos(),r=e.getPointer(),o=i-BigInt(Math.floor(r));t<i&&t>=o?(e.seekInline(r+Number(t-i)),e.writeUint24(a),e.seekInline(r)):(e.seek(t),e.writeUint24(a),e.seek(i))}function c(e,t,a,i,r,o){e.flush(),e.writeUint8(t);const n=e.getPos();e.writeUint24(0),e.writeUint24(Number(a&BigInt(16777215))),e.writeUint8(Number(a>>BigInt(24)&BigInt(255))),e.writeUint24(0);const c=e.getPos();i&&i(e),s.Pc(r)?(r(e),d(e,n,Number(e.getPos()-c))):r&&(d(e,n,r.length+Number(e.getPos()-c)),e.writeBuffer(r));const l=Number(e.getPos()-n)+1;o&&o(l),e.writeUint32(l)}function l(e){return 86018!==e&&27!==e&&86017!==e&&12!==e&&!!i.Tf[e]}function h(e,t,a,s,d,c,l,h){let f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0;const p=t.privData;let u=s?128:0;if(u|=(1&c?1:2)<<4,s){if(a.enableNanoTimestamp&&h){const t=(0,o.Mr)(l,h,n.FQ)-(0,o.Mr)(l,h,n.i0)*BigInt(1e6);t&&(u|=7,e.writeUint8(u),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),u=0)}a.multiVideoTracks&&(u|=6,e.writeUint8(u),u=0),u|=d,e.writeUint8(u),e.writeUint32((0,r.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(p.trackId),1===d&&e.writeInt24(f)}else u|=15&i.FV[t.codecpar.codecId],e.writeUint8(u),27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&12!==t.codecpar.codecId||(e.writeUint8(d),e.writeInt24(f))}function f(e,t,a,s,d,c,l){const h=t.privData;let f=(s?9:15&i.FV[t.codecpar.codecId])<<4;if(s){if(a.enableNanoTimestamp){const t=(0,o.Mr)(c,l,n.FQ)-(0,o.Mr)(c,l,n.i0)*BigInt(1e6);t&&(f|=7,e.writeUint8(f),e.writeUint8(2),e.writeUint24(Number(BigInt.asIntN(32,t))),f=0)}a.multiVideoTracks&&(f|=5,e.writeUint8(f),f=0),f|=d,e.writeUint8(f),e.writeUint32((0,r.A)(i.Tf[t.codecpar.codecId])),a.multiVideoTracks&&e.writeUint8(h.trackId)}else(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(f|=1),65541!==t.codecpar.codecId&&(f|=2),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?f|=12:t.codecpar.sampleRate>=22e3?f|=8:t.codecpar.sampleRate>=11e3&&(f|=4),e.writeUint8(f),86018===t.codecpar.codecId&&e.writeUint8(d)}},1794:(e,t,a)=>{a.d(t,{$x:()=>s,bD:()=>d});var i=a(8590),r=a(3321),o=a(665);async function n(e,t){return{key:await e.readString(await e.readUint16()),value:await s(e,t)}}async function s(e,t){let a;switch(await e.readUint8()){case 0:a=await e.readDouble();break;case 1:a=!!await e.readUint8();break;case 2:a=await e.readString(await e.readUint16());break;case 3:for(a={};e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(a={},await e.skip(4);e.getPos()<t;){const{key:i,value:r}=await n(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:a=null;break;case 10:a=[];const i=await e.readUint32();for(let r=0;r<i;r++)a.push(await s(e,t));break;case 11:const r=await e.readDouble(),o=await e.readInt16();a=new Date(r+60*o*1e3);break;case 12:a=await e.readString(await e.readUint32())}return a}function d(e,t){i.ai(t)?(e.writeUint8(0),e.writeDouble(t)):i.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):i.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):i.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):i.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),r.__(t,(t=>{d(e,t)}))):i.Ik(t)?(e.writeUint8(3),o.__(t,((t,a)=>{e.writeUint16(a.length),e.writeString(a),d(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}},1945:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4467);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},3043:(e,t,a)=>{a.d(t,{DK:()=>s,XC:()=>c,Xr:()=>d,jA:()=>o,ob:()=>r,oe:()=>n});var i=a(5815);const r=34,o=8,n=[0,8,12,0,16,20,24,32],s=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],d=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===r){const{bitsPerRawSample:a,sampleRate:r,channels:o}=function(e){const t=new i.A(e);t.skip(10);const a=t.readUint24();return{sampleRate:a>>4,channels:1+((15&a)>>>1),bitsPerRawSample:1+((1&a)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=o}}},3690:(e,t,a)=>{a.d(t,{Ij:()=>c,XC:()=>d,kt:()=>s});var i=a(3262),r=a(5815),o=a(187);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function s(e){let t=0,a=0,i=0;if(e.length<1)return 0;switch(t=e[0],a=n[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*a}function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const a=new r.A(t,!1);a.skip(9),e.codecpar.chLayout.nbChannels=a.readUint8(),e.codecpar.initialPadding=a.readUint16(),e.codecpar.sampleRate=a.readUint32(),e.codecpar.seekPreroll=Number((0,i.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(e){const t=new Uint8Array(19),a=new o.A(t,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(e.chLayout.nbChannels),a.writeUint16(e.initialPadding),a.writeUint32(e.sampleRate),t}},3831:(e,t,a)=>{a.d(t,{Ui:()=>p,XC:()=>f,Yj:()=>u,k9:()=>h,zk:()=>d});var i=a(9983),r=a(39),o=a(3139),n=a(84),s=a(4916);const d={0:"Main",1:"High",2:"Professional"},c=[{level:20,maxResolution:2359296},{level:21,maxResolution:4460544},{level:30,maxResolution:10653696},{level:31,maxResolution:17040384},{level:40,maxResolution:21233664},{level:41,maxResolution:21233664},{level:50,maxResolution:35651584},{level:51,maxResolution:35651584},{level:52,maxResolution:35651584},{level:53,maxResolution:35651584},{level:60,maxResolution:142606336},{level:61,maxResolution:142606336},{level:62,maxResolution:142606336},{level:63,maxResolution:142606336}],l=[20,21,22,23,30,31,32,33,40,41,42,43,50,51,52,53,60,61,62,63,70,71,72,73];function h(e,t,a){const i=e*t;for(const e of c)if(i<=e.maxResolution)return e.level}function f(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const a=p(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function p(e){const t=new n.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const a=t.readU(3),i=t.readU(5),r=t.readU1();let o=t.readU1()?10:8;return t.readU1()&&(o=12),{profile:a,level:i,tier:r,bitDepth:o,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}function u(e,t){const a=new s.A(4);a.writeU1(1),a.writeU(7,1);const d=function(e){const t=new n.A;t.appendBuffer(e);const a=[];for(;t.remainingLength();){const i=t.getPointer();t.readU1(),t.readU(4);const o=t.readU1(),n=t.readU1();t.readU1(),o&&t.readU(8);const s=n?r.v(t):e.length-1-o,d=t.getPointer()-i;a.push(e.subarray(i,i+d+s)),t.skip(8*s)}return a}(t).find((e=>1==(e[0]>>>3&15)));if(d){const e=function(e){const t=new n.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(4);const a=t.readU1(),i=t.readU1();t.readU1(),a&&t.readU(8),i&&r.v(t);const o=r.f(t,3),s=(r.f(t,1),r.f(t,1));let d=0,c=0,h=[0],f=[0],p=[0],u=[0],m=[0],g=[0],w=0,U=[0],I=[0],R=[0];if(s)f[0]=r.f(t,5);else{d=r.f(t,1),d?(r.f(t,32),r.f(t,32),r.f(t,1)&&r.d(t),r.f(t,1)&&(w=r.f(t,5),r.f(t,32),r.f(t,5),r.f(t,5))):c=0;let e=r.f(t,1),a=r.f(t,5);for(let i=0;i<=a;i++){if(h[i]=r.f(t,12),f[i]=r.f(t,5),f[i]>7?p[i]=r.f(t,1):p[i]=0,c){if(u[i]=r.f(t,1),u[i]){let e=w+1;U[i]=r.f(t,e),I[i]=r.f(t,e),R[i]=r.f(t,1)}}else u[i]=0;e&&(m[i]=r.f(t,1),m[i]&&(g[i]=r.f(t,4)))}}let v=r.f(t,4),k=r.f(t,4),M=v+1,b=r.f(t,M);M=k+1;let B=r.f(t,M),y=0,A=0,D=0;y=s?0:r.f(t,1),y&&(r.f(t,4),r.f(t,3)),r.f(t,1),r.f(t,1),r.f(t,1);let x=0,C=0,P=0,S=0,L=0,T=0,F=2,N=2,z=0;s||(r.f(t,1),r.f(t,1),r.f(t,1),r.f(t,1),S=r.f(t,1),S?(L=r.f(t,1),T=r.f(t,1)):(L=0,T=0),F=r.f(t,1)?2:r.f(t,1),F>0?r.f(t,1)?2:r.f(t,1):2,S&&r.f(t,3)),r.f(t,1),r.f(t,1),r.f(t,1);let E=r.f(t,1),$=0,V=0,_=0;2==o&&E?($=r.f(t,1),V=$?12:10):o<=2&&(V=E?10:8),_=1==o?0:r.f(t,1);let X=0,O=0,Y=0;r.f(t,1)?(X=r.f(t,8),O=r.f(t,8),Y=r.f(t,8)):(X=2,O=2,Y=2);let W=0,H=0,Q=0,j=0,J=0;return _?(W=r.f(t,1),H=1,Q=1,j=0,J=0):1==X&&13==O&&0==Y?(W=1,H=0,Q=0,J=r.f(t,1)):(W=r.f(t,1),0==o?(H=1,Q=1):1==o?(H=0,Q=0):12==V?(H=r.f(t,1),Q=H?r.f(t,1):0):(H=1,Q=0),H&&Q&&(j=r.f(t,2)),J=r.f(t,1)),r.f(t,1),{width:b+1,height:B+1,profile:o,level:l[f[0]],tier:p[0],bitDepth:V,monoChrome:_,colorRange:W,colorPrimaries:X,transferCharacteristics:O,matrixCoefficients:Y,subsamplingX:H,subsamplingY:Q,chromaSamplePosition:j}}(d);a.writeU(3,e.profile),a.writeU(5,e.level),a.writeU(1,e.tier),a.writeU(1,e.bitDepth>8?1:0),a.writeU(1,12===e.bitDepth?1:0),a.writeU(1,e.monoChrome),a.writeU(1,e.subsamplingX),a.writeU(1,e.subsamplingY),a.writeU(1,e.chromaSamplePosition)}else{const t=(0,o.I)(i.f[15](e+28));a.writeU(3,i.f[15](e+48)),a.writeU(5,i.f[15](e+52)),a.writeU(1,0),a.writeU(1,t.comp[0].depth>8?1:0),a.writeU(1,12===t.comp[0].depth?1:0),a.writeU(1,0),a.writeU(1,1),a.writeU(1,1),a.writeU(1,0)}return a.writeU(8,0),a.padding(),a.getBuffer()}},3997:(e,t,a)=>{a.d(t,{A:()=>h});var i=a(9983),r=a(9989),o=a(495),n=a(4187),s=a(3262),d=a(1237),c=a(9906);const l="packages/avformat/src/function/seekInBytes.ts";async function h(e,t,a,h,f,p){const u=e.ioReader.getPos(),m=await e.ioReader.fileSize();let g=d.Dh,w=a;t.startTime!==d.Dh?w-=t.startTime:w-=t.firstDTS;const U=(0,s.k)(a,t.timeBase,d.i0);if(U<BigInt(1e4))return c.Yz(`seek pts is earlier then 10s, seek to first packet pos(${h}) directly`,l,78),await e.ioReader.seek(h),u;let I=(0,r.d)(e.streams,w,t.timeBase);const R=m-(0,r.d)(e.streams,BigInt(1e4),d.i0),v=(0,r.d)(e.streams,BigInt(1e4),d.i0);if(I>R&&(I=R),I<h)return await e.ioReader.seek(h),u;const k=(0,n._5)();let M=m,b=BigInt(0);e:for(;M-b<v&&(I=b),await e.ioReader.seek(I),await p(e),!(8&e.ioReader.flags);){let a=await f(e,k),r=i.f[17](k+56);if(!(a>=0)){g=d.Dh;break}{const o=(0,s.Mr)(i.f[17](k+8),k+72,d.i0);let h=o-U;if(c.Yz(`try to seek to pos: ${I}, got packet pts: ${i.f[17](k+8)}(${o}ms), diff: ${h}ms`,l,115),h<=BigInt(0)&&-h<BigInt(1e4)||M-b<v){const o=[r];for(;h<=0;){if(i.f[15](k+32)===t.index&&1&i.f[15](k+36)&&o.push(r),(0,n.Up)(k),a=await f(e,k),a<0){if(-1048576===a)break;if(-1048575===a)continue;g=d.Dh;break e}r=i.f[17](k+56),h=(0,s.Mr)(i.f[17](k+8),k+72,d.i0)-U}g=o.pop();break}h>BigInt(0)?(M=I,I=b+M>>BigInt(1)):(b=I,I=b+M>>BigInt(1))}if(8&e.ioReader.flags)break}return(0,n.Qe)(k),g!==d.Dh?(c.Yz(`finally seek to pos ${g}`,l,170),await e.ioReader.seek(g),await p(e),u):(await e.ioReader.seek(u),8&e.ioReader.flags?BigInt(o.LT):BigInt(o.E$))}},6760:(e,t,a)=>{a.d(t,{Ui:()=>m,XC:()=>u,Yj:()=>g,k9:()=>p,wN:()=>h});var i=a(9983),r=a(7145),o=a(6890),n=a(1237),s=a(3139),d=a(3262),c=a(84),l=a(187);const h={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"},f=[{level:10,maxResolution:196608,maxFrameRate:30},{level:11,maxResolution:196608,maxFrameRate:60},{level:20,maxResolution:518400,maxFrameRate:30},{level:21,maxResolution:518400,maxFrameRate:60},{level:30,maxResolution:2073600,maxFrameRate:30},{level:31,maxResolution:2073600,maxFrameRate:60},{level:40,maxResolution:3686400,maxFrameRate:30},{level:41,maxResolution:3686400,maxFrameRate:60},{level:50,maxResolution:8294400,maxFrameRate:30},{level:51,maxResolution:8294400,maxFrameRate:60},{level:60,maxResolution:8847360,maxFrameRate:30},{level:61,maxResolution:8847360,maxFrameRate:60},{level:70,maxResolution:35389440,maxFrameRate:30},{level:71,maxResolution:35389440,maxFrameRate:60}];function p(e,t,a){const i=e*t;for(const e of f)if(i<=e.maxResolution&&a<=e.maxFrameRate)return e.level}function u(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=m(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function m(e){const t=new c.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}function g(e){const t=new l.A(new Uint8Array(8)),a=function(e){let t=i.f[15](e+48),a=i.f[15](e+52);a===n.N_&&(a=p(i.f[15](e+56),i.f[15](e+60),(0,d.lb)((0,o.A)(e+72,r.Q))));const c=(0,s.I)(i.f[15](e+28));let l=i.f[15](e+40),h=1;c&&(l=c.comp[0].depth,1===c.log2ChromaW&&1===c.log2ChromaH?1===i.f[15](e+100)&&(h=0):1===c.log2ChromaW&&0===c.log2ChromaH?h=2:0===c.log2ChromaW&&0===c.log2ChromaH&&(h=3));const f=2===i.f[15](e+84)?1:0;return t===n.N_&&l&&(t=0==h||1==h?8==l?0:2:8==l?1:3),{profile:t,level:a,bitDepth:l,chromaSubsampling:h,fullRange:f}}(e);return t.writeUint8(a.profile),t.writeUint8(a.level),t.writeUint8(a.bitDepth<<4|a.chromaSubsampling<<1|a.fullRange),t.writeUint8(i.f[15](e+88)),t.writeUint8(i.f[15](e+92)),t.writeUint8(i.f[15](e+96)),t.writeUint16(0),t.getWroteBuffer()}},6783:(e,t,a)=>{a.r(t),a.d(t,{default:()=>z});var i=a(4467),r=a(3674),o=a(7127),n=a(9983),s=a(2320),d=a(7195),c=a(8589),l=a(810),h=a(1945),f=a(9515),p=a(3997),u=a(495),m=a(4187),g=a(1755),w=a(3262),U=a(1237),I=a(7314),R=a(8940),v=a(3831),k=a(3043),M=a(1497),b=a(4229),B=a(9935),y=a(3690),A=a(6760),D=a(8039),x=a(4096),C=a(1794),P=a(449),S=a(8590),L=a(3321),T=a(9906),F=a(5967);const N="packages/avformat/src/formats/IFlvFormat.ts";class z extends h.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,i.A)(this,"type",0),(0,i.A)(this,"header",void 0),(0,i.A)(this,"script",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"firstTagPos",void 0),this.header=new d.A,this.script=new c.A,this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{if("FLV"!==await e.ioReader.peekString(3))return T.z3("the file format is not flv",N,155),u.LR;await this.header.read(e.ioReader),0!==await e.ioReader.readUint32()&&T.R8("the previousTagSize0 is not 0",N,162);let t=0;if(18===await e.ioReader.peekUint8()){await e.ioReader.skip(1);const a=await e.ioReader.readUint24();await e.ioReader.skip(7),t=await this.script.read(e.ioReader,a)}return t>=0&&(this.firstTagPos=e.ioReader.getPos()),t}catch(t){return T.z3(t.message,N,180),e.ioReader.error}}async readModEx(e,t,a){let i=await e.ioReader.readUint8()+1;256===i&&(i=await e.ioReader.readUint16()+1);const r=await e.ioReader.readBuffer(i),o=await e.ioReader.readUint8(),d=240&o;if(0===d&&0===a||0===d&&1===a){let e=0;3===r.length?(e=r[0]<<16|r[1]<<8|r[2],this.options.useNanoTimestamp?s.M[17](t+16,n.f[17](t+16)+BigInt(e)):s.M[17](t+16,n.f[17](t+16)+BigInt(e)/BigInt(1e6)),s.M[17](t+8,n.f[17](t+16))):T.R8(`Invalid ModEx size for Type TimestampOffsetNano!, need 3 but got ${r.length}`,N,213)}else T.R8(`unknown ModEx type: ${d}`,N,217);return 15&o}async readCodecConfigurationRecord(e,t,a,i){const o=(0,g.sY)(i);t.codecpar.extradata?((0,m.Ow)(a,1,o,i),await e.ioReader.readBuffer(i,(0,r.JW)(o,i))):(t.codecpar.extradata=o,t.codecpar.extradataSize=i,await e.ioReader.readBuffer(i,(0,r.JW)(o,i)),t.sideData[1]=(0,r.s3)(o,i).slice(),27===t.codecpar.codecId?M.XC(t):173===t.codecpar.codecId?b.XC(t):196===t.codecpar.codecId?x.XC(t):225===t.codecpar.codecId?v.XC(t):167===t.codecpar.codecId?A.XC(t):139===t.codecpar.codecId?D.XC(t):86018===t.codecpar.codecId?I.XC(t):86028===t.codecpar.codecId?k.XC(t):86076===t.codecpar.codecId&&y.XC(t))}async readAVPacketData(e,t,a,i){const o=(0,g.sY)(i);(0,m.NX)(a,o,i),await e.ioReader.readBuffer(i,(0,r.JW)(o,i))}parseColorInfo(e,t,a){let i=!1,r=!1;if(a.hdrMdcv&&(i=a.hdrMdcv.redX>0&&a.hdrMdcv.redY>0&&a.hdrMdcv.blueX>0&&a.hdrMdcv.blueY>0&&a.hdrMdcv.greenX>0&&a.hdrMdcv.greenY>0&&a.hdrMdcv.whitePointX>0&&a.hdrMdcv.whitePointY>0,r=a.hdrMdcv.maxLuminance>0&&a.hdrMdcv.minLuminance>0),3!==a.colorConfig.matrixCoefficients&&(e.codecpar.colorSpace=a.colorConfig.matrixCoefficients),3!==a.colorConfig.colorPrimaries&&0!==a.colorConfig.colorPrimaries&&(e.codecpar.colorPrimaries=a.colorConfig.colorPrimaries),3!==a.colorConfig.transferCharacteristics&&0!==a.colorConfig.transferCharacteristics&&(e.codecpar.colorTrc=a.colorConfig.transferCharacteristics),a.hdrCll&&a.hdrCll.maxCLL&&a.hdrCll.maxFall){const n=(0,g.Gy)(8);s.M[8](n,a.hdrCll.maxCLL),s.M[8](n+4,a.hdrCll.maxFall),(0,m.sn)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,22)?(0,m.Ow)(t,22,n,8):(0,m.$W)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,22,n,8)}if(r||i){const d=(0,g.Gy)(88);function c(e,t){const a=(0,w.j2)(t,U.go);s.M[15](e+4,a.den),s.M[15](e,a.num)}r&&(s.M[15](d+84,1),c(d+72,a.hdrMdcv.maxLuminance),c(d+64,a.hdrMdcv.minLuminance)),i&&(s.M[15](d+80,1),c(d,a.hdrMdcv.redX),c(d+8,a.hdrMdcv.redY),c(d+16,a.hdrMdcv.greenX),c(d+16+8,a.hdrMdcv.greenY),c(d+32,a.hdrMdcv.blueX),c(d+32+8,a.hdrMdcv.blueY)),(0,m.sn)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,20)?(0,m.Ow)(t,20,d,88):(0,m.$W)(e.codecpar[o.o9]+20,e.codecpar[o.o9]+24,20,d,88)}}findStream(e,t,a){for(let i=0;i<e.streams.length;i++)if(e.streams[i].codecpar.codecType===t){const t=e.streams[i].privData;if(t&&t.trackId===a)return e.streams[i]}}createStream(e,t,a,i){var r;const o=e.createStream();o.codecpar.codecType=t,o.timeBase.den=this.options.useNanoTimestamp?U.H3:U.qs,o.timeBase.num=1,o.startTime=n.f[17](a+8);const s={trackId:i};var d,c,l;if(o.privData=s,null!==(r=this.script.onMetaData)&&void 0!==r&&r.duration&&(o.duration=(0,w.k)(BigInt(Math.floor(1e3*this.script.onMetaData.duration)),U.i0,o.timeBase)),0===t)(null===(d=this.script.onMetaData)||void 0===d?void 0:d.width)>0&&(o.codecpar.width=this.script.onMetaData.width),(null===(c=this.script.onMetaData)||void 0===c?void 0:c.height)>0&&(o.codecpar.height=this.script.onMetaData.height),null!==(l=this.script.onMetaData)&&void 0!==l&&null!==(l=l.videoTrackIdInfoMap)&&void 0!==l&&l[i]&&(this.script.onMetaData.videoTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.videoTrackIdInfoMap[i].title),this.script.onMetaData.videoTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.videoTrackIdInfoMap[i].lang),this.script.onMetaData.videoTrackIdInfoMap[i].width>0&&(o.codecpar.width=this.script.onMetaData.videoTrackIdInfoMap[i].width),this.script.onMetaData.videoTrackIdInfoMap[i].height>0&&(o.codecpar.height=this.script.onMetaData.videoTrackIdInfoMap[i].height),this.script.onMetaData.videoTrackIdInfoMap[i].duration>0&&(o.duration=(0,w.k)(BigInt(1e3*this.script.onMetaData.videoTrackIdInfoMap[i].duration),U.i0,o.timeBase)));else if(1===t){var h;null!==(h=this.script.onMetaData)&&void 0!==h&&null!==(h=h.audioTrackIdInfoMap)&&void 0!==h&&h[i]&&(this.script.onMetaData.audioTrackIdInfoMap[i].title&&(o.metadata.title=this.script.onMetaData.audioTrackIdInfoMap[i].title),this.script.onMetaData.audioTrackIdInfoMap[i].lang&&(o.metadata.language=this.script.onMetaData.audioTrackIdInfoMap[i].lang),this.script.onMetaData.audioTrackIdInfoMap[i].duration>0&&(o.duration=(0,w.k)(BigInt(1e3*this.script.onMetaData.audioTrackIdInfoMap[i].duration),U.i0,o.timeBase)))}return this.onStreamAdd&&this.onStreamAdd(o),o}async readAVPacket_(e,t){const a=e.ioReader.getPos();s.M[17](t+56,a);let i=!1;const d=31&await e.ioReader.readUint8();let c=await e.ioReader.readUint24(),h=await e.ioReader.readUint24();const p=await e.ioReader.readUint8();if(p&&(h|=p<<24),s.M[17](t+16,this.options.useNanoTimestamp?(0,w.k)(BigInt(Math.floor(h)),U.i0,U.FQ):BigInt(Math.floor(h))),s.M[17](t+8,n.f[17](t+16)),await e.ioReader.skip(3),8===d){s.M[15](t+36,1|n.f[15](t+36));const d=await e.ioReader.readUint8();c--;const h=(240&d)>>4;if(9===h){let l=!1,h=15&d;for(;7===h;){let a=e.ioReader.getPos();h=await this.readModEx(e,t,1),c-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let p=0,u=0;if(5===h){l=!0;const t=await e.ioReader.readUint8();c--,u=(240&t)>>4,h=15&t,2!==u&&(p=await e.ioReader.readUint32(),c-=4)}else p=await e.ioReader.readUint32(),c-=4;let g=t;for(;;){let d=c,w=0;l&&(2===u&&(p=await e.ioReader.readUint32(),c-=4),w=await e.ioReader.readUint8(),c--,0!==u?(d=await e.ioReader.readUint24(),c-=3):d=c);let I=this.findStream(e,1,w);if(I||(I=this.createStream(e,1,g,w),p===(0,f.A)("ac-3")?I.codecpar.codecId=86019:p===(0,f.A)("ec-3")?I.codecpar.codecId=86056:p===(0,f.A)("Opus")?(I.codecpar.codecId=86076,I.codecpar.sampleRate=48e3):p===(0,f.A)(".mp3")?I.codecpar.codecId=86017:p===(0,f.A)("fLaC")?I.codecpar.codecId=86028:p===(0,f.A)("mp4a")?I.codecpar.codecId=86018:(T.R8(`unknown codec fourcc(${p.toString(16)})`,N,546),I.codecpar.codecId=0)),s.M[15](g+32,I.index),c-=d,4===h){const t=await e.ioReader.readUint8(),a=await e.ioReader.readUint8();if(d-=2,P.bl(I.codecpar[o.o9]+112),2===t){P.xY(I.codecpar[o.o9]+112,a);for(let t=0;t<a;t++){const a=await e.ioReader.readUint8();d--,a<18?s.M[15](I.codecpar.chLayout.u.map+24*t,a):a>=18&&a<=23?s.M[15](I.codecpar.chLayout.u.map+24*t,a-18+35):254===a?s.M[15](I.codecpar.chLayout.u.map+24*t,512):s.M[15](I.codecpar.chLayout.u.map+24*t,768)}}else if(1===t){let t=BigInt(await e.ioReader.readUint32());d-=4,t=t&BigInt(262143)|(t&BigInt(16515072))<<BigInt(35)-BigInt(18),P.ML(I.codecpar[o.o9]+112,t)}i=!0}else if(0===h)d?(await this.readCodecConfigurationRecord(e,I,g,d),d=0,i=!1,(0,m.fQ)(t,1)||(i=!0)):i=!0;else if(2===h)s.M[15](g+36,32|n.f[15](g+36)),i=!1;else if(1===h){if(await this.readAVPacketData(e,I,g,d),(86019===I.codecpar.codecId||86056===I.codecpar.codecId||86017===I.codecpar.codecId)&&I.codecpar.sampleRate===U.N_)if(86019===I.codecpar.codecId||86056===I.codecpar.codecId){const e=R.R((0,m.iI)(g));S.ai(e)||(I.codecpar.sampleRate=e.sampleRate,I.codecpar.chLayout.nbChannels=e.channels,I.codecpar.bitrate=BigInt(e.bitrate))}else 86017===I.codecpar.codecId&&B.XC(I,(0,m.iI)(g));i=!1,d=0}else T.R8(`invalid audioPacketType ${h}`,N,628);if(d&&await e.ioReader.skip(d),g===t||i||e.interval.packetBuffer.push(g),!l||0===u||!c)break;g=(0,m._5)(),s.M[17](g+56,a),(0,r.Mr)(g+72,t+72,8),s.M[17](g+16,n.f[17](t+16)),s.M[17](g+8,n.f[17](t+8)),s.M[15](g+36,1|n.f[15](g+36))}}else{let a=this.findStream(e,1,0);if(!a){if(a=this.createStream(e,1,t,0),a.disposition|=1,a.codecpar.chLayout.nbChannels=1&~d?1:2,a.codecpar.sampleRate=44100<<((12&d)>>>2)>>3,a.codecpar.bitsPerCodedSample=2&d?16:8,0===h)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else if(3===h)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else{var u;a.codecpar.codecId=null!==(u=l.FJ[h])&&void 0!==u?u:0}86051===a.codecpar.codecId?(a.codecpar.sampleRate=16e3,a.codecpar.chLayout.nbChannels=1):65543!==a.codecpar.codecId&&65542!==a.codecpar.codecId||(a.codecpar.sampleRate=8e3)}s.M[15](t+32,a.index),86018===a.codecpar.codecId&&(c--,0===await e.ioReader.readUint8()&&(this.readCodecConfigurationRecord(e,a,t,c),c=0,(0,m.fQ)(t,1)||(i=!0))),c&&(await this.readAVPacketData(e,a,t,c),c=0)}}else if(9===d){const o=await e.ioReader.readUint8(),d=128&o,h=(112&o)>>4;if(c--,1===h&&s.M[15](t+36,1|n.f[15](t+36)),d){let d=!0,l=!1,p=15&o;for(;7===p;){let a=e.ioReader.getPos();p=await this.readModEx(e,t,0),c-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let u=0,g=0;if(4!==p&&5===h)d=!1,i=!0;else if(6===p){l=!0;const t=await e.ioReader.readUint8();c--,g=(240&t)>>4,p=15&t,2!==g&&(u=await e.ioReader.readUint32(),c-=4)}else u=await e.ioReader.readUint32(),c-=4;let I=t;for(;d;){let o=c,d=0;l&&(2===g&&(u=await e.ioReader.readUint32(),c-=4),d=await e.ioReader.readUint8(),c--,0!==g?(o=await e.ioReader.readUint24(),c-=3):o=c);let R=this.findStream(e,0,d);if(R||(R=this.createStream(e,0,I,d),u===(0,f.A)("avc1")?R.codecpar.codecId=27:u===(0,f.A)("hvc1")?R.codecpar.codecId=173:u===(0,f.A)("vvc1")?R.codecpar.codecId=196:u===(0,f.A)("av01")?R.codecpar.codecId=225:u===(0,f.A)("vp09")?R.codecpar.codecId=167:u===(0,f.A)("vp08")&&(R.codecpar.codecId=139)),s.M[15](I+32,R.index),c-=o,4===p){const t=e.ioReader.getPos()+BigInt(Math.floor(o)),a=await C.$x(e.ioReader,t),r=await C.$x(e.ioReader,t);"colorInfo"===a?this.parseColorInfo(R,I,r):T.R8(`unknown metadata key ${a}`,N,805),e.ioReader.getPos()<t&&await e.ioReader.seek(t),i=!0,o=0}else if(0===p)o?(await this.readCodecConfigurationRecord(e,R,I,o),o=0,i=!1,(0,m.fQ)(t,1)||(i=!0)):i=!0;else if(2===p)s.M[15](I+36,32|n.f[15](I+36)),i=!1;else if(5===p)225===R.codecpar.codecId?(await this.readCodecConfigurationRecord(e,R,I,o-2),i=!1,o=0,(0,m.fQ)(t,1)||(i=!0)):i=!0;else if(1===p||3===p){if(1===p&&(173===R.codecpar.codecId||196===R.codecpar.codecId||27===R.codecpar.codecId)){const a=await e.ioReader.readInt24();s.M[17](I+8,n.f[17](I+16)+(this.options.useNanoTimestamp?(0,w.FP)(BigInt(0|a),U.i0,t+72):BigInt(0|a))),o-=3}await this.readAVPacketData(e,R,I,o),o=0,i=!1}else T.R8(`invalid videoPacketType ${p}`,N,864);if(o&&await e.ioReader.skip(o),i||I===t||e.interval.packetBuffer.push(I),!l||0===g||!c)break;I=(0,m._5)(),s.M[17](I+56,a),(0,r.Mr)(I+72,t+72,8),s.M[17](I+16,n.f[17](t+16)),s.M[17](I+8,n.f[17](t+8)),1===h&&s.M[15](I+36,1|n.f[15](I+36))}}else if(5!==h){let a=this.findStream(e,0,0);var g;if(a||(a=this.createStream(e,0,t,0),a.disposition|=1,a.codecpar.codecId=null!==(g=l.U5[15&o])&&void 0!==g?g:0),s.M[15](t+32,a.index),27===a.codecpar.codecId||173===a.codecpar.codecId||196===a.codecpar.codecId||12===a.codecpar.codecId){const r=await e.ioReader.readUint8(),o=await e.ioReader.readInt24();c-=4,s.M[17](t+8,n.f[17](t+16)+(this.options.useNanoTimestamp?(0,w.FP)(BigInt(0|o),U.i0,t+72):BigInt(0|o))),0===r?(await this.readCodecConfigurationRecord(e,a,t,c),(0,m.fQ)(t,1)||(i=!0)):2===r?s.M[15](t+36,32|n.f[15](t+36)):await this.readAVPacketData(e,a,t,c)}else await this.readAVPacketData(e,a,t,c);c=0}else i=!0}else{if(18===d){let a=await this.script.read(e.ioReader,c);return a<0?a:await this.readAVPacket_(e,t)}if(15!==d)return T.R8(`invalid tag type: ${d}, try to sync to next tag`,N,950),await this.syncTag(e),this.readAVPacket_(e,t);T.R8("not support script tag encoded by amf3, ignore it",N,947)}c&&await e.ioReader.skip(c);const I=e.ioReader.getPos()-a,v=BigInt(Math.floor(await e.ioReader.readUint32()));return I!==v&&T.R8(`tag ${d} size not match, size: ${I}, previousTagSize: ${v}`,N,963),i?this.readAVPacket_(e,t):0}async readAVPacket(e,t){try{return s.M[15](t+76,this.options.useNanoTimestamp?U.H3:U.qs),s.M[15](t+72,1),await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(T.z3(`read packet error, ${t}`,N,981),u.LR):e.ioReader.error}}async syncTag(e){let t=U.Dh;for(;;)try{if(8&e.ioReader.flags)break;const a=await e.ioReader.readUint8();if(8===a||9===a){t=e.ioReader.getPos()-BigInt(1);const a=await e.ioReader.readUint24();if(a>10485760){await e.ioReader.seek(t+BigInt(1));continue}if(await e.ioReader.skip(4),0!==await e.ioReader.readUint24()){await e.ioReader.seek(t+BigInt(1));continue}await e.ioReader.skip(a);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32()))){await e.ioReader.seek(t+BigInt(1)),t=U.Dh;continue}{let a=0;for(;a<=3;){const t=e.ioReader.getPos(),i=await e.ioReader.readUint8();if(8!==i&&9!==i&&18!==i)break;{const i=await e.ioReader.readUint24();await e.ioReader.skip(7+i);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32())))break;a++}}if(!(a<3))break;await e.ioReader.seek(t+BigInt(1)),t=U.Dh}}}catch(e){break}t!==U.Dh&&await e.ioReader.seek(t)}async seek(e,t,a,i){const r=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(a),4&i||await this.syncTag(e),r;if(t&&t.sampleIndexes.length){let i=L.El(t.sampleIndexes,(e=>e.pts>a?-1:1));if(i>0&&(0,w.k)(a-t.sampleIndexes[i-1].pts,t.timeBase,U.i0)<BigInt(1e4))return T.Yz(`seek in sampleIndexes, found index: ${i}, pts: ${t.sampleIndexes[i-1].pts}, pos: ${t.sampleIndexes[i-1].pos}`,N,1088),await e.ioReader.seek(t.sampleIndexes[i-1].pos),r}if(this.script.canSeek()){const{pos:i,dts:o}=this.script.dts2Position(Number((0,w.k)(a,t.timeBase,U.i0)/BigInt(1e3)));if(i>0){T.Yz(`seek in filepositions, found pts: ${o}, pos: ${i}`,N,1097),await e.ioReader.seek(BigInt(Math.floor(i)));const t=await e.ioReader.peekUint8();return 8!==t&&9!==t&&18!==t&&await this.syncTag(e),r}}return T.Yz("not found any keyframe index, try to seek in bytes",N,1107),(0,p.A)(e,t,a,this.firstTagPos,this.readAVPacket.bind(this),this.syncTag.bind(this))}getAnalyzeStreamsCount(){let e=0;return(this.header.hasAudio||(0,F.A)(this.script.onMetaData.audiocodecid))&&e++,(this.header.hasVideo||(0,F.A)(this.script.onMetaData.videocodecid))&&e++,e}}},7195:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4467);class r{constructor(){(0,i.A)(this,"signature",void 0),(0,i.A)(this,"version",void 0),(0,i.A)(this,"flags",void 0),(0,i.A)(this,"dataOffset",void 0),(0,i.A)(this,"hasVideo",void 0),(0,i.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}},7314:(e,t,a)=>{a.d(t,{Bq:()=>f,En:()=>d,Hm:()=>n,Ij:()=>h,XC:()=>l,_5:()=>c,f7:()=>p,hY:()=>s,uF:()=>o});var i=a(1237),r=a(84);const o={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(e){let t=i.N_,a=i.N_,r=i.N_;return e.length>=2&&(t=e[0]>>3&31,a=s[(7&e[0])<<1|e[1]>>7],r=d[e[1]>>3&15]),{profile:t,sampleRate:a,channels:r}}function l(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:i,channels:r}=c(t);e.codecpar.profile=a,e.codecpar.sampleRate=i,e.codecpar.chLayout.nbChannels=r,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function h(e){const t=n[e.sampleRate],a=e.chLayout.nbChannels,r=e.profile===i.N_?2:e.profile,o=new Uint8Array(2);return o[0]=(31&r)<<3|(14&t)>>1,o[1]=(1&t)<<7|(15&a)<<3,o}function f(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],i=(192&e[2])>>>6,r=(60&e[2])>>>2,o=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,c=3&e[6];let l=1===a?7:9,h=n-l;return{syncWord:t,profile:i+1,sampleRate:s[r],channels:d[o],aacFrameLength:n,numberOfRawDataBlocksInFrame:c,headerLength:l,framePayloadLength:h}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let i=0;i<=e;i++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const i=t.getPointer(),o={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;o.syncWord=n,o.muxLengthBytes=t.readU(13);const c=1===t.readU1();if(o.useSameStreamMux=c,!c){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?a():0;const r=t.readU(5);i-=5;const n=t.readU(4);i-=4;const c=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),o.profile=r+1,o.sampleRate=s[n],o.channels=d[c]}let l=0;for(;;){const e=t.readU(8);if(l+=e,255!==e)break}return o.framePayloadLength=l,o.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),o}},8039:(e,t,a)=>{a.d(t,{Ui:()=>o,XC:()=>r});var i=a(84);function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=o(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function o(e){const t=new i.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},8370:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4467),r=a(4405);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1048576,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,a&&a.view)this.size=a.length,this.buffer=a,this.data=a.view;else if(a&&!a.byteOffset)this.size=a.length,this.buffer=a,this.data=new DataView(this.buffer.buffer);else{if(a)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,a=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(a),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(a),this.writeUint8(i))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let a=0;for(;t>0;){this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(a,a+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),a+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=r.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}},8589:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(4467),r=a(1135),o=a(1794),n=a(495),s=a(9906),d=a(3737),c=a(8370);class l{constructor(){(0,i.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const a=e.getPos(),i=a+BigInt(Math.floor(t)),r=await o.$x(e,i),d=await o.$x(e,i);this[r]=d,i>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,i-e.getPos())));const c=Number(e.getPos()-a),l=await e.readUint32();return c+11!==l?(s.R8(`script size not match, size: ${c+11}, previousTagSize: ${l}`,"packages/avformat/src/formats/flv/FlvScriptTag.ts",60),n.LR):0}computeSize(){const e=[],t=new c.A;return t.onFlush=t=>(e.push(t.slice()),0),o.bD(t,"onMetaData"),o.bD(t,this.onMetaData),t.flush(),(0,d.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],a=new c.A;a.onFlush=e=>(t.push(e.slice()),0),o.bD(a,"onMetaData"),o.bD(a,this.onMetaData),a.flush();const i=(0,d.A)(Uint8Array,t);r.M5(e,18,BigInt(0),void 0,i)}}dts2Position(e){if(this.canSeek()){let t=-1;const a=this.onMetaData.keyframes.times,i=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<a.length;r++){if(a[r]===e){t=r;break}if(a[r]>e){t=Math.max(r-1,0);break}}return r&&r===a.length&&(t=a.length-1),{pos:i[t],dts:a[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let a=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let o=0;for(o=0;o<r.length;o++)if(r[o]>e){a=o;break}var t;return o===r.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:i[i.length-1]:i[a]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},8940:(e,t,a)=>{a.d(t,{R:()=>p,j:()=>r});var i=a(84);const r=[3,4,3,7,259,263,1539,1543],o=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],s=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],h=[1,2,3,6],f=7;function p(e){const t=new i.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=s[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=d[a.srCode]>>a.srShift,a.bitrate=1e3*c[a.ac3BitrateCode]>>a.srShift,a.channels=l[a.channelMode]+a.lfeOn,a.frameSize=2*o[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<f)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=d[e]/2,a.srShift=1}else a.numBlocks=h[t.readU(2)],a.sampleRate=d[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=l[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},9515:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(9906);const r="packages/avformat/src/function/mktag.ts";function o(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,r,31);let t=0;for(let a=0;a<4;a++)t=t<<8|e.charCodeAt(a);return t}},9935:(e,t,a)=>{a.d(t,{Au:()=>U,He:()=>I,XC:()=>R,Y2:()=>m,hG:()=>g,oz:()=>w});var i=a(1237);const r=[44100,48e3,32e3,0],o=[22050,24e3,16e3,0],n=[11025,12e3,8e3,0],s=[0,1152,1152,384],d=[0,576,1152,384],c=[0,576,1152,384],l=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],h=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],p=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],u=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function m(e,t){switch(e){case 0:return n[t];case 2:return o[t];case 3:return r[t]}return i.N_}function g(e,t){switch(e){case 0:return c[t];case 2:return d[t];case 3:return s[t]}return i.N_}function w(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return u[a];case 3:return f[a]}break;case 2:switch(e){case 0:case 2:return u[a];case 3:return h[a]}case 3:switch(e){case 0:case 2:return p[a];case 3:return l[a]}}return i.N_}function U(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return i.N_}const I={32:"Layer1",33:"Layer2",34:"Layer3"};function R(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,i=(6&t[1])>>1,r=(12&t[2])>>>2,o=3&~(t[3]>>>6)?2:1,n=U(i),s=m(a,r);e.codecpar.profile=n,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=o}}},9989:(e,t,a)=>{a.d(t,{d:()=>n});var i=a(3321),r=a(1237),o=a(3262);function n(e,t,a){let n=BigInt(0);return i.__(e,(e=>{n+=e.codecpar.bitrate*(0,o.k)(t,a,r.i0)/BigInt(8e3)})),n}}}]);