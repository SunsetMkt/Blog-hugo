"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[296],{935:(e,t,i)=>{i.d(t,{CM:()=>o,Vz:()=>n,qg:()=>c});var a=i(4467),r=i(9935);class n{constructor(){(0,a.A)(this,"version",void 0),(0,a.A)(this,"layer",void 0),(0,a.A)(this,"protection",void 0),(0,a.A)(this,"bitrateIndex",void 0),(0,a.A)(this,"samplingFrequency",void 0),(0,a.A)(this,"padding",void 0),(0,a.A)(this,"private",void 0),(0,a.A)(this,"mode",void 0),(0,a.A)(this,"modeExtension",void 0),(0,a.A)(this,"copyright",void 0),(0,a.A)(this,"original",void 0),(0,a.A)(this,"emphasis",void 0)}}function c(e,t){e.version=t>>19&3,e.layer=t>>17&3,e.protection=t>>16&1,e.bitrateIndex=t>>12&15,e.samplingFrequency=t>>10&3,e.padding=t>>9&1,e.mode=t>>6&3,e.modeExtension=t>>4&3,e.copyright=t>>3&1,e.original=t>>2&1,e.emphasis=3&t}function o(e,t){let i=r.oz(e.version,e.layer,e.bitrateIndex);switch(e.layer){case 1:default:i=144e3*i/(t<<(3===e.version?0:1))>>>0,i+=e.padding;break;case 2:i=144e3*i/t>>>0,i+=e.padding;break;case 3:i=12e3*i/t>>>0,i=4*(i+e.padding)}return i}},4222:(e,t,i)=>{i.d(t,{FN:()=>n,W8:()=>a,c1:()=>r});const a=100,r=128,n=156},4906:(e,t,i)=>{i.d(t,{In:()=>T,M9:()=>A,VO:()=>v,fz:()=>w,hm:()=>I,qg:()=>S});var a=i(9983),r=i(2320),n=i(3674),c=i(4187),o=i(1755),s=i(3321),d=i(665),g=i(9906),l=i(4405),f=i(3737),u=i(8370),p=i(5815);const m="packages/avformat/src/formats/mp3/id3v2.ts",T={JPG:7,PNG:61,"image/gif":97,"image/jpeg":7,"image/jpg":7,"image/png":61,"image/tiff":96,"image/bmp":78,"image/webp":171},w=["Other","32x32 pixels 'file icon'","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"];function h(e,t){e.writeUint8(t>>21&127),e.writeUint8(t>>14&127),e.writeUint8(t>>7&127),e.writeUint8(127&t)}function b(e,t){let i="utf-8";return 0===e?i="iso-8859-1":1===e?i="utf-16":2===e&&(i="utf-16be"),new TextDecoder(i).decode(t)}function P(e){return(127&e)+((32512&e)>>1)+((8323072&e)>>2)+((2130706432&e)>>3)}async function k(e,t){await e.seek(t);const i=await e.readString(4);return/^[A-Z0-9]+$/.test(i)}async function S(e,t,i,a){const r=2!==i.version,n=r?10:6;let c=e.getPos()+BigInt(0|t);async function o(){await e.skip(Number(BigInt.asIntN(32,c-e.getPos())))}if(r&&64&i.flags){let a=await async function(e,t){let i=0;for(;t--;)i=(i<<7)+(127&await e.readUint8());return i}(e,4);if(4===i.version&&(a-=4),a<0)return g.z3("invalid extended header length",m,149),await o();if(await e.skip(a),(t-=a+4)<0)return g.z3("extended header too long",m,155),await o()}for(;t>n;){let c,o;if(r){if(c=await e.readString(4),o=await e.readUint32(),!o){g.z3("invalid frame size",m,168);break}if(4===i.version&&o>127)if(o<t){await e.flush();const t=e.getPos();if(!(1&e.flags||6+o<e.remainingLength()))break;if(await k(e,t+BigInt(2)+BigInt(P(o))))o=P(o);else if(!await k(e,t+BigInt(2)+BigInt(o)))break;await e.seek(t)}else o=P(o);await e.readUint16()}else c=await e.readString(3),o=await e.readUint24();if("APIC"===c)a.apic||(a.apic=[]),a.apic.push(await e.readBuffer(o));else if("USLT"===c){const t=await e.readUint8(),i=await e.readString(3),r=await e.readBuffer(o-4);a.lyrics=`${i} ${b(t,r)}`}else if("COMM"===c||"COM"===c){const t=await e.readUint8(),i=await e.readString(3),r=await e.readBuffer(o-4);a.comment=`${i} ${b(t,r)}`}else if("PRIV"===c){const t=e.getPos(),i=[];for(;;){const t=await e.readUint8();if(0===t)break;i.push(t)}const r=l.decode(new Uint8Array(i));let n;n="com.apple.streaming.transportStreamTimestamp"===r?await e.readUint64():await e.readBuffer(o-Number(e.getPos()-t)),a[r]=n}else{let t;switch(t="T"===c[0]?b(await e.readUint8(),await e.readBuffer(o-1)):await e.readBuffer(o),c){case"TIT2":case"TT2":a.title=t;break;case"TPE1":case"TP1":a.artist=t;break;case"TPE2":case"TP2":a.albumArtist=t;break;case"TPOS":a.disc=t;break;case"TCOP":a.copyright=t;break;case"TALB":case"TAL":a.album=t;break;case"TRCK":case"TRK":a.track=t;break;case"TYER":case"TDRL":case"TDRC":a.date=t;break;case"COMM":case"COM":a.comment=t;break;case"TCON":case"TCO":a.genre=t;break;case"TSSE":case"TEN":a.encoder=t;break;case"TCOM":a.composer=t;break;case"TENC":a.vendor=t;break;case"TLAN":a.language=t;break;case"TPE3":case"TP3":a.performer=t;break;case"TPUB":a.publisher=t;break;case"TCMP":case"TCP":a.compilation=t;break;case"TDEN":a.creationTime=t;break;case"TSOA":a.albumSort=t;break;case"TSOP":a.artistSort=t;break;case"TSOT":a.titleSort=t;break;case"TIT1":a.grouping=t;break;default:a[c]=t}}t-=o+n}4==i.version&&16&i.flags&&(c+=BigInt(10)),await e.skip(Number(BigInt.asIntN(32,c-e.getPos())))}function I(e,t,i){const d=2!==i.version;t.forEach((t=>{const i=new p.A(t),g=i.readUint8();let l;function f(){let e=Number(i.getPos());for(;e<t.length&&t[e];)e++;return e}if(d?(l=i.readString(f()-Number(i.getPos())),i.skip(1)):l=i.readString(3),!T[l])return;const u=i.readUint8();let m;const h=f()-Number(i.getPos());h&&(m=b(g,i.readBuffer(h))),i.skip(1);const P=e.createStream();P.codecpar.codecId=T[l],P.codecpar.codecType=0,P.disposition|=1024,P.attachedPic=(0,c._5)(),r.M[15](P.attachedPic+32,P.index);const k=i.remainingSize(),S=(0,o.sY)(k),I=i.readBuffer(k);(0,n.lW)(S,k,I),I.length>=8&&s.FB(I.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))&&(P.codecpar.codecId=61),(0,c.NX)(P.attachedPic,S,k),r.M[15](P.attachedPic+36,1|a.f[15](P.attachedPic+36)),P.metadata.comment=w[u],m&&(P.metadata.title=m)}))}function A(e,t,i,a){let r=e.getPos();e.writeString("ID3"),e.writeUint8(t),e.writeUint16(0);const n=e.getPos();function c(i,a){const r=l.encode(a);e.writeString(i),4===t?h(e,r.length+1):e.writeUint32(r.length+1),e.writeUint16(0),e.writeUint8(3),e.writeBuffer(r)}function o(i,a){e.writeString(i),4===t?h(e,a.length):e.writeUint32(a.length),e.writeUint16(0),e.writeBuffer(a)}if(e.writeUint32(0),a.poster&&o("APIC",a.poster),a.apic&&a.apic.forEach((e=>{o("APIC",e)})),a.title&&c("TIT2",a.title),a.artist&&c("TPE1",a.artist),a.albumArtist&&c("TPE2","albumArtist"),a.disc&&c("TPOS",a.disc),a.copyright&&c("TCOP",a.copyright),a.album&&c("TALB",a.album),a.track&&c("TRCK",a.track),a.date&&c("TDRC",a.date),a.comment){let e=a.comment;" "===e[3]&&(e=e.slice(0,3)+e.slice(4)),c("COMM",e)}if(a.lyrics){let e=a.lyrics;" "===e[3]&&(e=e.slice(0,3)+e.slice(4)),c("USLT",e)}a.genre&&c("TCON",a.genre+""),a.encoder&&c("TSSE",a.encoder),a.composer&&c("TCOM",a.composer),a.vendor&&c("TENC",a.vendor),a.language&&c("TLAN",a.language),a.performer&&c("TPE3",a.performer),a.publisher&&c("TPUB",a.publisher),a.compilation&&c("TCMP",a.compilation),a.creationTime&&c("TDEN",a.creationTime),a.albumSort&&c("TSOA",a.albumSort),a.artistSort&&c("TSOP",a.artistSort),a.titleSort&&c("TSOT",a.titleSort),a.grouping&&c("TIT1",a.grouping),i<10&&(i=10);const s=Number(BigInt.asIntN(32,e.getPos()-r));i>268435455-s&&(i=268435455-s),e.writeBuffer(new Uint8Array(i).fill(0)),r=e.getPos(),e.seek(n),h(e,s),e.seek(r)}function v(e,t){const i=[],a=new u.A,r=[];a.onFlush=e=>(r.push(e.slice()),0);const n=2!==t;return e.streams.forEach((e=>{if(1024&e.disposition&&(n&&(7===e.codecpar.codecId||61===e.codecpar.codecId||96===e.codecpar.codecId||97===e.codecpar.codecId||171===e.codecpar.codecId||78===e.codecpar.codecId)||!n&&(61===e.codecpar.codecId||7===e.codecpar.codecId))&&e.attachedPic){r.length=0,a.writeUint8(3),n?(a.writeString(d.BE(T)[e.codecpar.codecId]),a.writeUint8(0)):61===e.codecpar.codecId?a.writeString("PNG"):a.writeString("JPG");let t=0;e.metadata.comment&&w.indexOf(e.metadata.comment)>-1&&(t=w.indexOf(e.metadata.comment)),a.writeUint8(t),e.metadata.description&&a.writeString(e.metadata.description),a.writeUint8(0),a.writeBuffer((0,c.iI)(e.attachedPic)),a.flush(),i.push((0,f.A)(Uint8Array,r))}})),i}}}]);