"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[458],{2518:(t,i,e)=>{e.d(i,{A:()=>b});var r=e(4467),s=e(9983),c=e(2320),h=e(3458),a=e(665),o=e(4916),n=e(3674),d=e(495),p=e(4187),f=e(1755),u=e(7314);const l={mod:20},A=new Uint8Array([86,224,0]);class b extends h.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"bitWriter",void 0),(0,r.A)(this,"counter",void 0),(0,r.A)(this,"options",void 0),this.options=a.X$({},l,t)}init(t,i){return super.init(t,i),this.cache=(0,p._5)(),this.cached=!1,this.counter=0,this.bitWriter=new o.A,0}destroy(){super.destroy(),(0,p.Qe)(this.cache),this.cache=0}writeHeader(){this.bitWriter.writeU1(0===this.counter?0:1),0===this.counter&&(this.bitWriter.writeU1(0),this.bitWriter.writeU1(1),this.bitWriter.writeU(6,0),this.bitWriter.writeU(4,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(5,s.f[15](this.inCodecpar+48)-1&31),this.bitWriter.writeU(4,15&u.Hm[s.f[15](this.inCodecpar+136)]),this.bitWriter.writeU(4,15&s.f[15](this.inCodecpar+116)),this.bitWriter.writeU(3,0),this.bitWriter.writeU(3,0),this.bitWriter.writeU(8,255),this.bitWriter.writeU1(0),this.bitWriter.writeU1(0)),this.counter++,this.counter%=this.options.mod}copyBytes(t){for(let i=0;i<t.length;i++)this.bitWriter.writeU(8,t[i])}sendAVPacket(t){if(!s.f[20](t+24)||!s.f[15](t+28))return 0;this.bitWriter.reset();const i=(0,p.rU)(t,1);if(i){const{profile:t,sampleRate:e,channels:r}=u._5((0,n.s3)(s.f[20](i),s.f[25](i+4)));c.M[15](this.inCodecpar+48,t),c.M[15](this.inCodecpar+136,e),c.M[15](this.inCodecpar+116,r),this.counter=0}this.writeHeader();let e=0;for(;e<=s.f[15](t+28)-255;e+=255)this.bitWriter.writeU(8,255);this.bitWriter.writeU(8,s.f[15](t+28)-e);const r=(0,n.s3)(s.f[20](t+24),s.f[15](t+28));129==(225&r[0])?(this.bitWriter.writeU(8,254&r[0]),this.copyBytes(r.subarray(1))):this.copyBytes(r),this.bitWriter.padding();const h=this.bitWriter.getPointer(),a=3+h,o=(0,f.sY)(a),d=(0,n.s3)(o,a);return d.set(A,0),d[1]|=h>>8&31,d[2]|=255&h,d.set(this.bitWriter.getBuffer().subarray(0,h),3),(0,p.zu)(this.cache,t),(0,p.NX)(this.cache,o,a),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,p.Up)(t),(0,p.rN)(t,this.cache),this.cached=!1,0):d.LT}reset(){return 0}}},3458:(t,i,e)=>{e.d(i,{A:()=>a});var r=e(4467),s=e(9983),c=e(1755),h=e(2836);class a{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,i){return this.inCodecpar=(0,c.Gy)(168),(0,h.Yi)(this.inCodecpar,t),this.inTimeBase={den:s.f[15](i+4),num:s.f[15](i)},0}destroy(){this.inCodecpar&&((0,h.dn)(this.inCodecpar),this.inCodecpar=0)}}},4970:(t,i,e)=>{e.d(i,{A:()=>f});var r=e(4467),s=e(9983),c=e(2320),h=e(3458),a=e(3674),o=e(495),n=e(4187),d=e(1755),p=e(7314);class f extends h.A{constructor(){super(...arguments),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0)}init(t,i){return super.init(t,i),this.cache=(0,n._5)(),0}destroy(){super.destroy(),(0,n.Qe)(this.cache),this.cache=0,this.cached=!1}sendAVPacket(t){if(!s.f[20](t+24)||!s.f[15](t+28))return 0;const i=(0,n.rU)(t,1);if(i){const{profile:t,sampleRate:e,channels:r}=p._5((0,a.s3)(s.f[20](i),s.f[25](i+4)));c.M[15](this.inCodecpar+48,t),c.M[15](this.inCodecpar+136,e),c.M[15](this.inCodecpar+116,r)}const e=7+s.f[15](t+28),r=(0,d.sY)(e),h=(0,a.s3)(r,e);return h[0]=255,h[1]=240,h[1]|=8,h[1]|=1,h[2]=(s.f[15](this.inCodecpar+48)-1&3)<<6,h[2]|=(15&p.Hm[s.f[15](this.inCodecpar+136)])<<2,h[2]|=(4&s.f[15](this.inCodecpar+116))>>2,h[3]=(3&s.f[15](this.inCodecpar+116))<<6,h[3]|=h.length>>11&3,h[4]=h.length>>3&255,h[5]=(7&h.length)<<5,h[5]|=31,h[6]=252,h.set((0,a.s3)(s.f[20](t+24),s.f[15](t+28)),7),(0,n.zu)(this.cache,t),(0,n.NX)(this.cache,r,e),this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,n.Up)(t),(0,n.rN)(t,this.cache),this.cached=!1,0):o.LT}reset(){return 0}}},6911:(t,i,e)=>{e.d(i,{A:()=>s});var r=e(4467);class s{constructor(){(0,r.A)(this,"type",-1)}async destroy(t){}}(0,r.A)(s,"Capabilities",[])},9458:(t,i,e)=>{e.r(i),e.d(i,{default:()=>A});var r=e(4467),s=e(7127),c=e(9983),h=e(6911),a=e(4970),o=e(2518),n=e(495),d=e(4187),p=e(665),f=e(9906);const u="packages/avformat/src/formats/OAacFormat.ts",l={frameType:"adts"};class A extends h.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"type",15),(0,r.A)(this,"options",void 0),(0,r.A)(this,"muxStream",void 0),(0,r.A)(this,"filter",void 0),this.options=p.X$({},l,t)}init(t){return t.ioWriter.setEndian(!0),0}writeHeader(t){const i=t.streams.find((t=>1===t.codecpar.codecType&&86018===t.codecpar.codecId));return i?(this.muxStream=i,"adts"===this.options.frameType?(this.filter=new a.A,this.filter.init(i.codecpar[s.o9],i.timeBase[s.o9])):"latm"===this.options.frameType&&(this.filter=new o.A,this.filter.init(i.codecpar[s.o9],i.timeBase[s.o9])),0):(f.z3("can not found stream with aac codec",u,85),n.UY)}writeAVPacket(t,i){const e=t.getStreamByIndex(c.f[15](i+32));if(!e||1024&e.disposition)f.R8(`can not found the stream width the packet's streamIndex: ${c.f[15](i+32)}, ignore it`,u,107);else{if(e===this.muxStream)return this.filter&&(this.filter.sendAVPacket(i),this.filter.receiveAVPacket(i)),t.ioWriter.writeBuffer((0,d.iI)(i)),0;f.R8(`packet's type is not audio: ${c.f[15](i+32)}, ignore it`,u,112)}}writeTrailer(t){return t.ioWriter.flush(),0}flush(t){return t.ioWriter.flush(),0}getCapabilities(){return A.Capabilities}}(0,r.A)(A,"Capabilities",[86018])}}]);