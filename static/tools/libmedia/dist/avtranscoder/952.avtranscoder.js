"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[952],{51597:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(49859);class s{constructor(){(0,r.A)(this,"type",-1)}async destroy(t){}}(0,r.A)(s,"Capabilities",[])},29952:(t,e,i)=>{i.r(e),i.d(e,{default:()=>S});var r=i(49859),s=i(86226),n=i.n(s),h=i(18979),a=i.n(h),o=i(63939),d=(i(9599),i(35336)),c=i(51597),l=i(38743),g=i(4624),u=i(71517),p=i(77231),f=i(54712),m=i(87400),b=i(14686),w=i(82348),v=i(9705),U=i(44328);const P="src/avformat/formats/OOggFormat.ts";class S extends c.A{constructor(){super(),(0,r.A)(this,"type",4),(0,r.A)(this,"checksumTable",void 0),(0,r.A)(this,"headerPagesPayload",void 0),(0,r.A)(this,"cacheWriter",void 0),(0,r.A)(this,"page",void 0),this.checksumTable=[],this.page=new l.B,this.headerPagesPayload=[]}initChecksumTab(){for(let t=0;t<256;t++){let e=t<<24;for(let t=0;t<8;t++)e=2147483648&e?e<<1^79764919:e<<1;this.checksumTable[t]=4294967295&e}}getChecksum(t){let e=0;for(let i=0;i<t.length;i++)e=e<<8^this.checksumTable[e>>>24&255^t[i]];return e>>>0}init(t){if(t.ioWriter.setEndian(!1),this.initChecksumTab(),this.cacheWriter=new d.A(65025,!1),this.headerPagesPayload)for(let e=0;e<this.headerPagesPayload.length;e++)this.headerPagesPayload[e].setCodec(t.getStreamByIndex(this.headerPagesPayload[e].streamIndex).codecpar);var e;return t.streams&&n()(e=t.streams).call(e,(t=>{t.privData={granulePosition:BigInt(0),pageSequenceLast:0}})),0}writePage(t,e,i,r){let s=i.length,n=s,h=0;for(;s>0;){const a=Math.min(65025,s),o=i.subarray(h,h+a),d=h+a===n,c=0===h;this.page.reset(),this.page.serialNumber=t.index,this.page.granulePosition=d?t.privData.granulePosition:p.Dh,this.page.pageSequenceNumber=t.privData.pageSequenceLast,this.page.crcCheckSum=0,this.page.headerTypeFlag=r||0,c||(this.page.headerTypeFlag|=1),this.page.payload=o,this.cacheWriter.reset(),this.page.write(this.cacheWriter);const l=this.getChecksum(this.cacheWriter.getBuffer()),g=this.cacheWriter.getPointer();this.cacheWriter.seekInline(22),this.cacheWriter.writeUint32(l),this.cacheWriter.seekInline(g),e.writeBuffer(this.cacheWriter.getBuffer()),s-=a,h+=a}++t.privData.pageSequenceLast,t.privData.pageSequenceLast>Math.pow(2,32)-1&&(t.privData.pageSequenceLast=0)}writeHeader(t){if(!this.headerPagesPayload.length){const d=t.getStreamByMediaType(1);if(d)if(86076===d.codecpar.codecId){const t=new f.q,e=new f.o;t.streamIndex=d.index;const i=(0,m.MZ)(d.metadata);if(n()(i).call(i,(t=>{e.addComment(t)})),t.setCodec(d.codecpar),d.codecpar.extradata){let e=new w.A(d.codecpar.extradataSize,!1);e.appendBuffer((0,b.s3)(d.codecpar.extradata,d.codecpar.extradataSize)),t.read(e)}e.streamIndex=d.index,this.headerPagesPayload=[t,e]}else if(86021===d.codecpar.codecId){var e,i;if(!d.codecpar.extradataSize)return v.LR;const r=new m.mS,s=new m.GM;r.setCodec(d.codecpar),r.streamIndex=d.index,s.streamIndex=d.index;const h=(0,m.MZ)(d.metadata);n()(h).call(h,(t=>{s.addComment(t)})),this.cacheWriter.reset(),r.write(this.cacheWriter),this.writePage(d,t.ioWriter,a()(e=this.cacheWriter.getBuffer()).call(e),2),this.cacheWriter.reset(),s.write(this.cacheWriter),this.writePage(d,t.ioWriter,a()(i=this.cacheWriter.getBuffer()).call(i),0);const o=(0,b.s3)(d.codecpar.extradata,d.codecpar.extradataSize);let c=new w.A(o.length,!0);if(c.appendBuffer(o),30===c.peekUint16())for(let e=0;e<3;e++){const i=c.readUint16();2===e?this.writePage(d,t.ioWriter,c.readBuffer(i),0):c.skip(i)}else{if(2!==c.peekUint8())return v.LR;{c.skip(1);const e=[];for(let t=0;t<2;t++){let i=0;for(;255===c.peekUint8();)i+=255,c.skip(1);i+=c.readUint8(),e[t]=i}c.skip(e[0]),c.skip(e[1]),this.writePage(d,t.ioWriter,c.readBuffer(c.remainingLength()),0)}}}else if(86028===d.codecpar.codecId){var r,s;if(d.codecpar.extradataSize<34)return v.LR;this.cacheWriter.setEndian(!0),this.cacheWriter.reset(),this.cacheWriter.writeUint8(127),this.cacheWriter.writeString("FLAC"),this.cacheWriter.writeUint8(1),this.cacheWriter.writeUint8(0),this.cacheWriter.writeUint16(1),this.cacheWriter.writeString("fLaC"),this.cacheWriter.writeUint8(0),this.cacheWriter.writeUint24(34),this.cacheWriter.writeBuffer((0,b.s3)(d.codecpar.extradata,34)),this.cacheWriter.setEndian(!1),this.writePage(d,t.ioWriter,a()(r=this.cacheWriter.getBuffer()).call(r),2);const e=new l.h;e.streamIndex=d.index;const i=(0,m.MZ)(d.metadata);n()(i).call(i,(t=>{e.addComment(t)})),this.cacheWriter.setEndian(!0),this.cacheWriter.reset(),this.cacheWriter.writeUint8(132),this.cacheWriter.writeUint24(0),this.cacheWriter.setEndian(!1),e.write(this.cacheWriter),this.cacheWriter.setEndian(!0);const h=this.cacheWriter.getPointer();this.cacheWriter.seekInline(1),this.cacheWriter.writeUint24(h-4),this.cacheWriter.setEndian(!1),this.cacheWriter.seekInline(h),this.writePage(d,t.ioWriter,a()(s=this.cacheWriter.getBuffer()).call(s),0)}else if(86051===d.codecpar.codecId){var h,o;if(!d.codecpar.extradataSize)return v.LR;this.cacheWriter.reset(),this.cacheWriter.writeBuffer((0,b.s3)(d.codecpar.extradata,d.codecpar.extradataSize)),this.writePage(d,t.ioWriter,a()(h=this.cacheWriter.getBuffer()).call(h),2);const e=new l.h;e.streamIndex=d.index;const i=(0,m.MZ)(d.metadata);n()(i).call(i,(t=>{e.addComment(t)})),this.cacheWriter.reset(),e.write(this.cacheWriter),this.writePage(d,t.ioWriter,a()(o=this.cacheWriter.getBuffer()).call(o),0)}}if(this.headerPagesPayload)for(let e=0;e<this.headerPagesPayload.length;e++){const i=t.getStreamByIndex(this.headerPagesPayload[e].streamIndex);var d;i&&(this.cacheWriter.reset(),this.headerPagesPayload[e].write(this.cacheWriter),this.writePage(i,t.ioWriter,a()(d=this.cacheWriter.getBuffer()).call(d),0===e?2:0))}return 0}writeAVPacket(t,e){if(!o.f[15](e+28))return void g.R8(`packet's size is 0: ${o.f[15](e+32)}, ignore it`,P,345);const i=t.getStreamByIndex(o.f[15](e+32));if(i&&!(1024&i.disposition))return 1===i.codecpar.codecType&&(i.privData.granulePosition=(0,U.Mr)(o.f[17](e+8),e+72,{den:i.codecpar.sampleRate,num:1})),this.writePage(i,t.ioWriter,(0,u.iI)(e),0),0===i.codecpar.codecType&&i.privData.granulePosition++,0;g.R8(`can not found the stream width the packet's streamIndex: ${o.f[15](e+32)}, ignore it`,P,352)}writeTrailer(t){return t.ioWriter.flush(),0}flush(t){return t.ioWriter.flush(),0}getCapabilities(){return S.Capabilities}}(0,r.A)(S,"Capabilities",[86021,86076,86028,86051])},38743:(t,e,i)=>{i.d(e,{B:()=>d,h:()=>c});var r=i(49859),s=i(73363),n=i.n(s),h=i(77231),a=i(50011);class o{constructor(){(0,r.A)(this,"list",void 0),this.list=[]}read(t,e){for(let i=0;i<e;i++){const e=t.readUint32();this.list.push(t.readString(e))}}write(t){for(let e=0;e<this.list.length;e++){const i=a.encode(this.list[e]);t.writeUint32(i.length),t.writeBuffer(i)}}addComment(t){this.list.push(t)}}class d{constructor(){(0,r.A)(this,"capturePattern",void 0),(0,r.A)(this,"streamStructureVersion",void 0),(0,r.A)(this,"headerTypeFlag",void 0),(0,r.A)(this,"granulePosition",void 0),(0,r.A)(this,"serialNumber",void 0),(0,r.A)(this,"pageSequenceNumber",void 0),(0,r.A)(this,"crcCheckSum",void 0),(0,r.A)(this,"numberPageSegments",void 0),(0,r.A)(this,"segmentTable",void 0),(0,r.A)(this,"payload",void 0),(0,r.A)(this,"pos",void 0),this.reset()}reset(){this.capturePattern="OggS",this.streamStructureVersion=0,this.headerTypeFlag=0,this.granulePosition=h.Dh,this.serialNumber=0,this.pageSequenceNumber=0,this.crcCheckSum=0,this.numberPageSegments=0,this.segmentTable=[],this.pos=BigInt(0)}async read(t){var e;this.pos=t.getPos(),await this.readPageHeader(t);const i=n()(e=this.segmentTable).call(e,((t,e)=>t+e),0);i&&(this.payload=await t.readBuffer(i))}async readPageHeader(t){if(this.capturePattern=await t.readString(4),this.streamStructureVersion=await t.readUint8(),this.headerTypeFlag=await t.readUint8(),this.granulePosition=await t.readUint64(),this.serialNumber=await t.readUint32(),this.pageSequenceNumber=await t.readUint32(),this.crcCheckSum=await t.readUint32(),this.numberPageSegments=await t.readUint8(),this.numberPageSegments)for(let e=0;e<this.numberPageSegments;e++){const e=await t.readUint8();this.segmentTable.push(e)}}write(t){if(this.pos=t.getPos(),t.writeString(this.capturePattern),t.writeUint8(this.streamStructureVersion),t.writeUint8(this.headerTypeFlag),t.writeUint64(this.granulePosition),t.writeUint32(this.serialNumber),t.writeUint32(this.pageSequenceNumber),t.writeUint32(this.crcCheckSum),this.payload){this.numberPageSegments=Math.floor(this.payload.length/255)+1;const e=this.payload.length%255;t.writeUint8(this.numberPageSegments);for(let e=0;e<this.numberPageSegments-1;e++)t.writeUint8(255);t.writeUint8(e),t.writeBuffer(this.payload)}else t.writeUint8(0)}}class c{constructor(){(0,r.A)(this,"streamIndex",void 0),(0,r.A)(this,"signature",void 0),(0,r.A)(this,"vendorStringLength",void 0),(0,r.A)(this,"vendorString",void 0),(0,r.A)(this,"userCommentListLength",void 0),(0,r.A)(this,"comments",void 0),this.vendorString="libmedia-v0.6.1-355-g72ba4aa7",this.vendorStringLength=this.vendorString.length,this.userCommentListLength=0,this.comments=new o}read(t){this.vendorStringLength=t.readUint32(),this.vendorString=t.readString(this.vendorStringLength),this.userCommentListLength=t.readUint32(),this.userCommentListLength&&this.comments.read(t,this.userCommentListLength)}write(t){const e=a.encode(this.vendorString);t.writeUint32(e.length),t.writeBuffer(e),t.writeUint32(this.comments.list.length),this.comments.write(t)}addComment(t){this.comments.addComment(t)}setCodec(t){}}},54712:(t,e,i)=>{i.d(e,{o:()=>a,q:()=>h});var r=i(49859),s=i(38743);class n{constructor(){(0,r.A)(this,"streamCount",void 0),(0,r.A)(this,"coupledStreamCount",void 0),(0,r.A)(this,"mapping",void 0),this.streamCount=1,this.coupledStreamCount=0,this.mapping=new Uint8Array(1)}read(t){this.streamCount=t.readUint8(),this.coupledStreamCount=t.readUint8(),this.mapping=t.readBuffer(this.streamCount+this.coupledStreamCount)}write(t){t.writeUint8(this.streamCount),t.writeUint8(this.coupledStreamCount),t.writeBuffer(this.mapping)}}class h{constructor(){(0,r.A)(this,"streamIndex",void 0),(0,r.A)(this,"signature",void 0),(0,r.A)(this,"version",void 0),(0,r.A)(this,"channels",void 0),(0,r.A)(this,"preSkip",void 0),(0,r.A)(this,"sampleRate",void 0),(0,r.A)(this,"outputGain",void 0),(0,r.A)(this,"channelMappingFamily",void 0),(0,r.A)(this,"channelMappingTable",void 0),this.signature="OpusHead",this.version=1,this.channels=1,this.preSkip=0,this.sampleRate=48e3,this.outputGain=0,this.channelMappingFamily=0,this.channelMappingTable=new n}read(t){this.signature=t.readString(8),this.version=t.readUint8(),this.channels=t.readUint8(),this.preSkip=t.readUint16(),this.sampleRate=t.readUint32(),this.outputGain=t.readInt16(),this.channelMappingFamily=t.readUint8(),0!==this.channelMappingFamily&&this.channelMappingTable.read(t)}write(t){t.writeString(this.signature),t.writeUint8(this.version),t.writeUint8(this.channels),t.writeUint16(this.preSkip),t.writeUint32(this.sampleRate),t.writeInt16(this.outputGain),t.writeUint8(this.channelMappingFamily),0!==this.channelMappingFamily&&this.channelMappingTable.write(t)}setCodec(t){this.sampleRate=t.sampleRate,this.channels=t.chLayout.nbChannels,this.channelMappingFamily=t.format}}class a extends s.h{constructor(){super(),this.signature="OpusTags"}read(t){this.signature=t.readString(8),super.read(t)}write(t){t.writeString(this.signature),super.write(t)}addComment(t){this.comments.addComment(t)}setCodec(t){}}},87400:(t,e,i)=>{i.d(e,{GM:()=>b,MZ:()=>f,mS:()=>m,ol:()=>p});var r=i(49859),s=i(86226),n=i.n(s),h=i(11265),a=i.n(h),o=i(54810),d=i.n(o),c=i(38743),l=i(95335),g=i(34677);const u={album:"album",artist:"artist",description:"description",encoder:"encoder",title:"title",tracknumber:"track",date:"date",genre:"genre",comment:"comment",albumartist:"albumArtist",composer:"composer",performer:"performer",discnumber:"disc",organization:"vendor",copyright:"copyright",license:"license",isrc:"isrc",lyrics:"lyrics",language:"language",label:"vendor",script:"lyrics",encoded_by:"vendor"};function p(t,e){t&&n()(t).call(t,(t=>{const i=t.split("=");if(2===i.length){var r,s;const t=a()(r=i[0]).call(r).toLowerCase(),n=a()(s=i[1]).call(s);u[t]?e[u[t]]=n:e[t.toLowerCase()]=n}}))}function f(t){const e=[];return l.__(u,((i,r)=>{(0,g.A)(t[i])&&e.push(`${r.toUpperCase()}=${t[i]}`)})),e}class m{constructor(t="vorbis"){(0,r.A)(this,"streamIndex",void 0),(0,r.A)(this,"packetType",void 0),(0,r.A)(this,"signature",void 0),(0,r.A)(this,"version",void 0),(0,r.A)(this,"channels",void 0),(0,r.A)(this,"sampleRate",void 0),(0,r.A)(this,"bitrateMaximum",void 0),(0,r.A)(this,"bitrateNominal",void 0),(0,r.A)(this,"bitrateMinimum",void 0),(0,r.A)(this,"blocksize0",void 0),(0,r.A)(this,"blocksize1",void 0),(0,r.A)(this,"framingFlag",void 0),this.signature=t,this.version=0,this.channels=1,this.sampleRate=48e3,this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=2048,this.blocksize1=256}read(t){this.packetType=t.readUint8(),this.signature=t.readString(6),this.version=t.readUint32(),this.channels=t.readUint8(),this.sampleRate=t.readInt32(),this.bitrateMaximum=t.readInt32(),this.bitrateNominal=t.readInt32(),this.bitrateMinimum=t.readInt32();const e=255&t.readUint8();this.blocksize0=Math.pow(2,e>>>4),this.blocksize1=Math.pow(2,15&e),this.framingFlag=t.readUint8()}write(t){t.writeUint8(1),t.writeString(this.signature),t.writeUint32(this.version),t.writeUint8(this.channels),t.writeInt32(this.sampleRate),t.writeInt32(this.bitrateMaximum),t.writeInt32(this.bitrateNominal),t.writeInt32(this.bitrateMinimum),t.writeUint8(d()(this.blocksize0)<<4|d()(this.blocksize1)),t.writeUint8(1)}setCodec(t){this.sampleRate=t.sampleRate,this.channels=t.chLayout.nbChannels}}class b extends c.h{constructor(t="vorbis"){super(),(0,r.A)(this,"packetType",void 0),(0,r.A)(this,"framingFlag",void 0),this.signature=t,this.packetType=1,this.framingFlag=1}read(t){this.packetType=t.readUint8(),this.signature=t.readString(6),super.read(t),"vorbis"===this.signature&&(this.framingFlag=t.readUint8())}write(t){t.writeUint8(this.packetType),t.writeString(this.signature),super.write(t),"vorbis"===this.signature&&t.writeUint8(this.framingFlag)}addComment(t){this.comments.addComment(t)}setCodec(t){}}},82348:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(49859),s=i(4624),n=i(50011);const h="src/common/io/IOReaderSync.ts";class a{constructor(t=1048576,e=!0,i){if((0,r.A)(this,"data",void 0),(0,r.A)(this,"buffer",void 0),(0,r.A)(this,"pointer",void 0),(0,r.A)(this,"endPointer",void 0),(0,r.A)(this,"pos",void 0),(0,r.A)(this,"size",void 0),(0,r.A)(this,"littleEndian",void 0),(0,r.A)(this,"fileSize_",void 0),(0,r.A)(this,"error",void 0),(0,r.A)(this,"onFlush",void 0),(0,r.A)(this,"onSeek",void 0),(0,r.A)(this,"onSize",void 0),(0,r.A)(this,"flags",void 0),this.pos=BigInt(0),this.pointer=0,this.error=0,this.endPointer=0,this.littleEndian=!e,this.flags=0,i&&i.view)this.size=i.length,this.buffer=i,this.data=i.view;else if(i&&!i.byteOffset)this.size=i.length,this.buffer=i,this.data=new DataView(this.buffer.buffer);else{if(i)throw new Error("not support subarray of ArrayBuffer");this.size=Math.max(t,102400),this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}readUint8(){this.remainingLength()<1&&this.flush(1);const t=this.data.getUint8(this.pointer);return this.pointer++,this.pos++,t}peekUint8(){return this.remainingLength()<1&&this.flush(1),this.data.getUint8(this.pointer)}readUint16(){this.remainingLength()<2&&this.flush(2);const t=this.data.getUint16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),t}peekUint16(){return this.remainingLength()<2&&this.flush(2),this.data.getUint16(this.pointer,this.littleEndian)}readUint24(){this.remainingLength()<3&&this.flush(3);const t=this.readUint16(),e=this.readUint8();return this.littleEndian?e<<16|t:t<<8|e}peekUint24(){this.remainingLength()<3&&this.flush(3);const t=this.pointer,e=this.pos,i=this.readUint16(),r=this.readUint8(),s=this.littleEndian?r<<16|i:i<<8|r;return this.pointer=t,this.pos=e,s}readUint32(){this.remainingLength()<4&&this.flush(4);const t=this.data.getUint32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekUint32(){return this.remainingLength()<4&&this.flush(4),this.data.getUint32(this.pointer,this.littleEndian)}readUint64(){this.remainingLength()<8&&this.flush(8);const t=this.data.getBigUint64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekUint64(){return this.remainingLength()<8&&this.flush(8),this.data.getBigUint64(this.pointer,this.littleEndian)}readInt8(){this.remainingLength()<1&&this.flush(1);const t=this.data.getInt8(this.pointer);return this.pointer++,this.pos++,t}peekInt8(){return this.remainingLength()<1&&this.flush(1),this.data.getInt8(this.pointer)}readInt16(){this.remainingLength()<2&&this.flush(2);const t=this.data.getInt16(this.pointer,this.littleEndian);return this.pointer+=2,this.pos+=BigInt(2),t}peekInt16(){return this.remainingLength()<2&&this.flush(2),this.data.getInt16(this.pointer,this.littleEndian)}readInt24(){const t=this.readUint24();return 8388608&t?t-16777216:t}peekInt24(){const t=this.peekUint24();return 8388608&t?t-16777216:t}readInt32(){this.remainingLength()<4&&this.flush(4);const t=this.data.getInt32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekInt32(){return this.remainingLength()<4&&this.flush(4),this.data.getInt32(this.pointer,this.littleEndian)}readInt64(){this.remainingLength()<8&&this.flush(8);const t=this.data.getBigInt64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekInt64(){return this.remainingLength()<8&&this.flush(8),this.data.getBigInt64(this.pointer,this.littleEndian)}readFloat(){this.remainingLength()<4&&this.flush(4);const t=this.data.getFloat32(this.pointer,this.littleEndian);return this.pointer+=4,this.pos+=BigInt(4),t}peekFloat(){return this.remainingLength()<4&&this.flush(4),this.data.getFloat32(this.pointer,this.littleEndian)}readDouble(){this.remainingLength()<8&&this.flush(8);const t=this.data.getFloat64(this.pointer,this.littleEndian);return this.pointer+=8,this.pos+=BigInt(8),t}peekDouble(){return this.remainingLength()<8&&this.flush(8),this.data.getFloat64(this.pointer,this.littleEndian)}readHex(t=1){let e="";for(let i=0;i<t;i++){const t=this.readUint8().toString(16);e+=1===t.length?"0"+t:t}return e}peekHex(t=1){t>this.size&&(this.error=-1048574,s.h2("peekHex, length too large",h,412)),this.remainingLength()<t&&this.flush(t);const e=this.pointer,i=this.pos;let r="";for(let e=0;e<t;e++){const t=this.readUint8().toString(16);r+=1===t.length?"0"+t:t}return this.pointer=e,this.pos=i,r}readBuffer(t,e){if(!t)return new Uint8Array(0);if(e||(e=new Uint8Array(t)),this.remainingLength()<t){let i=0;if(this.remainingLength()>0){const r=this.remainingLength();e.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),t-=r}for(;t>0;){this.flush();const r=Math.min(this.endPointer-this.pointer,t);e.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),t-=r}}else e.set(this.buffer.subarray(this.pointer,this.pointer+t),0),this.pointer+=t,this.pos+=BigInt(t);return e}peekBuffer(t,e){return t?(t>this.size&&(this.error=-1048574,s.h2("peekBuffer, length too large",h,505)),this.remainingLength()<t&&this.flush(t),e||(e=new Uint8Array(t)),e.set(this.buffer.subarray(this.pointer,this.pointer+t),0),e):new Uint8Array(0)}readToBuffer(t,e){if(this.remainingLength()<t){let i=0;if(this.remainingLength()>0){const r=this.remainingLength();e.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),t-=r}for(;t>0;){try{this.flush()}catch(t){if(-1048576===this.error&&i)return i;throw t}const r=Math.min(this.endPointer-this.pointer,t);e.set(this.buffer.subarray(this.pointer,this.pointer+r),i),i+=r,this.pointer+=r,this.pos+=BigInt(r),t-=r}return i}return e.set(this.buffer.subarray(this.pointer,this.pointer+t),0),this.pointer+=t,this.pos+=BigInt(t),t}readString(t=1){const e=this.readBuffer(t);return n.decode(e)}peekString(t=1){const e=this.peekBuffer(t);return n.decode(e)}readLine(){let t="";for(;;){let e=!1;for(let i=this.pointer;i<this.endPointer;i++)if(10===this.buffer[i]||13===this.buffer[i]){i!==this.pointer&&(t+=this.readString(i-this.pointer)),e=!0;break}if(e)break;t+=this.readString(this.remainingLength()),this.flush()}let e=this.peekUint8();return 10!==e&&13!==e||(this.pointer++,13===e&&(e=this.peekUint8(),10===e&&this.pointer++)),t}peekLine(){this.remainingLength()<this.size&&this.flush();let t="",e=!1;for(let i=this.pointer;i<this.endPointer;i++)if(10===this.buffer[i]||13===this.buffer[i]){t+=this.peekString(i-this.pointer),e=!0;break}return e||(this.error=-1048574,s.h2("peekLine, out of buffer",h,656)),t}getPointer(){return this.pointer}getPos(){return this.pos}skip(t){const e=t;for(;this.remainingLength()<t;)t-=this.remainingLength(),this.pointer=this.endPointer,this.flush();this.remainingLength()>=t&&(this.pointer+=t),this.pos+=BigInt(e)}remainingLength(){return this.endPointer-this.pointer}flush(t=0){if(this.onFlush||(this.error=-1048574,s.h2("IOReader error, flush failed because of no flush callback",h,720)),!(this.size-this.remainingLength()<=0)){if(t=Math.min(t,this.size),this.pointer<this.endPointer?(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer):this.endPointer=0,this.pointer=0,t)for(;this.remainingLength()<t;){const t=this.onFlush(this.buffer.subarray(this.endPointer));if(t<0)throw this.error=t,new Error(`IOReader error, flush ${-1048576===t?"ended":"failed"}, ret: ${t}`);this.endPointer+=t}else{const t=this.onFlush(this.buffer.subarray(this.endPointer));if(t<0)throw this.error=t,new Error(`IOReader error, flush ${-1048576===t?"ended":"failed"}, ret: ${t}`);this.endPointer+=t}this.error=0}}seek(t,e=!1,i=!0){if(!e){const e=Number(t-this.pos);if(e<0&&Math.abs(e)<=this.pointer)return this.pointer+=e,void(this.pos=t);if(e>0&&this.pointer+e<this.endPointer)return this.pointer+=e,void(this.pos=t);if(0===e)return}this.onSeek||(this.error=-1048574,s.h2("IOReader error, seek failed because of no seek callback",h,790)),this.pointer=this.endPointer=0,this.pos=t;const r=this.onSeek(t);0!==r&&(this.error=r,s.h2("IOReader error, seek failed",h,799)),i&&this.flush()}getBuffer(){return this.buffer}appendBuffer(t){if(this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else if(this.buffer.set(this.buffer.subarray(this.pointer,this.endPointer),0),this.endPointer=this.endPointer-this.pointer,this.pointer=0,this.size-this.endPointer>=t.length)this.buffer.set(t,this.endPointer),this.endPointer+=t.length;else{const e=Math.min(this.size-this.endPointer,t.length);this.buffer.set(t.subarray(0,e),this.endPointer),this.endPointer+=e,s.R8("IOReader, call appendBuffer but the buffer's size is lagger then the remaining size",h,838)}}reset(){this.pointer=this.endPointer=0,this.pos=BigInt(0),this.error=0}setEndian(t){this.littleEndian=!t}isBigEndian(){return!this.littleEndian}fileSize(){if(this.fileSize_)return this.fileSize_;if(!this.onSize)return s.R8("IOReader error, fileSize failed because of no onSize callback",h,880),BigInt(0);try{this.fileSize_=this.onSize()}catch(t){s.R8(`IOReader error, call fileSize failed: ${t}`,h,887),this.fileSize_=BigInt(0)}return this.fileSize_}getBufferSize(){return this.size}pipe(t,e){if(e)if(this.remainingLength()<e){if(this.remainingLength()>0){const i=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i),e-=i}for(;e>0;){this.flush();const i=Math.min(this.endPointer-this.pointer,e);t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+i)),this.pointer+=i,this.pos+=BigInt(i),e-=i}}else t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+e)),this.pointer+=e,this.pos+=BigInt(e);else{if(this.remainingLength()>0){const e=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+e)),this.pointer+=e,this.pos+=BigInt(e)}for(;this.onFlush(this.buffer.subarray(0))>0;){const e=this.remainingLength();t.writeBuffer(this.buffer.subarray(this.pointer,this.pointer+e)),this.pointer+=e,this.pos+=BigInt(e)}}}}}}]);