"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[787],{3082:(e,t,i)=>{i.d(t,{O5:()=>u,S5:()=>f,Xo:()=>p,uC:()=>l});var r=i(9983),n=i(2320),a=i(3139),o=i(495),s=i(1237),c=i(3674),d=i(2479);function l(e){if(!(e<=0||e>=7))return{x:128*(1&e),y:128*(e>>>1^(e<4?1:0))}}function h(e,t,i,r,n){if(!n)return o.UY;if(e<0)return o.UY;const a=1===r||2===r?n.log2ChromaW:0,c=e+(1<<a)-1>>>a;if(c&&i>s.go/c)return o.UY;let d=i*c;return 4&n.flags&&(d=d+7>>>3),d}function u(e,t,i){const r=(0,a.I)(t);if(!r)return o.UY;const{maxPixSteps:s,maxPixStepsComps:d}=function(e){const t=[0,0,0,0],i=[0,0,0,0];for(let r=0;r<4;r++)e.comp[r]&&e.comp[r].step>t[e.comp[r].plane]&&(t[e.comp[r].plane]=e.comp[r].step,i[e.comp[r].plane]=r);return{maxPixSteps:t,maxPixStepsComps:i}}(r);(0,c.sO)(e,0,16);let l=0;for(let t=0;t<4;t++){if((l=h(i,0,s[t],d[t],r))<0)return l;n.M[15](e+4*t,l)}}function f(e,t,i,d){const l=[0,0,0,0],h=(0,a.I)(t);if(!h)return o.UY;if((0,c.sO)(e,0,16),r.f[15](d)>s.go/i)return o.UY;if(n.M[25](e,r.f[15](d)*i),2&h.flags)return n.M[25](e+4,1024),0;for(let e=0;e<4;e++)h.comp[e]&&(l[h.comp[e].plane]=1);for(let t=0;t<4&&l[t];t++){let a=1===t||2===t?h.log2ChromaH:0,c=i+(1<<a)-1>>a;if(r.f[15](d+4*t)>s.go/c)return o.UY;n.M[25](e+4*t,c*r.f[15](d+4*t))}return 0}function p(e,t,i,a,l){const h=d.z(16),u=d.z(16);(0,c.sO)(e,0,16);for(let e=0;e<4;e++)n.M[15](h+4*e,r.f[15](l+4*e));let p=f(u,t,i,h);if(p<0)return g(),p;p=0;for(let e=0;e<4;e++){if(r.f[25](u+4*e)>s.go-p)return g(),o.UY;p+=r.f[25](u+4*e)}if(!a)return g(),p;n.M[20](e,a);for(let t=1;t<4&&r.f[25](u+4*t);t++)n.M[20](e+4*t,r.f[20](e+4*(t-1))+r.f[25](u+4*(t-1)));return g(),p;function g(){d.t(16),d.t(16)}}},3458:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(4467),n=i(9983),a=i(1755),o=i(2836);class s{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,a.Gy)(168),(0,o.Yi)(this.inCodecpar,e),this.inTimeBase={den:n.f[15](t+4),num:n.f[15](t)},0}destroy(){this.inCodecpar&&((0,o.dn)(this.inCodecpar),this.inCodecpar=0)}}},3535:(e,t,i)=>{function r(e,t){return e+(t-1)&~(t-1)}i.d(t,{A:()=>r})},4096:(e,t,i)=>{i.d(t,{HL:()=>x,OD:()=>S,S1:()=>U,Ui:()=>C,XC:()=>v,kM:()=>_,mW:()=>w,oT:()=>y,sL:()=>A,wA:()=>P,wf:()=>b});var r=i(9983),n=i(1958),a=i(1755),o=i(2149),s=i(2171),c=i(8636),d=i(3674),l=i(3321),h=i(84),u=i(4916),f=i(5815),p=i(187);const g=3;function m(e){const t=e.readU(9),i=e.readU(3),r=e.readU(2),n=e.readU(2),a=e.readU(3);e.readU(5),e.readU(2);const o=e.readU(6),s=e.readU(7),c=e.readU(1),d=e.readU(8),l=e.readU(1),h=e.readU(1),u=[],f=[];if(o){for(let t=0;t<o-1;t++)u[t]=e.readU(8);u[o-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let r=i-2;r>=0;--r)t|=e.readU(1)<<r;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let r=i-2;r>=0;--r)t&1<<r&&(f[r]=e.readU(8))}const p=e.readU(8),g=[];if(p)for(let t=0;t<p;t++)g.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:a,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:s,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:h,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:g,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function x(e){const t=new f.A(e,!0);if(1&t.readUint8()){const i=new h.A;i.appendBuffer(e.subarray(1)),m(i),t.skip(i.getPointer())}let i=[],r=[],n=[];const a=t.readUint8();for(let e=0;e<a;e++){const e=31&t.readUint8();let a=1;13!==e&&12!==e&&(a=t.readUint16());const o=[];for(let e=0;e<a;e++){const e=t.readUint16();o.push(t.readBuffer(e))}14===e?i=o:15===e?r=o:16===e&&(n=o)}return{vpss:i,spss:r,ppss:n}}function I(e,t,i){const r=t[0];let n;if(r){const e=b(r);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new u.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let a=2+(n?n.length:0);e.length&&(a+=3,a=e.reduce(((e,t)=>e+2+t.length),a)),t.length&&(a+=3,a=t.reduce(((e,t)=>e+2+t.length),a)),i.length&&(a+=3,a=i.reduce(((e,t)=>e+2+t.length),a));const o=new Uint8Array(a),s=new p.A(o,!0);s.writeUint8(g<<1|(n?1:0)|248),n&&s.writeBuffer(n);let c=0;return e.length&&c++,t.length&&c++,i.length&&c++,s.writeUint8(c),e.length&&(s.writeUint8(142),s.writeUint16(e.length),l.__(e,(e=>{s.writeUint16(e.length),s.writeBuffer(e)}))),t.length&&(s.writeUint8(143),s.writeUint16(t.length),l.__(t,(e=>{s.writeUint16(e.length),s.writeBuffer(e)}))),i.length&&(s.writeUint8(144),s.writeUint16(i.length),l.__(i,(e=>{s.writeUint16(e.length),s.writeBuffer(e)}))),o}function U(e){let t=n.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?i.push(t):16===n&&r.push(t)})),i.length&&r.length)return I(e,i,r)}}function A(e){let t=n.py(e);if(t.length>=2){const e=[],i=[],r=[];if(t.forEach((t=>{const n=t[1]>>>3&31;14===n?e.push(t):15===n?i.push(t):16===n&&r.push(t)})),i.length&&r.length){const t=[i[0],r[0]];return e.length&&t.unshift(e[0]),n.nW(t,0)}}}function y(e){let t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1,o=n.py(e);if(o.length){const e=[],n=[],a=[];o.forEach((t=>{const i=t[1]>>>3&31;14===i?e.push(t):15===i?n.push(t):16===i&&a.push(t),8!==i&&7!==i&&9!==i&&10!==i||(r=!0)})),n.length&&a.length?(t=I(e,n,a),o=o.filter((e=>{const t=e[1]>>>3&31;return(i||14!==t&&15!==t&&16!==t)&&20!==t}))):o=o.filter((e=>20!=(e[1]>>>3&31)))}const s=o.reduce(((e,t)=>e+g+1+t.length),0),c=(0,a.sY)(s),l=(0,d.s3)(c,s);return n.S9(o,g,l),{bufferPointer:c,length:s,extradata:t,key:r}}function P(e,t,i,r,o){const s=[n.Le(e,0),n.Le(t,0),n.Le(i,0),n.Le(r,2)];let l=s.reduce(((e,t)=>e+t),0);const h=(0,a.sY)(l+7);let u=h;return c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),1),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),161),c.w8((u+=1,u-1),(o?1:0)<<7|40),e.length&&(n.nW(e,0,(0,d.s3)(u,s[0])),u+=s[0]),t.length&&(n.nW(t,0,(0,d.s3)(u,s[1])),u+=s[1]),i.length&&(n.nW(i,0,(0,d.s3)(u,s[2])),u+=s[2]),r.length&&n.nW(r,2,(0,d.s3)(u,s[3])),{bufferPointer:h,length:l+7}}function _(e,t){let i=n.py(e).concat(n.py(t));if(i.length){let e=[],t=[],r=[],n=[];return i.forEach((i=>{const a=i[1]>>>3&31;14===a?e.push(i):15===a?t.push(i):16===a?r.push(i):20!==a&&n.push(i)})),P(e,t,r,n,!0)}}function S(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;t&&(i=t[0]>>>1&3);let r=[],a=[],o=[],s=!1;if(t){const e=x(t);r=e.vpss,a=e.spss,o=e.ppss,s=!0}const c=n.wN(e,i).filter((e=>20!=(e[1]>>>3&31))),d=[];return c.forEach((e=>{const t=e[1]>>>3&31;15!==t||a.length?16!==t||o.length?20!==t&&d.push(e):o.push(e):a.push(e),8!==t&&7!==t||(s=!0)})),{...P(r,a,o,d,s),key:s}}function v(e,t){let i;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&n.Bs(t))l.__(n.py(t),(e=>{if(15==(e[1]>>>3&31))return i=e,!1}));else if(t&&t.length>=6){const{spss:e}=x(t);e.length&&(i=e[0])}i&&function(e,t){const{profile:i,level:r,width:n,height:a,videoDelay:o,chromaFormatIdc:s,bitDepthMinus8:c}=b(t);switch(e.codecpar.profile=i,e.codecpar.level=r,e.codecpar.width=n,e.codecpar.height=a,e.codecpar.videoDelay=o,c){case 0:e.codecpar.format=3===s?5:2===s?4:0;break;case 2:e.codecpar.format=3===s?68:2===s?64:62}}(e,i)}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](e+36))return n.py((0,d.s3)(r.f[20](e+24),r.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t||9===t}));{const i=r.f[15](e+28);let n=0;for(;n<i-t;){const i=s.r8(r.f[20](e+24)+(n+t+1))>>>3&31;if(8===i||7===i||9===i)return!0;n+=4===t?s.Sg(r.f[20](e+24)+n):3===t?s.ht(r.f[20](e+24)+n):2===t?s.yd(r.f[20](e+24)+n):s.r8(r.f[20](e+24)+n),n+=t}return!1}}function b(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,r=0,a=0,s=0,c=0,d=1,l=0,u=0,f=0;const p=[],g=[],m=[],x=[],I=n.BN(e.subarray(t)),U=new h.A(I.length);U.appendBuffer(I),U.readU1(),U.readU1(),U.readU(6),U.readU(5),U.readU(3),U.readU(8);const A=U.readU(3);d=U.readU(2);const y=U.readU(2);if(U.readU(1)){if(i=U.readU(7),l=U.readU(1),r=U.readU(8),u=U.readU(1),f=U.readU(1),U.readU(1)){for(let e=0;e<8;e++)p[e]=U.readU(8);p[8]=U.readU(7);const e=U.readU(8);U.readU(e)}U.skipPadding();for(let e=A-1;e>=0;e--)g[e]=U.readU(1);U.skipPadding();for(let e=A-1;e>=0;e--)g[e]&&(m[e]=U.readU(8));const e=U.readU(8);if(e)for(let t=0;t<e;t++)x[t]=U.readU(32)}U.readU1(),U.readU1()&&U.readU1();const P=a=o.xb(U),_=s=o.xb(U);if(U.readU1()&&(o.xb(U),o.xb(U),o.xb(U),o.xb(U)),U.readU1()){const e=o.xb(U),t=y+5,i=1<<t,r=P/(1<<t),n=_/(1<<t),a=Math.ceil(Math.log2(r)),s=Math.ceil(Math.log2(n));let c=0,d=0,l=0;e>0&&(l=U.readU1(),d=U.readU1());for(let t=0;e>0&&t<=e;t++)d&&0!=t||(t>0&&P>i&&U.readU(a),t>0&&_>i&&U.readU(s),t<e&&P>i&&U.readU(a),t<e&&_>i&&U.readU(s)),l||U.readU(2);if(c=o.xb(U)+1,U.readU(1)&&U.readU(1))for(let t=0;t<=e;t++)U.readU(c)}c=o.xb(U),U.readU(1),U.readU(1);const S=U.readU(4),v=U.readU(1);let w=0;v&&(w=o.xb(U));const b=[],C=U.readU(2);for(let e=0;e<8*C;e++)b[e]=U.readU(1);return{profile:i,level:r,width:a,height:s,videoDelay:A+1>2?2:A,chromaFormatIdc:d,bitDepthMinus8:c,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:p,generalSubProfileIdc:x,ptlFrameOnlyConstraintFlag:u,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:A,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:m,sps_log2_max_pic_order_cnt_lsb_minus4:S,sps_poc_msb_cycle_flag:v,sps_poc_msb_cycle_len_minus1:w,sps_num_extra_ph_bytes:C,sps_extra_ph_bit_present_flag:b}}function C(e){n.Bs(e)&&(e=U(e));const t=new h.A;return t.appendBuffer(e),1&t.readU(8)?m(t):{}}},4367:(e,t,i)=>{i.d(t,{ST:()=>A,SW:()=>f,Uz:()=>B,Wd:()=>g,bx:()=>P,cK:()=>u,ec:()=>S,h1:()=>h,jp:()=>_,kt:()=>m,mI:()=>y,mM:()=>w,on:()=>I,p:()=>T,qh:()=>d,qz:()=>l,s0:()=>E});var r=i(8590),n=i(3321),a=i(665),o=i(4405),s=i(3737);function c(e){let t=0;do{t++}while(e>>=r.o(e)?BigInt(7):7);return t}function d(e){return r.o(e)?c(e+BigInt(1)):c(e+1)}function l(e,t,i){if(r.o(t)){t|=BigInt(1)<<BigInt(7*i);for(let r=i-1;r>=0;r--)e.writeUint8(Number(t>>BigInt(8*r)&BigInt(255)))}else{t|=1<<7*i;for(let r=i-1;r>=0;r--)e.writeUint8(t>>8*r&255)}}function h(e,t){let i=function(e){return Math.floor((Math.log2(e)+7)/8)}(t);for(;i--;)e.writeUint8(t>>8*i)}function u(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=d(t);0===i&&(i=r),l(e,t,i)}function f(e,t){e.writeUint8(511>>t);for(let i=0;i<t-1;i++)e.writeUint8(255)}function p(e,t,i){h(e,t),u(e,8),e.writeUint64(i)}function g(e,t,i){let n=1,a=i;if(r.o(a))for(;a>>=BigInt(8);)n++;else for(;a>>=8;)n++;h(e,t),u(e,n);for(let t=n-1;t>=0;t--)e.writeUint8(r.o(i)?Number(i>>BigInt(8*t)):i>>8*t)}function m(e,t,i){let r=0;if(i){let e=i<0?(~i).toString(2).length:i.toString(2).length;r=Math.ceil((e+1)/8)}switch(h(e,t),u(e,r),r){case 0:return;case 1:return void e.writeInt8(Number(i));case 2:return void e.writeInt16(Number(i));case 3:return void e.writeInt24(Number(i));case 4:return void e.writeInt32(Number(i))}i=BigInt.asUintN(8*r,BigInt(i));for(let t=r-1;t>=0;t--)e.writeUint8(Number(i>>BigInt(8*t)))}function x(e,t,i){h(e,t),u(e,8),e.writeDouble(i)}function I(e,t,i){h(e,t),u(e,i.length),e.writeBuffer(i)}function U(e,t,i){I(e,t,o.encode(i))}function A(e,t){const i=e.getPos(),r=e.getPointer(),a=i-BigInt(Math.floor(r)),o=[];n.__(t.elePositionInfos,(t=>{t.pos<i&&t.pos>=a?(e.seekInline(r+Number(t.pos-i)),u(e,t.length,t.bytes)):o.push(t)})),n.__(o,(t=>{e.seek(t.pos),u(e,t.length,t.bytes)})),o.length?e.seek(i):e.seekInline(r),e.flush(),t.elePositionInfos=[]}function y(e,t,i,r){t.eleWriter.flush();const n=t.eleCaches;t.eleCaches=[],r(t.eleWriter),t.eleWriter.flush();const a=(0,s.A)(Uint8Array,t.eleCaches);t.eleCaches=n,I(e,i,a)}function P(e,t,i){y(e,t,440786851,(e=>{g(e,17030,i.version),g(e,17143,i.readVersion),g(e,17138,i.maxIdLength),g(e,17139,i.maxSizeLength),U(e,17026,i.docType),g(e,17031,i.docTypeVersion),g(e,17029,i.docTypeReadVersion)}))}function _(e,t,i){y(e,t,290298740,(e=>{i.entry.forEach((i=>{!function(e,t,i){y(e,t,19899,(e=>{g(e,21419,i.id),g(e,21420,i.pos)}))}(e,t,i)}))}))}function S(e,t,i){y(e,t,357149030,(e=>{p(e,29604,i.segmentUUID),g(e,2807729,i.timestampScale),x(e,17545,i.duration),U(e,19840,i.muxingApp),U(e,22337,i.writingApp),I(e,17505,i.dateUTC.data)}))}function v(e,t,i){y(e,t,174,(e=>{g(e,215,i.number),p(e,29637,i.uid),g(e,131,i.type),i.language&&U(e,21358,i.language),i.name&&U(e,21358,i.name),U(e,134,i.codecId),i.codecPrivate&&I(e,25506,i.codecPrivate.data),i.audio?function(e,t,i){y(e,t,225,(e=>{x(e,181,i.sampleRate),i.outSampleRate&&x(e,181,i.outSampleRate),g(e,25188,i.bitDepth),g(e,159,i.channels)}))}(e,t,i.audio):i.video&&function(e,t,i){y(e,t,224,(e=>{g(e,176,i.pixelWidth),g(e,186,i.pixelHeight),i.color&&function(e,t,i){y(e,t,21936,(e=>{a.zy(i,"matrixCoefficients")&&g(e,21937,i.matrixCoefficients),a.zy(i,"primaries")&&g(e,21947,i.primaries),a.zy(i,"transferCharacteristics")&&g(e,21946,i.transferCharacteristics),a.zy(i,"range")&&g(e,21945,i.range),a.zy(i,"chromaSitingVert")&&g(e,21944,i.chromaSitingVert),a.zy(i,"chromaSitingHorz")&&g(e,21943,i.chromaSitingHorz)}))}(e,t,i.color)}))}(e,t,i.video)}))}function w(e,t,i){y(e,t,374648427,(e=>{i.entry.forEach((i=>{v(e,t,i)}))}))}function b(e,t,i){y(e,t,26568,(e=>{i.name&&U(e,17827,i.name),i.string&&U(e,17543,i.string),i.language&&U(e,17530,i.language),a.zy(i,"default")&&g(e,17540,i.default),i.sub&&b(e,t,i.sub)}))}function C(e,t,i){y(e,t,29555,(e=>{i.tag&&i.tag.forEach((i=>{b(e,t,i)})),i.target&&function(e,t,i){y(e,t,25536,(e=>{i.type&&U(e,25546,i.type),a.zy(i,"typeValue")&&g(e,26826,i.typeValue),a.zy(i,"trackUid")&&p(e,25541,i.trackUid),a.zy(i,"chapterUid")&&p(e,25540,i.chapterUid),a.zy(i,"attachUid")&&p(e,25540,i.attachUid)}))}(e,t,i.target)}))}function T(e,t,i){y(e,t,307544935,(e=>{i.entry.forEach((i=>{C(e,t,i)}))}))}function B(e,t,i){y(e,t,475249515,(e=>{i.entry.forEach((i=>{!function(e,t,i){y(e,t,187,(e=>{g(e,179,i.time),i.pos.forEach((i=>{!function(e,t,i){y(e,t,183,(e=>{g(e,247,i.track),g(e,241,i.pos)}))}(e,t,i)}))}))}(e,t,i)}))}))}function E(e,t,i){const r=t.elePositionInfos;t.elePositionInfos=[],h(e,423732329);const n={pos:e.getPos(),length:0,bytes:8};u(e,0,8);const a=e.getPos();i.entry.forEach((i=>{!function(e,t,i){h(e,24999);const r={pos:e.getPos(),length:0,bytes:8};u(e,0,8);const n=e.getPos();p(e,18094,i.uid),i.name&&U(e,18030,i.name),i.mime&&U(e,18016,i.mime),i.description&&U(e,18046,i.description),i.data&&I(e,18012,i.data.data),r.length=e.getPos()-n,t.elePositionInfos.push(r)}(e,t,i)})),n.length=e.getPos()-a,t.elePositionInfos.push(n),A(e,t),t.elePositionInfos=r}},4477:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M});var r=i(4467),n=i(7127),a=i(9983),o=i(6911),s=i(4367),c=i(5640),d=i(8547),l=i(3674),h=i(5316),u=i(495),f=i(4187),p=i(3262),g=i(1237),m=i(2171),x=i(1958),I=i(3082),U=i(1497),A=i(4229),y=i(4096),P=i(8590),_=i(8927),S=i(665),v=i(9906),w=i(4405),b=i(3737),C=i(1762),T=i(4566),B=i(8370);const E="packages/avformat/src/formats/OMatroskaFormat.ts",V={isLive:!1,docType:"matroska"};function W(e){const t=e/BigInt(36e5),i=e%BigInt(36e5),r=i/BigInt(6e4),n=i%BigInt(6e4),a=n/BigInt(1e3),o=n%BigInt(1e3);return _.GP("%02d:%02d:%02d.%03d000000\0\0",Number(BigInt.asIntN(32,t)),Number(BigInt.asIntN(32,r)),Number(BigInt.asIntN(32,a)),Number(BigInt.asIntN(32,o)))}class M extends o.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"type",8),(0,r.A)(this,"options",void 0),(0,r.A)(this,"context",void 0),(0,r.A)(this,"random",void 0),(0,r.A)(this,"randomView",void 0),(0,r.A)(this,"avpacket",void 0),(0,r.A)(this,"annexb2AvccFilter",void 0),this.options=S.X$({},V,e),this.random=new Uint8Array(8),this.randomView=new DataView(this.random.buffer)}init(e){var t;e.ioWriter.setEndian(!1),this.avpacket=(0,f._5)();const i={isLive:this.options.isLive,segmentStart:-BigInt(1),seekHeadEnd:-BigInt(1),header:{version:1,readVersion:1,maxIdLength:4,maxSizeLength:8,docType:this.options.docType,docTypeVersion:4,docTypeReadVersion:2},seekHead:{entry:[]},info:{muxingApp:"libmedia-v0.6.1-408-gdf1fec0d",writingApp:null!==(t=e.metadata.encoder)&&void 0!==t?t:"libmedia-v0.6.1-408-gdf1fec0d",timestampScale:1e6,duration:0,segmentUUID:-BigInt(1)},tracks:{entry:[]},attachments:{entry:[]},chapters:{entry:[]},cues:{entry:[]},tags:{entry:[]},elePositionInfos:[],eleCaches:[],eleWriter:new B.A,currentCluster:{timeCode:-BigInt(1),pos:-BigInt(1)},hasVideo:!1};e.metadata.title&&(i.info.title=e.metadata.title);let r=(0,C.A)();e.metadata.creationTime&&(r=new Date(e.metadata.creationTime).getTime()),this.randomView.setBigUint64(0,BigInt(r-9783072e5)*BigInt(1e6)),i.info.dateUTC={data:this.random.slice(),size:BigInt(8),pos:g.Dh},"webm"===i.header.docType&&(i.header.docTypeVersion=2,i.header.docTypeReadVersion=2),i.eleWriter.onFlush=e=>(i.eleCaches.push(e.slice()),0),(0,h.A)(this.random),i.info.segmentUUID=this.randomView.getBigUint64(0),e.privateData=this.context=i;const a="webm"===this.context.header.docType?c.Nk:c.eP;let o=!1;e.streams.forEach((e=>{if(4===e.codecpar.codecType||1024&e.disposition){var t;(0,h.A)(this.random);const r={uid:this.randomView.getBigUint64(0),name:e.metadata.title,mime:null!==(t=S.BE(c.xz)[e.codecpar.codecId])&&void 0!==t?t:e.metadata.mime,data:{data:e.attachedPic?(0,f.iI)(e.attachedPic):(0,l.s3)(e.codecpar.extradata,e.codecpar.extradataSize),size:BigInt(0|e.codecpar.extradataSize),pos:-BigInt(1)},description:e.metadata.description};i.attachments.entry.push(r);const n={tag:[],target:{attachUid:r.uid}};S.__(e.metadata,((e,t)=>{"title"!==t&&"mime"!==t&&"description"!==t&&"duration"!==t.toLocaleLowerCase()&&P.Yj(e)&&n.tag.push({name:t,string:e})})),n.tag.length&&i.tags.entry.push(n)}else{const t={};if((0,h.A)(this.random),t.uid=this.randomView.getBigUint64(0),t.codecId=function(e){let t="";return S.__(a,((i,r)=>{i===e.codecId&&(t=r)})),65559!==e.codecId&&65557!==e.codecId||(t="A_PCM/FLOAT/IEEE"),65537!==e.codecId&&65549!==e.codecId&&65545!==e.codecId||(t="A_PCM/INT/BIG"),65541!==e.codecId&&65536!==e.codecId&&65548!==e.codecId&&65544!==e.codecId||(t="A_PCM/INT/LIT"),t}(e.codecpar),!t.codecId)return o=!0,void v.z3(`codecId ${e.codecpar.codecId} not support in ${this.options.docType}`,E,303);t.number=e.index+1,e.codecpar.extradata&&(t.codecPrivate={data:(0,l.s3)(e.codecpar.extradata,e.codecpar.extradataSize).slice(),pos:-BigInt(1),size:BigInt(0|e.codecpar.extradataSize)}),e.metadata.language&&(t.language=e.metadata.language),e.metadata.title&&(t.name=e.metadata.title);const r={tag:[],target:{trackUid:t.uid}};switch(S.__(e.metadata,((e,t)=>{"title"!==t&&"language"!==t&&P.Yj(e)&&r.tag.push({name:t,string:e})})),r.tag.length&&i.tags.entry.push(r),e.codecpar.codecType){case 1:t.type=2,t.audio={channels:e.codecpar.chLayout.nbChannels,sampleRate:e.codecpar.sampleRate,bitDepth:e.codecpar.bitsPerRawSample};break;case 0:{i.hasVideo=!0,t.type=1,t.video={pixelWidth:e.codecpar.width,pixelHeight:e.codecpar.height,color:{matrixCoefficients:e.codecpar.colorSpace,primaries:e.codecpar.colorPrimaries,transferCharacteristics:e.codecpar.colorTrc,range:e.codecpar.colorRange}};const r=I.uC(e.codecpar.chromaLocation);r&&(t.video.color.chromaSitingVert=1+(r.x>>>7),t.video.color.chromaSitingHorz=1+(r.y>>>7)),27!==e.codecpar.codecId&&173!==e.codecpar.codecId&&196!==e.codecpar.codecId||(t.codecPrivate&&x.Bs(t.codecPrivate.data)&&(27===e.codecpar.codecId?t.codecPrivate.data=U.S1(t.codecPrivate.data):173===e.codecpar.codecId?t.codecPrivate.data=A.S1(t.codecPrivate.data):196===e.codecpar.codecId&&(t.codecPrivate.data=y.S1(t.codecPrivate.data)),t.codecPrivate.size=BigInt(Math.floor(t.codecPrivate.data.length))),this.annexb2AvccFilter=new d.A,this.annexb2AvccFilter.init(e.codecpar[n.o9],e.timeBase[n.o9]));break}case 3:t.type=17}if(t.lastPts=BigInt(0),e.privData=t,94212===e.codecpar.codecId||94230===e.codecpar.codecId){t.codecPrivate||v.h2("ass need extradata",E,403),t.ass={order:1,popIndex:[]};let e,i=w.decode(t.codecPrivate.data).split(/\r?\n/);for(let t=0;t<i.length;t++)if("[Events]"===i[t].trim()){i[t+1]&&/^Format:/.test(i[t+1])&&(e=i[t+1]),i=i.slice(0,t);break}if(e){e=e.replace(/^Format:/,"");const i=e.split(",").map((e=>e.trim()));i.indexOf("Start")>-1&&t.ass.popIndex.push(i.indexOf("Start")),i.indexOf("End")>-1&&t.ass.popIndex.push(i.indexOf("End")),t.ass.popIndex.sort(((e,t)=>t-e))}}i.tracks.entry.push(t)}})),e.chapters.forEach((e=>{const t={uid:e.id,start:e.start,end:e.end};if(e.metadata){t.display={};const r={tag:[],target:{chapterUid:e.id}};S.__(e.metadata,((i,n)=>{"title"===n?t.display.title=e.metadata.title:"language"===n?t.display.language=e.metadata.language:P.Yj(i)&&r.tag.push({name:n,string:i})})),r.tag.length&&i.tags.entry.push(r),S.HP(t.display).length||delete t.display}i.chapters.entry.push({atom:[t]})}));const s={tag:[]};return S.__(e.metadata,((e,t)=>{P.Yj(e)&&"encoder"!==t.toLocaleLowerCase()&&"creationTime"!==t.toLocaleLowerCase()&&s.tag.push({name:t,string:e})})),s.tag.length&&i.tags.entry.push(s),o?u.r8:0}async destroy(e){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null),this.avpacket&&((0,f.Qe)(this.avpacket),this.avpacket=0)}writeHeader(e){s.bx(e.ioWriter,this.context,this.context.header),s.h1(e.ioWriter,408125543);const t=e.ioWriter.getPos();return s.SW(e.ioWriter,8),this.context.elePositionInfos.push({pos:t,length:0,bytes:8}),this.context.segmentStart=e.ioWriter.getPos(),e.ioWriter.skip(96),this.context.seekHeadEnd=e.ioWriter.getPos(),0}processAss(e,t){var i;const r=t.privData;let n=w.decode(e);/^Dialogue:/.test(n)&&(n=n.replace(/^Dialogue:/,""));const a=n.split(",").map((e=>e.trim()));return null!==(i=r.ass.popIndex)&&void 0!==i&&i.length&&r.ass.popIndex.forEach((e=>{a.splice(e,1)})),a.unshift((0,T.A)(r.ass.order++)),w.encode(a.join(","))}writeBlock(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:163;const r=e.privData;s.h1(this.context.eleWriter,i),(27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId)&&64&a.f[15](t+36)&&(this.annexb2AvccFilter.sendAVPacket(t),this.annexb2AvccFilter.receiveAVPacket(this.avpacket),t=this.avpacket);let n=(0,f.iI)(t);94230!==e.codecpar.codecId&&94212!==e.codecpar.codecId||(n=this.processAss(n,e)),s.cK(this.context.eleWriter,s.qh(r.number)+2+1+n.length),s.qz(this.context.eleWriter,r.number,s.qh(r.number));const o=(0,p.Mr)(a.f[17](t+8),t+72,g.i0);if(this.context.eleWriter.writeInt16(Number(BigInt.asIntN(32,o-this.context.currentCluster.timeCode))),1&a.f[15](t+36)||0!==e.codecpar.codecType?this.context.eleWriter.writeUint8(128):this.context.eleWriter.writeUint8(0),!r.codecPrivate){let e=(0,f.rU)(t,1);e&&(r.codecPrivate={data:(0,l.s3)(a.f[20](e),a.f[25](e+4)).slice(),pos:-BigInt(1),size:BigInt(a.f[25](e+4))})}this.context.eleWriter.writeBuffer(n)}writeBlockGroup(e,t){s.mI(this.context.eleWriter,this.context,160,(i=>{a.f[17](t+48)>0&&s.Wd(i,155,(0,p.Mr)(a.f[17](t+48),t+72,g.i0));const r=[];let n=[];for(let e=0;e<a.f[15](t+44);e++)15===a.f[15](a.f[20](t+40)+12*e+8)?r.push({additionalId:Number(BigInt.asIntN(32,m.v4(a.f[20](a.f[20](t+40)+12*e)))),buffer:(0,l.s3)(a.f[20](a.f[20](t+40)+12*e)+8,a.f[25](a.f[20](t+40)+12*e+4)-8)}):(16===a.f[15](a.f[20](t+40)+12*e+8)||17===a.f[15](a.f[20](t+40)+12*e+8))&&n.push((0,l.s3)(a.f[20](a.f[20](t+40)+12*e),a.f[25](a.f[20](t+40)+12*e+4)),[10]);if(94226===e.codecpar.codecId&&n.length&&r.push({additionalId:1,buffer:(0,b.A)(Uint8Array,n)}),r.length&&s.mI(this.context.eleWriter,this.context,30113,(e=>{s.mI(e,this.context,166,(e=>{r.forEach((t=>{s.Wd(e,238,t.additionalId),s.on(e,30113,t.buffer)}))}))})),0===e.codecpar.codecType&&!(1&a.f[15](t+36))){const r=e.privData;s.kt(i,251,r.lastPts-a.f[17](t+8))}this.writeBlock(e,t,161)}))}writeCluster(e){if(this.context.currentCluster.pos===-BigInt(1))return;e.ioWriter.flush(),this.context.eleWriter.flush();let t=(0,b.A)(Uint8Array,this.context.eleCaches);t.length&&(this.context.eleCaches.length=0,s.Wd(this.context.eleWriter,231,this.context.currentCluster.timeCode),this.context.eleWriter.flush(),t=(0,b.A)(Uint8Array,[...this.context.eleCaches,t]),s.h1(e.ioWriter,524531317),s.cK(e.ioWriter,t.length),e.ioWriter.writeBuffer(t),e.ioWriter.flush(),this.context.eleCaches.length=0)}writeAVPacket(e,t){if(!a.f[15](t+28))return v.R8(`packet's size is 0: ${a.f[15](t+32)}, ignore it`,E,675),0;const i=e.getStreamByIndex(a.f[15](t+32));if(!i||1024&i.disposition)return void v.R8(`can not found the stream width the avpacket's streamIndex: ${a.f[15](t+32)}, ignore it`,E,682);const r=i.privData,n=(0,p.Mr)(a.f[17](t+8)!==g.Dh?a.f[17](t+8):a.f[17](t+16),t+72,g.i0);return(!r.maxPts||r.maxPts<n)&&(r.maxPts=n,r.duration=n,a.f[17](t+48)!==g.Dh&&(r.duration+=(0,p.Mr)(a.f[17](t+48),t+72,g.i0))),(this.options.isLive||1&a.f[15](t+36)&&(0===i.codecpar.codecType||!this.context.hasVideo&&n-this.context.currentCluster.timeCode>BigInt(5e3)))&&(this.writeCluster(e),this.context.currentCluster.timeCode=n,this.context.currentCluster.pos=e.ioWriter.getPos()-this.context.segmentStart,this.context.cues.entry.push({time:this.context.currentCluster.timeCode,pos:[{pos:this.context.currentCluster.pos,track:r.number}]})),a.f[17](t+48)>0||(0,f.fQ)(t,15)||(0,f.fQ)(t,16)||(0,f.fQ)(t,17)?this.writeBlockGroup(i,t):this.writeBlock(i,t),r.lastPts=a.f[17](t+8),0}writeTrailer(e){this.writeCluster(e),e.streams.forEach((e=>{const t=e.privData;if(!this.options.isLive&&null!=t&&t.duration){const e=t.duration;this.context.info.duration=Math.max(Number(BigInt.asIntN(32,e)),this.context.info.duration);let i=this.context.tags.entry.find((e=>{var i;return(null===(i=e.target)||void 0===i?void 0:i.trackUid)===t.uid}));i||(i={tag:[],target:{trackUid:t.uid}},this.context.tags.entry.push(i)),i.tag.push({name:"DURATION",string:W(e)})}})),e.ioWriter.flush(),this.context.eleWriter.flush(),this.context.eleCaches.length=0,this.context.eleWriter.reset();const t=e.ioWriter.getPos();let i=t-this.context.segmentStart;this.context.seekHead.entry.push({id:357149030,pos:this.context.eleWriter.getPos()+this.context.seekHeadEnd-this.context.segmentStart}),s.ec(this.context.eleWriter,this.context,this.context.info),this.context.seekHead.entry.push({id:374648427,pos:this.context.eleWriter.getPos()+this.context.seekHeadEnd-this.context.segmentStart}),s.mM(this.context.eleWriter,this.context,this.context.tracks),this.context.seekHead.entry.push({id:307544935,pos:this.context.eleWriter.getPos()+this.context.seekHeadEnd-this.context.segmentStart}),s.p(this.context.eleWriter,this.context,this.context.tags),this.context.eleWriter.flush();const r=(0,b.A)(Uint8Array,this.context.eleCaches);e.ioWriter.onFlush(r,this.context.seekHeadEnd),i+=BigInt(Math.floor(r.length)),this.context.cues.entry.forEach((e=>{e.pos.forEach((e=>{e.pos+=BigInt(Math.floor(r.length))}))})),this.context.cues.entry.length&&(this.context.seekHead.entry.push({id:475249515,pos:e.ioWriter.getPos()-this.context.segmentStart+BigInt(Math.floor(r.length))}),s.Uz(e.ioWriter,this.context,this.context.cues)),this.context.attachments.entry.length&&(this.context.seekHead.entry.push({id:423732329,pos:e.ioWriter.getPos()-this.context.segmentStart+BigInt(Math.floor(r.length))}),s.s0(e.ioWriter,this.context,this.context.attachments)),e.ioWriter.flush(),i+=e.ioWriter.getPos()-t,e.ioWriter.seek(this.context.segmentStart),s.jp(e.ioWriter,this.context,this.context.seekHead);const n=e.ioWriter.getPos()-this.context.segmentStart;return s.h1(e.ioWriter,236),s.cK(e.ioWriter,this.context.seekHeadEnd-this.context.segmentStart-n-BigInt(2),1),e.ioWriter.flush(),this.context.elePositionInfos[0].length=i,s.ST(e.ioWriter,this.context),this.context.eleCaches.length=0,0}flush(e){return e.ioWriter.flush(),this.context.currentCluster.timeCode=-BigInt(1),this.context.currentCluster.pos=-BigInt(1),0}getCapabilities(){return"webm"===this.options.docType?M.CapabilitiesWebm:M.Capabilities}}(0,r.A)(M,"Capabilities",[86021,86076,86018,86017,86028,86032,86020,86056,86019,65557,65537,65536,139,167,225,27,173,196,12,30,94226,94212,94230,94210,94225]),(0,r.A)(M,"CapabilitiesWebm",[86021,86076,139,167,225,94226])},5316:(e,t,i)=>{let r;function n(e){r.getRandomValues(e)}i.d(t,{A:()=>n}),"undefined"!=typeof crypto&&(r=crypto)},5640:(e,t,i)=>{i.d(t,{Nk:()=>n,eP:()=>r,xz:()=>a});const r={A_AAC:86018,A_AC3:86019,A_ALAC:86032,A_DTS:86020,A_EAC3:86056,A_FLAC:86028,A_MLP:86045,"A_MPEG/L2":86016,"A_MPEG/L1":86058,"A_MPEG/L3":86017,A_OPUS:86076,"A_OPUS/EXPERIMENTAL":86076,"A_PCM/FLOAT/IEEE":65557,"A_PCM/INT/BIG":65537,"A_PCM/INT/LIT":65536,"A_QUICKTIME/QDMC":86066,"A_QUICKTIME/QDM2":86035,"A_REAL/14_4":77824,"A_REAL/28_8":77825,"A_REAL/ATRC":86047,"A_REAL/COOK":86036,"A_REAL/SIPR":86057,A_TRUEHD:86060,A_TTA1:86038,A_VORBIS:86021,A_WAVPACK4:86041,"D_WEBVTT/SUBTITLES":94226,"D_WEBVTT/CAPTIONS":94226,"D_WEBVTT/DESCRIPTIONS":94226,"D_WEBVTT/METADATA":94226,"S_TEXT/UTF8":94225,"S_TEXT/ASCII":94210,"S_TEXT/ASS":94230,"S_TEXT/SSA":94230,"S_TEXT/WEBVTT":94226,S_ASS:94230,S_SSA:94230,S_VOBSUB:94208,S_DVBSUB:94209,"S_HDMV/PGS":94214,"S_HDMV/TEXTST":94231,V_AV1:225,V_DIRAC:116,V_FFV1:33,V_MJPEG:7,V_MPEG1:1,V_MPEG2:2,"V_MPEG4/ISO/ASP":12,"V_MPEG4/ISO/AP":12,"V_MPEG4/ISO/SP":12,"V_MPEG4/ISO/AVC":27,"V_MPEGH/ISO/HEVC":173,"V_MPEGH/ISO/VVC":196,"V_MPEG4/MS/V3":16,V_PRORES:147,"V_REAL/RV10":5,"V_REAL/RV20":6,"V_REAL/RV30":68,"V_REAL/RV40":69,V_SNOW:208,V_THEORA:30,V_UNCOMPRESSED:13,V_VP8:139,V_VP9:167},n={V_VP8:139,V_VP9:167,V_AV1:225,A_VORBIS:86021,A_OPUS:86076,"D_WEBVTT/SUBTITLES":94226,"D_WEBVTT/CAPTIONS":94226,"D_WEBVTT/DESCRIPTIONS":94226,"D_WEBVTT/METADATA":94226},a={"image/gif":97,"image/jpeg":7,"image/png":61,"image/tiff":96}},6911:(e,t,i)=>{i.d(t,{A:()=>n});var r=i(4467);class n{constructor(){(0,r.A)(this,"type",-1)}async destroy(e){}}(0,r.A)(n,"Capabilities",[])},8547:(e,t,i)=>{i.d(t,{A:()=>g});var r=i(4467),n=i(9983),a=i(2320),o=i(3458),s=i(3674),c=i(9906),d=i(495),l=i(4187),h=i(1755),u=i(1497),f=i(4229),p=i(4096);class g extends o.A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"reverseSps",void 0),this.reverseSps=e}init(e,t){return super.init(e,t),this.cache=(0,l._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,l.Qe)(this.cache),this.cache=0}sendAVPacket(e){if(64&n.f[15](e+36)){let t;(0,l.zu)(this.cache,e);const i=(0,s.JW)(n.f[20](e+24),n.f[15](e+28));if(27===n.f[15](this.inCodecpar+4)?t=u.oT(i,this.reverseSps):173===n.f[15](this.inCodecpar+4)?t=f.oT(i,this.reverseSps):196===n.f[15](this.inCodecpar+4)?t=p.oT(i,this.reverseSps):c.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"packages/avformat/src/bsf/h2645/Annexb2AvccFilter.ts",114),a.M[15](this.cache+36,-65&n.f[15](this.cache+36)),(0,l.NX)(this.cache,t.bufferPointer,t.length),t.key&&a.M[15](this.cache+36,1|n.f[15](this.cache+36)),t.extradata){const e=(0,h.sY)(t.extradata.length);(0,s.lW)(e,t.extradata.length,t.extradata),(0,l.Ow)(this.cache,1,e,t.extradata.length)}}else(0,l.rN)(this.cache,e);return this.cached=!0,0}receiveAVPacket(e){return this.cached?((0,l.Up)(e),(0,l.rN)(e,this.cache),this.cached=!1,0):d.LR}reset(){return 0}}}}]);