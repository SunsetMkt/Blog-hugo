"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[611],{85947:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(49859);class n{constructor(){(0,s.A)(this,"type",-1),(0,s.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},85611:(t,e,i)=>{i.r(e),i.d(e,{default:()=>M});var s=i(49859),n=i(11265),a=i.n(n),r=i(86226),l=i.n(r),c=i(64007),o=i.n(c),h=i(96319),u=i.n(h),d=i(52730),g=i.n(d),f=i(71426),B=i.n(f),T=i(50932),p=i(4624),I=i(9705),x=i(85947),m=i(14686),v=i(37837),k=i(71517),q=i(72739),y=i(50011),A=i(54825),R=i(77231),w=i(44328);const b="src/avformat/formats/IWebVttFormat.ts";class M extends x.A{constructor(){super(),(0,s.A)(this,"type",18),(0,s.A)(this,"queue",void 0),(0,s.A)(this,"index",void 0),(0,s.A)(this,"baseTs",void 0)}init(t){this.queue=[],this.baseTs=BigInt(0)}async readChunk(t){let e="";const i=t.ioReader.getPos();for(;;){const i=await t.ioReader.readLine();if(""===i||"WEBVTT"===i)break;e+=i+"\n"}return{chunk:a()(e).call(e),pos:i}}async readCue(t,e){for(;;){var i,s,n;const{chunk:c,pos:h}=await this.readChunk(t);if(""===c||/^NOTE/.test(c)||"WEBVTT"===c)continue;if(/^STYLE/.test(c)){e.push({style:c.replace(/STYLE[\s|\n]?/,""),pos:h});continue}if(/^X-TIMESTAMP-MAP/.test(c)){const t=c.split("=")[1].split(",");let e=BigInt(0),i=BigInt(0);l()(t).call(t,(t=>{const s=t.split(":");var n;"LOCAL"===s[0]?(s.shift(),e=(0,A.j)(a()(n=s.join(":")).call(n))):"MPEGTS"===s[0]&&(i=BigInt(+s[1])*BigInt(1e3)/BigInt(9e4))})),this.baseTs=i-e;continue}const d=c.split("\n");let g,f;var r;-1===o()(i=d[0]).call(i,"--\x3e")&&(g=a()(r=d.shift()).call(r));let B=d.shift().split("--\x3e");const T=(0,A.j)(B.shift())+this.baseTs;B=a()(s=B.shift()).call(s).split(" ");const p=(0,A.j)(B.shift())+this.baseTs;if(p<=T)continue;B=u()(B).call(B,(t=>""!==t)),B.length&&(f=B.join(" "));const I=a()(n=d.join("\n")).call(n);if(I)return{identifier:g,options:f,context:I,startTs:T,endTs:p,pos:h}}}async readHeader(t){const e=await t.ioReader.peekBuffer(3);if(239===e[0]&&187===e[1]&&191===e[2]&&await t.ioReader.skip(3),"WEBVTT"!==await t.ioReader.peekString(6))return p.z3("the file format is not vtt",b,169),I.LR;const i=t.createStream();i.codecpar.codecId=94226,i.codecpar.codecType=3,i.timeBase.den=1e3,i.timeBase.num=1;const s=await t.ioReader.readLine();var n;o()(s).call(s,"-")>0&&(i.metadata.title=a()(n=s.split("-").pop()).call(n)),this.index=0;const r=[];let l=BigInt(0);try{for(;;){const e=await this.readCue(t,r);if(i.nbFrames++,i.duration=e.endTs,e.startTs>=l?(this.queue.push(e),l=e.startTs):q._(this.queue,e,(t=>t.startTs<e.startTs?1:-1)),2&g()(t.ioReader))break}}catch(t){}return i.metadata.styles=r,0}async readAVPacket(t,e){var i;const s=B()(i=t.streams).call(i,(t=>3===t.codecpar.codecType));if(2&g()(t.ioReader)){if(this.index>=this.queue.length)try{const i=await this.readCue(t,s.metadata.styles);if(this.queue.length){const s=this.queue[this.queue.length-1];if(s.startTs===i.startTs&&s.endTs===i.endTs&&s.context===i.context)return this.readAVPacket(t,e)}this.queue.push(i),s.nbFrames++,s.duration=i.endTs}catch(e){return-1048576!==t.ioReader.error&&-1048572!==t.ioReader.error?(p.z3(`read cue error, ${e}`,b,252),I.LR):t.ioReader.error}}else{if(!this.queue.length)return I.LR;if(this.index>=this.queue.length)return-1048576}const n=this.queue[this.index++];if(T.M[15](e+32,s.index),T.M[15](e+76,s.timeBase.den),T.M[15](e+72,s.timeBase.num),T.M[17](e+16,n.startTs),T.M[17](e+8,n.startTs),T.M[17](e+48,n.endTs-n.startTs),n.identifier){const t=y.encode(n.identifier),i=(0,v.sY)(t.length);(0,m.lW)(i,t.length,t),(0,k.Ow)(e,16,i,t.length)}if(n.options){const t=y.encode(n.options),i=(0,v.sY)(t.length);(0,m.lW)(i,t.length,t),(0,k.Ow)(e,17,i,t.length)}const a=y.encode(n.context),r=(0,v.sY)(a.length);return(0,m.lW)(r,a.length,a),(0,k.NX)(e,r,a.length),0}async seek(t,e,i,s){if(2&s)return BigInt(I.E$);if(16&s&&2&g()(t.ioReader)){const s=(0,w.k)(i,e.timeBase,R.i0);return await t.ioReader.seek(s,!0),this.queue.length=0,this.index=0,BigInt(0)}if(i<=BigInt(0))return this.index=0,BigInt(0);const n=q.El(this.queue,(t=>t.startTs>i?-1:1));if(n>=0){for(p.Yz(`seek in cues, found index: ${n}, pts: ${this.queue[n].startTs}, pos: ${this.queue[n].pos}`,b,319),this.index=Math.max(n-1,0);this.index>0&&(this.queue[this.index-1].startTs===this.queue[this.index].startTs||this.queue[this.index-1].endTs>i);)this.index--;return BigInt(0)}return BigInt(I.LR)}getAnalyzeStreamsCount(){return 1}}},54825:(t,e,i)=>{i.d(e,{j:()=>a,t:()=>r});var s=i(11265),n=i.n(s);function a(t){var e,i,s;if(!t)return-BigInt(1);let a=(t=n()(t).call(t)).split(":"),r=BigInt(0);var l;if(3===a.length&&(r+=BigInt(+n()(l=a.shift()).call(l))*BigInt(36e5)),r+=BigInt(+n()(e=a.shift()).call(e))*BigInt(6e4),a=n()(i=a.shift()).call(i).split("."),r+=BigInt(+n()(s=a.shift()).call(s))*BigInt(1e3),a.length){var c,o;let t=n()(c=a[0]).call(c).length,e=BigInt(+n()(o=a.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),r+=e}return r}function r(t){var e,i,s;if(!t)return-BigInt(1);let a=(t=n()(t).call(t)).split(":"),r=BigInt(0);var l;if(3===a.length&&(r+=BigInt(+n()(l=a.shift()).call(l))*BigInt(36e5)),r+=BigInt(+n()(e=a.shift()).call(e))*BigInt(6e4),a=n()(i=a.shift()).call(i).split(","),r+=BigInt(+n()(s=a.shift()).call(s))*BigInt(1e3),a.length){var c,o;let t=n()(c=a[0]).call(c).length,e=BigInt(+n()(o=a.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),r+=e}return r}}}]);