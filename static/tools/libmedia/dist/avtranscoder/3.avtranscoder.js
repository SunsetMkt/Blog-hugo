"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[3],{64436:(e,t,i)=>{i.d(t,{A:()=>o});var a=i(134),r=i(63939),c=(i(77162),i(37837)),s=i(71766);class o{constructor(){(0,a.A)(this,"inCodecpar",void 0),(0,a.A)(this,"inTimeBase",void 0),(0,a.A)(this,"outCodecpar",void 0)}init(e,t){return this.inCodecpar=(0,c.Gy)(168),(0,s.Yi)(this.inCodecpar,e),this.inTimeBase={den:r.f[15](t+4),num:r.f[15](t)},0}destroy(){this.inCodecpar&&((0,s.dn)(this.inCodecpar),this.inCodecpar=0)}}},26173:(e,t,i)=>{i.d(t,{A:()=>g});var a=i(134),r=i(63939),c=i(50932),s=i(64436),o=i(71517),n=i(62815),d=i(67659),h=i(59166),l=i(14686),p=i(9705),f=i(37837),u=i(4624);class g extends s.A{constructor(...e){super(...e),(0,a.A)(this,"cache",void 0),(0,a.A)(this,"cached",void 0)}init(e,t){return super.init(e,t),this.cache=(0,o._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,o.Qe)(this.cache),this.cache=0}sendAVPacket(e){const t=(0,l.JW)(r.f[20](e+24),r.f[15](e+28));if(1===r.f[15](e+80))(0,o.rN)(this.cache,e);else{let i;if((0,o.zu)(this.cache,e),27===r.f[15](this.inCodecpar+4)?i=n.oT(t):173===r.f[15](this.inCodecpar+4)?i=d.oT(t):196===r.f[15](this.inCodecpar+4)?i=h.oT(t):u.h2(`not support for codecId: ${r.f[15](this.inCodecpar+4)}`,"src/avformat/bsf/h2645/Annexb2AvccFilter.ts",91),c.M[15](this.cache+80,1),(0,o.NX)(this.cache,i.bufferPointer,i.length),i.key&&c.M[15](this.cache+36,1|r.f[15](this.cache+36)),i.extradata){const e=(0,f.sY)(i.extradata.length);(0,l.lW)(e,i.extradata.length,i.extradata),(0,o.Ow)(this.cache,1,e,i.extradata.length)}}return this.cached=!0,0}receiveAVPacket(e){return this.cached?((0,o.Up)(e),(0,o.rN)(e,this.cache),this.cached=!1,0):p.LR}reset(){return 0}}},4003:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var a=i(134),r=i(61499),c=i(63939),s=(i(9599),i(51597)),o=i(58121),n=i(68243),d=i(72739),h=i(95335),l=i(35028),p=i(94889),f=i(96157),u=i(95268),g=i(33854),m=i(92647),U=i(14686),w=i(4624),I=i(71517),x=i(44328),y=i(26173),b=i(77231);const M="src/avformat/formats/OFlvFormat.ts";class v extends s.A{constructor(e={}){super(),(0,a.A)(this,"type",0),(0,a.A)(this,"context",void 0),(0,a.A)(this,"header",void 0),(0,a.A)(this,"script",void 0),(0,a.A)(this,"options",void 0),(0,a.A)(this,"annexb2AvccFilter",void 0),(0,a.A)(this,"avpacket",void 0),this.header=new o.A,this.script=new n.A,this.options=e,this.context={keyframeFilePositions:[],keyFrameTimes:[],lastkeyframelocation:0,lastkeyframetimestamp:BigInt(0),lasttimestamp:BigInt(0),framerate:0,filesize:0,audioSize:0,videosize:0,datasize:0,duration:0,scriptWrote:!1,frameCount:0,firstKeyframePositionWrote:!1,videoMetadataWrote:!1}}init(e){e.ioWriter&&e.ioWriter.setEndian(!0);const t=e.getStreamByMediaType(1),i=e.getStreamByMediaType(0);return t&&(this.header.hasAudio=!0,this.script.onMetaData.hasAudio=!0,86051===t.codecpar.codecId&&(16e3!==t.codecpar.sampleRate&&w.h2("flv speex only support 16000 sample rate",M,116),1!==t.codecpar.chLayout.nbChannels&&w.h2("flv speex only support 1 channel",M,119)),h.zy(l.FV,t.codecpar.codecId)&&(this.script.onMetaData.audiocodecid=l.FV[t.codecpar.codecId],this.script.onMetaData.stereo=t.codecpar.chLayout.nbChannels>1,this.script.onMetaData.audiosamplerate=t.codecpar.sampleRate||0,this.script.onMetaData.audiosamplesize=t.codecpar.frameSize||0),t.timeBase.den=1e3,t.timeBase.num=1),i&&(this.header.hasVideo=!0,this.script.onMetaData.hasVideo=!0,h.zy(l.FV,i.codecpar.codecId)&&(this.script.onMetaData.videocodecid=l.FV[i.codecpar.codecId],this.script.onMetaData.width=i.codecpar.width||0,this.script.onMetaData.height=i.codecpar.height||0,this.script.onMetaData.framerate=(0,x.lb)(i.codecpar.framerate)),i.timeBase.den=1e3,i.timeBase.num=1,27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||(this.annexb2AvccFilter=new y.A,this.annexb2AvccFilter.init(i.codecpar[r.o9],i.timeBase[r.o9]))),this.avpacket=(0,I._5)(),0}async destroy(e){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null),this.avpacket&&((0,I.Qe)(this.avpacket),this.avpacket=0)}writeHeader(e){this.header.write(e.ioWriter),e.ioWriter.writeUint32(0),this.options.live&&(this.script.write(e.ioWriter),this.context.scriptWrote=!0);const t=e.getStreamByMediaType(1),i=e.getStreamByMediaType(0);if(t&&t.codecpar.extradata){if(86018===t.codecpar.codecId){const i=f.e(e.ioWriter,t,(0,U.s3)(t.codecpar.extradata,t.codecpar.extradataSize),BigInt(0));this.context.filesize+=i+4,this.context.audioSize+=t.codecpar.extradataSize,this.context.datasize+=t.codecpar.extradataSize}this.script.onMetaData.hasMetadata=!0}if(i&&i.codecpar.extradata){if(27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId||12===i.codecpar.codecId){const t=e.ioWriter.getPos(),a=173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId?g.e(e.ioWriter,i,(0,U.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1,BigInt(0)):u.e(e.ioWriter,i,(0,U.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1,BigInt(0));this.context.filesize+=a+4,this.context.videosize+=i.codecpar.extradataSize,this.context.datasize+=i.codecpar.extradataSize,this.context.keyFrameTimes.push(0),this.context.keyframeFilePositions.push(Number(t)),this.context.videoMetadataWrote=!0}this.script.onMetaData.hasMetadata=!0}return 0}writeAVPacket(e,t){const i=e.getStreamByIndex(c.f[15](t+32));if(i){if(1===i.codecpar.codecType){const a=(0,I.rU)(t,1);if(a){const r=(0,U.s3)(c.f[20](a),c.f[25](a+4));86018===i.codecpar.codecId&&f.e(e.ioWriter,i,r,(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase))}if(c.f[15](t+28)){const a=e.ioWriter.getPos();p.xk(e.ioWriter,8,c.f[15](t+28)+1+l.IO[i.codecpar.codecId],(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase)),p.BV(e.ioWriter,i),86018===i.codecpar.codecId&&f.x(e.ioWriter,1),e.ioWriter.writeBuffer((0,U.s3)(c.f[20](t+24),c.f[15](t+28)));const r=Number(e.ioWriter.getPos()-a);e.ioWriter.writeUint32(r),this.context.audioSize+=r,this.context.filesize+=r+4,this.context.lasttimestamp=(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase),this.context.datasize+=c.f[15](t+28)||0}}else if(0===i.codecpar.codecType){27!==i.codecpar.codecId&&173!==i.codecpar.codecId&&196!==i.codecpar.codecId||1===c.f[15](t+80)||(this.annexb2AvccFilter.sendAVPacket(t),this.annexb2AvccFilter.receiveAVPacket(this.avpacket),t=this.avpacket);const a=e.ioWriter.getPos(),r=(0,I.rU)(t,1);if(r){const a=(0,U.s3)(c.f[20](r),c.f[25](r+4));27===i.codecpar.codecId||12===i.codecpar.codecId?u.e(e.ioWriter,i,a,1,(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase)):173!==i.codecpar.codecId&&196!==i.codecpar.codecId&&167!==i.codecpar.codecId&&225!==i.codecpar.codecId||g.e(e.ioWriter,i,(0,U.s3)(i.codecpar.extradata,i.codecpar.extradataSize),1,(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase))}if(c.f[15](t+28)){const r=e.ioWriter.getPos();if(173===i.codecpar.codecId||196===i.codecpar.codecId||167===i.codecpar.codecId||225===i.codecpar.codecId){const a=c.f[17](t+16)===c.f[17](t+8)||173!==i.codecpar.codecId&&196!==i.codecpar.codecId?3:1;if(p.xk(e.ioWriter,9,c.f[15](t+28)+1+l.IO[i.codecpar.codecId]+(1===a?3:0),(0,x.Mr)(c.f[17](t+16),t+72,i.timeBase)),p.VU(e.ioWriter,i,a,c.f[15](t+36)),g.d(e.ioWriter,i.codecpar.codecId),1===a){let a=0;c.f[17](t+8)!==b.Dh&&(a=Number(BigInt.asIntN(32,(0,x.Mr)(c.f[17](t+8)-c.f[17](t+16),t+72,i.timeBase)))),e.ioWriter.writeUint24(a)}}else if(p.xk(e.ioWriter,9,c.f[15](t+28)+1+l.IO[i.codecpar.codecId],(0,x.Mr)(c.f[17](t+16),t+72,i.timeBase)),27===i.codecpar.codecId||12===i.codecpar.codecId){p.ii(e.ioWriter,i,c.f[15](t+36));let a=0;c.f[17](t+8)!==b.Dh&&(a=Number(BigInt.asIntN(32,(0,x.Mr)(c.f[17](t+8)-c.f[17](t+16),t+72,i.timeBase)))),u.x(e.ioWriter,1,a)}e.ioWriter.writeBuffer((0,U.s3)(c.f[20](t+24),c.f[15](t+28)));const s=Number(e.ioWriter.getPos()-r);e.ioWriter.writeUint32(s),this.context.videosize+=s,this.context.filesize+=s+4,this.context.lasttimestamp=(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase),this.context.datasize+=c.f[15](t+28)||0,this.context.frameCount++,1&c.f[15](t+36)&&(this.context.firstKeyframePositionWrote||!this.context.videoMetadataWrote?(this.context.lastkeyframetimestamp=(0,x.Mr)(c.f[17](t+8),t+72,i.timeBase),this.context.lastkeyframelocation=Number(a),this.context.keyFrameTimes.push(Number((Number(this.context.lastkeyframetimestamp)*(0,x.lb)(i.timeBase)).toFixed(2))),this.context.keyframeFilePositions.push(this.context.lastkeyframelocation)):this.context.firstKeyframePositionWrote=!0)}}return 0}w.R8(`can not found the stream width the packet's streamIndex: ${c.f[15](t+32)}, ignore it`,M,250)}writeTrailer(e){const t=e.getStreamByMediaType(0);if(t&&(27===t.codecpar.codecId||173===t.codecpar.codecId||196===t.codecpar.codecId||167===t.codecpar.codecId||225===t.codecpar.codecId||12===t.codecpar.codecId)){const i=173===t.codecpar.codecId||196===t.codecpar.codecId||167===t.codecpar.codecId||225===t.codecpar.codecId;p.xk(e.ioWriter,9,1+l.IO[t.codecpar.codecId],this.context.lasttimestamp),i?(p.VU(e.ioWriter,t,2,1),g.d(e.ioWriter,t.codecpar.codecId)):(p.ii(e.ioWriter,t,1),u.x(e.ioWriter,2,0)),e.ioWriter.writeUint32(12+l.IO[t.codecpar.codecId]),this.context.videosize+=12+l.IO[t.codecpar.codecId],this.context.filesize+=12+l.IO[t.codecpar.codecId]+4,this.script.onMetaData.canSeekToEnd=!0}if(this.context.scriptWrote)e.ioWriter.flush();else{e.ioWriter.flush(),this.script.onMetaData.filesize=this.context.filesize,this.script.onMetaData.audiosize=this.context.audioSize,this.script.onMetaData.videosize=this.context.videosize,this.script.onMetaData.datasize=this.context.datasize,this.script.onMetaData.lasttimestamp=this.context.lasttimestamp,this.options.hasKeyframes?(this.script.onMetaData.lastkeyframetimestamp=this.context.lastkeyframetimestamp,this.script.onMetaData.lastkeyframelocation=this.context.lastkeyframelocation,this.context.keyFrameTimes.length>1?(this.script.onMetaData.hasKeyframes=!0,this.script.onMetaData.keyframes={filepositions:this.context.keyframeFilePositions,times:this.context.keyFrameTimes}):this.script.onMetaData.hasKeyframes=!1):this.script.onMetaData.hasKeyframes=!1,this.script.onMetaData.duration=Number((Number(this.context.lasttimestamp)/1e3).toFixed(2)),this.script.onMetaData.audiodatarate=Number((this.context.audioSize/this.script.onMetaData.duration/1e3).toFixed(2)),this.script.onMetaData.videodatarate=Number((this.context.videosize/this.script.onMetaData.duration/1e3).toFixed(2)),this.script.onMetaData.framerate=Math.floor(this.context.frameCount/this.script.onMetaData.duration);const t=this.script.computeSize();d.__(this.context.keyframeFilePositions,((e,i)=>{this.context.keyframeFilePositions[i]=e+11+t+4})),this.script.onMetaData.keyframes&&(this.script.onMetaData.keyframes.filepositions=this.context.keyframeFilePositions),this.context.filesize+=11+t+4,this.script.onMetaData.filesize=this.context.filesize;const i=[],a=e.ioWriter.onFlush;e.ioWriter.onFlush=e=>(i.push(e.slice()),0),this.script.write(e.ioWriter),e.ioWriter.flush(),e.ioWriter.onFlush=a;const r=(0,m.A)(Uint8Array,i);a&&a(r,BigInt(13))}return 0}flush(e){return e.ioWriter.flush(),0}}},58121:(e,t,i)=>{i.d(t,{A:()=>r});var a=i(134);class r{constructor(){(0,a.A)(this,"signature",void 0),(0,a.A)(this,"version",void 0),(0,a.A)(this,"flags",void 0),(0,a.A)(this,"dataOffset",void 0),(0,a.A)(this,"hasVideo",void 0),(0,a.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&this.flags),this.hasVideo=!!(1&this.flags)}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(this.flags),e.writeUint32(this.dataOffset)}}},68243:(e,t,i)=>{i.d(t,{A:()=>h});var a=i(134),r=i(35336),c=i(92647),s=i(4624),o=i(94889),n=i(9705),d=i(73040);class h{constructor(){(0,a.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const i=e.getPos(),a=i+BigInt(Math.floor(t)),r=await(0,d.$x)(e,a),c=await(0,d.$x)(e,a);this[r]=c,a>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,a-e.getPos())));const o=Number(e.getPos()-i),h=await e.readUint32();return o+11!==h?(s.R8(`script size not match, size: ${o+11}, previousTagSize: ${h}`,"src/avformat/formats/flv/FlvScriptTag.ts",63),n.LR):0}computeSize(){const e=[],t=new r.A;return t.onFlush=t=>(e.push(t.slice()),0),(0,d.bD)(t,"onMetaData"),(0,d.bD)(t,this.onMetaData),t.flush(),(0,c.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],i=new r.A;i.onFlush=e=>(t.push(e.slice()),0),(0,d.bD)(i,"onMetaData"),(0,d.bD)(i,this.onMetaData),i.flush();const a=(0,c.A)(Uint8Array,t),s=e.getPos();o.xk(e,18,a.length,BigInt(0)),e.writeBuffer(a),e.writeUint32(Number(e.getPos()-s))}}dts2Position(e){if(this.canSeek()){let t=-1;const i=this.onMetaData.keyframes.times,a=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<i.length;r++){if(i[r]===e){t=r;break}if(i[r]>e){t=Math.max(r-1,0);break}}return r&&r===i.length&&(t=i.length-1),{pos:a[t],dts:i[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let i=-1;const a=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let c=0;for(c=0;c<r.length;c++)if(r[c]>e){i=c;break}var t;return c===r.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:a[a.length-1]:a[i]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},96157:(e,t,i)=>{i.d(t,{e:()=>s,x:()=>c});var a=i(94889),r=i(35028);function c(e,t){e.writeUint8(t)}function s(e,t,i,s){const o=e.getPos();a.xk(e,8,i.length+1+r.IO[86018],s),a.BV(e,t),c(e,0),e.writeBuffer(i);const n=Number(e.getPos()-o);return e.writeUint32(n),n}},33854:(e,t,i)=>{i.d(t,{d:()=>d,e:()=>h});var a=i(94889),r=i(35028),c=i(60264),s=i(62815),o=i(67659),n=i(59166);function d(e,t){switch(t){case 173:e.writeString("hvc1");break;case 196:e.writeString("vvc1");break;case 167:e.writeString("vp09");break;case 225:e.writeString("av01")}}function h(e,t,i,h,l){const p=e.getPos();27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||c.Bs(i)&&(27===t.codecpar.codecId?i=s.S1(i):173===t.codecpar.codecId?i=o.S1(i):196===t.codecpar.codecId&&(i=n.S1(i))),a.xk(e,9,i.length+1+r.IO[t.codecpar.codecId],l),(0,a.VU)(e,t,0,h),d(e,t.codecpar.codecId),e.writeBuffer(i);const f=Number(e.getPos()-p);return e.writeUint32(f),f}},95268:(e,t,i)=>{i.d(t,{e:()=>h,x:()=>d});var a=i(94889),r=i(35028),c=i(60264),s=i(62815),o=i(67659),n=i(59166);function d(e,t,i){e.writeUint8(t),e.writeUint24(i)}function h(e,t,i,h,l){const p=e.getPos();27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||c.Bs(i)&&(27===t.codecpar.codecId?i=s.S1(i):173===t.codecpar.codecId?i=o.S1(i):196===t.codecpar.codecId&&(i=n.S1(i))),a.xk(e,9,i.length+1+r.IO[27],l),a.ii(e,t,h),d(e,0,0),e.writeBuffer(i);const f=Number(e.getPos()-p);return e.writeUint32(f),f}},35028:(e,t,i)=>{i.d(t,{FJ:()=>r,FV:()=>a,IO:()=>s,U5:()=>c});const a={86018:10,86017:2,86051:11,69645:1,86049:6,65543:7,65542:8,27:7,173:12,196:13,12:9,4:2,86:3,92:4,106:5,131:6},r={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},c={7:27,12:173,13:196,9:12,2:4,3:86,4:92,5:106,6:131},s={86018:1,86017:0,86051:0,65543:0,65542:0,69645:0,86049:0,27:4,12:4,173:4,196:4,167:4,225:4,4:0,86:0,92:0,106:0,131:0}},94889:(e,t,i)=>{i.d(t,{BV:()=>c,VU:()=>o,ii:()=>s,xk:()=>r});var a=i(35028);function r(e,t,i,a){e.writeUint8(t),e.writeUint24(i),e.writeUint24(Number(a&BigInt(16777215))),e.writeUint8(Number(a>>BigInt(24)&BigInt(255))),e.writeUint24(0)}function c(e,t){let i=2;(86018===t.codecpar.codecId||t.codecpar.chLayout.nbChannels>1)&&(i|=1),86018===t.codecpar.codecId||t.codecpar.sampleRate>=44e3?i|=12:t.codecpar.sampleRate>=22e3?i|=8:t.codecpar.sampleRate>=11e3&&(i|=4),i|=a.FV[t.codecpar.codecId]<<4,e.writeUint8(i)}function s(e,t,i){let r=15&a.FV[t.codecpar.codecId];27!==t.codecpar.codecId&&12!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||(r|=1&i?16:32),e.writeUint8(r)}function o(e,t,i,a){let r=15&i|128;27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId&&167!==t.codecpar.codecId&&225!==t.codecpar.codecId||(r|=1&a?16:32),e.writeUint8(r)}},59166:(e,t,i)=>{i.d(t,{HL:()=>U,KD:()=>D,OD:()=>v,S1:()=>I,Ui:()=>A,XC:()=>k,kM:()=>M,oT:()=>y,sL:()=>x,wA:()=>b,wf:()=>S});var a=i(63939),r=i(72739),c=i(729),s=i(31865),o=i(37246),n=i(14686),d=i(60264),h=i(37837),l=i(23991),p=i(83314),f=i(39381),u=i(82774);const g=3;function m(e){const t=e.readU(9),i=e.readU(3),a=e.readU(2),r=e.readU(2),c=e.readU(3);e.readU(5),e.readU(2);const s=e.readU(6),o=e.readU(7),n=e.readU(1),d=e.readU(8),h=e.readU(1),l=e.readU(1),p=[],f=[];if(s){for(let t=0;t<s-1;t++)p[t]=e.readU(8);p[s-1]=e.readU(6)}else e.readU(6);if(i>1){let t=0;for(let a=i-2;a>=0;--a)t|=e.readU(1)<<a;for(let t=i;t<=8&&i>1;++t)e.readU(1);for(let a=i-2;a>=0;--a)t&1<<a&&(f[a]=e.readU(8))}const u=e.readU(8),g=[];if(u)for(let t=0;t<u;t++)g.push(e.readU(8));return{olsIdx:t,numSublayers:i,bitDepthMinus8:c,chromaFormatIdc:r,constantFrameRate:a,generalProfileIdc:o,generalTierFlag:n,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:h,ptlMultilayerEnabledFlag:l,generalConstraintInfo:p,sublayerLevelIdc:f,generalSubProfileIdc:g,maxPictureWidth:e.readU(16),maxPictureHeight:e.readU(16),avgFramerate:e.readU(16)}}function U(e){const t=new s.A(e,!0);if(1&t.readUint8()){const i=new o.A;i.appendBuffer(e.subarray(1)),m(i),t.skip(i.getPointer())}let i=[],a=[],r=[];const c=t.readUint8();for(let e=0;e<c;e++){const e=31&t.readUint8();let c=1;13!==e&&12!==e&&(c=t.readUint16());const s=[];for(let e=0;e<c;e++){const e=t.readUint16();s.push(t.readBuffer(e))}14===e?i=s:15===e?a=s:16===e&&(r=s)}return{vpss:i,spss:a,ppss:r}}function w(e,t,i){const a=t[0];let s;if(a){const e=S(a);let t=e.generalConstraintInfo;t.length||(t=new Array(12).fill(0));const i=new p.A;if(i.writeU(9,0),i.writeU(3,e.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,e.chromaFormatIdc),i.writeU(3,e.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,t.length),i.writeU(7,e.profile),i.writeU1(e.tierFlag),i.writeU(8,e.level),i.writeU1(e.ptlFrameOnlyConstraintFlag),i.writeU1(e.ptlMultilayerEnabledFlag),t.length){for(let e=0;e<t.length-1;e++)i.writeU(8,t[e]);i.writeU(6,t[t.length-1])}else i.writeU(6,63);if(e.spsMaxSublayersMinus1+1>1){let t=0;for(let i=e.spsMaxSublayersMinus1-1;i>=0;i--)t=t<<1|e.ptlSublayerLevelPresentFlag[i];i.writeU(e.spsMaxSublayersMinus1,t);for(let t=e.spsMaxSublayersMinus1+1;t<=8&&e.spsMaxSublayersMinus1>0;++t)i.writeU1(0);for(let t=e.spsMaxSublayersMinus1-1;t>=0;t--)e.ptlSublayerLevelPresentFlag[t]&&i.writeU(8,e.sublayerLevelIdc[t])}i.writeU(8,e.generalSubProfileIdc.length);for(let t=0;t<e.generalSubProfileIdc.length;t++)i.writeU(8,e.sublayerLevelIdc[t]);i.writeU(16,e.width),i.writeU(16,e.height),i.writeU(16,0),i.padding(),s=i.getBuffer().subarray(0,i.getPointer())}let o=2+(s?s.length:0);e.length&&(o+=3,o=e.reduce(((e,t)=>e+2+t.length),o)),t.length&&(o+=3,o=t.reduce(((e,t)=>e+2+t.length),o)),i.length&&(o+=3,o=i.reduce(((e,t)=>e+2+t.length),o));const n=new Uint8Array(o),d=new c.A(n,!0);d.writeUint8(g<<1|(s?1:0)|248),s&&d.writeBuffer(s);let h=0;return e.length&&h++,t.length&&h++,i.length&&h++,d.writeUint8(h),e.length&&(d.writeUint8(142),d.writeUint16(e.length),r.__(e,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),t.length&&(d.writeUint8(143),d.writeUint16(t.length),r.__(t,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),i.length&&(d.writeUint8(144),d.writeUint16(i.length),r.__(i,(e=>{d.writeUint16(e.length),d.writeBuffer(e)}))),n}function I(e){let t=d.py(e);if(t.length>=2){const e=[],i=[],a=[];if(t.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&a.push(t)})),i.length&&a.length)return w(e,i,a)}}function x(e){let t=d.py(e);if(t.length>=2){const e=[],i=[],a=[];if(t.forEach((t=>{const r=t[1]>>>3&31;14===r?e.push(t):15===r?i.push(t):16===r&&a.push(t)})),i.length&&a.length){const t=[i[0],a[0]];return e.length&&t.unshift(e[0]),d.nW(t,0)}}}function y(e){let t,i=!1,a=d.py(e);if(a.length){const e=[],r=[],c=[];a.forEach((t=>{const a=t[1]>>>3&31;14===a?e.push(t):15===a?r.push(t):16===a&&c.push(t),8!==a&&7!==a&&9!==a&&10!==a||(i=!0)})),r.length&&c.length?(t=w(e,r,c),a=a.filter((e=>{const t=e[1]>>>3&31;return 14!==t&&15!==t&&16!==t&&20!==t}))):a=a.filter((e=>20!=(e[1]>>>3&31)))}const r=a.reduce(((e,t)=>e+g+1+t.length),0),c=(0,h.sY)(r),s=(0,n.s3)(c,r);return d.S9(a,g,s),{bufferPointer:c,length:r,extradata:t,key:i}}function b(e,t,i,a,r){const c=[d.Le(e,0),d.Le(t,0),d.Le(i,0),d.Le(a,2)];let s=c.reduce(((e,t)=>e+t),0);const o=(0,h.sY)(s+7);let l=o;return u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),1),u.w8((l+=1,l-1),0),u.w8((l+=1,l-1),161),u.w8((l+=1,l-1),(r?1:0)<<7|40),e.length&&(d.nW(e,0,(0,n.s3)(l,c[0])),l+=c[0]),t.length&&(d.nW(t,0,(0,n.s3)(l,c[1])),l+=c[1]),i.length&&(d.nW(i,0,(0,n.s3)(l,c[2])),l+=c[2]),a.length&&d.nW(a,2,(0,n.s3)(l,c[3])),{bufferPointer:o,length:s+7}}function M(e,t){let i=d.py(e).concat(d.py(t));if(i.length){let e=[],t=[],a=[],r=[];return i.forEach((i=>{const c=i[1]>>>3&31;14===c?e.push(i):15===c?t.push(i):16===c?a.push(i):20!==c&&r.push(i)})),b(e,t,a,r,!0)}}function v(e,t){const i=t?t[0]>>>1&3:g;let a=[],r=[],c=[],s=!1;if(t){const e=U(t);a=e.vpss,r=e.spss,c=e.ppss,s=!0}return{...b(a,r,c,d.wN(e,i).filter((e=>20!=(e[1]>>>3&31))),s),key:s}}function k(e,t){let i;if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&d.Bs(t))r.__(d.py(t),(e=>{if(15==(e[1]>>>3&31))return i=e,!1}));else if(t&&t.length>=6){e.metadata.naluLengthSizeMinusOne=t[0]>>>1&3;const{spss:a}=U(t);a.length&&(i=a[0])}i&&function(e,t){const{profile:i,level:a,width:r,height:c,videoDelay:s,chromaFormatIdc:o,bitDepthMinus8:n}=S(t);switch(e.codecpar.profile=i,e.codecpar.level=a,e.codecpar.width=r,e.codecpar.height=c,e.codecpar.videoDelay=s,n){case 0:e.codecpar.format=3===o?5:2===o?4:0;break;case 2:e.codecpar.format=3===o?68:2===o?64:62}}(e,i)}function D(e,t=4){if(2===a.f[15](e+80))return d.py((0,n.s3)(a.f[20](e+24),a.f[15](e+28))).some((e=>{const t=e[1]>>>3&31;return 8===t||7===t}));{const i=a.f[15](e+28);let r=0;for(;r<i-t;){const i=f.r8(a.f[20](e+24)+(r+t+1))>>>3&31;if(8===i||7===i)return!0;r+=4===t?f.Sg(a.f[20](e+24)+r):3===t?f.ht(a.f[20](e+24)+r):2===t?f.yd(a.f[20](e+24)+r):f.r8(a.f[20](e+24)+r),r+=t}return!1}}function S(e){if(!e||e.length<3)return;let t=0;0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]&&(t=4);let i=0,a=0,r=0,c=0,s=0,n=1,h=0,p=0,f=0;const u=[],g=[],m=[],U=[],w=d.BN(e.subarray(t)),I=new o.A(w.length);I.appendBuffer(w),I.readU1(),I.readU1(),I.readU(6),I.readU(5),I.readU(3),I.readU(8);const x=I.readU(3);n=I.readU(2);const y=I.readU(2);if(I.readU(1)){if(i=I.readU(7),h=I.readU(1),a=I.readU(8),p=I.readU(1),f=I.readU(1),I.readU(1)){for(let e=0;e<8;e++)u[e]=I.readU(8);u[8]=I.readU(7);const e=I.readU(8);I.readU(e)}I.skipPadding();for(let e=x-1;e>=0;e--)g[e]=I.readU(1);I.skipPadding();for(let e=x-1;e>=0;e--)g[e]&&(m[e]=I.readU(8));const e=I.readU(8);if(e)for(let t=0;t<e;t++)U[t]=I.readU(32)}I.readU1(),I.readU1()&&I.readU1();const b=r=l.xb(I),M=c=l.xb(I);if(I.readU1()&&(l.xb(I),l.xb(I),l.xb(I),l.xb(I)),I.readU1()){const e=l.xb(I),t=y+5,i=1<<t,a=b/(1<<t),r=M/(1<<t),c=Math.ceil(Math.log2(a)),s=Math.ceil(Math.log2(r));let o=0,n=0,d=0;e>0&&(d=I.readU1(),n=I.readU1());for(let t=0;e>0&&t<=e;t++)n&&0!=t||(t>0&&b>i&&I.readU(c),t>0&&M>i&&I.readU(s),t<e&&b>i&&I.readU(c),t<e&&M>i&&I.readU(s)),d||I.readU(2);if(o=l.xb(I)+1,I.readU(1)&&I.readU(1))for(let t=0;t<=e;t++)I.readU(o)}s=l.xb(I),I.readU(1),I.readU(1);const v=I.readU(4),k=I.readU(1);let D=0;k&&(D=l.xb(I));const S=[],A=I.readU(2);for(let e=0;e<8*A;e++)S[e]=I.readU(1);return{profile:i,level:a,width:r,height:c,videoDelay:x+1>2?2:x,chromaFormatIdc:n,bitDepthMinus8:s,generalProfileSpace:0,tierFlag:h,generalConstraintInfo:u,generalSubProfileIdc:U,ptlFrameOnlyConstraintFlag:p,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:x,ptlSublayerLevelPresentFlag:g,sublayerLevelIdc:m,sps_log2_max_pic_order_cnt_lsb_minus4:v,sps_poc_msb_cycle_flag:k,sps_poc_msb_cycle_len_minus1:D,sps_num_extra_ph_bytes:A,sps_extra_ph_bit_present_flag:S}}function A(e){d.Bs(e)&&(e=I(e));const t=new o.A;return t.appendBuffer(e),1&t.readU(8)?m(t):{}}},73040:(e,t,i)=>{i.d(t,{$x:()=>o,bD:()=>n});var a=i(67672),r=i(72739),c=i(95335);async function s(e,t){return{key:await e.readString(await e.readUint16()),value:await o(e,t)}}async function o(e,t){let i;switch(await e.readUint8()){case 0:i=await e.readDouble();break;case 1:i=!!await e.readUint8();break;case 2:i=await e.readString(await e.readUint16());break;case 3:for(i={};e.getPos()<t;){const{key:a,value:r}=await s(e,t);if(i[a]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(i={},await e.skip(4);e.getPos()<t;){const{key:a,value:r}=await s(e,t);if(i[a]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:i=null;break;case 10:i=[];const a=await e.readUint32();for(let r=0;r<a;r++)i.push(await o(e,t));break;case 11:const r=await e.readDouble(),c=await e.readInt16();i=new Date(r+60*c*1e3);break;case 12:i=await e.readString(await e.readUint32())}return i}function n(e,t){a.ai(t)?(e.writeUint8(0),e.writeDouble(t)):a.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):a.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):a.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):a.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),r.__(t,(t=>{n(e,t)}))):a.Ik(t)?(e.writeUint8(3),c.__(t,((t,i)=>{e.writeUint16(i.length),e.writeString(i),n(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}}}]);