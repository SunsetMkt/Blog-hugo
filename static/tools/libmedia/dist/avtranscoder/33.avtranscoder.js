"use strict";(self.webpackChunkAVTranscoder=self.webpackChunkAVTranscoder||[]).push([[33],{491:(t,e,i)=>{i.d(e,{_l:()=>r,gQ:()=>n});const r=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],n=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco","encv","enca","sinf","schi","udta","iprp"]},534:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(5815),n=i(3674);function s(t,e,i){let s;if(i.fragment&&e.sideData[1]?(s=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(s=(0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),!s||s.length<19)t.writeUint32(19),t.writeString("dOps"),t.writeUint8(0),t.writeUint8(e.codecpar.chLayout.nbChannels),t.writeUint16(e.codecpar.initialPadding),t.writeUint32(e.codecpar.sampleRate),t.writeUint16(0),t.writeUint8(0);else{const e=new r.A(s,!1);t.writeUint32(s.length),t.writeString("dOps"),t.writeUint8(0),e.seek(9),t.writeUint8(e.readUint8()),t.writeUint16(e.readUint16()),t.writeUint32(e.readUint32()),t.writeUint16(e.readUint16()),t.writeBuffer(s.subarray(18))}}},713:(t,e,i)=>{i.d(e,{ZK:()=>o,bE:()=>c,p$:()=>s,zz:()=>a});var r=i(5815),n=i(187);function s(t){const e=new r.A(t,!0),i=e.readUint32(),n=e.readUint32(),s=e.readUint32(),a=e.readUint32(),o=e.readUint32(),c=e.readUint32(),d={scheme:i,cryptByteBlock:n,skipByteBlock:s,keyId:e.readBuffer(a),iv:e.readBuffer(o),subsamples:[]};if(c)for(let t=0;t<c;t++)d.subsamples.push({bytesOfClearData:e.readUint32(),bytesOfProtectedData:e.readUint32()});return d}function a(t){const e=new Uint8Array(24+t.keyId.length+t.iv.length+8*t.subsamples.length),i=new n.A(e,!0);return i.writeUint32(t.scheme),i.writeUint32(t.cryptByteBlock),i.writeUint32(t.skipByteBlock),i.writeUint32(t.keyId.length),i.writeUint32(t.iv.length),i.writeUint32(t.subsamples.length),i.writeBuffer(t.keyId),i.writeBuffer(t.iv),t.subsamples.forEach((t=>{i.writeUint32(t.bytesOfClearData),i.writeUint32(t.bytesOfProtectedData)})),e}function o(t){const e=new r.A(t,!0),i=e.readUint32(),n=[];for(let t=0;t<i;t++){const t=e.readUint32(),i=e.readUint32(),r=e.readUint32(),s=e.readUint32(),a={systemId:e.readBuffer(t),keyIds:[],data:null};if(i)for(let t=0;t<i;t++)a.keyIds.push(e.readBuffer(r));a.data=e.readBuffer(s),n.push(a)}return n}function c(t){let e=4;t.forEach((t=>{e+=16+t.systemId.length+t.keyIds.length*(t.keyIds.length?t.keyIds[0].length:0)+t.data.length}));const i=new Uint8Array(e),r=new n.A(i,!0);return r.writeUint32(t.length),t.forEach((t=>{r.writeUint32(t.systemId.length),r.writeUint32(t.keyIds.length),r.writeUint32(t.keyIds.length?t.keyIds[0].length:0),r.writeUint32(t.data.length),r.writeBuffer(t.systemId),t.keyIds.forEach((t=>{r.writeBuffer(t)})),r.writeBuffer(t.data)})),i}},738:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),n=t.getPos();t.writeUint32(0),t.writeString("saiz"),t.writeUint32(0),t.writeUint8(r.cenc.sampleSizes.length?0:r.cenc.defaultSampleInfoSize),t.writeUint32(r.cenc.sampleCount),r.cenc.sampleSizes.length&&r.cenc.sampleSizes.forEach((e=>{t.writeUint8(e)})),i.boxsPositionInfo.push({pos:n,type:"saiz",size:Number(t.getPos()-n)})}i.d(e,{A:()=>r})},812:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(9906),n=i(3674),s=i(3043);const a="packages/avformat/src/formats/isobmff/writing/dfla.ts";function o(t,e,i){let o;i.fragment&&e.sideData[1]?(o=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(o=(0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),o&&o.length===s.ob?(t.writeUint32(o.length+16),t.writeString("dfLa"),t.writeUint8(0),t.writeUint24(0),t.writeUint8(128),t.writeUint24(o.length),t.writeBuffer(o)):r.z3("invalid extradata",a,55)}},892:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(3674),n=i(1497),s=i(1958);function a(t,e,i){let a;i.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&s.Bs(a)&&(a=n.S1(a)),t.writeUint32(8+(a?a.length:0)),t.writeString("avcC"),a&&t.writeBuffer(a)}},982:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("mfhd"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(i.currentFragment.sequence)}i.d(e,{A:()=>r})},1065:(t,e,i)=>{function r(t,e,i){t.writeUint32(20),t.writeString("btrt"),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)}i.d(e,{A:()=>r})},1152:(t,e,i)=>{function r(t,e,i){const r=e.privData.chunkOffsets||[];t.writeUint32(16+4*r.length),t.writeString("stco"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(Number(r[e]))}i.d(e,{A:()=>r})},1209:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(9575);function n(t,e,i){(0,r.A)(t,null,i)}},1230:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),n=i.cencs?i.cencs[r.trackId]:null,s=t.getPos();t.writeUint32(0),t.writeString("senc"),t.writeUint32(r.cenc.useSubsamples?2:0),t.writeUint32(r.cenc.sampleEncryption.length),r.cenc.offset=Number(t.getPos()-i.currentFragment.pos),r.cenc.sampleEncryption.forEach((e=>{n.defaultPerSampleIVSize&&t.writeBuffer(e.iv),r.cenc.useSubsamples&&(t.writeUint16(e.subsamples.length),e.subsamples.forEach((e=>{t.writeUint16(e.bytesOfClearData),t.writeUint32(e.bytesOfProtectedData)})))})),i.boxsPositionInfo.push({pos:s,type:"senc",size:Number(t.getPos()-s)})}i.d(e,{A:()=>r})},1357:(t,e,i)=>{i.d(e,{A:()=>M});var r=i(7175),n=i(5063),s=i(1524),a=i(7675),o=i(2580),c=i(1152),d=i(2729),l=i(5068),p=i(3590),u=i(9600),f=i(9575),h=i(1849),m=i(7416),w=i(1461),g=i(4505),U=i(8832),y=i(5058),I=i(2968),b=i(4198),S=i(982),v=i(5067),x=i(1687),A=i(7632),k=i(1209),D=i(738),P=i(4373),B=i(1230),C=i(9932),z=i(8246);const M={stts:r.A,ctts:n.A,stss:s.A,stsz:a.A,stsc:o.A,stco:c.A,co64:d.A,mdhd:l.A,mvhd:p.A,tkhd:u.A,hdlr:f.A,stsd:h.A,vmhd:m.A,edts:w.A,smhd:g.A,nmhd:U.A,sthd:y.A,dref:I.A,trex:b.A,mfhd:S.A,tfhd:v.A,tfdt:x.A,trun:A.A,minf_hdlr:k.A,saio:P.A,saiz:D.A,senc:B.A,meta:C.A,chpl:z.A}},1461:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(7877),n=i(1237),s=i(3262);function a(t,e,i){const a=e.privData;let o=(0,s.k)((0,r.A)(a),e.timeBase,{den:i.timescale,num:1}),c=a.startCT;const d=(0,s.k)(a.startDts+BigInt(Math.floor(c)),e.timeBase,{den:i.timescale,num:1});let l=o<n.go?0:1;l|=d<n.go?0:1;const p=1+(d>0?1:0),u=24+p*(1===l?20:12);t.writeUint32(u),t.writeString("edts"),t.writeUint32(u-8),t.writeString("elst"),t.writeUint8(l),t.writeUint24(0),t.writeUint32(p),d>0?(1===l?(t.writeUint64(d),t.writeInt64(n.Dh)):(t.writeUint32(Number(d)),t.writeInt32(-1)),t.writeUint32(65536)):(c=-Math.min(Number(a.startDts),0),o+=d),i.fragment&&(o=BigInt(0)),1===l?(t.writeUint64(o),t.writeInt64(BigInt(Math.floor(c)))):(t.writeUint32(Number(o)),t.writeInt32(c)),t.writeUint32(65536)}},1524:(t,e,i)=>{function r(t,e,i){const r=e.privData.stssSampleNumbers;t.writeUint32(16+4*r.length),t.writeString("stss"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(r[e])}i.d(e,{A:()=>r})},1638:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(8590);function n(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,i="";for(let n=0;n<e;n++)r.ai(t)?(i=String.fromCharCode(255&t)+i,t>>>=8):(i=String.fromCharCode(Number(t&BigInt(255)))+i,t>>=BigInt(8));return i}},1687:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),n=r?r.baseMediaDecodeTime:BigInt(0);t.writeUint32(20),t.writeString("tfdt"),t.writeUint8(1),t.writeUint24(0),t.writeUint64(n)}i.d(e,{A:()=>r})},1700:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(1237);function n(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,duration:BigInt(0),trackId:r.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],samplesEncryption:[],fragIndexes:[],lastPts:r.Dh,lastDts:r.Dh,startDts:r.Dh,startCT:r.N_,startPts:r.Dh,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},1849:(t,e,i)=>{i.d(e,{A:()=>D});var r=i(3674),n=i(892),s=i(8441),a=i(7811),o=i(5509),c=i(3282),d=i(812),l=i(534),p=i(2288),u=i(4569),f=i(4881),h=i(1065),m=i(6856),w=i(2772),g=i(6968),U=i(1638),y=i(9515);const I={27:"avc1",173:"hvc1",196:"vvc1",225:"av01",167:"vp09",86019:"ac-3",86056:"ec-3",94226:"wvtt",94232:"stpp",94213:"tx3g"};function b(t){if(t.codecTag)return(0,U.A)(t.codecTag);let e=I[t.codecId];return e||(e=0===t.codecType?"mp4v":1===t.codecType?86076===t.codecId?"Opus":86028===t.codecId?"fLaC":"mp4a":3===t.codecType?"text":"none"),e}function S(t,e,i){const r=e.privData,n=i.cencs[r.trackId],s=t.getPos();t.writeUint32(0),t.writeString("sinf"),t.writeUint32(12),t.writeString("frma"),t.writeString(b(e.codecpar)),t.writeUint32(20),t.writeString("schm"),t.writeUint32(0),t.writeUint32(n.schemeType||(0,y.A)("cenc")),t.writeUint32(n.schemeVersion||65536),t.writeUint32(16+n.defaultKeyId.length+8+(n.defaultConstantIV?1+n.defaultConstantIV.length:0)),t.writeString("schi"),t.writeUint32(16+n.defaultKeyId.length+(n.defaultConstantIV?1+n.defaultConstantIV.length:0)),t.writeString("tenc"),n.cryptByteBlock||n.skipByteBlock||n.pattern?t.writeUint8(1):t.writeUint8(0),t.writeUint24(0),t.writeUint8(0),t.writeUint8((15&(n.cryptByteBlock||0))<<4|15&(n.skipByteBlock||0)),t.writeUint8(1),t.writeUint8(n.defaultPerSampleIVSize),t.writeBuffer(n.defaultKeyId),n.defaultConstantIV&&(t.writeUint8(n.defaultConstantIV.length),t.writeBuffer(n.defaultConstantIV)),i.boxsPositionInfo.push({pos:s,type:"sinf",size:Number(t.getPos()-s)})}function v(t,e,i){const r=i.isom?1:0;t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(r),t.writeUint16(0),t.writeUint32(0),i.isom?(t.writeUint16(e.codecpar.chLayout.nbChannels),65541===e.codecpar.codecId||65540===e.codecpar.codecId?t.writeUint16(8):69643===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(16),t.writeUint16(-2)):(t.writeUint16(e.codecpar.chLayout.nbChannels),86028===e.codecpar.codecId||86032===e.codecpar.codecId?t.writeUint16(e.codecpar.bitsPerRawSample):t.writeUint16(16),t.writeUint16(0)),t.writeUint16(0),86076===e.codecpar.codecId?t.writeUint16(48e3):86060===e.codecpar.codecId?t.writeUint32(e.codecpar.sampleRate):t.writeUint16(e.codecpar.sampleRate),86060!==e.codecpar.codecId&&t.writeUint16(0),1===r&&(t.writeUint32(e.codecpar.frameSize),t.writeUint32(0),t.writeUint32(0),t.writeUint32(2))}function x(t,e,i){const r=b(e.codecpar);!i.isom||86018!==e.codecpar.codecId&&86019!==e.codecpar.codecId&&86056!==e.codecpar.codecId&&73728!==e.codecpar.codecId&&86032!==e.codecpar.codecId&&69638!==e.codecpar.codecId&&69633!==e.codecpar.codecId&&86035!==e.codecpar.codecId?86028===e.codecpar.codecId?(0,d.A)(t,e,i):86076===e.codecpar.codecId?(0,l.A)(t,e,i):86019===e.codecpar.codecId?(0,w.A)(t,e,i):86056===e.codecpar.codecId?(0,g.A)(t,e,i):"mp4a"==r&&(0,p.A)(t,e,i):(0,m.A)(t,e,i)}function A(t,e,i){const r=13==e.codecpar.codecId&&15==e.codecpar.format||13==e.codecpar.codecId&&1==e.codecpar.format||202==e.codecpar.codecId||203==e.codecpar.codecId||156==e.codecpar.codecId||127==e.codecpar.codecId;t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),t.writeUint16(r?2:0),t.writeUint16(0),i.isom?(t.writeString("FFMP"),13===e.codecpar.codecId||r?(t.writeUint32(0),t.writeUint32(1024)):(t.writeUint32(512),t.writeUint32(512))):(t.writeUint32(0),t.writeUint32(0),t.writeUint32(0)),t.writeUint16(e.codecpar.width),t.writeUint16(e.codecpar.height),t.writeUint32(4718592),t.writeUint32(4718592),t.writeUint32(0),t.writeUint16(1);let n=e.metadata.compressorName||"";if(n=n.slice(0,31),t.writeUint8(n.length),t.writeString(n),n.length<31){let e=31-n.length;for(;e>0;)t.writeUint8(0),e--}i.isom&&e.codecpar.bitsPerCodedSample?t.writeUint16(e.codecpar.bitsPerCodedSample):t.writeUint16(24),t.writeUint16(65535)}function k(t,e,i){"mp4v"===b(e.codecpar)?(0,p.A)(t,e,i):27===e.codecpar.codecId?(0,n.A)(t,e,i):173===e.codecpar.codecId?(0,s.A)(t,e,i):196===e.codecpar.codecId?(0,a.A)(t,e,i):167===e.codecpar.codecId?(0,o.A)(t,e,i):225===e.codecpar.codecId&&(0,c.A)(t,e,i)}function D(t,e,i){const n=t.getPos();t.writeUint32(0),t.writeString("stsd");const s=e.privData,a=i.cencs&&i.cencs[s.trackId]&&(1===e.codecpar.codecType||0===e.codecpar.codecType)&&!i.ignoreEncryption;t.writeUint8(0),t.writeUint24(0),t.writeUint32(a?2:1),1===e.codecpar.codecType?(a&&function(t,e,i){const r=t.getPos();t.writeUint32(0),t.writeString("enca"),v(t,e,i),S(t,e,i),x(t,e,i),i.boxsPositionInfo.push({pos:r,type:"enca",size:Number(t.getPos()-r)})}(t,e,i),function(t,e,i){const r=t.getPos(),n=b(e.codecpar);t.writeUint32(0),t.writeString(n),v(t,e,i),x(t,e,i),i.isom||(0,h.A)(t,e,i),i.boxsPositionInfo.push({pos:r,type:n,size:Number(t.getPos()-r)})}(t,e,i)):0===e.codecpar.codecType?(a&&function(t,e,i){const r=t.getPos();t.writeUint32(0),t.writeString("encv"),A(t,e,i),S(t,e,i),k(t,e,i),i.boxsPositionInfo.push({pos:r,type:"encv",size:Number(t.getPos()-r)})}(t,e,i),function(t,e,i){const r=t.getPos(),n=b(e.codecpar);t.writeUint32(0),t.writeString(n),A(t,e,i),k(t,e,i),(0,u.A)(t,e,i),(0,f.A)(t,e,i),i.isom||(0,h.A)(t,e,i),i.boxsPositionInfo.push({pos:r,type:n,size:Number(t.getPos()-r)})}(t,e,i)):3===e.codecpar.codecType&&function(t,e,i){const n=t.getPos(),s=b(e.codecpar);t.writeUint32(0),t.writeString(s),t.writeUint32(0),t.writeUint16(0),t.writeUint16(1),94208===e.codecpar.codecId?(0,p.A)(t,e,i):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),i.isom||(0,h.A)(t,e,i),i.boxsPositionInfo.push({pos:n,type:s,size:Number(t.getPos()-n)})}(t,e,i),i.boxsPositionInfo.push({pos:n,type:"esds",size:Number(t.getPos()-n)})}},2288:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(7962),n=i(3674);function s(t,e,i){t.writeUint8(e);for(let e=3;e>0;e--)t.writeUint8(i>>7*e|128);t.writeUint8(127&i)}function a(t,e,i){const a=e.privData,o=e.codecpar.extradata?5+e.codecpar.extradataSize:0,c=t.getPos();t.writeUint32(0),t.writeString("esds"),t.writeUint32(0),s(t,3,21+o+5+1),t.writeUint16(a.trackId),t.writeUint8(0),s(t,4,13+o),(86016===e.codecpar.codecId||86017===e.codecpar.codecId)&&e.codecpar.sampleRate>24e3?t.writeUint8(107):t.writeUint8(r.zs[e.codecpar.codecId]),94208===e.codecpar.codecId?t.writeUint8(225):1===e.codecpar.codecType?t.writeUint8(21):t.writeUint8(17),t.writeUint24(0),t.writeUint32(0),t.writeUint32(0),e.codecpar.extradata&&(s(t,5,e.codecpar.extradataSize),t.writeBuffer((0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize))),s(t,6,1),t.writeUint8(2),i.boxsPositionInfo.push({pos:c,type:"esds",size:Number(t.getPos()-c)})}},2580:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(9906);const n="packages/avformat/src/formats/isobmff/writing/stsc.ts";function s(t,e,i){const s=e.privData,a=s.stscFirstChunk,o=s.stscSamplesPerChunk,c=s.stscSampleDescriptionIndex;a.length===o.length&&a.length===c.length||r.R8("ctts firstChunk's length is not match samplesPerChunk's length or sampleDescriptionIndex's length",n,42);const d=Math.min(a.length,o.length,c.length);t.writeUint32(16+12*d),t.writeString("stsc"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(d);for(let e=0;e<d;e++)t.writeUint32(a[e]),t.writeUint32(o[e]),t.writeUint32(c[e])}},2729:(t,e,i)=>{function r(t,e,i){const r=e.privData.chunkOffsets||[];t.writeUint32(16+8*r.length),t.writeString("co64"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint64(r[e])}i.d(e,{A:()=>r})},2772:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(4916);function n(t,e,i){t.writeUint32(11),t.writeString("dac3");const n=new r.A(3),s=i.ac3Info;n.writeU(2,s.substream[0].fscod),n.writeU(5,s.substream[0].bsid),n.writeU(3,s.substream[0].bsmod),n.writeU(3,s.substream[0].acmod),n.writeU(1,s.substream[0].lfeon),n.writeU(5,s.ac3BitrateCode),n.writeU(5,0),t.writeBuffer(n.getBuffer())}},2968:(t,e,i)=>{function r(t,e,i){t.writeUint32(28),t.writeString("dref"),t.writeUint32(0),t.writeUint32(1),t.writeUint32(12),t.writeString("url "),t.writeUint32(1)}i.d(e,{A:()=>r})},3043:(t,e,i)=>{i.d(e,{DK:()=>o,XC:()=>d,Xr:()=>c,jA:()=>s,ob:()=>n,oe:()=>a});var r=i(5815);const n=34,s=8,a=[0,8,12,0,16,20,24,32],o=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],c=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function d(t,e){if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&e.length===n){const{bitsPerRawSample:i,sampleRate:n,channels:s}=function(t){const e=new r.A(t);e.skip(10);const i=e.readUint24();return{sampleRate:i>>4,channels:1+((15&i)>>>1),bitsPerRawSample:1+((1&i)<<4|(240&e.readUint8())>>>4)}}(e);t.codecpar.bitsPerRawSample=i,t.codecpar.sampleRate=n,t.codecpar.chLayout.nbChannels=s}}},3180:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(1237);function n(){return{isom:!1,timescale:r.N_,duration:r.Dh,foundMoov:!1,foundMdat:!1,foundHEIF:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:r.N_,volume:r.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},3282:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(3674);function n(t,e,i){var n;t.writeUint32(8+(null!==(n=e.codecpar.extradataSize)&&void 0!==n?n:0)),t.writeString("av1C"),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},3299:(t,e,i)=>{function r(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t)return!1;if(t.length<2)return!0;let i=t[e],r=e+1;for(;r<t.length&&i===t[r];r++);return r===t.length}i.d(e,{A:()=>r})},3458:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(4467),n=i(9983),s=i(1755),a=i(2836);class o{constructor(){(0,r.A)(this,"inCodecpar",void 0),(0,r.A)(this,"inTimeBase",void 0),(0,r.A)(this,"outCodecpar",void 0)}init(t,e){return this.inCodecpar=(0,s.Gy)(168),(0,a.Yi)(this.inCodecpar,t),this.inTimeBase={den:n.f[15](e+4),num:n.f[15](e)},0}destroy(){this.inCodecpar&&((0,a.dn)(this.inCodecpar),this.inCodecpar=0)}}},3462:(t,e,i)=>{i.d(e,{BB:()=>n,Ip:()=>s,Jl:()=>r});const r={1:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},0:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]},3:function(t,e){return[{type:"tkhd"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:94232===e.codecpar.codecId?"sthd":"nmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:"stco"}]}]}]}]}},n={1:function(t,e){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"smhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]},0:function(t,e){let i=!0;if(27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId){const t=e.privData;2&e.codecpar.flags&&(!t.cttsSampleCounts||!t.cttsSampleCounts.length||1===t.cttsSampleCounts.length&&0===t.cttsSampleOffsets[0])&&(i=!1)}return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:"vmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stss"},i?{type:"ctts"}:null,{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]},3:function(t,e){return[{type:"tkhd"},{type:"edts"},{type:"mdia",children:[{type:"mdhd"},{type:"hdlr"},{type:"minf",children:[{type:94232===e.codecpar.codecId?"sthd":"nmhd"},t.isom?{type:"minf_hdlr"}:null,{type:"dinf",children:[{type:"dref",children:[{type:"url "}]}]},{type:"stbl",children:[{type:"stsd"},{type:"stts"},{type:"stsc"},{type:"stsz"},{type:t.use64Mdat?"co64":"stco"}]}]}]}]}},s=function(t){return[{type:"tfhd"},{type:"tfdt"},{type:"trun"},t.cenc&&(t.cenc.defaultSampleInfoSize||t.cenc.sampleSizes.length)?{type:"saiz"}:null,t.cenc&&(t.cenc.defaultSampleInfoSize||t.cenc.sampleSizes.length)?{type:"saio"}:null,t.cenc?{type:"senc"}:null]}},3590:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(5756),n=i(1237);function s(t,e,i){const s=i.duration,a=i.creationTime||0,o=i.modificationTime||0,c=i.timescale||0;let d=i.nextTrackId||1;i.fragment&&(d=2);let l=s<BigInt(n.f7)?0:1;l=a<n.f7?0:1,l=o<n.f7?0:1,t.writeUint32(1===l?120:108),t.writeString("mvhd"),t.writeUint8(l),t.writeUint24(0),1===l?(t.writeUint64(a),t.writeUint64(o)):(t.writeUint32(Number(a)),t.writeUint32(Number(o))),t.writeUint32(c),1===l?t.writeUint64(s):t.writeUint32(Number(s)),t.writeUint32(65536),t.writeUint16(256),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),(0,r.A)(t,1,0,0,1,0,0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(d)}},4096:(t,e,i)=>{i.d(e,{HL:()=>g,OD:()=>x,S1:()=>y,Ui:()=>P,XC:()=>A,kM:()=>v,mW:()=>k,oT:()=>b,sL:()=>I,wA:()=>S,wf:()=>D});var r=i(9983),n=i(1958),s=i(1755),a=i(2149),o=i(2171),c=i(8636),d=i(3674),l=i(3321),p=i(84),u=i(4916),f=i(5815),h=i(187);const m=3;function w(t){const e=t.readU(9),i=t.readU(3),r=t.readU(2),n=t.readU(2),s=t.readU(3);t.readU(5),t.readU(2);const a=t.readU(6),o=t.readU(7),c=t.readU(1),d=t.readU(8),l=t.readU(1),p=t.readU(1),u=[],f=[];if(a){for(let e=0;e<a-1;e++)u[e]=t.readU(8);u[a-1]=t.readU(6)}else t.readU(6);if(i>1){let e=0;for(let r=i-2;r>=0;--r)e|=t.readU(1)<<r;for(let e=i;e<=8&&i>1;++e)t.readU(1);for(let r=i-2;r>=0;--r)e&1<<r&&(f[r]=t.readU(8))}const h=t.readU(8),m=[];if(h)for(let e=0;e<h;e++)m.push(t.readU(8));return{olsIdx:e,numSublayers:i,bitDepthMinus8:s,chromaFormatIdc:n,constantFrameRate:r,generalProfileIdc:o,generalTierFlag:c,generalLevelIdc:d,ptlFrameOnlyConstraintFlag:l,ptlMultilayerEnabledFlag:p,generalConstraintInfo:u,sublayerLevelIdc:f,generalSubProfileIdc:m,maxPictureWidth:t.readU(16),maxPictureHeight:t.readU(16),avgFramerate:t.readU(16)}}function g(t){const e=new f.A(t,!0);if(1&e.readUint8()){const i=new p.A;i.appendBuffer(t.subarray(1)),w(i),e.skip(i.getPointer())}let i=[],r=[],n=[];const s=e.readUint8();for(let t=0;t<s;t++){const t=31&e.readUint8();let s=1;13!==t&&12!==t&&(s=e.readUint16());const a=[];for(let t=0;t<s;t++){const t=e.readUint16();a.push(e.readBuffer(t))}14===t?i=a:15===t?r=a:16===t&&(n=a)}return{vpss:i,spss:r,ppss:n}}function U(t,e,i){const r=e[0];let n;if(r){const t=D(r);let e=t.generalConstraintInfo;e.length||(e=new Array(12).fill(0));const i=new u.A;if(i.writeU(9,0),i.writeU(3,t.spsMaxSublayersMinus1+1),i.writeU(2,1),i.writeU(2,t.chromaFormatIdc),i.writeU(3,t.bitDepthMinus8),i.writeU(5,31),i.writeU(2,0),i.writeU(6,e.length),i.writeU(7,t.profile),i.writeU1(t.tierFlag),i.writeU(8,t.level),i.writeU1(t.ptlFrameOnlyConstraintFlag),i.writeU1(t.ptlMultilayerEnabledFlag),e.length){for(let t=0;t<e.length-1;t++)i.writeU(8,e[t]);i.writeU(6,e[e.length-1])}else i.writeU(6,63);if(t.spsMaxSublayersMinus1+1>1){let e=0;for(let i=t.spsMaxSublayersMinus1-1;i>=0;i--)e=e<<1|t.ptlSublayerLevelPresentFlag[i];i.writeU(t.spsMaxSublayersMinus1,e);for(let e=t.spsMaxSublayersMinus1+1;e<=8&&t.spsMaxSublayersMinus1>0;++e)i.writeU1(0);for(let e=t.spsMaxSublayersMinus1-1;e>=0;e--)t.ptlSublayerLevelPresentFlag[e]&&i.writeU(8,t.sublayerLevelIdc[e])}i.writeU(8,t.generalSubProfileIdc.length);for(let e=0;e<t.generalSubProfileIdc.length;e++)i.writeU(8,t.sublayerLevelIdc[e]);i.writeU(16,t.width),i.writeU(16,t.height),i.writeU(16,0),i.padding(),n=i.getBuffer().subarray(0,i.getPointer())}let s=2+(n?n.length:0);t.length&&(s+=3,s=t.reduce(((t,e)=>t+2+e.length),s)),e.length&&(s+=3,s=e.reduce(((t,e)=>t+2+e.length),s)),i.length&&(s+=3,s=i.reduce(((t,e)=>t+2+e.length),s));const a=new Uint8Array(s),o=new h.A(a,!0);o.writeUint8(m<<1|(n?1:0)|248),n&&o.writeBuffer(n);let c=0;return t.length&&c++,e.length&&c++,i.length&&c++,o.writeUint8(c),t.length&&(o.writeUint8(142),o.writeUint16(t.length),l.__(t,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),e.length&&(o.writeUint8(143),o.writeUint16(e.length),l.__(e,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),i.length&&(o.writeUint8(144),o.writeUint16(i.length),l.__(i,(t=>{o.writeUint16(t.length),o.writeBuffer(t)}))),a}function y(t){let e=n.py(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const n=e[1]>>>3&31;14===n?t.push(e):15===n?i.push(e):16===n&&r.push(e)})),i.length&&r.length)return U(t,i,r)}}function I(t){let e=n.py(t);if(e.length>=2){const t=[],i=[],r=[];if(e.forEach((e=>{const n=e[1]>>>3&31;14===n?t.push(e):15===n?i.push(e):16===n&&r.push(e)})),i.length&&r.length){const e=[i[0],r[0]];return t.length&&e.unshift(t[0]),n.nW(e,0)}}}function b(t){let e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!1,a=n.py(t);if(a.length){const t=[],n=[],s=[];a.forEach((e=>{const i=e[1]>>>3&31;14===i?t.push(e):15===i?n.push(e):16===i&&s.push(e),8!==i&&7!==i&&9!==i&&10!==i||(r=!0)})),n.length&&s.length?(e=U(t,n,s),a=a.filter((t=>{const e=t[1]>>>3&31;return(i||14!==e&&15!==e&&16!==e)&&20!==e}))):a=a.filter((t=>20!=(t[1]>>>3&31)))}const o=a.reduce(((t,e)=>t+m+1+e.length),0),c=(0,s.sY)(o),l=(0,d.s3)(c,o);return n.S9(a,m,l),{bufferPointer:c,length:o,extradata:e,key:r}}function S(t,e,i,r,a){const o=[n.Le(t,0),n.Le(e,0),n.Le(i,0),n.Le(r,2)];let l=o.reduce(((t,e)=>t+e),0);const p=(0,s.sY)(l+7);let u=p;return c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),1),c.w8((u+=1,u-1),0),c.w8((u+=1,u-1),161),c.w8((u+=1,u-1),(a?1:0)<<7|40),t.length&&(n.nW(t,0,(0,d.s3)(u,o[0])),u+=o[0]),e.length&&(n.nW(e,0,(0,d.s3)(u,o[1])),u+=o[1]),i.length&&(n.nW(i,0,(0,d.s3)(u,o[2])),u+=o[2]),r.length&&n.nW(r,2,(0,d.s3)(u,o[3])),{bufferPointer:p,length:l+7}}function v(t,e){let i=n.py(t).concat(n.py(e));if(i.length){let t=[],e=[],r=[],n=[];return i.forEach((i=>{const s=i[1]>>>3&31;14===s?t.push(i):15===s?e.push(i):16===s?r.push(i):20!==s&&n.push(i)})),S(t,e,r,n,!0)}}function x(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;e&&(i=e[0]>>>1&3);let r=[],s=[],a=[],o=!1;if(e){const t=g(e);r=t.vpss,s=t.spss,a=t.ppss,o=!0}const c=n.wN(t,i).filter((t=>20!=(t[1]>>>3&31))),d=[];return c.forEach((t=>{const e=t[1]>>>3&31;15!==e||s.length?16!==e||a.length?20!==e&&d.push(t):a.push(t):s.push(t),8!==e&&7!==e||(o=!0)})),{...S(r,s,a,d,o),key:o}}function A(t,e){let i;if(!e&&t.sideData[1]&&(e=t.sideData[1]),e&&n.Bs(e))l.__(n.py(e),(t=>{if(15==(t[1]>>>3&31))return i=t,!1}));else if(e&&e.length>=6){const{spss:t}=g(e);t.length&&(i=t[0])}i&&function(t,e){const{profile:i,level:r,width:n,height:s,videoDelay:a,chromaFormatIdc:o,bitDepthMinus8:c}=D(e);switch(t.codecpar.profile=i,t.codecpar.level=r,t.codecpar.width=n,t.codecpar.height=s,t.codecpar.videoDelay=a,c){case 0:t.codecpar.format=3===o?5:2===o?4:0;break;case 2:t.codecpar.format=3===o?68:2===o?64:62}}(t,i)}function k(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;if(64&r.f[15](t+36))return n.py((0,d.s3)(r.f[20](t+24),r.f[15](t+28))).some((t=>{const e=t[1]>>>3&31;return 8===e||7===e||9===e}));{const i=r.f[15](t+28);let n=0;for(;n<i-e;){const i=o.r8(r.f[20](t+24)+(n+e+1))>>>3&31;if(8===i||7===i||9===i)return!0;n+=4===e?o.Sg(r.f[20](t+24)+n):3===e?o.ht(r.f[20](t+24)+n):2===e?o.yd(r.f[20](t+24)+n):o.r8(r.f[20](t+24)+n),n+=e}return!1}}function D(t){if(!t||t.length<3)return;let e=0;0===t[0]&&0===t[1]&&0===t[2]&&1===t[3]&&(e=4);let i=0,r=0,s=0,o=0,c=0,d=1,l=0,u=0,f=0;const h=[],m=[],w=[],g=[],U=n.BN(t.subarray(e)),y=new p.A(U.length);y.appendBuffer(U),y.readU1(),y.readU1(),y.readU(6),y.readU(5),y.readU(3),y.readU(8);const I=y.readU(3);d=y.readU(2);const b=y.readU(2);if(y.readU(1)){if(i=y.readU(7),l=y.readU(1),r=y.readU(8),u=y.readU(1),f=y.readU(1),y.readU(1)){for(let t=0;t<8;t++)h[t]=y.readU(8);h[8]=y.readU(7);const t=y.readU(8);y.readU(t)}y.skipPadding();for(let t=I-1;t>=0;t--)m[t]=y.readU(1);y.skipPadding();for(let t=I-1;t>=0;t--)m[t]&&(w[t]=y.readU(8));const t=y.readU(8);if(t)for(let e=0;e<t;e++)g[e]=y.readU(32)}y.readU1(),y.readU1()&&y.readU1();const S=s=a.xb(y),v=o=a.xb(y);if(y.readU1()&&(a.xb(y),a.xb(y),a.xb(y),a.xb(y)),y.readU1()){const t=a.xb(y),e=b+5,i=1<<e,r=S/(1<<e),n=v/(1<<e),s=Math.ceil(Math.log2(r)),o=Math.ceil(Math.log2(n));let c=0,d=0,l=0;t>0&&(l=y.readU1(),d=y.readU1());for(let e=0;t>0&&e<=t;e++)d&&0!=e||(e>0&&S>i&&y.readU(s),e>0&&v>i&&y.readU(o),e<t&&S>i&&y.readU(s),e<t&&v>i&&y.readU(o)),l||y.readU(2);if(c=a.xb(y)+1,y.readU(1)&&y.readU(1))for(let e=0;e<=t;e++)y.readU(c)}c=a.xb(y),y.readU(1),y.readU(1);const x=y.readU(4),A=y.readU(1);let k=0;A&&(k=a.xb(y));const D=[],P=y.readU(2);for(let t=0;t<8*P;t++)D[t]=y.readU(1);return{profile:i,level:r,width:s,height:o,videoDelay:I+1>2?2:I,chromaFormatIdc:d,bitDepthMinus8:c,generalProfileSpace:0,tierFlag:l,generalConstraintInfo:h,generalSubProfileIdc:g,ptlFrameOnlyConstraintFlag:u,ptlMultilayerEnabledFlag:f,spsMaxSublayersMinus1:I,ptlSublayerLevelPresentFlag:m,sublayerLevelIdc:w,sps_log2_max_pic_order_cnt_lsb_minus4:x,sps_poc_msb_cycle_flag:A,sps_poc_msb_cycle_len_minus1:k,sps_num_extra_ph_bytes:P,sps_extra_ph_bit_present_flag:D}}function P(t){n.Bs(t)&&(t=y(t));const e=new p.A;return e.appendBuffer(t),1&e.readU(8)?w(e):{}}},4198:(t,e,i)=>{function r(t,e,i){var r,n,s;const a=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId)),o=i.trexs.find((t=>{t.trackId,e.privData.trackId})),c=null!==(r=null==o?void 0:o.duration)&&void 0!==r?r:0,d=null!==(n=null==o?void 0:o.size)&&void 0!==n?n:0,l=null!==(s=null==o?void 0:o.flags)&&void 0!==s?s:0;t.writeUint32(32),t.writeString("trex"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(a.trackId),t.writeUint32(1),t.writeUint32(c),t.writeUint32(d),t.writeUint32(l)}i.d(e,{A:()=>r})},4373:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId));t.writeUint32(20),t.writeString("saio"),t.writeUint32(0),t.writeUint32(1),r.cenc.offsetPos=t.getPos(),t.writeUint32(0)}i.d(e,{A:()=>r})},4505:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("smhd"),t.writeUint32(0),t.writeUint16(0),t.writeUint16(0)}i.d(e,{A:()=>r})},4569:(t,e,i)=>{function r(t,e,i){const r=e.sideData[28];if(r)t.writeUint32(12+r.length),t.writeString("colr"),t.writeString("prof"),t.writeBuffer(r);else{const i=2===e.codecpar.colorRange;t.writeUint32(19),t.writeString("colr"),t.writeString("nclx"),t.writeUint16(e.codecpar.colorPrimaries),t.writeUint16(e.codecpar.colorTrc),t.writeUint16(e.codecpar.colorSpace),t.writeUint8(i?128:0)}}i.d(e,{A:()=>r})},4876:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(1237);function n(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,remainDataOffsets:[],remainDataOffsetIndex:[],dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[],lastFragIndexDts:BigInt(0),tfdtDelay:r.Dh,trunPtsDelay:BigInt(0)}}},4881:(t,e,i)=>{function r(t,e,i){t.writeUint32(16),t.writeString("pasp"),t.writeUint32(1),t.writeUint32(1)}i.d(e,{A:()=>r})},5024:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(3321);function n(t,e){const i=t.getPos(),n=t.getPointer(),s=i-BigInt(Math.floor(n)),a=[];r.__(e.boxsPositionInfo,(e=>{e.pos<i&&e.pos>=s?(t.seekInline(n+Number(e.pos-i)),t.writeUint32(e.size)):a.push(e)})),t.seekInline(n),a.length&&(r.__(a,(e=>{t.seek(e.pos),t.writeUint32(e.size)})),t.seek(i)),e.boxsPositionInfo=[]}},5033:(t,e,i)=>{i.r(e),i.d(e,{default:()=>M});var r=i(4467),n=i(7127),s=i(9983),a=i(6911),o=i(3180),c=i(9515),d=i(9227),l=i(1700),p=i(4876),u=i(5024),f=i(7083),h=i(3299),m=i(8547),w=i(7877),g=i(3674),U=i(713),y=i(4187),I=i(3262),b=i(1237),S=i(8940),v=i(8590),x=i(3321),A=i(665),k=i(1605),D=i(9906),P=i(3737),B=i(8370);const C="packages/avformat/src/formats/OIsobmffFormat.ts",z={fragmentMode:0,mp4Mode:0,fragment:!1,fastOpen:!1,defaultBaseIsMoof:!1,reverseSpsInAvcc:!1,ignoreEncryption:!1,minFragmentLength:5e3,minFragmentIndexLength:5e3,hasTfra:!0,useMetadataTags:!1};class M extends a.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),(0,r.A)(this,"type",1),(0,r.A)(this,"context",void 0),(0,r.A)(this,"options",void 0),(0,r.A)(this,"annexb2AvccFilter",void 0),(0,r.A)(this,"avpacket",void 0),this.options=A.X$({},z,t),this.context=(0,o.A)()}init(t){return t.ioWriter.setEndian(!0),t.streams.forEach((t=>{this.annexb2AvccFilter||27!==t.codecpar.codecId&&173!==t.codecpar.codecId&&196!==t.codecpar.codecId||(this.annexb2AvccFilter=new m.A(this.options.reverseSpsInAvcc),this.annexb2AvccFilter.init(t.codecpar[n.o9],t.timeBase[n.o9]))})),this.avpacket=(0,y._5)(),this.context.metadata=t.metadata,this.context.chapters=t.chapters,0}async destroy(t){this.annexb2AvccFilter&&(this.annexb2AvccFilter.destroy(),this.annexb2AvccFilter=null),this.avpacket&&((0,y.Qe)(this.avpacket),this.avpacket=0)}enableStreams(t){const e=[],i=[];for(let t=0;t<5;t++)e[t]=0,i[t]=-1;x.__(t.streams,((t,r)=>{if(-1===t.codecpar.codecType||t.codecpar.codecType>=5||1024&t.disposition)return!0;i[t.codecpar.codecType]<0&&(i[t.codecpar.codecType]=r),1&t.disposition&&(e[t.codecpar.codecType]++,t.privData.flags|=1)}));for(let r=0;r<5;r++)switch(r){case 0:case 1:case 3:e[r]>1&&(t.streams[e[r]].privData.perStreamGrouping=!0),!e[r]&&i[r]>=0&&(t.streams[i[r]].privData.flags|=1)}}writeHeader(t){this.context.majorBrand=(0,c.A)("isom"),this.context.minorVersion=512,this.context.compatibleBrand=[(0,c.A)("isom")],this.context.timescale=1e3,this.context.ignoreEncryption=this.options.ignoreEncryption,this.context.useMetadataTags=this.options.useMetadataTags;const e=t.streams.find((t=>1024&t.disposition&&(7===t.codecpar.codecId||61===t.codecpar.codecId||78===t.codecpar.codecId)));if(e&&e.attachedPic&&(this.context.covr={type:27,data:(0,y.iI)(e.attachedPic)},61===e.codecpar.codecId?this.context.covr.type=14:7===e.codecpar.codecId&&(this.context.covr.type=13)),this.options.fragment&&(this.context.compatibleBrand.push((0,c.A)("iso6")),this.context.fragment=!0),1===this.options.mp4Mode&&(this.context.isom=!0,this.context.majorBrand=(0,c.A)("qt  "),this.context.compatibleBrand=[this.context.majorBrand]),1!==this.options.mp4Mode){this.context.compatibleBrand.push((0,c.A)("iso2"));const e=t.getStreamByMediaType(0);e&&27===e.codecpar.codecId&&this.context.compatibleBrand.push((0,c.A)("avc1")),this.context.compatibleBrand.push((0,c.A)("mp41"))}if(d.l7(t.ioWriter,this.context),this.context.holdMoovPos=t.ioWriter.getPos(),this.options.fragment)this.context.currentFragment={pos:BigInt(0),currentTrack:null,sequence:1,tracks:[],size:0,firstWrote:!1},x.__(t.streams,((t,e)=>{const i=(0,l.A)();if(t.privData=i,i.chunkOffsets=[],i.cttsSampleCounts=[],i.cttsSampleOffsets=[],i.stscFirstChunk=[],i.stscSamplesPerChunk=[],i.stscSampleDescriptionIndex=[],i.stssSampleNumbers=[],i.sampleSizes=[],i.sttsSampleCounts=[],i.sttsSampleDeltas=[],i.alternateGroup=e,!(1024&t.disposition)){const e=(0,p.A)();e.baseIsMoof=this.options.defaultBaseIsMoof,e.streamIndex=t.index,e.trackId=this.context.nextTrackId++,i.trackId=e.trackId;const r=this.options.encryption||t.metadata.encryption;if(r){const t=this.context.cencs||{};t[e.trackId]={schemeType:r.schemeType,schemeVersion:r.schemeVersion,cryptByteBlock:r.cryptByteBlock,skipByteBlock:r.skipByteBlock,defaultConstantIV:r.constantIV,isProtected:1,defaultPerSampleIVSize:r.perSampleIVSize,defaultKeyId:r.kid,pattern:!!r.pattern},this.context.cencs=t}e.ioWriter=new B.A,e.ioWriter.onFlush=t=>(e.buffers.push(t.slice()),0),this.context.currentFragment.tracks.push(e)}})),this.enableStreams(t),d.dI(t.ioWriter,t,this.context),t.ioWriter.flush();else{x.__(t.streams,((t,e)=>{const i=(0,l.A)();t.privData=i,i.trackId=this.context.nextTrackId++,i.chunkOffsets=[],i.cttsSampleCounts=[],i.cttsSampleOffsets=[],i.stscFirstChunk=[],i.stscSamplesPerChunk=[],i.stscSampleDescriptionIndex=[],i.stssSampleNumbers=[],i.sampleSizes=[],i.sttsSampleCounts=[],i.sttsSampleDeltas=[],i.alternateGroup=e})),this.enableStreams(t);const e=t.ioWriter.getPos();t.ioWriter.writeUint32(0),t.ioWriter.writeUint32((0,c.A)("mdat")),this.context.boxsPositionInfo.push({pos:e,type:"mdat",size:0})}return t.getStreamByMediaType(0)||(this.context.audioOnly=!0),0}updateCurrentChunk(t){let e=this.context.currentChunk;if(!e||!e.sampleCount)return;const i=t.streams.find((t=>t.index===e.streamIndex)).privData;i.chunkCount++,i.chunkOffsets.push(e.pos),i.stscFirstChunk.length?i.lastStscCount!==e.sampleCount&&(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(e.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=e.sampleCount):(i.stscFirstChunk.push(i.chunkCount),i.stscSamplesPerChunk.push(e.sampleCount),i.stscSampleDescriptionIndex.push(1),i.lastStscCount=e.sampleCount)}updateCurrentFragment(t,e){if(this.context.currentFragment.firstWrote){x.__(this.context.currentFragment.tracks,(i=>{const r=t.streams.find((t=>t.index===i.streamIndex));if(!i.sampleCount||!r)return!0;const n=r.privData;var s,a;i.baseDataOffset=t.ioWriter.getPos(),this.context.currentFragment.pos=t.ioWriter.getPos(),i.sampleDurations.length?e&&i.sampleDurations.length===i.sampleSizes.length-1&&i.sampleDurations.push(Number(e-n.lastDts)):1===r.codecpar.codecType?e?i.sampleDurations.push(Number(e-n.lastDts)):r.codecpar.frameSize>0?i.sampleDurations.push(Number((0,I.k)(BigInt(Math.floor(r.codecpar.frameSize/r.codecpar.sampleRate*b.SF)),b.KR,r.timeBase))):(r.codecpar.codecId,i.sampleDurations.push(Number((0,I.k)(BigInt(Math.floor(1024/r.codecpar.sampleRate*b.SF)),b.KR,r.timeBase)))):0===r.codecpar.codecType?e?i.sampleDurations.push(Number(e-n.lastDts)):(0,I.lb)(r.codecpar.framerate)>0?i.sampleDurations.push(Number((0,I.k)(BigInt(Math.floor(1/(0,I.lb)(r.codecpar.framerate)*b.SF)),b.KR,r.timeBase))):i.sampleDurations.push(r.timeBase.den/(30*r.timeBase.num)>>>0):i.sampleDurations.push(0),n.lastDuration=i.sampleDurations[i.sampleSizes.length-1],(1===i.sampleFlags.length||(0,h.A)(i.sampleFlags,1))&&(i.firstSampleFlags=i.sampleFlags[0],i.defaultSampleFlags=null!==(s=i.sampleFlags[1])&&void 0!==s?s:i.firstSampleFlags,i.sampleFlags=[]),(1===i.sampleSizes.length||(0,h.A)(i.sampleSizes))&&(i.defaultSampleSize=i.sampleSizes[0],i.sampleSizes=[]),(1===i.sampleDurations.length||(0,h.A)(i.sampleDurations))&&(i.defaultSampleDuration=i.sampleDurations[0],i.sampleDurations=[]),i.cenc&&(1===i.cenc.sampleSizes.length||(0,h.A)(i.cenc.sampleSizes))&&(i.cenc.defaultSampleInfoSize=i.cenc.sampleSizes[0],i.cenc.sampleSizes=[]),1===r.codecpar.codecType?i.defaultSampleFlags=33554432:i.sampleFlags.length&&(i.defaultSampleFlags=i.sampleFlags[0]),i.sampleSizes.length&&(i.defaultSampleSize=i.sampleSizes[0]),i.sampleDurations.length&&(i.defaultSampleDuration=i.sampleDurations[0]),this.options.hasTfra&&(!n.fragIndexes.length||0===this.options.fragmentMode||(0,I.k)(i.baseDataOffset-i.lastFragIndexDts,r.timeBase,b.i0)>=this.options.minFragmentIndexLength)&&(n.fragIndexes.push({pos:i.baseDataOffset,time:i.baseMediaDecodeTime+BigInt(Math.floor(null!==(a=i.sampleCompositionTimeOffset[0])&&void 0!==a?a:0))}),i.lastFragIndexDts=n.lastDts)})),t.ioWriter.flush(),this.options.onFragmentStart&&this.options.onFragmentStart(),d.Ro(t.ioWriter,t,this.context);let i=this.context.currentFragment.size+8;const r=[];let n=8;x.__(this.context.currentFragment.tracks,(e=>{if(!e.sampleCount)return!0;e.ioWriter.flush();const s=(0,P.A)(Uint8Array,e.buffers);e.dataOffset=i,i+=s.length,n+=s.length,r.push(s),(0,f.A)(t.ioWriter,e.dataOffsetPos,e.dataOffset,"int32"),e.cenc&&e.cenc.offsetPos&&(0,f.A)(t.ioWriter,e.cenc.offsetPos,e.cenc.offset,"int32"),e.buffers=[],e.sampleFlags=[],e.sampleSizes=[],e.sampleDurations=[],e.sampleCompositionTimeOffset=[],e.sampleCount=0,e.firstSampleFlags=0,e.cenc=null})),t.ioWriter.writeUint32(n),t.ioWriter.writeUint32((0,c.A)("mdat")),x.__(r,(e=>{t.ioWriter.writeBuffer(e)})),(0,u.A)(t.ioWriter,this.context),t.ioWriter.flush(),this.context.currentFragment.firstWrote=!1,this.context.currentFragment.sequence++}}handleEAC3(t,e){this.context.ac3Info||(this.context.ac3Info={done:!1,numBlocks:0,dataRate:0,ac3BitrateCode:-1,numIndSub:0,substream:[]});const i=this.context.ac3Info,r=S.R((0,g.s3)(s.f[20](t+24),s.f[15](t+28)));if(v.ai(r))i.done=!0;else if(i.dataRate=Math.max(i.dataRate,r.bitrate/1e3),i.ac3BitrateCode=Math.max(i.ac3BitrateCode,r.ac3BitrateCode),!i.done){if(r.bitstreamId<=10&&0!=r.substreamId)return;if(0===r.frameType||2==r.frameType){var n;if(r.substreamId>i.numIndSub+1)return;if(r.substreamId==i.numIndSub+1)return;if(r.substreamId<i.numIndSub||0==r.substreamId&&null!==(n=i.substream[0])&&void 0!==n&&n.bsid)return void(i.done=!0)}else if(0!=r.substreamId)return;if(i.substream[r.substreamId]||(i.substream[r.substreamId]={fscod:0,bsid:0,bsmod:0,acmod:0,lfeon:0,numDepSub:0,chanLoc:0}),i.substream[r.substreamId].fscod=r.srCode,i.substream[r.substreamId].bsid=r.bitstreamId,i.substream[r.substreamId].bsmod=r.bitstreamMode,i.substream[r.substreamId].acmod=r.channelMode,i.substream[r.substreamId].lfeon=r.lfeOn,86019===e.codecpar.codecId)return void(i.done=!0)}}writeTrackData(t,e,i,r){if(94226===r.codecpar.codecId){const n=r.privData;if(n.lastDuration>0){const a=n.lastDts+BigInt(Math.floor(n.lastDuration));if(a<i&&(0,I.k)(i-a,r.timeBase,b.i0)>200){t.writeUint32(8),t.writeString("vtte");const r=Number(i-a);if(this.context.fragment){const t=this.context.currentFragment.tracks.find((t=>t.streamIndex===s.f[15](e+32)));t.sampleCount++,t.sampleSizes.length||(t.baseMediaDecodeTime=a),t.sampleDurations.push(r),t.sampleSizes.push(8)}else{const t=Number(a-n.lastDts);this.context.currentChunk.sampleCount++,n.sampleSizes.push(8),n.sttsSampleDeltas[n.sttsSampleDeltas.length-1]===t?n.sttsSampleCounts[n.sttsSampleCounts.length-1]++:(n.sttsSampleCounts.push(1),n.sttsSampleDeltas.push(t))}n.lastPts=a,n.lastDts=a,n.lastDuration=r}}const a=(0,y.rU)(e,16),o=(0,y.rU)(e,17);let c=s.f[15](e+28)+8;return a&&(c+=8+(0|s.f[25](a+4))),o&&(c+=8+(0|s.f[25](o+4))),t.writeUint32(8+c),t.writeString("vttc"),a&&(t.writeUint32(8+s.f[25](a+4)),t.writeString("iden"),t.writeBuffer((0,g.s3)(s.f[20](a),s.f[25](a+4)))),o&&(t.writeUint32(8+s.f[25](o+4)),t.writeString("sttg"),t.writeBuffer((0,g.s3)(s.f[20](o),s.f[25](o+4)))),t.writeUint32(8+s.f[15](e+28)),t.writeString("payl"),t.writeBuffer((0,y.iI)(e)),8+c}return t.writeBuffer((0,y.iI)(e)),s.f[15](e+28)}writeAVPacket(t,e){if(!s.f[15](e+28))return D.R8(`packet's size is 0: ${s.f[15](e+32)}, ignore it`,C,781),0;const i=t.getStreamByIndex(s.f[15](e+32));if(!i||1024&i.disposition)return void D.R8(`can not found the stream width the avpacket's streamIndex: ${s.f[15](e+32)}, ignore it`,C,788);const r=i.privData;let n=(0,I.Mr)(s.f[17](e+16),e+72,i.timeBase),a=(0,I.Mr)(s.f[17](e+8)!==b.Dh?s.f[17](e+8):s.f[17](e+16),e+72,i.timeBase);const o=s.f[17](e+48)!==b.Dh?(0,I.Mr)(s.f[17](e+48),e+72,i.timeBase):b.Dh;if((27===i.codecpar.codecId||173===i.codecpar.codecId||196===i.codecpar.codecId)&&64&s.f[15](e+36)?(this.annexb2AvccFilter.sendAVPacket(e),this.annexb2AvccFilter.receiveAVPacket(this.avpacket),e=this.avpacket):86019!==i.codecpar.codecId&&86056!==i.codecpar.codecId||this.context.ac3Info&&this.context.ac3Info.done||this.handleEAC3(e,i),this.context.fragment){const c=this.context.currentFragment.tracks.find((t=>t.streamIndex===s.f[15](e+32)));if(c){c.tfdtDelay===b.Dh&&(c.tfdtDelay=n<0?-n:BigInt(0),a<0&&(c.trunPtsDelay=c.tfdtDelay)),n+=c.tfdtDelay,a+=c.trunPtsDelay,(0===this.options.fragmentMode&&(0===i.codecpar.codecType&&1&s.f[15](e+36)||this.context.audioOnly&&(0,I.k)(n-c.baseMediaDecodeTime,i.timeBase,b.i0)>=this.options.minFragmentLength)||1===this.options.fragmentMode)&&(1===this.context.currentFragment.tracks.length?this.updateCurrentFragment(t,n):this.updateCurrentFragment(t));const d=this.writeTrackData(c.ioWriter,e,n,i);if(c.sampleSizes.length||(c.baseMediaDecodeTime=n),c.sampleSizes.length&&(!c.sampleDurations[c.sampleSizes.length-1]||c.sampleDurations[c.sampleSizes.length-1]<=0)&&(c.sampleDurations[c.sampleSizes.length-1]=Number(n-r.lastDts)),o>0&&c.sampleDurations.push(Number(o)),c.sampleSizes.push(d),0===i.codecpar.codecType){let t=0;1&s.f[15](e+36)?t|=33554432:t|=16842752,c.sampleCompositionTimeOffset.push(Number((a!==b.Dh?a:n)-n)),c.sampleFlags.push(t)}const l=(0,y.Un)(e+40,e+44,25),p=this.context.cencs&&this.context.cencs[r.trackId];if(l&&p){const t=(0,U.p$)((0,g.s3)(s.f[20](l),s.f[25](l+4)));c.cenc||(c.cenc={sampleCount:0,defaultSampleInfoSize:0,sampleSizes:[],offset:0,useSubsamples:!1,sampleInfoOffset:[],sampleEncryption:[]}),t.subsamples.length&&(!c.cenc.useSubsamples&&c.cenc.sampleSizes.length&&(c.cenc.sampleSizes=c.cenc.sampleSizes.map((t=>t+2))),c.cenc.useSubsamples=!0),c.cenc.sampleCount++,c.cenc.sampleSizes.push(p.defaultPerSampleIVSize+(c.cenc.useSubsamples?2+6*t.subsamples.length:0)),c.cenc.sampleEncryption.push({iv:t.iv,subsamples:t.subsamples})}c.sampleCount++,r.lastPts=k.T9(r.lastPts,a+(o!==b.Dh?o:BigInt(0))),r.lastDts=n,o>0&&(r.lastDuration=Number(o)),this.context.currentFragment.firstWrote=!0}else D.R8(`can not found track width streamIndex ${s.f[15](e+32)}, ignore it`,C,926)}else{const c=t.ioWriter.getPos();let d=this.context.currentChunk;if(d?d.streamIndex!==s.f[15](e+32)?(this.updateCurrentChunk(t),d.streamIndex=s.f[15](e+32),d.sampleCount=1,d.pos=c):d.sampleCount++:d=this.context.currentChunk={pos:c,streamIndex:s.f[15](e+32),sampleCount:1},r.sampleSizes.push(this.writeTrackData(t.ioWriter,e,n,i)),0===i.codecpar.codecType&&1&s.f[15](e+36)&&r.stssSampleNumbers.push(r.sampleSizes.length),r.firstWrote){const t=Number(n-r.lastDts);r.sttsSampleDeltas[r.sttsSampleDeltas.length-1]===t?r.sttsSampleCounts[r.sttsSampleCounts.length-1]++:(r.sttsSampleCounts.push(1),r.sttsSampleDeltas.push(t))}else r.startDts=n,r.startCT=Number((a!==b.Dh?a:n)-n),r.firstWrote=!0;if(a>=0&&(r.startPts===b.Dh?r.startPts=a:r.startPts=k.jk(r.startPts,a)),0===i.codecpar.codecType){const t=Number((a!==b.Dh?a:n)-n);r.cttsSampleCounts.length&&r.cttsSampleOffsets[r.cttsSampleOffsets.length-1]===t?r.cttsSampleCounts[r.cttsSampleCounts.length-1]++:(r.cttsSampleCounts.push(1),r.cttsSampleOffsets.push(t))}r.lastPts=k.T9(r.lastPts,a+(o!==b.Dh?o:BigInt(0))),r.lastDts=n,r.lastDuration=Number(o)}return 0}writeTrailer(t){if(this.context.fragment)x.__(this.context.currentFragment.tracks,(e=>{const i=t.streams.find((t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t),this.options.hasTfra?d.yT(t.ioWriter,t,this.context):(t.ioWriter.writeUint32(8),t.ioWriter.writeString("mfra")),t.ioWriter.flush();else{this.updateCurrentChunk(t);let e=BigInt(0);x.__(t.streams,(t=>{if(1024&t.disposition)return!0;const i=t.privData;i.sampleSizes.length&&(i.sttsSampleDeltas.length?i.lastDuration>0&&i.lastDuration!==i.sttsSampleDeltas[i.sttsSampleDeltas.length-1]?(i.sttsSampleCounts.push(1),i.sttsSampleDeltas.push(i.lastDuration)):i.sttsSampleCounts[i.sttsSampleCounts.length-1]++:(i.sttsSampleCounts=[1],i.sttsSampleDeltas=[0]));const r=(0,I.k)((0,w.A)(i),t.timeBase,{den:1e3,num:1});r>e&&(e=r)})),this.context.duration=e;const i=this.context.boxsPositionInfo[this.context.boxsPositionInfo.length-1];if("mdat"!==i.type&&D.z3("last box is not mdat",C,1053),i.size=Number(t.ioWriter.getPos()-i.pos),i.size>b.f7){const e=t.ioWriter.getPos();t.ioWriter.seek(i.pos-BigInt(8)),t.ioWriter.writeUint32(1),t.ioWriter.writeUint32((0,c.A)("mdat")),t.ioWriter.writeUint64(BigInt(i.size)+BigInt(8)),t.ioWriter.seek(e),this.context.boxsPositionInfo.pop(),this.context.use64Mdat=!0}if((0,u.A)(t.ioWriter,this.context),this.options.fastOpen){t.ioWriter.flush();let e=[];const i=t.ioWriter.onFlush;t.ioWriter.onFlush=t=>(e.push(t.slice()),0),d.dI(t.ioWriter,t,this.context),t.ioWriter.flush();let r=(0,P.A)(Uint8Array,e);x.__(t.streams,(t=>{const e=t.privData;if(e.chunkOffsets.length)for(let t=0;t<e.chunkOffsets.length;t++)e.chunkOffsets[t]+=BigInt(Math.floor(r.length))})),e=[],d.dI(t.ioWriter,t,this.context),t.ioWriter.flush(),r=(0,P.A)(Uint8Array,e),i&&i(r,this.context.holdMoovPos),t.ioWriter.onFlush=i}else d.dI(t.ioWriter,t,this.context),t.ioWriter.flush()}return 0}flush(t){return this.options.fragment&&(x.__(this.context.currentFragment.tracks,(e=>{const i=t.streams.find((t=>t.index===e.streamIndex)).privData;e.sampleCount&&(e.sampleDurations.length?e.sampleDurations.push(e.sampleDurations[e.sampleDurations.length-1]):e.sampleDurations=[i.lastDuration])})),this.updateCurrentFragment(t)),t.ioWriter.flush(),0}getCapabilities(){return M.Capabilities}}(0,r.A)(M,"Capabilities",[86021,86076,86018,86017,86028,86051,86019,86056,167,225,27,173,196,12,94226,94213])},5058:(t,e,i)=>{function r(t,e,i){t.writeUint32(12),t.writeString("sthd"),t.writeUint32(0)}i.d(e,{A:()=>r})},5063:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(9906);const n="packages/avformat/src/formats/isobmff/writing/ctts.ts";function s(t,e,i){const s=e.privData,a=s.cttsSampleCounts||[],o=s.cttsSampleOffsets||[];a.length!==o.length&&r.R8("ctts sampleCounts's length is not match sampleOffsets's length",n,39);const c=Math.min(a.length,o.length);t.writeUint32(16+8*c),t.writeString("ctts"),t.writeUint8(1),t.writeUint24(0),t.writeUint32(c);for(let e=0;e<c;e++)t.writeUint32(a[e]),t.writeInt32(o[e])}},5067:(t,e,i)=>{function r(t,e,i){const r=i.currentFragment.tracks.find((t=>t.trackId===e.privData.trackId));let n=57;r.baseIsMoof&&(n&=-2,n|=131072);const s=t.getPos();t.writeUint32(0),t.writeString("tfhd"),t.writeUint8(0),t.writeUint24(n),t.writeUint32(r.trackId),1&n&&t.writeUint64(r.baseDataOffset),8&n&&t.writeUint32(r.defaultSampleDuration),16&n&&t.writeUint32(r.defaultSampleSize),32&n&&t.writeUint32(r.defaultSampleFlags),i.boxsPositionInfo.push({pos:s,type:"tfhd",size:Number(t.getPos()-s)})}i.d(e,{A:()=>r})},5068:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(7877),n=i(8590),s=i(1237);function a(t,e,i){const a=e.privData,o=(0,r.A)(a),c=e.metadata.creationTime||0,d=e.metadata.modificationTime||0;let l=21956,p=e.metadata.language;p&&n.Yj(p)&&p.length>=3&&(l=(p.charCodeAt(0)-96&31)<<10|(p.charCodeAt(1)-96&31)<<5|p.charCodeAt(2)-96&31);let u=o<BigInt(s.f7)?0:1;u=c<s.f7?0:1,u=d<s.f7?0:1,t.writeUint32(1===u?44:32),t.writeString("mdhd"),t.writeUint8(u),t.writeUint24(0),1===u?(t.writeUint64(c),t.writeUint64(d)):(t.writeUint32(Number(c)),t.writeUint32(Number(d))),t.writeUint32(e.timeBase.den),1===u?t.writeUint64(o):t.writeUint32(Number(o)),t.writeUint16(l),t.writeUint16(0)}},5509:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(3674);function n(t,e,i){var n;t.writeUint32(12+(null!==(n=e.codecpar.extradataSize)&&void 0!==n?n:0)),t.writeString("vpcC"),t.writeUint8(1),t.writeUint24(0),i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize))}},5756:(t,e,i)=>{function r(t,e,i,r,n,s,a){t.writeInt32(Math.floor(65536*e)),t.writeInt32(Math.floor(65536*i)),t.writeInt32(0),t.writeInt32(Math.floor(65536*r)),t.writeInt32(Math.floor(65536*n)),t.writeInt32(0),t.writeInt32(Math.floor(65536*s)),t.writeInt32(Math.floor(65536*a)),t.writeInt32(1073741824)}i.d(e,{A:()=>r})},6362:(t,e,i)=>{i.d(e,{c:()=>r});const r={"@PRM":"premiere_version","@PRQ":"quicktime_version",XMP_:"xmp",aART:"albumArtist",akID:"account_type",apID:"account_id",catg:"category",cpil:"compilation",cprt:"copyright",desc:"description",disk:"disc",egid:"episode_uid",FIRM:"firmware",gnre:"genre",hdvd:"hd_video",HMMT:"hmmt",keyw:"keywords",ldes:"synopsis",loci:"loci",manu:"make",modl:"model",pcst:"podcast",pgap:"gapless_playback",purd:"purchase_date",rtng:"rating",soaa:"albumArtistSort",soal:"albumSort",soar:"artistSort",soco:"composerSort",sonm:"nameSort",sosn:"showSort",stik:"media_type",trkn:"track",tven:"episode_id",tves:"episode_sort",tvnn:"network",tvsh:"show",tvsn:"season_number","ART":"albumArtist","PRD":"producer","alb":"album","aut":"artist","chp":"chapter","cmt":"comment","com":"composer","cpy":"copyright","day":"date","dir":"director","dis":"disclaimer","ed1":"edit_date","enc":"encoder","fmt":"original_format","gen":"genre","grp":"grouping","hst":"host_computer","inf":"comment","lyr":"lyrics","mak":"make","mod":"mod","nam":"title","ope":"original_artist","prd":"producer","prf":"performer","req":"playback_requirements","src":"original_source","st3":"subtitle","swr":"encoder","too":"encoder","trk":"track","url":"url","wrn":"warning","wrt":"composer","xyz":"location"}},6856:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(2288),n=i(3674);function s(t,e,i){const s=t.getPos();t.writeUint32(0),t.writeString("wave"),86035!==e.codecpar.codecId&&(t.writeUint32(12),t.writeString("frma"),t.writeUint32(e.codecpar.codecTag)),86018===e.codecpar.codecId?(t.writeUint32(12),t.writeString("mp4a"),t.writeUint32(0),(0,r.A)(t,e,i)):i.fragment&&e.sideData[1]?(t.writeBuffer(e.sideData[1]),delete e.sideData[1]):e.codecpar.extradata&&t.writeBuffer((0,n.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),t.writeUint32(8),t.writeUint32(0),i.boxsPositionInfo.push({pos:s,type:"wave",size:Number(t.getPos()-s)})}},6911:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(4467);class n{constructor(){(0,r.A)(this,"type",-1)}async destroy(t){}}(0,r.A)(n,"Capabilities",[])},6968:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(4916);function n(t,e,i){const n=i.ac3Info,s=new r.A(2+(34*(n.numIndSub+1)+7>>3));s.writeU(13,n.dataRate),s.writeU(3,n.numIndSub);for(let t=0;t<n.numIndSub;t++)s.writeU(2,n.substream[t].fscod),s.writeU(5,n.substream[t].bsid),s.writeU(1,0),s.writeU(1,0),s.writeU(3,n.substream[t].bsmod),s.writeU(3,n.substream[t].acmod),s.writeU(1,n.substream[t].lfeon),s.writeU(5,0),s.writeU(4,n.substream[t].numDepSub),n.substream[t].numDepSub?s.writeU(9,n.substream[t].chanLoc):s.writeU(1,0);s.padding();const a=s.getPointer();t.writeUint32(8+a),t.writeString("dec3"),t.writeBuffer(s.getBuffer().subarray(0,a))}},7083:(t,e,i)=>{function r(t,e,i,r){const n=t.getPos(),s=t.getPointer(),a=n-BigInt(Math.floor(s));let o=!1;switch(e<n&&e>=a?(t.seekInline(s+Number(e-n)),o=!0):t.seek(e),r){case"uint8":t.writeUint8(255&i);break;case"int8":t.writeInt8(i);break;case"uint16":t.writeUint16(65535&i);break;case"int16":t.writeInt16(i);break;case"uint32":t.writeUint32(i>>>0);break;case"int32":t.writeInt32(i);break;case"uint64":t.writeUint64(BigInt.asUintN(64,i));break;case"int64":t.writeInt64(i);break;case"float":t.writeFloat(i);break;case"double":t.writeDouble(i)}o?t.seekInline(s):t.seek(n)}i.d(e,{A:()=>r})},7175:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(9906);const n="packages/avformat/src/formats/isobmff/writing/stts.ts";function s(t,e,i){const s=e.privData,a=s.sttsSampleCounts||[],o=s.sttsSampleDeltas||[];a.length!==o.length&&r.R8("stts sampleCounts's length is not match sampleDeltas's length",n,39);const c=Math.min(a.length,o.length);t.writeUint32(16+8*c),t.writeString("stts"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(c);for(let e=0;e<c;e++)t.writeUint32(a[e]),t.writeInt32(o[e])}},7416:(t,e,i)=>{function r(t,e,i){t.writeUint32(20),t.writeString("vmhd"),t.writeUint8(0),t.writeUint24(1),t.writeUint64(BigInt(0))}i.d(e,{A:()=>r})},7632:(t,e,i)=>{function r(t,e,i){const r=e.privData,n=i.currentFragment.tracks.find((t=>t.trackId===r.trackId)),s=n.firstSampleFlags||0,a=n.dataOffset||0,o=n.sampleDurations,c=n.sampleSizes,d=n.sampleFlags,l=n.sampleCompositionTimeOffset,p=n.sampleCount,u=o.length>0,f=c.length>0,h=d.length>0,m=l.length>0,w=0!==s;let g=1;w&&(g|=4),u&&(g|=256),f&&(g|=512),h&&(g|=1024),m&&(g|=2048);const U=t.getPos();t.writeUint32(0),t.writeString("trun"),t.writeUint8(1),t.writeUint24(g),t.writeUint32(p),n.dataOffsetPos=t.getPos(),t.writeInt32(a),w&&t.writeUint32(s);for(let e=0;e<p;e++)u&&t.writeUint32(o[e]||0),f&&t.writeUint32(c[e]||0),h&&t.writeUint32(d[e]||0),m&&t.writeInt32(l[e]||0);i.boxsPositionInfo.push({pos:U,type:"trun",size:Number(t.getPos()-U)})}i.d(e,{A:()=>r})},7675:(t,e,i)=>{function r(t,e,i){const r=e.privData.sampleSizes;t.writeUint32(20+4*r.length),t.writeString("stsz"),t.writeUint8(0),t.writeUint24(0),t.writeUint32(0),t.writeUint32(r.length);for(let e=0;e<r.length;e++)t.writeUint32(r[e])}i.d(e,{A:()=>r})},7811:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(3674),n=i(4096),s=i(1958);function a(t,e,i){let a;i.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&s.Bs(a)&&(a=n.S1(a)),t.writeUint32(12+(a?a.length:0)),t.writeString("vvcC"),t.writeUint8(0),t.writeUint24(0),a&&t.writeBuffer(a)}},7877:(t,e,i)=>{i.d(e,{A:()=>n});var r=i(1237);function n(t){return t.startPts!==r.Dh?t.lastPts-t.startPts:t.startDts===r.Dh?t.lastPts:t.lastPts-(t.startDts+BigInt(0|t.startCT))}},7962:(t,e,i)=>{i.d(e,{Q9:()=>s,f3:()=>a,uf:()=>o,zs:()=>n});var r=i(9515);const n={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},s={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},a={vide:0,pict:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,r.A)("mp4a")]:86018,1836253269:86017,[(0,r.A)("Opus")]:86076,[(0,r.A)("fLaC")]:86028,[(0,r.A)("spex")]:86051,[(0,r.A)("SPXN")]:86051,[(0,r.A)("ac-3")]:86019,[(0,r.A)("sac3")]:86019,[r.A.mp4v]:12,[(0,r.A)("av01")]:225,[(0,r.A)("vp08")]:139,[(0,r.A)("vp09")]:167,[(0,r.A)("avc1")]:27,[(0,r.A)("avc3")]:27,[(0,r.A)("hev1")]:173,[(0,r.A)("hvc1")]:173,[(0,r.A)("vvc1")]:196,[(0,r.A)("vvi1")]:196,[(0,r.A)("text")]:94213,[(0,r.A)("tx3g")]:94213,[(0,r.A)("png ")]:61,[(0,r.A)("MNG ")]:61,[(0,r.A)("gif ")]:97,[(0,r.A)("tiff")]:96,[(0,r.A)("H263")]:4,[(0,r.A)("3IVD")]:16}},8246:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(8590),n=i(4405),s=i(3262);function a(t,e,i){const a=t.getPos();t.writeUint32(0),t.writeString("chpl"),t.writeUint32(16777216),t.writeUint32(0);const o=i.chapters;t.writeUint8(o.length),o.forEach((e=>{t.writeUint64((0,s.k)(e.start,e.timeBase,{num:1,den:1e7}));let i=e.metadata.title;if(i&&r.Yj(i)){let e=n.encode(i);e.length>255&&(e=e.slice(0,255)),t.writeUint8(e.length),t.writeBuffer(e)}else t.writeUint8(0)})),i.boxsPositionInfo.push({pos:a,type:"chpl",size:Number(t.getPos()-a)})}},8441:(t,e,i)=>{i.d(e,{A:()=>a});var r=i(3674),n=i(4229),s=i(1958);function a(t,e,i){let a;i.fragment&&e.sideData[1]?(a=e.sideData[1],delete e.sideData[1]):e.codecpar.extradata&&(a=(0,r.s3)(e.codecpar.extradata,e.codecpar.extradataSize)),a&&s.Bs(a)&&(a=n.S1(a)),t.writeUint32(8+(a?a.length:0)),t.writeString("hvcC"),a&&t.writeBuffer(a)}},8547:(t,e,i)=>{i.d(e,{A:()=>m});var r=i(4467),n=i(9983),s=i(2320),a=i(3458),o=i(3674),c=i(9906),d=i(495),l=i(4187),p=i(1755),u=i(1497),f=i(4229),h=i(4096);class m extends a.A{constructor(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];super(),(0,r.A)(this,"cache",void 0),(0,r.A)(this,"cached",void 0),(0,r.A)(this,"reverseSps",void 0),this.reverseSps=t}init(t,e){return super.init(t,e),this.cache=(0,l._5)(),this.cached=!1,0}destroy(){super.destroy(),(0,l.Qe)(this.cache),this.cache=0}sendAVPacket(t){if(64&n.f[15](t+36)){let e;(0,l.zu)(this.cache,t);const i=(0,o.JW)(n.f[20](t+24),n.f[15](t+28));if(27===n.f[15](this.inCodecpar+4)?e=u.oT(i,this.reverseSps):173===n.f[15](this.inCodecpar+4)?e=f.oT(i,this.reverseSps):196===n.f[15](this.inCodecpar+4)?e=h.oT(i,this.reverseSps):c.h2(`not support for codecId: ${n.f[15](this.inCodecpar+4)}`,"packages/avformat/src/bsf/h2645/Annexb2AvccFilter.ts",114),s.M[15](this.cache+36,-65&n.f[15](this.cache+36)),(0,l.NX)(this.cache,e.bufferPointer,e.length),e.key&&s.M[15](this.cache+36,1|n.f[15](this.cache+36)),e.extradata){const t=(0,p.sY)(e.extradata.length);(0,o.lW)(t,e.extradata.length,e.extradata),(0,l.Ow)(this.cache,1,t,e.extradata.length)}}else(0,l.rN)(this.cache,t);return this.cached=!0,0}receiveAVPacket(t){return this.cached?((0,l.Up)(t),(0,l.rN)(t,this.cache),this.cached=!1,0):d.LR}reset(){return 0}}},8832:(t,e,i)=>{function r(t,e,i){t.writeUint32(12),t.writeString("nmhd"),t.writeUint32(0)}i.d(e,{A:()=>r})},8940:(t,e,i)=>{i.d(e,{R:()=>f,j:()=>n});var r=i(84);const n=[3,4,3,7,259,263,1539,1543],s=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],a=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],l=[2,1,2,3,3,4,4,5],p=[1,2,3,6],u=7;function f(t){const e=new r.A(t.length);e.appendBuffer(t);const i={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(i.syncWord=e.readU(16),2935!==i.syncWord)return-1;if(i.bitstreamId=31&e.peekU(29),i.bitstreamId>16)return-2;if(i.numBlocks=6,i.ac3BitrateCode=-1,i.centerMixLevel=5,i.surroundMixLevel=6,i.dolbySurroundMode=0,i.bitstreamId<=10){if(i.crc1=e.readU(16),i.srCode=e.readU(2),3===i.srCode)return-3;const t=e.readU(6);if(t>37)return-4;i.ac3BitrateCode=t>>1,e.readU(5),i.bitstreamMode=e.readU(3),i.channelMode=e.readU(3),2==i.channelMode?i.dolbySurroundMode=e.readU(2):(1&i.channelMode&&1!=i.channelMode&&(i.centerMixLevel=a[e.readU(2)]),4&i.channelMode&&(i.surroundMixLevel=o[e.readU(2)])),i.lfeOn=e.readU(1),i.srShift=Math.max(i.bitstreamId,8)-8,i.sampleRate=c[i.srCode]>>i.srShift,i.bitrate=1e3*d[i.ac3BitrateCode]>>i.srShift,i.channels=l[i.channelMode]+i.lfeOn,i.frameSize=2*s[t][i.srCode],i.frameType=2,i.substreamId=0}else{if(i.crc1=0,i.frameType=e.readU(2),3==i.frameType)return-5;if(i.substreamId=e.readU(3),i.frameSize=e.readU(11)+1<<1,i.frameSize<u)return-6;if(i.srCode=e.readU(2),3==i.srCode){const t=e.readU(2);if(3==t)return-7;i.sampleRate=c[t]/2,i.srShift=1}else i.numBlocks=p[e.readU(2)],i.sampleRate=c[i.srCode],i.srShift=0;i.channelMode=e.readU(3),i.lfeOn=e.readU(1),i.bitrate=8*i.frameSize*i.sampleRate/(256*i.numBlocks),i.channels=l[i.channelMode]+i.lfeOn}return i.channelLayout=BigInt(n[i.channelMode]),i.lfeOn&&(i.channelLayout|=BigInt(8)),i}},9227:(t,e,i)=>{i.d(e,{Ro:()=>U,dI:()=>g,l7:()=>m,yT:()=>y});var r=i(7127),n=i(9983),s=i(9515),a=i(491),o=i(1357),c=i(3462),d=i(5024),l=i(3321),p=i(4405),u=i(3674),f=i(713),h=i(4187);function m(t,e){t.flush();const i=t.getPointer(),r=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("ftyp")),t.writeUint32(e.majorBrand||(0,s.A)("isom")),t.writeUint32(e.minorVersion||512),l.__(e.compatibleBrand,(e=>{t.writeUint32(e)})),function(t,e,i){const r=t.getPointer();t.seekInline(e),t.writeUint32(i),t.seekInline(r)}(t,i,Number(t.getPos()-r)),e.isom?(t.writeUint32(8),t.writeUint32((0,s.A)("wide"))):e.fragment||(t.writeUint32(8),t.writeUint32((0,s.A)("free")))}function w(t,e,i,r){l.__(e,(e=>{if(!e)return!0;if(o.A[e.type])o.A[e.type](t,i,r);else if(e.children){const n=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)(e.type)),w(t,e.children,i,r),r.boxsPositionInfo.push({pos:n,type:e.type,size:Number(t.getPos()-n)})}else!function(t,e){const i=l.zy(a._l,e);t.writeUint32(i?12:8),t.writeUint32((0,s.A)(e)),i&&t.writeUint32(0)}(t,e.type)}))}function g(t,e,i){var a;const m=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("moov")),o.A.mvhd(t,null,i),l.__(e.streams,(e=>{if(1024&e.disposition||1!==e.codecpar.codecType&&0!==e.codecpar.codecType&&3!==e.codecpar.codecType)return!0;const r=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("trak")),w(t,i.fragment?c.Jl[e.codecpar.codecType](i,e):c.BB[e.codecpar.codecType](i,e),e,i);const n=e.metadata.title;if(n){const e=p.encode(n);t.writeUint32(16+e.length),t.writeUint32((0,s.A)("udta")),t.writeUint32(8+e.length),t.writeUint32((0,s.A)("name")),t.writeBuffer(e)}i.boxsPositionInfo.push({pos:r,type:"trak",size:Number(t.getPos()-r)})}));let g=t.getPos();if(t.writeUint32(0),t.writeUint32((0,s.A)("udta")),o.A.meta(t,null,i),null!==(a=i.chapters)&&void 0!==a&&a.length&&o.A.chpl(t,null,i),i.boxsPositionInfo.push({pos:g,type:"udta",size:Number(t.getPos()-g)}),i.fragment){const a=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("mvex")),l.__(e.streams,(e=>{if(1024&e.disposition||1!==e.codecpar.codecType&&0!==e.codecpar.codecType&&3!==e.codecpar.codecType)return!0;o.A.trex(t,e,i)})),i.boxsPositionInfo.push({pos:a,type:"mvex",size:Number(t.getPos()-a)}),i.ignoreEncryption||function(t,e,i){const a=[];l.__(e.streams,(t=>{const e=(0,h.Un)(t.codecpar[r.o9]+20,t.codecpar[r.o9]+24,24);e&&(0,f.ZK)((0,u.s3)(n.f[20](e),n.f[25](e+4))).forEach((t=>{(function(t){if(!a.length)return!1;for(let e=0;e<a.length;e++){const i=a[e];if(!l.FB(i.systemId,t.systemId))return!1;if(!i.keyIds||!t.keyIds)return!1;if(i.keyIds.length!==t.keyIds.length)return!1;for(let e=0;e<i.keyIds.length;e++)if(!l.FB(i.keyIds[e],t.keyIds[e]))return!1;if(!l.FB(i.data,t.data))return!1}return!0})(t)||a.push(t)}))})),a.length&&a.forEach((e=>{const r=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("pssh")),t.writeUint8(1),t.writeUint24(0),t.writeBuffer(e.systemId),t.writeUint32(e.keyIds.length),e.keyIds.forEach((e=>{t.writeBuffer(e)})),t.writeUint32(e.data.length),t.writeBuffer(e.data),i.boxsPositionInfo.push({pos:r,type:"pssh",size:Number(t.getPos()-r)})}))}(t,e,i)}i.boxsPositionInfo.push({pos:m,type:"moov",size:Number(t.getPos()-m)}),(0,d.A)(t,i)}function U(t,e,i){const r=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("moof")),o.A.mfhd(t,null,i),l.__(i.currentFragment.tracks,(r=>{if(!r.sampleCount)return!0;const n=t.getPos();t.writeUint32(0),t.writeUint32((0,s.A)("traf"));const a=e.streams.find((t=>t.privData.trackId===r.trackId));w(t,(0,c.Ip)(r),a,i),i.boxsPositionInfo.push({pos:n,type:"traf",size:Number(t.getPos()-n)})}));const n=Number(t.getPos()-r);i.boxsPositionInfo.push({pos:r,type:"moof",size:n}),i.currentFragment.size=n}function y(t,e,i){let r=24;l.__(i.currentFragment.tracks,(t=>{const i=e.streams.find((e=>e.index===t.streamIndex)).privData;i.fragIndexes.length&&(r+=24+19*i.fragIndexes.length)})),t.writeUint32(r),t.writeString("mfra"),l.__(i.currentFragment.tracks,(i=>{const r=e.streams.find((t=>t.index===i.streamIndex)).privData;r.fragIndexes.length&&(t.writeUint32(24+19*r.fragIndexes.length),t.writeString("tfra"),t.writeUint8(1),t.writeUint24(0),t.writeUint32(i.trackId),t.writeUint32(0),t.writeUint32(r.fragIndexes.length),r.fragIndexes.forEach((e=>{t.writeUint64(e.time),t.writeUint64(e.pos),t.writeUint8(1),t.writeUint8(1),t.writeUint8(1)})))})),t.writeUint32(16),t.writeString("mfro"),t.writeUint32(0),t.writeUint32(r)}},9515:(t,e,i)=>{i.d(e,{A:()=>s});var r=i(9906);const n="packages/avformat/src/function/mktag.ts";function s(t){4!==t.length&&r.R8(`tag length is not 4, tag: ${t}`,n,31);let e=0;for(let i=0;i<4;i++)e=e<<8|t.charCodeAt(i);return e}},9575:(t,e,i)=>{function r(t,e,i){const r=t.getPos();t.writeUint32(0),t.writeString("hdlr"),t.writeUint8(0),t.writeUint24(0);let n="dhlr",s="url ",a="DataHandler";e&&(n="mhlr",1===e.codecpar.codecType?(s="soun",a="SoundHandler"):0===e.codecpar.codecType?(s="vide",a="VideoHandler"):3===e.codecpar.codecType?(s="text",a="SubtitleHandler"):(e.metadata.handlerName&&(a=e.metadata.handlerName),e.metadata.hdlrType&&(s=e.metadata.hdlrType))),t.writeString(n),t.writeString(s),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),e&&!i.isom||t.writeUint8(a.length),t.writeString(a),e&&!i.isom&&t.writeUint8(0),i.boxsPositionInfo.push({pos:r,type:"hdlr",size:Number(t.getPos()-r)})}i.d(e,{A:()=>r})},9600:(t,e,i)=>{i.d(e,{A:()=>o});var r=i(5756),n=i(7877),s=i(1237),a=i(3262);function o(t,e,i){const o=e.privData,c=(0,a.k)((0,n.A)(o),e.timeBase,{den:i.timescale,num:1}),d=e.metadata.creationTime||0,l=e.metadata.modificationTime||0,p=o.layer||0,u=o.alternateGroup||0;let f=e.codecpar.width>0?e.codecpar.width:0,h=e.codecpar.height>0?e.codecpar.height:0;const m=(0,a.lb)(e.codecpar.sampleAspectRatio);0!==m&&m!==1/0&&(f=Math.floor(f*m)),f<s.zg&&(f<<=16),h<s.zg&&(h<<=16);let w=c<BigInt(s.f7)?0:1;w=d<s.f7?0:1,w=l<s.f7?0:1;let g=2;1&o.flags&&(g|=1),t.writeUint32(1===w?100:92),t.writeString("tkhd"),t.writeUint8(w),t.writeUint24(g),1===w?(t.writeUint64(d),t.writeUint64(l)):(t.writeUint32(Number(d)),t.writeUint32(Number(l))),t.writeUint32(o.trackId),t.writeUint32(0),1===w?t.writeUint64(c):t.writeUint32(Number(c)),t.writeUint32(0),t.writeUint32(0),t.writeInt16(p),t.writeInt16(o.perStreamGrouping?u:e.codecpar.codecType),1===e.codecpar.codecType?t.writeInt16(256):t.writeInt16(0),t.writeInt16(0);const U=e.metadata.matrix;U?(0,r.A)(t,U[0],U[1],U[3],U[4],U[6],U[7]):(0,r.A)(t,1,0,0,1,0,0),t.writeUint32(f),t.writeUint32(h)}},9932:(t,e,i)=>{i.d(e,{A:()=>c});var r=i(6362),n=i(9515),s=i(8590),a=i(665),o=i(4405);function c(t,e,i){const c=t.getPos();t.writeUint32(0),t.writeString("meta"),t.writeUint32(0),t.writeUint32(33),t.writeString("hdlr"),t.writeUint32(0),t.writeString("dhlr"),t.writeString(i.useMetadataTags?"mdta":"mdir"),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint8(0);let d=[],l=[];const p=a.BE(r.c);function u(t){return i.useMetadataTags?(d.push(t),d.length):p[t]||4===t.length?(0,n.A)(p[t]||t):void 0}if(l.push({key:u("encoder"),value:"libmedia-v0.6.1-408-gdf1fec0d"}),i.covr&&l.push({key:u("covr"),value:i.covr.data,type:i.covr.type}),i.metadata&&a.__(i.metadata,((t,e)=>{if((s.Yj(t)||s.ai(t)||t instanceof Uint8Array)&&"encoder"!==e.toLocaleLowerCase()){let i=u(e);i&&l.push({key:i,value:t})}})),d.length&&(t.writeUint32(16+d.reduce(((t,e)=>t+(8+e.length)),0)),t.writeString("keys"),t.writeUint32(0),t.writeUint32(d.length),d.forEach((e=>{t.writeUint32(e.length+8),t.writeString("mdta"),t.writeString(e)}))),l.length){const e=t.getPos();t.writeUint32(0),t.writeString("ilst"),l.forEach((e=>{let i,r=0,n=0;if(s.ai(e.value))r=Math.trunc(e.value)===e.value?e.value<0?21:22:23,n=4;else if(e.value instanceof Uint8Array){var a;r=null!==(a=e.type)&&void 0!==a?a:0,n=e.value.length}else{if(!s.Yj(e.value))return;r=1,i=o.encode(e.value),n=i.length}t.writeUint32(24+n),t.writeUint32(e.key),t.writeUint32(16+n),t.writeString("data"),t.writeUint32(r),t.writeUint32(0),0===r||e.value instanceof Uint8Array?t.writeBuffer(e.value):1===r?t.writeBuffer(i):21===r?t.writeInt32(e.value):22===r?t.writeUint32(e.value):23===r&&t.writeFloat(e.value)})),i.boxsPositionInfo.push({pos:e,type:"ilst",size:Number(t.getPos()-e)})}i.boxsPositionInfo.push({pos:c,type:"meta",size:Number(t.getPos()-c)})}}}]);