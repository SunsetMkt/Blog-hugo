"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[773],{28773:(e,t,a)=>{a.r(t),a.d(t,{default:()=>W});var i=a(49859),r=a(18979),n=a.n(r),o=a(48079),s=a.n(o),d=a(52730),c=a.n(d),h=a(94870),l=a.n(h),f=a(14686),p=a(61499),u=a(63939),g=a(50932),w=(a(9599),a(58121)),m=a(68243),I=a(4624),U=a(35028),k=a(62815),M=a(95832),R=a(67659),v=a(59166),b=a(21477),B=a(82014),y=a(97077),D=a(14769),A=a(22576),P=a(87518),C=a(64093),S=a(9705),L=a(85947),T=a(37837),x=a(71517),z=a(65977),N=a(44328),E=a(77231),$=a(72739),F=a(52071),X=a(34677),_=a(73040),O=(a(55833),a(99991)),V=a(67672);const Y="src/avformat/formats/IFlvFormat.ts";class W extends L.A{constructor(e={}){super(),(0,i.A)(this,"type",0),(0,i.A)(this,"header",void 0),(0,i.A)(this,"script",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"firstTagPos",void 0),this.header=new w.A,this.script=new m.A,this.options=e}init(e){e.ioReader&&e.ioReader.setEndian(!0)}async readHeader(e){try{if("FLV"!==await e.ioReader.peekString(3))return I.z3("the file format is not flv",Y,120),S.LR;await this.header.read(e.ioReader),0!==await e.ioReader.readUint32()&&I.R8("the previousTagSize0 is not 0",Y,127);let t=0;if(18===await e.ioReader.peekUint8()){await e.ioReader.skip(1);const a=await e.ioReader.readUint24();await e.ioReader.skip(7),t=await this.script.read(e.ioReader,a)}return t>=0&&(this.firstTagPos=e.ioReader.getPos()),t}catch(t){return I.z3(t.message,Y,145),e.ioReader.error}}async readModEx(e,t,a){let i=await e.ioReader.readUint8()+1;256===i&&(i=await e.ioReader.readUint16()+1);const r=await e.ioReader.readBuffer(i),n=await e.ioReader.readUint8(),o=240&n;if(0===o&&0===a||0===o&&1===a){let e=0;3===r.length?(e=r[0]<<16|r[1]<<8|r[2],this.options.useNanoTimestamp?g.M[17](t+16,u.f[17](t+16)+BigInt(e)):g.M[17](t+16,u.f[17](t+16)+BigInt(e)/BigInt(1e6)),g.M[17](t+8,u.f[17](t+16))):I.R8(`Invalid ModEx size for Type TimestampOffsetNano!, need 3 but got ${r.length}`,Y,178)}else I.R8(`unknown ModEx type: ${o}`,Y,182);return 15&n}async readCodecConfigurationRecord(e,t,a,i){const r=(0,T.sY)(i);var o;t.codecpar.extradata?((0,x.Ow)(a,1,r,i),await e.ioReader.readBuffer(i,(0,f.JW)(r,i))):(t.codecpar.extradata=r,t.codecpar.extradataSize=i,await e.ioReader.readBuffer(i,(0,f.JW)(r,i)),t.sideData[1]=n()(o=(0,f.s3)(r,i)).call(o),27===t.codecpar.codecId?k.XC(t):173===t.codecpar.codecId?R.XC(t):196===t.codecpar.codecId?v.XC(t):225===t.codecpar.codecId?b.XC(t):167===t.codecpar.codecId?B.XC(t):139===t.codecpar.codecId?y.XC(t):86018===t.codecpar.codecId?M.XC(t):86028===t.codecpar.codecId?D.XC(t):86076===t.codecpar.codecId&&A.XC(t))}async readAVPacketData(e,t,a,i){const r=(0,T.sY)(i);(0,x.NX)(a,r,i),await e.ioReader.readBuffer(i,(0,f.JW)(r,i))}parseColorInfo(e,t,a){let i=!1,r=!1;if(a.hdrMdcv&&(i=a.hdrMdcv.redX>0&&a.hdrMdcv.redY>0&&a.hdrMdcv.blueX>0&&a.hdrMdcv.blueY>0&&a.hdrMdcv.greenX>0&&a.hdrMdcv.greenY>0&&a.hdrMdcv.whitePointX>0&&a.hdrMdcv.whitePointY>0,r=a.hdrMdcv.maxLuminance>0&&a.hdrMdcv.minLuminance>0),3!==a.colorConfig.matrixCoefficients&&(e.codecpar.colorSpace=a.colorConfig.matrixCoefficients),3!==a.colorConfig.colorPrimaries&&0!==a.colorConfig.colorPrimaries&&(e.codecpar.colorPrimaries=a.colorConfig.colorPrimaries),3!==a.colorConfig.transferCharacteristics&&0!==a.colorConfig.transferCharacteristics&&(e.codecpar.colorTrc=a.colorConfig.transferCharacteristics),a.hdrCll&&a.hdrCll.maxCLL&&a.hdrCll.maxFall){const n=(0,T.Gy)(8);g.M[8](n,a.hdrCll.maxCLL),g.M[8](n+4,a.hdrCll.maxFall),(0,x.sn)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,22)?(0,x.Ow)(t,22,n,8):(0,x.$W)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,22,n,8)}if(r||i){const o=(0,T.Gy)(88);function s(e,t){const a=(0,N.j2)(t,E.go);g.M[15](e+4,a.den),g.M[15](e,a.num)}r&&(g.M[15](o+84,1),s(o+72,a.hdrMdcv.maxLuminance),s(o+64,a.hdrMdcv.minLuminance)),i&&(g.M[15](o+80,1),s(o,a.hdrMdcv.redX),s(o+8,a.hdrMdcv.redY),s(o+16,a.hdrMdcv.greenX),s(o+16+8,a.hdrMdcv.greenY),s(o+32,a.hdrMdcv.blueX),s(o+32+8,a.hdrMdcv.blueY)),(0,x.sn)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,20)?(0,x.Ow)(t,20,o,88):(0,x.$W)(e.codecpar[p.o9]+20,e.codecpar[p.o9]+24,20,o,88)}}findStream(e,t,a){for(let i=0;i<e.streams.length;i++)if(e.streams[i].codecpar.codecType===t){const t=e.streams[i].privData;if(t&&t.trackId===a)return e.streams[i]}}createStream(e,t,a,i){var r;const n=e.createStream();n.codecpar.codecType=t,n.timeBase.den=this.options.useNanoTimestamp?E.H3:E.qs,n.timeBase.num=1,n.startTime=u.f[17](a+8);const o={trackId:i};var s,d,c;if(n.privData=o,null!==(r=this.script.onMetaData)&&void 0!==r&&r.duration&&(n.duration=(0,N.k)(BigInt(Math.floor(1e3*this.script.onMetaData.duration)),E.i0,n.timeBase)),0===t)(null===(s=this.script.onMetaData)||void 0===s?void 0:s.width)>0&&(n.codecpar.width=this.script.onMetaData.width),(null===(d=this.script.onMetaData)||void 0===d?void 0:d.height)>0&&(n.codecpar.height=this.script.onMetaData.height),null!==(c=this.script.onMetaData)&&void 0!==c&&null!==(c=c.videoTrackIdInfoMap)&&void 0!==c&&c[i]&&(this.script.onMetaData.videoTrackIdInfoMap[i].title&&(n.metadata.title=this.script.onMetaData.videoTrackIdInfoMap[i].title),this.script.onMetaData.videoTrackIdInfoMap[i].lang&&(n.metadata.language=this.script.onMetaData.videoTrackIdInfoMap[i].lang),this.script.onMetaData.videoTrackIdInfoMap[i].width>0&&(n.codecpar.width=this.script.onMetaData.videoTrackIdInfoMap[i].width),this.script.onMetaData.videoTrackIdInfoMap[i].height>0&&(n.codecpar.height=this.script.onMetaData.videoTrackIdInfoMap[i].height),this.script.onMetaData.videoTrackIdInfoMap[i].duration>0&&(n.duration=(0,N.k)(BigInt(1e3*this.script.onMetaData.videoTrackIdInfoMap[i].duration),E.i0,n.timeBase)));else if(1===t){var h;null!==(h=this.script.onMetaData)&&void 0!==h&&null!==(h=h.audioTrackIdInfoMap)&&void 0!==h&&h[i]&&(this.script.onMetaData.audioTrackIdInfoMap[i].title&&(n.metadata.title=this.script.onMetaData.audioTrackIdInfoMap[i].title),this.script.onMetaData.audioTrackIdInfoMap[i].lang&&(n.metadata.language=this.script.onMetaData.audioTrackIdInfoMap[i].lang),this.script.onMetaData.audioTrackIdInfoMap[i].duration>0&&(n.duration=(0,N.k)(BigInt(1e3*this.script.onMetaData.audioTrackIdInfoMap[i].duration),E.i0,n.timeBase)))}return this.onStreamAdd&&this.onStreamAdd(n),n}async readAVPacket_(e,t){const a=e.ioReader.getPos();g.M[17](t+56,a);let i=!1;const r=31&await e.ioReader.readUint8();let n=await e.ioReader.readUint24(),o=await e.ioReader.readUint24();const d=await e.ioReader.readUint8();if(d&&(o|=d<<24),g.M[17](t+16,this.options.useNanoTimestamp?(0,N.k)(BigInt(Math.floor(o)),E.i0,E.FQ):BigInt(Math.floor(o))),g.M[17](t+8,u.f[17](t+16)),await e.ioReader.skip(3),8===r){g.M[15](t+36,1|u.f[15](t+36));const r=await e.ioReader.readUint8();n--;const o=(240&r)>>4;if(9===o){let o=!1,d=15&r;for(;7===d;){let a=e.ioReader.getPos();d=await this.readModEx(e,t,1),n-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let c=0,h=0;if(5===d){o=!0;const t=await e.ioReader.readUint8();n--,h=(240&t)>>4,d=15&t,2!==h&&(c=await e.ioReader.readUint32(),n-=4)}else c=await e.ioReader.readUint32(),n-=4;let l=t;for(;;){let r=n,w=0;o&&(2===h&&(c=await e.ioReader.readUint32(),n-=4),w=await e.ioReader.readUint8(),n--,0!==h?(r=await e.ioReader.readUint24(),n-=3):r=n);let m=this.findStream(e,1,w);if(m||(m=this.createStream(e,1,l,w),c===(0,z.A)("ac-3")?m.codecpar.codecId=86019:c===(0,z.A)("ec-3")?m.codecpar.codecId=86056:c===(0,z.A)("Opus")?(m.codecpar.codecId=86076,m.codecpar.sampleRate=48e3):c===(0,z.A)(".mp3")?m.codecpar.codecId=86017:c===(0,z.A)("fLaC")?m.codecpar.codecId=86028:c===(0,z.A)("mp4a")?m.codecpar.codecId=86018:(I.R8(`unknown codec fourcc(${c.toString(16)})`,Y,511),m.codecpar.codecId=0)),g.M[15](l+32,m.index),n-=r,4===d){const t=await e.ioReader.readUint8(),a=await e.ioReader.readUint8();if(r-=2,(0,O.bl)(m.codecpar[p.o9]+112),2===t){(0,O.xY)(m.codecpar[p.o9]+112,a);for(let t=0;t<a;t++){const a=await e.ioReader.readUint8();r--,a<18?g.M[15](s()(m.codecpar.chLayout.u)+24*t,a):a>=18&&a<=23?g.M[15](s()(m.codecpar.chLayout.u)+24*t,a-18+35):254===a?g.M[15](s()(m.codecpar.chLayout.u)+24*t,512):g.M[15](s()(m.codecpar.chLayout.u)+24*t,768)}}else if(1===t){let t=BigInt(await e.ioReader.readUint32());r-=4,t=t&BigInt(262143)|(t&BigInt(16515072))<<BigInt(35)-BigInt(18),(0,O.ML)(m.codecpar[p.o9]+112,t)}i=!0}else if(0===d)r?(await this.readCodecConfigurationRecord(e,m,l,r),r=0,i=!1,(0,x.fQ)(t,1)||(i=!0)):i=!0;else if(2===d)g.M[15](l+36,32|u.f[15](l+36)),i=!1;else if(1===d){if(await this.readAVPacketData(e,m,l,r),(86019===m.codecpar.codecId||86056===m.codecpar.codecId||86017===m.codecpar.codecId)&&m.codecpar.sampleRate===E.N_)if(86019===m.codecpar.codecId||86056===m.codecpar.codecId){const e=P.R((0,x.iI)(l));V.ai(e)||(m.codecpar.sampleRate=e.sampleRate,m.codecpar.chLayout.nbChannels=e.channels,m.codecpar.bitrate=BigInt(e.bitrate))}else 86017===m.codecpar.codecId&&C.XC(m,(0,x.iI)(l));i=!1,r=0}else I.R8(`invalid audioPacketType ${d}`,Y,593);if(r&&await e.ioReader.skip(r),l===t||i||e.interval.packetBuffer.push(l),!o||0===h||!n)break;l=(0,x._5)(),g.M[17](l+56,a),(0,f.Mr)(l+72,t+72,8),g.M[17](l+16,u.f[17](t+16)),g.M[17](l+8,u.f[17](t+8)),g.M[15](l+36,1|u.f[15](l+36))}}else{let a=this.findStream(e,1,0);if(!a){if(a=this.createStream(e,1,t,0),a.disposition|=1,a.codecpar.chLayout.nbChannels=1&~r?1:2,a.codecpar.sampleRate=44100<<((12&r)>>>2)>>3,a.codecpar.bitsPerCodedSample=2&r?16:8,0===o)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else if(3===o)a.codecpar.codecId=8===a.codecpar.bitsPerCodedSample?65541:65536;else{var c;a.codecpar.codecId=null!==(c=U.FJ[o])&&void 0!==c?c:0}86051===a.codecpar.codecId?(a.codecpar.sampleRate=16e3,a.codecpar.chLayout.nbChannels=1):65543!==a.codecpar.codecId&&65542!==a.codecpar.codecId||(a.codecpar.sampleRate=8e3)}g.M[15](t+32,a.index),86018===a.codecpar.codecId&&(n--,0===await e.ioReader.readUint8()&&(this.readCodecConfigurationRecord(e,a,t,n),n=0,(0,x.fQ)(t,1)||(i=!0))),n&&(await this.readAVPacketData(e,a,t,n),n=0)}}else if(9===r){const r=await e.ioReader.readUint8(),o=128&r,s=(112&r)>>4;if(n--,1===s&&g.M[15](t+36,1|u.f[15](t+36)),o){let o=!0,d=!1,c=15&r;for(;7===c;){let a=e.ioReader.getPos();c=await this.readModEx(e,t,0),n-=Number(BigInt.asIntN(32,e.ioReader.getPos()-a))}let h=0,l=0;if(4!==c&&5===s)o=!1,i=!0;else if(6===c){d=!0;const t=await e.ioReader.readUint8();n--,l=(240&t)>>4,c=15&t,2!==l&&(h=await e.ioReader.readUint32(),n-=4)}else h=await e.ioReader.readUint32(),n-=4;let p=t;for(;o;){let r=n,o=0;d&&(2===l&&(h=await e.ioReader.readUint32(),n-=4),o=await e.ioReader.readUint8(),n--,0!==l?(r=await e.ioReader.readUint24(),n-=3):r=n);let w=this.findStream(e,0,o);if(w||(w=this.createStream(e,0,p,o),h===(0,z.A)("avc1")?w.codecpar.codecId=27:h===(0,z.A)("hvc1")?w.codecpar.codecId=173:h===(0,z.A)("vvc1")?w.codecpar.codecId=196:h===(0,z.A)("av01")?w.codecpar.codecId=225:h===(0,z.A)("vp09")?w.codecpar.codecId=167:h===(0,z.A)("vp08")&&(w.codecpar.codecId=139)),g.M[15](p+32,w.index),n-=r,4===c){const t=e.ioReader.getPos()+BigInt(Math.floor(r)),a=await _.$x(e.ioReader,t),n=await _.$x(e.ioReader,t);"colorInfo"===a?this.parseColorInfo(w,p,n):I.R8(`unknown metadata key ${a}`,Y,770),e.ioReader.getPos()<t&&await e.ioReader.seek(t),i=!0,r=0}else if(0===c)r?(await this.readCodecConfigurationRecord(e,w,p,r),r=0,i=!1,(0,x.fQ)(t,1)||(i=!0)):i=!0;else if(2===c)g.M[15](p+36,32|u.f[15](p+36)),i=!1;else if(5===c)225===w.codecpar.codecId?(await this.readCodecConfigurationRecord(e,w,p,r-2),i=!1,r=0,(0,x.fQ)(t,1)||(i=!0)):i=!0;else if(1===c||3===c){if(1===c&&(173===w.codecpar.codecId||196===w.codecpar.codecId||27===w.codecpar.codecId)){const a=await e.ioReader.readInt24();g.M[17](p+8,u.f[17](p+16)+(this.options.useNanoTimestamp?(0,N.FP)(BigInt(0|a),E.i0,t+72):BigInt(0|a))),r-=3}await this.readAVPacketData(e,w,p,r),r=0,i=!1}else I.R8(`invalid videoPacketType ${c}`,Y,829);if(r&&await e.ioReader.skip(r),i||p===t||e.interval.packetBuffer.push(p),!d||0===l||!n)break;p=(0,x._5)(),g.M[17](p+56,a),(0,f.Mr)(p+72,t+72,8),g.M[17](p+16,u.f[17](t+16)),g.M[17](p+8,u.f[17](t+8)),1===s&&g.M[15](p+36,1|u.f[15](p+36))}}else if(5!==s){let a=this.findStream(e,0,0);var h;if(a||(a=this.createStream(e,0,t,0),a.disposition|=1,a.codecpar.codecId=null!==(h=U.U5[15&r])&&void 0!==h?h:0),g.M[15](t+32,a.index),27===a.codecpar.codecId||173===a.codecpar.codecId||196===a.codecpar.codecId||12===a.codecpar.codecId){const r=await e.ioReader.readUint8(),o=await e.ioReader.readInt24();n-=4,g.M[17](t+8,u.f[17](t+16)+(this.options.useNanoTimestamp?(0,N.FP)(BigInt(0|o),E.i0,t+72):BigInt(0|o))),0===r?(await this.readCodecConfigurationRecord(e,a,t,n),(0,x.fQ)(t,1)||(i=!0)):2===r?g.M[15](t+36,32|u.f[15](t+36)):await this.readAVPacketData(e,a,t,n)}else await this.readAVPacketData(e,a,t,n);n=0}else i=!0}else{if(18===r){let a=await this.script.read(e.ioReader,n);return a<0?a:await this.readAVPacket_(e,t)}if(15!==r)return I.R8(`invalid tag type: ${r}, try to sync to next tag`,Y,915),await this.syncTag(e),this.readAVPacket_(e,t);I.R8("not support script tag encoded by amf3, ignore it",Y,912)}n&&await e.ioReader.skip(n);const l=e.ioReader.getPos()-a,w=BigInt(Math.floor(await e.ioReader.readUint32()));return l!==w&&I.R8(`tag ${r} size not match, size: ${l}, previousTagSize: ${w}`,Y,928),i?this.readAVPacket_(e,t):0}async readAVPacket(e,t){try{return g.M[15](t+76,this.options.useNanoTimestamp?E.H3:E.qs),g.M[15](t+72,1),await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(I.z3(`read packet error, ${t}`,Y,946),S.LR):e.ioReader.error}}async syncTag(e){let t=E.Dh;for(;;)try{if(8&c()(e.ioReader))break;const a=await e.ioReader.readUint8();if(8===a||9===a){t=e.ioReader.getPos()-BigInt(1);const a=await e.ioReader.readUint24();if(a>10485760){await e.ioReader.seek(t+BigInt(1));continue}if(await e.ioReader.skip(4),0!==await e.ioReader.readUint24()){await e.ioReader.seek(t+BigInt(1));continue}await e.ioReader.skip(a);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32()))){await e.ioReader.seek(t+BigInt(1)),t=E.Dh;continue}{let a=0;for(;a<=3;){const t=e.ioReader.getPos(),i=await e.ioReader.readUint8();if(8!==i&&9!==i&&18!==i)break;{const i=await e.ioReader.readUint24();await e.ioReader.skip(7+i);if(e.ioReader.getPos()-t!==BigInt(Math.floor(await e.ioReader.readUint32())))break;a++}}if(!(a<3))break;await e.ioReader.seek(t+BigInt(1)),t=E.Dh}}}catch(e){break}t!==E.Dh&&await e.ioReader.seek(t)}async seek(e,t,a,i){const r=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(a),4&i||await this.syncTag(e),r;var n,o;if(t&&t.sampleIndexes.length){let i=$.El(t.sampleIndexes,(e=>e.pts>a?-1:1));if(i>0&&(0,N.k)(a-t.sampleIndexes[i-1].pts,t.timeBase,E.i0)<BigInt(1e4))return I.Yz(`seek in sampleIndexes, found index: ${i}, pts: ${t.sampleIndexes[i-1].pts}, pos: ${t.sampleIndexes[i-1].pos}`,Y,1053),await e.ioReader.seek(t.sampleIndexes[i-1].pos),r}if(this.script.canSeek()){const{pos:i,dts:n}=this.script.dts2Position(Number((0,N.k)(a,t.timeBase,E.i0)/BigInt(1e3)));if(i>0){I.Yz(`seek in filepositions, found pts: ${n}, pos: ${i}`,Y,1062),await e.ioReader.seek(BigInt(Math.floor(i)));const t=await e.ioReader.peekUint8();return 8!==t&&9!==t&&18!==t&&await this.syncTag(e),r}}return I.Yz("not found any keyframe index, try to seek in bytes",Y,1072),(0,F.A)(e,t,a,this.firstTagPos,l()(n=this.readAVPacket).call(n,this),l()(o=this.syncTag).call(o,this))}getAnalyzeStreamsCount(){let e=0;return(this.header.hasAudio||(0,X.A)(this.script.onMetaData.audiocodecid))&&e++,(this.header.hasVideo||(0,X.A)(this.script.onMetaData.videocodecid))&&e++,e}}},85947:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(49859);class r{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},58121:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(49859),r=a(52730),n=a.n(r);class o{constructor(){(0,i.A)(this,"signature",void 0),(0,i.A)(this,"version",void 0),(0,i.A)(this,"flags",void 0),(0,i.A)(this,"dataOffset",void 0),(0,i.A)(this,"hasVideo",void 0),(0,i.A)(this,"hasAudio",void 0),this.signature="FLV",this.version=1,this.flags=0,this.dataOffset=9,this.hasAudio=!1,this.hasVideo=!1}async read(e){this.signature=await e.readString(3),this.version=await e.readUint8(),this.flags=await e.readUint8(),this.dataOffset=await e.readUint32(),this.hasAudio=!!(4&n()(this)),this.hasVideo=!!(1&n()(this))}write(e){this.flags=0,this.hasAudio&&(this.flags|=4),this.hasVideo&&(this.flags|=1),e.writeString(this.signature),e.writeUint8(this.version),e.writeUint8(n()(this)),e.writeUint32(this.dataOffset)}}},68243:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(49859),r=a(18979),n=a.n(r),o=a(35336),s=a(92647),d=a(4624),c=a(94889),h=a(9705),l=a(73040);class f{constructor(){(0,i.A)(this,"onMetaData",void 0),this.onMetaData={canSeekToEnd:!1}}async read(e,t){const a=e.getPos(),i=a+BigInt(Math.floor(t)),r=await(0,l.$x)(e,i),n=await(0,l.$x)(e,i);this[r]=n,i>e.getPos()&&await e.skip(Number(BigInt.asIntN(32,i-e.getPos())));const o=Number(e.getPos()-a),s=await e.readUint32();return o+11!==s?(d.R8(`script size not match, size: ${o+11}, previousTagSize: ${s}`,"src/avformat/formats/flv/FlvScriptTag.ts",63),h.LR):0}computeSize(){const e=[],t=new o.A;return t.onFlush=t=>(e.push(n()(t).call(t)),0),(0,l.bD)(t,"onMetaData"),(0,l.bD)(t,this.onMetaData),t.flush(),(0,s.A)(Uint8Array,e).length}write(e){if(this.onMetaData){const t=[],a=new o.A;a.onFlush=e=>(t.push(n()(e).call(e)),0),(0,l.bD)(a,"onMetaData"),(0,l.bD)(a,this.onMetaData),a.flush();const i=(0,s.A)(Uint8Array,t);c.M5(e,18,BigInt(0),void 0,i)}}dts2Position(e){if(this.canSeek()){let t=-1;const a=this.onMetaData.keyframes.times,i=this.onMetaData.keyframes.filepositions;let r;for(r=0;r<a.length;r++){if(a[r]===e){t=r;break}if(a[r]>e){t=Math.max(r-1,0);break}}return r&&r===a.length&&(t=a.length-1),{pos:i[t],dts:a[t]}}return{pos:-1,dts:-1}}position2DTS(e){if(this.canSeek()){let a=-1;const i=this.onMetaData.keyframes.times,r=this.onMetaData.keyframes.filepositions;let n=0;for(n=0;n<r.length;n++)if(r[n]>e){a=n;break}var t;return n===r.length?null!==(t=this.onMetaData.duration)&&void 0!==t?t:i[i.length-1]:i[a]}return-1}canSeek(){return!!(this.onMetaData.keyframes&&this.onMetaData.keyframes.filepositions&&this.onMetaData.keyframes.filepositions.length)}}},35028:(e,t,a)=>{a.d(t,{FJ:()=>i,U5:()=>r});const i={10:86018,2:86017,11:86051,1:69645,4:86049,5:86049,6:86049,7:65543,8:65542},r={7:27,12:173,9:12,2:4,3:86,4:92,5:106,6:131}},94889:(e,t,a)=>{a.d(t,{M5:()=>n}),a(35028),a(44328),a(77231),a(65977);var i=a(67672);function r(e,t,a){const i=e.getPos(),r=e.getPointer(),n=i-BigInt(Math.floor(r));t<i&&t>=n?(e.seekInline(r+Number(t-i)),e.writeUint24(a),e.seekInline(r)):(e.seek(t),e.writeUint24(a),e.seek(i))}function n(e,t,a,n,o,s){e.flush(),e.writeUint8(t);const d=e.getPos();e.writeUint24(0),e.writeUint24(Number(a&BigInt(16777215))),e.writeUint8(Number(a>>BigInt(24)&BigInt(255))),e.writeUint24(0);const c=e.getPos();n&&n(e),i.Pc(o)?(o(e),r(e,d,Number(e.getPos()-c))):o&&(r(e,d,o.length+Number(e.getPos()-c)),e.writeBuffer(o));const h=Number(e.getPos()-d)+1;s&&s(h),e.writeUint32(h)}},2187:(e,t,a)=>{a.d(t,{d:()=>o});var i=a(72739),r=a(44328),n=a(77231);function o(e,t,a){let o=BigInt(0);return i.__(e,(e=>{o+=e.codecpar.bitrate*(0,r.k)(t,a,n.i0)/BigInt(8e3)})),o}},65977:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(4624);const r="src/avformat/function/mktag.ts";function n(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,r,30);let t=0;for(let a=0;a<4;a++)t=t<<8|e.charCodeAt(a);return t}},52071:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(52730),r=a.n(i),n=a(63939),o=(a(9599),a(77231)),s=a(44328),d=a(2187),c=a(71517),h=a(9705),l=a(4624);const f="src/avformat/function/seekInBytes.ts";async function p(e,t,a,i,p,u){const g=e.ioReader.getPos(),w=await e.ioReader.fileSize();let m=o.Dh,I=a;t.startTime!==o.Dh?I-=t.startTime:I-=t.firstDTS;const U=(0,s.k)(a,t.timeBase,o.i0);if(U<BigInt(1e4))return l.Yz(`seek pts is earlier then 10s, seek to first packet pos(${i}) directly`,f,64),await e.ioReader.seek(i),g;let k=(0,d.d)(e.streams,I,t.timeBase);const M=w-(0,d.d)(e.streams,BigInt(1e4),o.i0),R=(0,d.d)(e.streams,BigInt(1e4),o.i0);if(k>M&&(k=M),k<i)return await e.ioReader.seek(i),g;const v=(0,c._5)();let b=w,B=BigInt(0);e:for(;b-B<R&&(k=B),await e.ioReader.seek(k),await u(e),!(8&r()(e.ioReader));){let a=await p(e,v),i=n.f[17](v+56);if(!(a>=0)){m=o.Dh;break}{const r=(0,s.Mr)(n.f[17](v+8),v+72,o.i0);let d=r-U;if(l.Yz(`try to seek to pos: ${k}, got packet pts: ${n.f[17](v+8)}(${r}ms), diff: ${d}ms`,f,101),d<=BigInt(0)&&-d<BigInt(1e4)||b-B<R){const r=[i];for(;d<=0;){if(n.f[15](v+32)===t.index&&1&n.f[15](v+36)&&r.push(i),(0,c.Up)(v),a=await p(e,v),a<0){if(-1048576===a)break;if(-1048575===a)continue;m=o.Dh;break e}i=n.f[17](v+56),d=(0,s.Mr)(n.f[17](v+8),v+72,o.i0)-U}m=r.pop();break}d>BigInt(0)?(b=k,k=B+b>>BigInt(1)):(B=k,k=B+b>>BigInt(1))}if(8&r()(e.ioReader))break}return(0,c.Qe)(v),m!==o.Dh?(l.Yz(`finally seek to pos ${m}`,f,156),await e.ioReader.seek(m),await u(e),g):(await e.ioReader.seek(g),8&r()(e.ioReader)?BigInt(h.LT):BigInt(h.E$))}},95832:(e,t,a)=>{a.d(t,{Bq:()=>l,En:()=>d,Ij:()=>h,XC:()=>c,f7:()=>f,hY:()=>s,uF:()=>n});var i=a(77231),r=a(37246);const n={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},o={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},s=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],d=[i.N_,1,2,3,4,5,6,7];function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:r,channels:n}=function(e){let t=i.N_,a=i.N_,r=i.N_;return e.length>=2&&(t=e[0]>>3&31,a=s[(7&e[0])<<1|e[1]>>7],r=d[e[1]>>3&15]),{profile:t,sampleRate:a,channels:r}}(t);e.codecpar.profile=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function h(e){const t=o[e.sampleRate],a=e.chLayout.nbChannels,r=e.profile===i.N_?2:e.profile,n=new Uint8Array(2);return n[0]=(31&r)<<3|(14&t)>>1,n[1]=(1&t)<<7|(15&a)<<3,n}function l(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],i=(192&e[2])>>>6,r=(60&e[2])>>>2,n=(1&e[2])<<2|(192&e[3])>>>6,o=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,c=3&e[6];let h=1===a?7:9,l=o-h;return{syncWord:t,profile:i+1,sampleRate:s[r],channels:d[n],aacFrameLength:o,numberOfRawDataBlocksInFrame:c,headerLength:h,framePayloadLength:l}}function f(e,t){function a(){const e=t.readU(2);let a=0;for(let i=0;i<=e;i++)a<<=8,a|=t.readU(8);return a}t||(t=new r.A).appendBuffer(e);const i=t.getPointer(),n={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},o=t.readU(11);if(695!==o)return-1;n.syncWord=o,n.muxLengthBytes=t.readU(13);const c=1===t.readU1();if(n.useSameStreamMux=c,!c){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?a():0;const r=t.readU(5);i-=5;const o=t.readU(4);i-=4;const c=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),n.profile=r+1,n.sampleRate=s[o],n.channels=d[c]}let h=0;for(;;){const e=t.readU(8);if(h+=e,255!==e)break}return n.framePayloadLength=h,n.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),n}},87518:(e,t,a)=>{a.d(t,{R:()=>p,j:()=>r});var i=a(37246);const r=[3,4,3,7,259,263,1539,1543],n=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],o=[4,5,6,5],s=[4,6,7,6],d=[48e3,44100,32e3,0],c=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],h=[2,1,2,3,3,4,4,5],l=[1,2,3,6],f=7;function p(e){const t=new i.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=o[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=s[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=d[a.srCode]>>a.srShift,a.bitrate=1e3*c[a.ac3BitrateCode]>>a.srShift,a.channels=h[a.channelMode]+a.lfeOn,a.frameSize=2*n[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<f)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=d[e]/2,a.srShift=1}else a.numBlocks=l[t.readU(2)],a.sampleRate=d[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=h[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(r[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},21477:(e,t,a)=>{a.d(t,{Ui:()=>o,XC:()=>n,zk:()=>r}),a(71426);var i=a(37246);a(11573),a(83314),a(97317);const r={0:"Main",1:"High",2:"Professional"};function n(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const a=o(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function o(e){const t=new i.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const a=t.readU(3),r=t.readU(5),n=t.readU1();let o=t.readU1()?10:8;return t.readU1()&&(o=12),{profile:a,level:r,tier:n,bitDepth:o,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}},14769:(e,t,a)=>{a.d(t,{DK:()=>s,XC:()=>c,Xr:()=>d,jA:()=>n,ob:()=>r,oe:()=>o});var i=a(31865);const r=34,n=8,o=[0,8,12,0,16,20,24,32],s=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],d=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===r){const{bitsPerRawSample:a,sampleRate:r,channels:n}=function(e){const t=new i.A(e);t.skip(10);const a=t.readUint24();return{sampleRate:a>>4,channels:1+((15&a)>>>1),bitsPerRawSample:1+((1&a)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=a,e.codecpar.sampleRate=r,e.codecpar.chLayout.nbChannels=n}}},64093:(e,t,a)=>{a.d(t,{Au:()=>I,He:()=>U,XC:()=>k,Y2:()=>g,hG:()=>w,oz:()=>m});var i=a(77231);const r=[44100,48e3,32e3,0],n=[22050,24e3,16e3,0],o=[11025,12e3,8e3,0],s=[0,1152,1152,384],d=[0,576,1152,384],c=[0,576,1152,384],h=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],l=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],f=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],p=[0,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],u=[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1];function g(e,t){switch(e){case 0:return o[t];case 2:return n[t];case 3:return r[t]}return i.N_}function w(e,t){switch(e){case 0:return c[t];case 2:return d[t];case 3:return s[t]}return i.N_}function m(e,t,a){switch(t){case 1:switch(e){case 0:case 2:return u[a];case 3:return f[a]}break;case 2:switch(e){case 0:case 2:return u[a];case 3:return l[a]}case 3:switch(e){case 0:case 2:return p[a];case 3:return h[a]}}return i.N_}function I(e){switch(e){case 1:return 34;case 2:return 33;case 3:return 32}return i.N_}const U={32:"Layer1",33:"Layer2",34:"Layer3"};function k(e,t){if(t&&t.length>=4){const a=t[1]>>>3&3,i=(6&t[1])>>1,r=(12&t[2])>>>2,n=3&~(t[3]>>>6)?2:1,o=I(i),s=g(a,r);e.codecpar.profile=o,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=n}}},22576:(e,t,a)=>{a.d(t,{Ij:()=>c,XC:()=>d,kt:()=>s});var i=a(31865),r=a(729),n=a(44328);const o=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function s(e){let t=0,a=0,i=0;if(e.length<1)return 0;switch(t=e[0],a=o[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*a}function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const a=new i.A(t,!1);a.skip(9),e.codecpar.chLayout.nbChannels=a.readUint8(),e.codecpar.initialPadding=a.readUint16(),e.codecpar.sampleRate=a.readUint32(),e.codecpar.seekPreroll=Number((0,n.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function c(e){const t=new Uint8Array(19),a=new r.A(t,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(e.chLayout.nbChannels),a.writeUint16(e.initialPadding),a.writeUint32(e.sampleRate),t}},97077:(e,t,a)=>{a.d(t,{Ui:()=>n,XC:()=>r});var i=a(37246);function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=n(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function n(e){const t=new i.A(e.length);return t.appendBuffer(e.subarray(4)),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},82014:(e,t,a)=>{a.d(t,{Ui:()=>o,XC:()=>n,wN:()=>r}),a(9599);var i=a(37246);a(77231),a(97317),a(44328),a(729);const r={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function n(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=o(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function o(e){const t=new i.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},73040:(e,t,a)=>{a.d(t,{$x:()=>s,bD:()=>d});var i=a(67672),r=a(72739),n=a(95335);async function o(e,t){return{key:await e.readString(await e.readUint16()),value:await s(e,t)}}async function s(e,t){let a;switch(await e.readUint8()){case 0:a=await e.readDouble();break;case 1:a=!!await e.readUint8();break;case 2:a=await e.readString(await e.readUint16());break;case 3:for(a={};e.getPos()<t;){const{key:i,value:r}=await o(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 8:for(a={},await e.skip(4);e.getPos()<t;){const{key:i,value:r}=await o(e,t);if(a[i]=r,9==(16777215&await e.peekUint24())){await e.skip(3);break}}break;case 9:case 5:a=null;break;case 10:a=[];const i=await e.readUint32();for(let r=0;r<i;r++)a.push(await s(e,t));break;case 11:const r=await e.readDouble(),n=await e.readInt16();a=new Date(r+60*n*1e3);break;case 12:a=await e.readString(await e.readUint32())}return a}function d(e,t){i.ai(t)?(e.writeUint8(0),e.writeDouble(t)):i.o(t)?(e.writeUint8(0),e.writeDouble(Number(t))):i.zM(t)?(e.writeUint8(1),e.writeUint8(t?1:0)):i.Yj(t)?t.length>=65536?(e.writeUint8(12),e.writeUint32(t.length),e.writeString(t)):(e.writeUint8(2),e.writeUint16(t.length),e.writeString(t)):i.YO(t)?(e.writeUint8(10),e.writeUint32(t.length),r.__(t,(t=>{d(e,t)}))):i.Ik(t)?(e.writeUint8(3),n.__(t,((t,a)=>{e.writeUint16(a.length),e.writeString(a),d(e,t)})),e.writeUint24(9)):t instanceof Date?(e.writeUint8(11),e.writeDouble(t.getTime()),e.writeInt16(0)):null==t&&e.writeUint8(5)}},11573:(e,t,a)=>{a(54810)},35336:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(49859),r=a(50011);class n{constructor(e=1048576,t=!0,a){if((0,i.A)(this,"data",void 0),(0,i.A)(this,"buffer",void 0),(0,i.A)(this,"pointer",void 0),(0,i.A)(this,"pos",void 0),(0,i.A)(this,"size",void 0),(0,i.A)(this,"littleEndian",void 0),(0,i.A)(this,"error",void 0),(0,i.A)(this,"onFlush",void 0),(0,i.A)(this,"onSeek",void 0),this.pointer=0,this.pos=BigInt(0),this.size=e,this.littleEndian=!t,this.error=0,a&&a.view)this.size=a.length,this.buffer=a,this.data=a.view;else if(a&&!a.byteOffset)this.size=a.length,this.buffer=a,this.data=new DataView(this.buffer.buffer);else{if(a)throw new Error("not support subarray of ArrayBuffer");this.buffer=new Uint8Array(this.size),this.data=new DataView(this.buffer.buffer)}}writeUint8(e){this.remainingLength()<1&&this.flush(),this.data.setUint8(this.pointer,e),this.pointer++,this.pos++}writeUint16(e){this.remainingLength()<2&&this.flush(),this.data.setUint16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeUint24(e){this.remainingLength()<3&&this.flush();const t=(16711680&e)>>16,a=(65280&e)>>8,i=255&e;this.littleEndian?(this.writeUint8(i),this.writeUint8(a),this.writeUint8(t)):(this.writeUint8(t),this.writeUint8(a),this.writeUint8(i))}writeUint32(e){this.remainingLength()<4&&this.flush(),this.data.setUint32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeUint64(e){this.remainingLength()<8&&this.flush(),this.data.setBigUint64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeInt8(e){this.remainingLength()<1&&this.flush(),this.data.setInt8(this.pointer,e),this.pointer++,this.pos++}writeInt16(e){this.remainingLength()<2&&this.flush(),this.data.setInt16(this.pointer,e,this.littleEndian),this.pointer+=2,this.pos+=BigInt(2)}writeInt24(e){this.writeUint24(e<0?e+16777216:e)}writeInt32(e){this.remainingLength()<4&&this.flush(),this.data.setInt32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeInt64(e){this.remainingLength()<8&&this.flush(),this.data.setBigInt64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}writeFloat(e){this.remainingLength()<4&&this.flush(),this.data.setFloat32(this.pointer,e,this.littleEndian),this.pointer+=4,this.pos+=BigInt(4)}writeDouble(e){this.remainingLength()<8&&this.flush(),this.data.setFloat64(this.pointer,e,this.littleEndian),this.pointer+=8,this.pos+=BigInt(8)}getPointer(){return this.pointer}getPos(){return this.pos}remainingLength(){return this.size-this.pointer}writeBuffer(e){if(!e.length)return;let t=e.length;if(this.remainingLength()<t){let a=0;for(;t>0;){this.flush();const i=Math.min(this.size,t);this.buffer.set(e.subarray(a,a+i),this.pointer),this.pointer+=i,this.pos+=BigInt(i),a+=i,t-=i}}else this.buffer.set(e,this.pointer),this.pointer+=t,this.pos+=BigInt(t)}writeString(e){const t=r.encode(e);return this.writeBuffer(t),t.length}flush(){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const e=this.onFlush(this.buffer.subarray(0,this.pointer));if(0!==e)throw this.error=e,Error("IOWriter error, flush failed")}this.pointer=0}flushToPos(e){if(!this.onFlush)throw this.error=-1048574,Error("IOWriter error, flush failed because of no flush callback");if(this.pointer){const t=this.onFlush(this.buffer.subarray(0,this.pointer),e);if(0!==t)throw this.error=t,Error("IOWriter error, flush failed")}this.pointer=0}seek(e){if(!this.onSeek)throw this.error=-1048574,Error("IOWriter error, seek failed because of no seek callback");this.flush();const t=this.onSeek(e);if(0!==t)throw this.error=t,Error("IOWriter error, seek failed");this.pos=e}seekInline(e){const t=this.pointer;this.pointer=Math.max(0,Math.min(this.size,e)),this.pos+=BigInt(this.pointer-t)}skip(e){const t=this.pointer;this.pointer=Math.min(this.size,this.pointer+e),this.pos+=BigInt(this.pointer-t)}back(e){const t=this.pointer;this.pointer=Math.max(0,this.pointer-e),this.pos+=BigInt(this.pointer-t)}getBuffer(){return this.buffer.subarray(0,this.pointer)}setEndian(e){this.littleEndian=!e}reset(){this.pointer=0,this.pos=BigInt(0),this.error=0}getBufferSize(){return this.size}}}}]);