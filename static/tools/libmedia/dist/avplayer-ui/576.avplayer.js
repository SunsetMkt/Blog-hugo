(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[576],{41576:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>U});var s=i(49859),n=i(74707),a=i.n(n),r=i(61240),o=i.n(r),d=i(31721),l=i.n(d),u=i(64007),c=i.n(u),m=i(86226),h=i.n(m),g=i(48079),p=i.n(g),f=i(11393),v=i.n(f),S=i(96319),y=i.n(S),L=i(71426),R=i.n(L),b=i(13724),x=i(82800),P=i(95335),A=i(4624),w=i(78417),I=i(77580),T=i(86932),D=i(9705);const B="src/avnetwork/ioLoader/DashIOLoader.ts";class U extends x.A{constructor(...e){super(...e),(0,s.A)(this,"info",void 0),(0,s.A)(this,"mediaPlayList",void 0),(0,s.A)(this,"fetchMediaPlayListPromise",void 0),(0,s.A)(this,"minBuffer",void 0),(0,s.A)(this,"audioResource",void 0),(0,s.A)(this,"videoResource",void 0),(0,s.A)(this,"subtitleResource",void 0),(0,s.A)(this,"aborted",void 0),(0,s.A)(this,"signal",void 0)}createResource(e){return{type:e,fetchedMap:new(a()),fetchedHistoryListMax:100,fetchedHistoryList:[],loader:null,segmentIndex:0,currentUri:"",selectedIndex:0,segments:[],initSegmentPadding:"",initedSegment:"",sleep:null,lastPendingSegmentFetchTs:0,lastPendingSegmentDuration:0}}addHistory(e,t,i){e.fetchedMap.clear(),e.fetchedHistoryList.length=0;for(let s=0;s<i;s++)e.fetchedMap.set(t[s].url,!0),e.fetchedHistoryList.push(t[s].url);for(;e.fetchedHistoryList.length>=e.fetchedHistoryListMax;)e.fetchedMap.delete(e.fetchedHistoryList.shift())}async fetchMediaPlayList(e){var t,i,s;if(!e){if(this.fetchMediaPlayListPromise)return;this.fetchMediaPlayListPromise=new(o())((t=>{e=t}))}const n={method:"GET",headers:{},mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};null!==(t=this.info.httpOptions)&&void 0!==t&&t.headers&&P.__(this.info.httpOptions.headers,((e,t)=>{n.headers[t]=e})),null!==(i=this.info.httpOptions)&&void 0!==i&&i.credentials&&(n.credentials=this.info.httpOptions.credentials),null!==(s=this.info.httpOptions)&&void 0!==s&&s.referrerPolicy&&(n.referrerPolicy=this.info.httpOptions.referrerPolicy);try{var a;"function"==typeof AbortController&&(this.signal=new AbortController);const t=await fetch(this.info.url,{...n,signal:null===(a=this.signal)||void 0===a?void 0:a.signal});this.signal=null;const i=await t.text();this.mediaPlayList=(0,w.A)(i,this.info.url),this.minBuffer=this.mediaPlayList.minBufferTime,"vod"===this.mediaPlayList.type?this.options.isLive=!1:this.options.isLive=!0;const s=(e,t,i)=>{let s=0,n=0;for(let e=t.length-2;e>=0;e--)if(!0!==t[e].pending&&(n+=t[e].segmentDuration,n>=i)){s=e;break}e.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,e.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration,e.fetchedHistoryListMax=Math.max(e.fetchedHistoryListMax,t.length+1),this.addHistory(e,t,s)};if(this.mediaPlayList.mediaList.audio.length){if(this.options.preferAudioCodec||this.options.preferAudioLang){var r,d;let e=!1,t=!1,i=l()(r=this.mediaPlayList.mediaList.audio).call(r,(e=>{var t;return e.codecs&&c()(t=e.codecs).call(t,this.options.preferAudioCodec)>=0}));h()(d=this.mediaPlayList.mediaList.audio).call(d,((s,n)=>{var a,r;this.options.preferAudioCodec&&i&&s.codecs&&-1===c()(a=s.codecs).call(a,this.options.preferAudioCodec)||(e||(this.audioResource.selectedIndex=n,e=!0),s.lang&&this.options.preferAudioLang&&c()(r=s.lang).call(r,this.options.preferAudioLang)>=0&&!t&&(this.audioResource.selectedIndex=n,s.lang===this.options.preferAudioLang&&(t=!0)))}))}const e=this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex];var u,m,g;e.file?this.audioResource.segments=[{url:e.file}]:this.options.isLive&&this.audioResource.initedSegment===e.initSegment?(this.audioResource.segments=p()(u=e.mediaSegments).call(u,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.audioResource.lastPendingSegmentFetchTs=this.mediaPlayList.timestamp,this.audioResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.audioResource,e.mediaSegments,this.minBuffer),this.audioResource.segments=v()(m=[{url:e.initSegment}]).call(m,p()(g=e.mediaSegments).call(g,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.audioResource.initedSegment=e.initSegment)}if(this.mediaPlayList.mediaList.video.length){if(this.options.preferResolution||this.options.preferVideoCodec){var f,S;let e=1,t=1;if(this.options.preferResolution){const i=this.options.preferResolution.split("*");e=+i[0]||1,t=+i[1]||1}let i=!1,s=1/0,n=l()(f=this.mediaPlayList.mediaList.video).call(f,(e=>{var t;return e.codecs&&c()(t=e.codecs).call(t,this.options.preferVideoCodec)>=0}));h()(S=this.mediaPlayList.mediaList.video).call(S,((a,r)=>{var o;if(!(this.options.preferVideoCodec&&n&&a.codecs&&-1===c()(o=a.codecs).call(o,this.options.preferVideoCodec))&&(i||(this.videoResource.selectedIndex=r,i=!0),a.width&&a.height&&this.options.preferResolution)){const i=1===e?1:a.width,n=1===t?1:a.height;Math.abs(i*n-e*t)<s&&(s=Math.abs(i*n-e*t),this.videoResource.selectedIndex=r)}}))}const e=this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex];var y,L,R;e.file?this.videoResource.segments=[{url:e.file}]:this.options.isLive&&this.videoResource.initedSegment===e.initSegment?(this.videoResource.segments=p()(y=e.mediaSegments).call(y,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.videoResource.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,this.videoResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.videoResource,e.mediaSegments,this.minBuffer),this.videoResource.segments=v()(L=[{url:e.initSegment}]).call(L,p()(R=e.mediaSegments).call(R,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.videoResource.initedSegment=e.initSegment)}if(this.mediaPlayList.mediaList.subtitle.length){if(this.options.preferSubtitleCodec||this.options.preferSubtitleLang){var x,I;let e=!1,t=!1,i=l()(x=this.mediaPlayList.mediaList.subtitle).call(x,(e=>{var t;return e.codecs&&c()(t=e.codecs).call(t,this.options.preferSubtitleCodec)>=0}));h()(I=this.mediaPlayList.mediaList.subtitle).call(I,((s,n)=>{var a,r;this.options.preferSubtitleCodec&&i&&s.codecs&&-1===c()(a=s.codecs).call(a,this.options.preferSubtitleCodec)||(e||(this.subtitleResource.selectedIndex=n,e=!0),s.lang&&this.options.preferSubtitleLang&&c()(r=s.lang).call(r,this.options.preferSubtitleLang)>=0&&!t&&(this.subtitleResource.selectedIndex=n,s.lang===this.options.preferSubtitleLang&&(t=!0)))}))}const e=this.mediaPlayList.mediaList.subtitle[this.subtitleResource.selectedIndex];var T,D,U;e.file?this.subtitleResource.segments=[{url:e.file}]:this.options.isLive&&this.subtitleResource.initedSegment===e.initSegment?(this.subtitleResource.segments=p()(T=e.mediaSegments).call(T,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration}))),this.subtitleResource.lastPendingSegmentFetchTs=this.mediaPlayList.maxSegmentDuration,this.subtitleResource.lastPendingSegmentDuration=this.mediaPlayList.maxSegmentDuration):(this.options.isLive&&s(this.subtitleResource,e.mediaSegments,this.minBuffer),this.subtitleResource.segments=v()(D=[{url:e.initSegment}]).call(D,p()(U=e.mediaSegments).call(U,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.subtitleResource.initedSegment=e.initSegment)}return e(),this.fetchMediaPlayListPromise=null,this.status=2,this.retryCount=0,this.mediaPlayList}catch(t){if(this.aborted)return this.status=3,void e();if(this.retryCount<this.options.retryCount)return this.retryCount++,A.z3(`failed fetch mpd file ${t}, retry(${this.retryCount}/3)`,B,400),await new b.A(2===this.status?this.options.retryInterval:5),this.fetchMediaPlayList(e);this.status=3,e(),A.h2(`DashLoader: exception, fetch slice error, error: ${t.message}`,B,408)}}async open(e){return 2===this.status?0:0!==this.status?D.lh:(this.info=e,this.videoResource=this.createResource(0),this.audioResource=this.createResource(1),this.subtitleResource=this.createResource(3),this.status=1,this.retryCount=0,this.aborted=!1,await this.fetchMediaPlayList(),0)}async readResource(e,t){let i=0;if(t.loader){if(i=await t.loader.read(e),-1048576!==i||this.aborted)return i;if(this.options.isLive)t.fetchedMap.set(t.currentUri,!0),t.fetchedHistoryList.length===t.fetchedHistoryListMax&&t.fetchedMap.delete(t.fetchedHistoryList.shift()),t.fetchedHistoryList.push(t.currentUri);else if(t.segmentIndex++,t.segmentIndex>=t.segments.length)return-1048576;t.loader=null}if(this.options.isLive){var s;const i=y()(s=t.segments).call(s,(e=>!t.fetchedMap.get(e.url)));if(!i.length){if(this.mediaPlayList.isEnd)return-1048576;const i=(this.mediaPlayList.duration||this.mediaPlayList.minimumUpdatePeriod)-((0,T.A)()-this.mediaPlayList.timestamp)/1e3;if(i>0&&(t.sleep=new b.A(i),await t.sleep,t.sleep=null,this.aborted))return-1048576;if(this.fetchMediaPlayListPromise){if(await this.fetchMediaPlayListPromise,3===this.status||this.aborted)return-1048576}else if(await this.fetchMediaPlayList(),this.aborted)return-1048576;return this.readResource(e,t)}if(t.currentUri=i[0].url,this.options.isLive&&i[0].pending){if(t.lastPendingSegmentFetchTs){const e=t.lastPendingSegmentDuration-((0,T.A)()-t.lastPendingSegmentFetchTs)/1e3;if(e>0&&(t.sleep=new b.A(e),await t.sleep,t.sleep=null,this.aborted))return-1048576}t.lastPendingSegmentFetchTs=(0,T.A)(),t.lastPendingSegmentDuration=i[0].duration||this.mediaPlayList.maxSegmentDuration}return t.loader=new I.A(P.X$({},this.options,{disableSegment:!0,loop:!1,enableBandwidthReader:0===t.type})),await t.loader.open(P.X$({},this.info,{url:t.currentUri}),{from:0,to:-1}),t.loader.read(e)}return t.loader=new I.A(P.X$({},this.options,{disableSegment:!0,loop:!1,enableBandwidthReader:0===t.type})),t.initSegmentPadding?(await t.loader.open(P.X$({},this.info,{url:t.initSegmentPadding}),{from:0,to:-1}),t.initSegmentPadding=null,t.segmentIndex--):await t.loader.open(P.X$({},this.info,{url:t.segments[t.segmentIndex].url}),{from:0,to:-1}),t.loader.read(e)}async read(e,t){return 1===t.mediaType?this.readResource(e,this.audioResource):0===t.mediaType?this.readResource(e,this.videoResource):3===t.mediaType?this.readResource(e,this.subtitleResource):D.UY}async seekResource(e,t){let i="";t.loader&&(i=t.loader.getUrl(),await t.loader.abort(),t.loader=null);let s=Number(BigInt.asIntN(32,e));if(t.segments){let e=0;const n=1===t.type?this.mediaPlayList.mediaList.audio:0===t.type?this.mediaPlayList.mediaList.video:this.mediaPlayList.mediaList.subtitle,a=n[t.selectedIndex].mediaSegments;if(null!=a&&a.length){e=-1;for(let t=0;t<a.length;t++)if(s>=1e3*a[t].start&&s<1e3*a[t].end){e=t;break}-1===e&&(e=a.length-1)}t.segmentIndex=e+(n[t.selectedIndex].initSegment?1:0);let r="";0===t.type?r=this.mediaPlayList.mediaList.video[t.selectedIndex].initSegment:1===t.type?r=this.mediaPlayList.mediaList.audio[t.selectedIndex].initSegment:3===t.type&&(r=this.mediaPlayList.mediaList.subtitle[t.selectedIndex].initSegment),r&&r===i&&(t.initSegmentPadding=r)}}async seek(e,t){return 1===t.mediaType&&this.audioResource.loader&&await this.seekResource(e,this.audioResource),0===t.mediaType&&this.videoResource.loader&&await this.seekResource(e,this.videoResource),3===t.mediaType&&this.subtitleResource.loader&&await this.seekResource(e,this.subtitleResource),4===this.status&&(this.status=2),this.aborted=!1,0}async size(){return BigInt(0)}abortSleep(){this.aborted=!0,this.videoResource.loader&&this.videoResource.loader.abortSleep(),this.videoResource.sleep&&(this.videoResource.sleep.stop(),this.videoResource.sleep=null),this.audioResource.loader&&this.audioResource.loader.abortSleep(),this.audioResource.sleep&&(this.audioResource.sleep.stop(),this.audioResource.sleep=null),this.subtitleResource.loader&&this.subtitleResource.loader.abortSleep(),this.subtitleResource.sleep&&(this.subtitleResource.sleep.stop(),this.subtitleResource.sleep=null)}async abort(){this.abortSleep(),this.signal&&this.signal.abort(),this.videoResource.loader&&(await this.videoResource.loader.abort(),this.videoResource.loader=null),this.audioResource.loader&&(await this.audioResource.loader.abort(),this.audioResource.loader=null),this.subtitleResource.loader&&(await this.subtitleResource.loader.abort(),this.subtitleResource.loader=null)}async stop(){await this.abort(),this.status=0}getDuration(){return this.mediaPlayList.duration}hasVideo(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.video.length)>0}hasAudio(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.audio.length)>0}hasSubtitle(){var e;return(null===(e=this.mediaPlayList)||void 0===e?void 0:e.mediaList.subtitle.length)>0}getVideoList(){var e;return this.hasVideo()?{list:p()(e=this.mediaPlayList.mediaList.video).call(e,(e=>({width:e.width,height:e.height,frameRate:e.frameRate,codec:e.codecs,bandwidth:e.bandwidth}))),selectedIndex:this.videoResource.selectedIndex}:{list:[],selectedIndex:0}}getAudioList(){var e;return this.hasAudio()?{list:p()(e=this.mediaPlayList.mediaList.audio).call(e,(e=>({lang:e.lang,codec:e.codecs,bandwidth:e.bandwidth}))),selectedIndex:this.audioResource.selectedIndex}:{list:[],selectedIndex:0}}getSubtitleList(){var e;return this.hasSubtitle()?{list:p()(e=this.mediaPlayList.mediaList.subtitle).call(e,(e=>({lang:e.lang,codec:e.codecs}))),selectedIndex:this.subtitleResource.selectedIndex}:{list:[],selectedIndex:0}}selectVideo(e){if(e!==this.videoResource.selectedIndex&&this.hasVideo()&&e>=0&&e<this.mediaPlayList.mediaList.video.length){this.videoResource.selectedIndex=e;const n=this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex];if(n.file)this.videoResource.segments=[{url:n.file}];else{var t,i;if(this.options.isLive){var s;let e=this.videoResource.segmentIndex;R()(s=this.videoResource.segments).call(s,((t,i)=>{if(t.url===this.videoResource.currentUri)return e=i,!0})),this.addHistory(this.videoResource,n.mediaSegments,e+1)}this.videoResource.segments=v()(t=[{url:n.initSegment}]).call(t,p()(i=n.mediaSegments).call(i,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.videoResource.initSegmentPadding=n.initSegment}if(n.mediaSegments&&this.videoResource.segmentIndex-(n.initSegment?1:0)<n.mediaSegments.length-1)return n.mediaSegments[this.videoResource.segmentIndex+(n.initSegment?0:1)].start}return-1}selectAudio(e){if(e!==this.audioResource.selectedIndex&&this.hasAudio()&&e>=0&&e<this.mediaPlayList.mediaList.audio.length){this.audioResource.selectedIndex=e;const n=this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex];if(n.file)this.audioResource.segments=[{url:n.file}];else{var t,i;if(this.options.isLive){var s;let e=this.audioResource.segmentIndex;R()(s=this.audioResource.segments).call(s,((t,i)=>{if(t.url===this.audioResource.currentUri)return e=i,!0})),this.addHistory(this.audioResource,n.mediaSegments,e+1)}this.audioResource.segments=v()(t=[{url:n.initSegment}]).call(t,p()(i=n.mediaSegments).call(i,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.audioResource.initSegmentPadding=n.initSegment}if(n.mediaSegments&&this.audioResource.segmentIndex-(n.initSegment?1:0)<n.mediaSegments.length-1)return n.mediaSegments[this.audioResource.segmentIndex+(n.initSegment?0:1)].start}return-1}selectSubtitle(e){if(e!==this.subtitleResource.selectedIndex&&this.hasSubtitle()&&e>=0&&e<this.mediaPlayList.mediaList.subtitle.length){this.subtitleResource.selectedIndex=e;const n=this.mediaPlayList.mediaList.subtitle[this.subtitleResource.selectedIndex];if(n.file)this.subtitleResource.segments=[{url:n.file}];else{var t,i;if(this.options.isLive){var s;let e=this.subtitleResource.segmentIndex;R()(s=this.subtitleResource.segments).call(s,((t,i)=>{if(t.url===this.subtitleResource.currentUri)return e=i,!0})),this.addHistory(this.subtitleResource,n.mediaSegments,e+1)}this.subtitleResource.segments=v()(t=[{url:n.initSegment}]).call(t,p()(i=n.mediaSegments).call(i,(e=>({url:e.url,pending:e.pending,duration:e.segmentDuration})))),this.subtitleResource.initSegmentPadding=n.initSegment}if(n.mediaSegments&&this.subtitleResource.segmentIndex-(n.initSegment?1:0)<n.mediaSegments.length-1)return n.mediaSegments[this.subtitleResource.segmentIndex+(n.initSegment?0:1)].start}return-1}getCurrentProtection(e){return 1===e?this.mediaPlayList.mediaList.audio[this.audioResource.selectedIndex].protection:0===e?this.mediaPlayList.mediaList.video[this.videoResource.selectedIndex].protection:void 0}getMinBuffer(){return this.minBuffer}}},78417:(e,t,i)=>{"use strict";i.d(t,{A:()=>j});var s=i(36586),n=i.n(s),a=i(43981),r=i.n(a),o=i(78010),d=i.n(o),l=i(64007),u=i.n(l),c=i(17201),m=i.n(c),h=i(86226),g=i.n(h),p=i(18979),f=i.n(p),v=i(56712),S=i.n(v),y=i(129),L=i.n(y),R=i(48079),b=i.n(R),x=i(71426),P=i.n(x),A=i(11393),w=i.n(A),I=i(79331),T=i(67672),D=i(95335),B=i(62100),U=i(86932);function $(e){const t=e.match(/^PT?(?:(\d+)Y)?(?:(\d+)D)?(?:(\d+)H)?(?:(\d+)M)?(?:(\d+(?:\.\d+)?)S)?$/);if(!t)throw new Error("Invalid DASH PT duration: "+e);const[,i,s,a,o,d]=t;return 3600*n()(i||"0")*24*365+3600*n()(s||"0")*24+3600*n()(a||"0")+60*n()(o||"0")+r()(d||"0")}function M(e,t){const i=(0,B.A)(e);return i.length>=t?i:d()("0").call("0",t-i.length)+i}function C(e){if(!e)return 0;if(u()(e).call(e,"/")>-1){const t=e.split("/");return r()(t[0])/r()(t[1])}return r()(e)}function H(e){e=m()(e).call(e,"-","");const t=[];for(let i=0;i<e.length;i+=2)t.push(+`0x${e.substring(i,i+2)}`);return new Uint8Array(t)}function k(e){let t={};return g()(e).call(e,(e=>{const i={};if(D.__(e,((e,t)=>{i[t.toLocaleLowerCase()]=e})),i["cenc:default_kid"]&&(t.kid=H(i["cenc:default_kid"]),t.scheme=i.value),i.schemeiduri){const e=i.schemeiduri.split(":");3===e.length&&"urn"===e[0]&&"uuid"===e[1]&&(t.systemId=H(e[2]))}i["clearkey:laurl"]&&(t.url=i["clearkey:laurl"].value),i["dashif:laurl"]&&(t.url=i["dashif:laurl"].value)})),t}function O(e,t){return/^https?:\/\//.test(t)?t:e+t}function W(e,t,i){var s;const a={mediaList:{audio:[],video:[],subtitle:[]},type:"live",isEnd:!1,duration:0,minBufferTime:0,maxSegmentDuration:0,minimumUpdatePeriod:0,timeShiftBufferDepth:0,timestamp:(0,U.A)()},o=[];"static"===e.type&&(a.type="vod",a.isEnd=!0),e.minBufferTime&&(a.minBufferTime=$(e.minBufferTime)),e.maxSegmentDuration&&(a.maxSegmentDuration=$(e.maxSegmentDuration)),e.minimumUpdatePeriod&&(a.minimumUpdatePeriod=Math.min($(e.minimumUpdatePeriod),30*Math.max(a.maxSegmentDuration,2))),e.availabilityStartTime&&(a.availabilityStartTime=new Date(e.availabilityStartTime).getTime()),e.timeShiftBufferDepth&&(a.timeShiftBufferDepth=$(e.timeShiftBufferDepth)),e.mediaPresentationDuration&&(a.duration=$(e.mediaPresentationDuration));let d="";e.BaseURL&&(d=T.YO(e.BaseURL)?e.BaseURL[0].value:T.Yj(e.BaseURL)?e.BaseURL:e.BaseURL.value),null!=t&&t.duration&&(a.duration=$(t.duration)),t.BaseURL&&(d=O(d,T.Yj(t.BaseURL)?t.BaseURL:t.BaseURL.value));const l=T.YO(t.AdaptationSet)?t.AdaptationSet:[t.AdaptationSet];return g()(l).call(l,((e,t)=>{let s,l="",c="",m="",h=0,p=0,v=0,y=0,L=0,R="1:1",b="1",x=0,P=d,A="und";e.BaseURL&&(P=O(P,T.Yj(e.BaseURL)?e.BaseURL:e.BaseURL.value)),e.lang&&(A=e.lang),e.mimeType||e.contentType?(l=e.mimeType,c=e.contentType,"video/mp4"===l||"video"===c?(m=e.codecs,h=r()(e.width),p=r()(e.height),e.maxWidth&&(v=r()(e.maxWidth)),e.maxHeight&&(y=r()(e.maxHeight)),e.frameRate&&(L=C(e.frameRate)),R=e.sar,b=e.startWithSAP,x=r()(e.bandwidth)):"audio/mp4"!==l&&"audio"!==c||(m=e.codecs,b=e.startWithSAP,x=r()(e.bandwidth))):(e.maxWidth&&(v=r()(e.maxWidth)),e.maxHeight&&(y=r()(e.maxHeight)),e.frameRate&&(L=C(e.frameRate))),e.ContentProtection&&(s=k(e.ContentProtection));const w=T.YO(e.Representation)?e.Representation:[e.Representation];g()(w).call(w,((t,d)=>{u()(o).call(o,t.id)>-1&&(t.id=(n()(o[o.length-1])+1).toString()),o.push(t.id);let g="";const w=[];let I=0,D=a.duration,$=O(f()(i).call(i,0,S()(i).call(i,"/")+1),P);if(t.mimeType&&(l=t.mimeType),"video/mp4"===l||"video"===c?(t.codecs&&(m=t.codecs),t.width&&(h=r()(t.width)),t.height&&(p=r()(t.height)),t.maxWidth&&(v=r()(t.maxWidth)),t.maxHeight&&(y=r()(t.maxHeight)),t.frameRate&&(L=r()(t.frameRate)),t.sar&&(R=t.sar),t.startWithSAP&&(b=t.startWithSAP),t.bandwidth&&(x=r()(t.bandwidth))):(t.codecs&&(m=t.codecs),t.startWithSAP&&(b=t.startWithSAP),t.bandwidth&&(x=r()(t.bandwidth))),t.BaseURL&&($=O($,T.Yj(t.BaseURL)?t.BaseURL:t.BaseURL.value)),t.ContentProtection&&(s=k(t.ContentProtection)),t.SegmentBase)"video/mp4"===l||"video"===c?a.mediaList.video.push({id:t.id,file:$,mimeType:l,codecs:m,width:h,height:p,maxWidth:v,maxHeight:y,frameRate:L,sar:R,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s}):"audio/mp4"===l||"audio"===c?a.mediaList.audio.push({id:t.id,file:$,mimeType:l,codecs:m,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s,lang:A}):"application/mp4"!==l&&"text"!==c||a.mediaList.subtitle.push({id:t.id,file:$,mimeType:l,codecs:m,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s,lang:A});else{let i;if(e.SegmentTemplate&&(i=T.YO(e.SegmentTemplate)?e.SegmentTemplate[0]:e.SegmentTemplate),t.SegmentTemplate&&(i=T.YO(t.SegmentTemplate)?t.SegmentTemplate[0]:t.SegmentTemplate),i){let e=i.startNumber?n()(i.startNumber):1;if(g=i.initialization,I=r()(i.timescale||"1"),i.duration&&!i.SegmentTimeline){D=r()(i.duration);let s=D/I,o=e+Math.ceil((a.duration||s)/s)-1,d=o;if("live"===a.type&&(T.ai(a.availabilityStartTime)||i.presentationTimeOffset)){const t=((a.timestamp||(0,U.A)())-a.availabilityStartTime)/1e3-(i.presentationTimeOffset?n()(i.presentationTimeOffset):0);o=e+Math.floor(t/s),a.timeShiftBufferDepth&&(e=o-Math.ceil(a.timeShiftBufferDepth/s)+1),d=o,("false"===i.availabilityTimeComplete||a.minimumUpdatePeriod>2*a.minBufferTime)&&(o+=Math.ceil(a.minimumUpdatePeriod/s))}for(let n=e;n<=o;n++){const r=s*(n-e);let l=s*(n-e+1);n===o&&a.duration&&(s=a.duration-s*(o-e),l=a.duration),w.push({idx:n,start:r,end:l,url:$+i.media.replace(/\$RepresentationID\$/g,t.id).replace(/\$Number(%(\d+)d)?\$/g,((e,t,i)=>i?M(n,+i):(0,B.A)(n))),segmentDuration:s,pending:n>d})}}else if(i.SegmentTimeline&&i.SegmentTimeline.S){const s=T.YO(i.SegmentTimeline.S)?i.SegmentTimeline.S:[i.SegmentTimeline.S];let a=0,o=e;for(let e=0;e<s.length;e++){let d=r()(s[e].d);s[e].t&&(a=r()(s[e].t));let l=1;s[e].r&&(l=n()(s[e].r),-1===l&&D?l=Math.ceil(D*I/d):l+=1);for(let e=0;e<l;e++)w.push({idx:o,start:a/I,end:(a+d)/I,url:$+i.media.replace(/\$RepresentationID\$/g,t.id).replace(/\$Number(%(\d+)d)?\$/g,((e,t,i)=>i?M(o,+i):(0,B.A)(o))).replace(/\$Time\$/g,(0,B.A)(a)),segmentDuration:d/I}),o++,a+=d}}}else if(t.SegmentList){const e=T.YO(t.SegmentList.SegmentURL)?t.SegmentList.SegmentURL:[t.SegmentList.SegmentURL];let i=0,s=r()(t.SegmentList.duration);for(let t=0;t<e.length;t++)w.push({idx:t,start:i/I,end:(i+s)/I,url:$+e[t].media,segmentDuration:s/I}),i+=s}"video/mp4"===l||"video"===c?a.mediaList.video.push({id:t.id,baseURL:$,initSegment:$+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,B.A)(x)),mediaSegments:w,mimeType:l,codecs:m,width:h,height:p,maxWidth:v,maxHeight:y,frameRate:L,sar:R,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s}):"audio/mp4"===l||"audio"===c?a.mediaList.audio.push({id:t.id,baseURL:$,initSegment:$+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,B.A)(x)),mediaSegments:w,mimeType:l,codecs:m,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s,lang:A}):"application/mp4"!==l&&"text"!==c||a.mediaList.subtitle.push({id:t.id,baseURL:$,initSegment:$+g.replace(/\$RepresentationID\$/g,t.id).replace(/\$Bandwidth\$/g,(0,B.A)(x)),mediaSegments:w,mimeType:l,codecs:m,startWithSAP:"1"===b,bandwidth:x,timescale:I,duration:D,protection:s,lang:A})}}))})),g()(s=["video","audio"]).call(s,(e=>{var t;L()(t=a.mediaList[e]).call(t,((e,t)=>e.bandwidth-t.bandwidth))})),a}function j(e,t){const i=(s=e,s?(0,I.A)(s,{aloneValueName:"value"}):null).MPD;var s;if("dynamic"===i.type){const e=T.YO(i.Period)?i.Period[i.Period.length-1]:i.Period;return W(i,e,t)}{const e=T.YO(i.Period)?i.Period:[i.Period],s=b()(e).call(e,(e=>W(i,e,t))),o=s[0];for(let e=1;e<s.length;e++){var n,a,r;o.duration+=s[e].duration,g()(n=s[e].mediaList.video).call(n,(e=>{var t;const i=P()(t=o.mediaList.video).call(t,(t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var s,n,a,r;i?(null!==(s=i.mediaSegments)&&void 0!==s&&s.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&g()(r=e.mediaSegments).call(r,(e=>{e.start+=i.mediaSegments[i.mediaSegments.length-1].end,e.end+=i.mediaSegments[i.mediaSegments.length-1].end})),i.mediaSegments=w()(a=i.mediaSegments||[]).call(a,e.mediaSegments||[])):o.mediaList.video.push(e)})),g()(a=s[e].mediaList.audio).call(a,(e=>{var t;const i=P()(t=o.mediaList.audio).call(t,(t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var s,n,a,r;i?(null!==(s=i.mediaSegments)&&void 0!==s&&s.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&g()(r=e.mediaSegments).call(r,(e=>{e.start+=i.mediaSegments[i.mediaSegments.length-1].end,e.end+=i.mediaSegments[i.mediaSegments.length-1].end})),i.mediaSegments=w()(a=i.mediaSegments||[]).call(a,e.mediaSegments||[])):o.mediaList.audio.push(e)})),g()(r=s[e].mediaList.subtitle).call(r,(e=>{var t;const i=P()(t=o.mediaList.subtitle).call(t,(t=>e.initSegment&&e.initSegment===t.initSegment||e.id===t.id));var s,n,a,r;i?(null!==(s=i.mediaSegments)&&void 0!==s&&s.length&&null!==(n=e.mediaSegments)&&void 0!==n&&n.length&&g()(r=e.mediaSegments).call(r,(e=>{e.start+=i.mediaSegments[i.mediaSegments.length-1].end,e.end+=i.mediaSegments[i.mediaSegments.length-1].end})),i.mediaSegments=w()(a=i.mediaSegments||[]).call(a,e.mediaSegments||[])):o.mediaList.subtitle.push(e)}))}return i.mediaPresentationDuration&&(o.duration=$(i.mediaPresentationDuration)),o}}},79331:(e,t,i)=>{"use strict";i.d(t,{A:()=>d});var s=i(66615),n=i.n(s),a=i(72739);const r={aloneValueName:"_@attribute"},o=[" ","/",'"',"'","<",">"];function d(e,t=r){e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/[\n\t\r]/g,"")).replace(/>[ \t]+</g,"><")).replace(/<\?[^>]*\?>/g,"");const i=[];let s=0;function d(e,s){const a=i[i.length-1];a&&(e!==t.aloneValueName||null==a.obj[t.aloneValueName]?null==a.obj[e]?a.obj[e]=s:n()(a.obj[e])?a.obj[e].push(s):a.obj[e]=[a.obj[e],s]:a.obj[t.aloneValueName]=[a.obj[t.aloneValueName],{tagName:e,...s}])}function l(t){for(;s<e.length;){if(e[s]===t)return!0;s++}return!1}function u(){c();let t="";for(;s<e.length&&!a.zy(o,e[s]);)t+=e[s],s++;return t}function c(){for(;s<e.length&&/\s|\r|\n/.test(e[s]);)s++}const m=/\s/,h=/'/,g=/"/;function p(){if(s>=e.length)return!0;c();let t=m;'"'!==e[s]&&"'"!=e[s]||(t='"'===e[s]?g:h,s++);let i="";for(;s<e.length;){if(t.test(e[s])){s++;break}i+=e[s],s++}return i}function f(){c();let t="";for(;s<e.length&&"<"!==e[s];)t+=e[s],s++;return t}function v(){for(;"<"===e[s];){const t=s;if(s++,c(),"/"!==e[s]){s=t;break}if(s++,u()===i[i.length-1].tag){if(i.length>1){const e=i.pop();d(e.tag,e.obj)}l(">"),s++,c()}else i.pop(),l(">"),s++,c()}}return function n(){if(s>=e.length)return;let a=s;if(c(),"<"!==e[s])return s=a,d(t.aloneValueName,f()),v(),n();let r=l("<");if(!r)return;a=s,s++;const o=u();if(i.push({obj:{},tag:o,start:a}),function(){for(;c(),">"!==e[s]&&"/"!==e[s];){let e=u();if(!e)break;"="===e[e.length-1]?e=e.substring(0,e.length-1):(l("="),s++),d(e,p())}}(),c(),"/"===e[s]){if(s++,i.length>1){const e=i.pop();d(e.tag,e.obj)}return l(">"),s++,v(),n()}r=l(">"),r&&(s++,c(),"<"!==e[s]&&(d(t.aloneValueName,f()),c()),v(),n())}(),{[i[0].tag]:i[0].obj}}},11393:(e,t,i)=>{e.exports=i(50530)},96319:(e,t,i)=>{e.exports=i(22616)},71426:(e,t,i)=>{e.exports=i(99617)},48079:(e,t,i)=>{e.exports=i(98894)},78010:(e,t,i)=>{e.exports=i(465)},31721:(e,t,i)=>{e.exports=i(82990)},17201:(e,t,i)=>{e.exports=i(53042)},41829:(e,t,i)=>{"use strict";var s=i(92222);e.exports=s},96275:(e,t,i)=>{"use strict";i(58545);var s=i(61747);e.exports=s("Array","concat")},16177:(e,t,i)=>{"use strict";i(49295);var s=i(61747);e.exports=s("Array","filter")},94668:(e,t,i)=>{"use strict";i(6290);var s=i(61747);e.exports=s("Array","find")},28253:(e,t,i)=>{"use strict";i(6687);var s=i(61747);e.exports=s("Array","map")},55939:(e,t,i)=>{"use strict";i(10521);var s=i(61747);e.exports=s("Array","some")},45837:(e,t,i)=>{"use strict";var s=i(88280),n=i(96275),a=Array.prototype;e.exports=function(e){var t=e.concat;return e===a||s(a,e)&&t===a.concat?n:t}},33155:(e,t,i)=>{"use strict";var s=i(88280),n=i(16177),a=Array.prototype;e.exports=function(e){var t=e.filter;return e===a||s(a,e)&&t===a.filter?n:t}},63246:(e,t,i)=>{"use strict";var s=i(88280),n=i(94668),a=Array.prototype;e.exports=function(e){var t=e.find;return e===a||s(a,e)&&t===a.find?n:t}},39299:(e,t,i)=>{"use strict";var s=i(88280),n=i(28253),a=Array.prototype;e.exports=function(e){var t=e.map;return e===a||s(a,e)&&t===a.map?n:t}},7766:(e,t,i)=>{"use strict";var s=i(88280),n=i(69008),a=String.prototype;e.exports=function(e){var t=e.repeat;return"string"==typeof e||e===a||s(a,e)&&t===a.repeat?n:t}},86823:(e,t,i)=>{"use strict";var s=i(88280),n=i(52017),a=String.prototype;e.exports=function(e){var t=e.replaceAll;return"string"==typeof e||e===a||s(a,e)&&t===a.replaceAll?n:t}},69685:(e,t,i)=>{"use strict";var s=i(88280),n=i(55939),a=Array.prototype;e.exports=function(e){var t=e.some;return e===a||s(a,e)&&t===a.some?n:t}},69008:(e,t,i)=>{"use strict";i(8592);var s=i(61747);e.exports=s("String","repeat")},52017:(e,t,i)=>{"use strict";i(51398),i(21995),i(50929);var s=i(61747);e.exports=s("String","replaceAll")},53042:(e,t,i)=>{"use strict";e.exports=i(49604)},49604:(e,t,i)=>{"use strict";i(36038);var s=i(41829);e.exports=s},67703:(e,t,i)=>{"use strict";var s=i(1907),n=i(39298),a=Math.floor,r=s("".charAt),o=s("".replace),d=s("".slice),l=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,u=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,i,s,c,m){var h=i+e.length,g=s.length,p=u;return void 0!==c&&(c=n(c),p=l),o(m,p,(function(n,o){var l;switch(r(o,0)){case"$":return"$";case"&":return e;case"`":return d(t,0,i);case"'":return d(t,h);case"<":l=c[d(o,1,-1)];break;default:var u=+o;if(0===u)return n;if(u>g){var m=a(u/10);return 0===m?n:m<=g?void 0===s[m-1]?r(o,1):s[m-1]+r(o,1):n}l=s[u-1]}return void 0===l?"":l}))}},72087:(e,t,i)=>{"use strict";var s=i(46285),n=i(45807),a=i(76264)("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[a])?!!t:"RegExp"===n(e))}},1816:(e,t,i)=>{"use strict";var s=i(45951),n=i(98828),a=s.RegExp,r=!n((function(){var e=!0;try{a(".","d")}catch(t){e=!1}var t={},i="",s=e?"dgimsy":"gimsy",n=function(e,s){Object.defineProperty(t,e,{get:function(){return i+=s,!0}})},r={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(r.hasIndices="d"),r)n(o,r[o]);return Object.getOwnPropertyDescriptor(a.prototype,"flags").get.call(t)!==s||i!==s}));e.exports={correct:r}},85606:(e,t,i)=>{"use strict";var s=i(36624);e.exports=function(){var e=s(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},40663:(e,t,i)=>{"use strict";var s=i(13930),n=i(49724),a=i(88280),r=i(1816),o=i(85606),d=RegExp.prototype;e.exports=r.correct?function(e){return e.flags}:function(e){return r.correct||!a(d,e)||n(e,"flags")?e.flags:s(o,e)}},69314:(e,t,i)=>{"use strict";var s=i(65482),n=i(90160),a=i(74239),r=RangeError;e.exports=function(e){var t=n(a(this)),i="",o=s(e);if(o<0||o===1/0)throw new r("Wrong number of repetitions");for(;o>0;(o>>>=1)&&(t+=t))1&o&&(i+=t);return i}},49295:(e,t,i)=>{"use strict";var s=i(11091),n=i(70726).filter;s({target:"Array",proto:!0,forced:!i(59552)("filter")},{filter:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},6290:(e,t,i)=>{"use strict";var s=i(11091),n=i(70726).find,a=i(42156),r="find",o=!0;r in[]&&Array(1)[r]((function(){o=!1})),s({target:"Array",proto:!0,forced:o},{find:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}}),a(r)},6687:(e,t,i)=>{"use strict";var s=i(11091),n=i(70726).map;s({target:"Array",proto:!0,forced:!i(59552)("map")},{map:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},10521:(e,t,i)=>{"use strict";var s=i(11091),n=i(70726).some;s({target:"Array",proto:!0,forced:!i(77623)("some")},{some:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}})},51398:()=>{},8592:(e,t,i)=>{"use strict";i(11091)({target:"String",proto:!0},{repeat:i(69314)})},50929:(e,t,i)=>{"use strict";var s=i(11091),n=i(13930),a=i(1907),r=i(74239),o=i(62250),d=i(46285),l=i(72087),u=i(90160),c=i(29367),m=i(40663),h=i(67703),g=i(76264),p=i(7376),f=g("replace"),v=TypeError,S=a("".indexOf),y=a("".replace),L=a("".slice),R=Math.max;s({target:"String",proto:!0},{replaceAll:function(e,t){var i,s,a,g,b,x,P,A,w,I,T=r(this),D=0,B="";if(d(e)){if((i=l(e))&&(s=u(r(m(e))),!~S(s,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(a=c(e,f))return n(a,e,T,t);if(p&&i)return y(u(T),e,t)}for(g=u(T),b=u(e),(x=o(t))||(t=u(t)),P=b.length,A=R(1,P),w=S(g,b);-1!==w;)I=x?u(t(b,w,g)):h(b,g,w,[],void 0,t),B+=L(g,D,w)+I,D=w+P,w=w+A>g.length?-1:S(g,b,w+A);return D<g.length&&(B+=L(g,D)),B}})},21995:()=>{},36038:(e,t,i)=>{"use strict";i(50929)},50530:(e,t,i)=>{"use strict";var s=i(45837);e.exports=s},22616:(e,t,i)=>{"use strict";var s=i(33155);e.exports=s},99617:(e,t,i)=>{"use strict";var s=i(63246);e.exports=s},98894:(e,t,i)=>{"use strict";var s=i(39299);e.exports=s},465:(e,t,i)=>{"use strict";var s=i(7766);e.exports=s},92222:(e,t,i)=>{"use strict";var s=i(86823);e.exports=s},82990:(e,t,i)=>{"use strict";var s=i(69685);e.exports=s}}]);