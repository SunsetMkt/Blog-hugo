"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[31],{53616:(e,t,s)=>{s.d(t,{A:()=>h});var i=s(49859),r=s(63939),a=s(9705),n=s(26235),o=s(59996),l=s(62624),d=s(9787),c=s(43950);class h{constructor(e){(0,i.A)(this,"options",void 0),(0,i.A)(this,"frame",void 0),(0,i.A)(this,"decoder",void 0),this.options=e}getAVFrame(){return this.frame?this.frame:this.frame={pts:BigInt(0),duration:BigInt(0),rects:[],timeBase:{den:1,num:1}}}outputAVFrame(){this.frame&&(this.options.onReceiveSubtitle&&this.options.onReceiveSubtitle(this.frame),this.frame=void 0)}receiveAVFrame(){return this.decoder.receiveAVFrame(this.getAVFrame())}async open(e){switch(r.f[15](e+4)){case 94226:this.decoder=new n.A;break;case 94232:this.decoder=new l.A;break;case 94210:case 94225:this.decoder=new c.A;break;case 94213:this.decoder=new d.A;break;case 94212:case 94230:this.decoder=new o.A;break;default:return a.r8}return 0}decode(e){let t=this.decoder.sendAVPacket(e);if(t)return t;for(;;){if(t=this.receiveAVFrame(),1!==t){if(t<0)return t;break}this.outputAVFrame()}return 0}async flush(){for(this.decoder.flush();;){if(this.receiveAVFrame()<1)return;this.outputAVFrame()}}close(){this.frame&&(this.frame=void 0)}}},59996:(e,t,s)=>{s.d(t,{A:()=>c});var i=s(49859),r=s(18979),a=s.n(r),n=s(63939),o=s(81023),l=s(71517),d=s(50011);class c extends o.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){var t;return this.queue.push({data:a()(t=(0,l.iI)(e)).call(t),pts:n.f[17](e+8),duration:n.f[17](e+48),timeBase:{den:n.f[15](e+76),num:n.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num;let s=d.decode(t.data);return/^\w+?\s*:/.test(s)||(s="Dialogue: "+s),e.rects.push({type:3,text:s,flags:0}),1}return 0}flush(){return 0}}},81023:(e,t,s)=>{s.d(t,{A:()=>i});class i{}},43950:(e,t,s)=>{s.d(t,{A:()=>c});var i=s(49859),r=s(18979),a=s.n(r),n=s(63939),o=s(81023),l=s(71517),d=s(50011);class c extends o.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){var t;return this.queue.push({data:a()(t=(0,l.iI)(e)).call(t),pts:n.f[17](e+8),duration:n.f[17](e+48),timeBase:{den:n.f[15](e+76),num:n.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num,e.rects.push({type:1,text:d.decode(t.data),flags:0}),1}return 0}flush(){return 0}}},9787:(e,t,s)=>{s.d(t,{A:()=>h});var i=s(49859),r=s(18979),a=s.n(r),n=s(63939),o=s(81023),l=s(71517),d=s(50011),c=s(4624);class h extends o.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){var t;const s=a()(t=(0,l.iI)(e)).call(t);if(s.length<2)return 0;const i=s[0]<<8|s[1];if(i+2>s.length)return c.R8(`invalid timed text data, need ${i+2} but got ${s.length}, ignore it`,"src/avcodec/subtitle/decoder/TimedTextDecoder.ts",60),0;const r=d.decode(s.subarray(2,2+i));return this.queue.push({text:r,pts:n.f[17](e+8),duration:n.f[17](e+48),timeBase:{den:n.f[15](e+76),num:n.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=t.timeBase.den,e.timeBase.num=t.timeBase.num,e.rects.push({type:1,text:t.text,flags:0}),1}return 0}flush(){return 0}}},62624:(e,t,s)=>{s.d(t,{A:()=>p});var i=s(49859),r=s(11265),a=s.n(r),n=s(11393),o=s.n(n),l=s(63939),d=s(81023),c=s(50011),h=s(71517),u=s(77231),g=s(74762);class p extends d.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}sendAVPacket(e){let t=c.decode((0,h.iI)(e));return t?(/<tt/.test(a()(t).call(t))?this.queue=o()(s=this.queue).call(s,g.q(t).queue):this.queue.push({pts:l.f[17](e+8),duration:l.f[17](e+48),context:t,region:"Default"}),0):0;var s}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=u.qs,e.timeBase.num=1,e.rects.push({type:2,text:t.context,flags:0}),1}return 0}flush(){return 0}}},26235:(e,t,s)=>{s.d(t,{A:()=>u});var i=s(49859),r=s(64007),a=s.n(r),n=s(63939),o=s(81023),l=s(50011),d=s(71517),c=s(54825),h=s(77231);class u extends o.A{constructor(){super(),(0,i.A)(this,"queue",void 0),this.queue=[]}findTimelineTag(e){const t=a()(e).call(e,"<");if(t>=0){const s=a()(e).call(e,">",t);if(s>t&&/^(\d{2,}:)?\d{2}:\d{2}\.\d{1,3}$/.test(e.substring(t+1,s)))return{start:t,end:s}}return{start:-1,end:-1}}sendAVPacket(e){let t=l.decode((0,d.iI)(e)),s=n.f[17](e+8);const i=s+n.f[17](e+48),r=[];for(;;){const{start:i,end:a}=this.findTimelineTag(t);if(i<0)break;const o=(0,c.j)(t.substring(i+1,a));r.push(t.substring(0,i)),this.queue.push({context:r.join(""),pts:s,duration:o-s,timeBase:{den:n.f[15](e+76),num:n.f[15](e+72)}}),s=o,t=t.substring(a+1)}return r.push(t),this.queue.push({context:r.join(""),pts:s,duration:i-s,timeBase:{den:n.f[15](e+76),num:n.f[15](e+72)}}),0}receiveAVFrame(e){if(this.queue.length){const t=this.queue.shift();return e.pts=t.pts,e.duration=t.duration,e.timeBase.den=h.qs,e.timeBase.num=1,e.rects.push({type:2,text:t.context,flags:0}),1}return 0}flush(){return 0}}},5028:(e,t,s)=>{s.d(t,{Q:()=>i});const i=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},51785:(e,t,s)=>{s.d(t,{Bp:()=>f,Ew:()=>b,wj:()=>m});var i=s(71426),r=s.n(i),a=s(18979),n=s.n(a),o=(s(48079),s(11265)),l=s.n(o),d=(s(96319),s(82895),s(4624)),c=s(5028),h=s(54825),u=s(44453),g=s(93935);const p="src/avformat/formats/ass/iass.ts";function f(e){return function(e,t){const s=t.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),i=[];for(let t=0;t<s.length;t++){const a=r()(e).call(e,(e=>e.toLowerCase()===s[t].toLowerCase()));a||d.R8(`not support ass field(${s[t]})`,p,41),i.push(a||s[t])}return i}(c.Q,e)}function v(e,t){let s=t.split(",");if(s.length>e.length){const t=n()(s).call(s,e.length-1).join(",");s=n()(s).call(s,0,e.length-1),s.push(t)}return s}function b(e,t,s,i){const[,,r]=t.match(/^(\w+?)\s*:\s*(.*)/i),a=v(e,r);return{start:(0,h.j)(a[s]),end:(0,h.j)(a[i])}}function m(e,t){const[,s,i]=t.match(/^(\w+?)\s*:\s*(.*)/i);let r=0;switch(s){case"Comment":r=2;break;case"Dialogue":r=1;break;case"Command":r=6;break;case"Movie":r=5;break;case"Picture":r=3;break;case"Sound":r=4}const a=v(e,i),n={type:r};for(let t=0;t<a.length;t++){var o;n[e[t]]=a[t];const s=e[t],i=l()(o=a[t]).call(o);switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":n[s]=+i;break;case"Start":case"End":n[s]=(0,h.j)(i);break;case"Effect":n[s]=(0,u.d)(i);break;case"Text":n[s]=(0,g.r)(i);break;default:n[s]=i}}return n}},57038:(e,t,s)=>{s.d(t,{A:()=>R});var i=s(49859),r=s(94870),a=s.n(r),n=s(86226),o=s.n(n),l=s(8628),d=s.n(l),c=s(18182),h=s.n(c),u=s(385),g=s.n(u),p=s(18979),f=s.n(p),v=s(77658),b=s(21194),m=s(77334),y=s(8284),A=s(65749),x=s(49963),w=s(78040),S=s(47924),k=s(95335);const B='.ASS-box{font-family:Arial;overflow:hidden;pointer-events:none;position:absolute}.ASS-dialogue{font-size:0;width:max-content;position:absolute;z-index:0;transform:translate(calc(var(--ass-align-h)*-1),calc(var(--ass-align-v)*-1));span{display:inline-block}[data-text]{display:inline-block;color:var(--ass-fill-color);font-size:calc(var(--ass-scale)*var(--ass-real-fs)*1px);line-height:calc(var(--ass-scale)*var(--ass-tag-fs)*1px);letter-spacing:calc(var(--ass-scale)*var(--ass-tag-fsp)*1px);filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*(1-round(up,sin(var(--ass-tag-xbord))*sin(var(--ass-tag-xbord))))*(1-round(up,sin(var(--ass-tag-ybord))*sin(var(--ass-tag-ybord))))*1px))}[data-is="br"]+[data-is="br"]{height:calc(var(--ass-scale)*var(--ass-tag-fs)*1px/2)}}.ASS-dialogue[data-wrap-style="0"],.ASS-dialogue[data-wrap-style="3"]{text-wrap:balance;white-space:pre-wrap}.ASS-dialogue[data-wrap-style="1"]{word-break:break-word;white-space:pre-wrap}.ASS-dialogue[data-wrap-style="2"]{word-break:normal;white-space:pre}.ASS-dialogue[data-border-style="1"]{position:relative;&::before,&::after{content:attr(data-text);position:absolute;top:0;left:0;z-index:-1;filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*1px))}&::before{color:var(--ass-shadow-color);-webkit-text-stroke:calc(var(--ass-scale-stroke)*var(--ass-border-width)*1px) var(--ass-shadow-color);transform:translate(calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px),calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px))}&::after{color:var(--ass-border-color);-webkit-text-stroke:calc(var(--ass-scale-stroke)*var(--ass-border-width)*1px) var(--ass-border-color)}&[data-stroke="svg"]{color:#000;&::before,&::after{opacity:0}}}@container style(--ass-tag-xbord:0) and style(--ass-tag-ybord:0){.ASS-dialogue[data-border-style="1"]::after{display:none}}@container style(--ass-tag-xshad:0) and style(--ass-tag-yshad:0){.ASS-dialogue[data-border-style="1"]::before{display:none}}.ASS-dialogue[data-border-style="3"]{padding:calc(var(--ass-scale-stroke)*var(--ass-tag-xbord)*1px)calc(var(--ass-scale-stroke)*var(--ass-tag-ybord)*1px);position:relative;filter:blur(calc(var(--ass-scale-stroke)*var(--ass-tag-blur)*1px));&::before,&::after{content:"";width:100%;height:100%;position:absolute;z-index:-1}&::before{background-color:var(--ass-shadow-color);left:calc(var(--ass-scale-stroke)*var(--ass-tag-xshad)*1px);top:calc(var(--ass-scale-stroke)*var(--ass-tag-yshad)*1px)}&::after{background-color:var(--ass-border-color);left:0;top:0}}@container style(--ass-tag-xbord:0) and style(--ass-tag-ybord:0){.ASS-dialogue [data-border-style="3"]::after{background-color:transparent}}@container style(--ass-tag-xshad:0) and style(--ass-tag-yshad:0){.ASS-dialogue [data-border-style="3"]::before{background-color:transparent}}.ASS-dialogue[data-rotate]{transform:perspective(312.5px) rotateY(calc(var(--ass-tag-fry) * 1deg)) rotateX(calc(var(--ass-tag-frx) * 1deg)) rotateZ(calc(var(--ass-tag-frz) * -1deg));&[data-text]{transform-style:preserve-3d;word-break:normal;white-space:nowrap}}.ASS-dialogue[data-scale],.ASS-dialogue[data-skew]{display:inline-block;transform:scale(var(--ass-tag-fscx), var(--ass-tag-fscy)) skew(calc(var(--ass-tag-fax)*1rad),calc(var(--ass-tag-fay) * 1rad));transform-origin:var(--ass-align-h) var(--ass-align-v)}.ASS-fix-font-size{font-family:Arial;line-height:normal;width:0;height:0;position:absolute;visibility:hidden;overflow:hidden;span{position:absolute}}.ASS-clip-area{width:100%;height:100%;position:absolute;top:0;left:0}.ASS-effect-area{position:absolute;display:flex;width:100%;height:fit-content;overflow:hidden;mask-composite:intersect;&[data-effect="banner"]{flex-direction:column;height:100%}.ASS-dialogue{position:static;transform:none}}',q={Name:"Default",Fontname:"Arial",Fontsize:"16",PrimaryColour:"&Hffffff",SecondaryColour:"&Hffffff",OutlineColour:"&H0",BackColour:"&H0",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"1",Shadow:"0",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"0"};class R{constructor(e,t={container:e.parentNode}){var s;if((0,i.A)(this,"store",void 0),(0,i.A)(this,"resampling_","video_height"),(0,i.A)(this,"resize_",void 0),(0,i.A)(this,"options",void 0),this.options=k.X$({},t),this.store={video:e,box:document.createElement("div"),svg:(0,m.An)("svg"),defs:(0,m.An)("defs"),observer:null,scale:1,width:0,height:0,scriptRes:{width:t.videoWidth||e.clientWidth,height:t.videoHeight||e.clientHeight},layoutRes:{width:t.videoWidth||e.clientWidth,height:t.videoHeight||e.clientHeight},resampledRes:{width:0,height:0},sbas:!0,styles:null,space:[],actives:[],delay:0,index:0,dialogues:[]},null==t.videoWidth&&(e.videoWidth=t.videoWidth),null==t.videoHeight&&(e.videoHeight=t.videoHeight),!t.container)throw new Error("Missing container.");this.resize_=(0,b.By)(this,this.store),this.updateHeader(t.header),v.Y&&t.container.append(v.Y);const{svg:r,defs:n,scriptRes:o,box:l}=this.store;r.setAttributeNS(null,"viewBox",`0 0 ${o.width} ${o.height}`),r.append(n),t.container.append(r),l.className="ASS-box",t.container.append(l),function(e){const t=e.getRootNode()||document;let s=t instanceof Document;!s&&"object"==typeof documentPictureInPicture&&documentPictureInPicture.window&&(s=t===documentPictureInPicture.window.document);const i=s?t.head:t;let r=i.querySelector("#ASS-global-style");r||(r=document.createElement("style"),r.type="text/css",r.id="ASS-global-style",r.append(document.createTextNode(B)),i.append(r)),document.head.querySelector("#ASS-global-style")||(r=document.createElement("style"),r.type="text/css",r.id="ASS-global-style",r.append(document.createTextNode(B)),document.head.append(r))}(t.container),this.resampling_=t.resampling||"video_height";const d=new ResizeObserver(a()(s=this.resize).call(s,this));return d.observe(e),this.store.observer=d,this}framing(e){const t=(0,S.U)(e,this.store);var s;t.animations&&o()(s=t.animations).call(s,(e=>{e.currentTime=Number(this.store.video.currentTime)-1e3*t.start})),(0,m.MA)(t,"play"),t.__dialogue=e,this.store.actives.push(t)}updateHeader(e){if(e){const{info:t,width:s,height:i,styles:r}=(0,A.wE)(e,{defaultStyle:q});this.store.sbas=/yes/i.test(t.ScaledBorderAndShadow),this.store.layoutRes={width:+t.LayoutResX||this.options.videoWidth||this.store.video.clientWidth,height:+t.LayoutResY||this.options.videoHeight||this.store.video.clientHeight},this.store.scriptRes={width:s||this.store.layoutRes.width,height:i||this.store.layoutRes.height},this.store.styles=r}else this.store.styles=(0,w.W)({info:{WrapStyle:""},style:[],defaultStyle:q}),this.store.scriptRes={width:384,height:288};this.resize_(),this.options.header=e}updateVideoResolution(e,t){if(this.options.header){const{info:s,width:i,height:r}=(0,A.wE)(this.options.header,{defaultStyle:q});this.store.layoutRes={width:+s.LayoutResX||e||this.store.video.clientWidth,height:+s.LayoutResY||t||this.store.video.clientHeight},this.store.scriptRes={width:i||this.store.layoutRes.width,height:r||this.store.layoutRes.height}}else this.store.layoutRes={width:e,height:t}}render(e){if(1===e.type){var t,s;e.Start=Number(e.Start)/1e3,e.End=Number(e.End)/1e3;const i=(0,x.b)({styles:this.store.styles,dialogues:[e]})[0];k.X$(i,{effect:d()(t=["banner","scroll up","scroll down"]).call(t,null===(s=i.effect)||void 0===s?void 0:s.name)?i.effect:null,d:`ASS-${(0,y.A)()}`,align:{h:(i.alignment+2)%3,v:h()((i.alignment-1)/3)}}),this.framing(i)}}clear(e){const t=Number(e)/1e3;for(let e=this.store.actives.length-1;e>=0;e-=1){const i=this.store.actives[e],{end:r}=i;var s;r<t&&(i.$div.remove(),g()(s=this.store.actives).call(s,e,1))}}clearAll(){for(let e=this.store.actives.length-1;e>=0;e-=1)this.store.actives[e].$div.remove();this.store.actives.length=0,this.store.space.length=0}resize(){var e;const t=f()(e=this.store.actives).call(e);this.resize_();for(let e=0;e<t.length;e++)this.framing(t[e].__dialogue)}destroy(){const{video:e,box:t,svg:s,observer:i}=this.store;return(0,b.IU)(this.store),v.Y&&v.Y.remove(),s.remove(),t.remove(),i.unobserve(e),this.store.styles={},this}show(){return this.store.box.style.visibility="visible",this}hide(){return this.store.box.style.visibility="hidden",this}get resampling(){return this.resampling_}set resampling(e){e!==this.resampling_&&/^(video|script)_(width|height)$/.test(e)&&(this.resampling_=e,this.resize())}}},40031:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var i=s(49859),r=s(74707),a=s.n(r),n=s(11265),o=s.n(n),l=s(12264),d=s(29170),c=s(63939),h=(s(9599),s(50932)),u=s(53616),g=s(84149),p=s(39148),f=s(4624),v=s(57038),b=s(50011),m=s(14686),y=s(51785),A=s(84290),x=s(44328),w=s(77231),S=s(95335),k=s(71517);const B="src/avplayer/subtitle/SubtitleRender.ts",q=[{reg:/<i>/g,value:"{\\i1}"},{reg:/<\/i>/g,value:"{\\i0}"},{reg:/<b>/g,value:"{\\b1}"},{reg:/<\/b>/g,value:"{\\b0}"},{reg:/<u>/g,value:"{\\u1}"},{reg:/<\/u>/g,value:"{\\u0}"},{reg:/{/g,value:"\\{"},{reg:/}/g,value:"\\}"},{reg:/&gt;/g,value:">"},{reg:/&lt;/g,value:"<"},{reg:/&lrm;/g,value:""},{reg:/&rlm;/g,value:""},{reg:/&amp;/g,value:"&"},{reg:/&nbsp;/g,value:"\\h"},{reg:/(<br\s*\/?>)|\n>/g,value:"\\N"}];class R{constructor(e){(0,i.A)(this,"decoder",void 0),(0,i.A)(this,"loop",void 0),(0,i.A)(this,"demuxer2SubtitleRenderChannels",void 0),(0,i.A)(this,"leftPorts",void 0),(0,i.A)(this,"currentPort",void 0),(0,i.A)(this,"render",void 0),(0,i.A)(this,"queue",void 0),(0,i.A)(this,"ended",void 0),(0,i.A)(this,"options",void 0),(0,i.A)(this,"pulling",void 0),(0,i.A)(this,"formats",void 0),(0,i.A)(this,"avpacketPool",void 0),(0,i.A)(this,"delay",void 0),(0,i.A)(this,"enable",void 0),this.options=S.X$({},e),this.ended=!1,this.pulling=!1,this.queue=[],this.delay=BigInt(0),this.demuxer2SubtitleRenderChannels=new(a()),this.leftPorts=new(a()),e.avpacketList&&(this.avpacketPool=new A.A((0,d.A)(e.avpacketList,l.A),e.avpacketListMutex)),this.createDecoder(),this.render=new v.A(this.options.dom,{header:this.getAssHeader(this.options.codecpar),container:this.options.container,videoWidth:this.options.videoWidth,videoHeight:this.options.videoHeight}),this.loop=new p.A((()=>{!this.queue.length&&this.ended&&this.loop.stop(),this.queue.length<6&&!this.ended&&this.pull();const e=this.options.getCurrentTime()-this.delay;for(this.render.clear(e);this.queue.length;){const t=this.queue[0];if(t.Start>e)break;t.End>e&&this.render.render(t),this.queue.shift()}}),0,50,!1)}getAssHeader(e){let t="";if(94230===c.f[15](e+4)&&c.f[15](e+16)){t=b.decode((0,m.s3)(c.f[20](e+12),c.f[15](e+16)));const i=t.split(/\r?\n/);let r=!1;for(let e=0;e<i.length;e++){var s;const t=o()(s=i[e]).call(s);"[Events]"===t&&(r=!0),/^Format:/.test(t)&&r&&(this.formats=y.Bp(o()(t).call(t)))}}return t}createDecoder(){this.decoder&&this.decoder.close(),this.decoder=new u.A({onReceiveSubtitle:e=>{for(let t=0;t<e.rects.length;t++){const s=e.rects[t];if(3===s.type){const t=y.wj(this.formats,s.text);null==t.Start&&(t.Start=e.pts),null==t.End&&(t.End=e.pts+e.duration),this.queue.push(t)}else 2===s.type?this.queue.push(this.webvtt2AssEvent(s.text,e.pts,e.pts+e.duration)):this.queue.push(this.text2AssEvent(s.text,e.pts,e.pts+e.duration))}}}),this.decoder.open(this.options.codecpar)}text2AssEvent(e,t,s){return{type:1,ReadOrder:0,Layer:0,Start:t,End:s,Style:"Default",Name:"",MarginL:0,MarginR:0,MarginV:0,Text:{raw:e,combined:e,parsed:[{tags:[],text:e,drawing:[]}]}}}webvtt2AssEvent(e,t,s){for(let t=0;t<q.length;t++)e=e.replace(q[t].reg,q[t].value);return this.text2AssEvent(e,t,s)}async pull(){if(this.pulling&&!this.ended)return;this.pulling=!0;const e=this.currentPort,t=await this.leftPorts.get(this.currentPort).request("pull");var s;if(-1048576===t)f.Yz("SubtitleRender end",B,291),null===(s=this.decoder)||void 0===s||s.flush(),this.ended=!0;else if(t<0)f.Yz(`SubtitleRender pull avpacket error, ret: ${t}`,B,296),this.ended=!0;else if(this.loop&&e===this.currentPort){h.M[17](t+8,(0,x.Mr)(c.f[17](t+8),t+72,w.i0)),h.M[17](t+48,(0,x.Mr)(c.f[17](t+48),t+72,w.i0));const e=this.decoder.decode(t);this.avpacketPool?this.avpacketPool.release(t):(0,k.Qe)(t),e<0&&(f.Yz(`SubtitleRender decode avpacket error, ret: ${t}`,B,310),this.ended=!0)}else this.avpacketPool?this.avpacketPool.release(t):(0,k.Qe)(t);this.pulling=!1}getDemuxerPort(e){if(this.demuxer2SubtitleRenderChannels.has(e))return this.demuxer2SubtitleRenderChannels.get(e).port1;const t=new MessageChannel,s=new g.Ay(t.port2);return this.demuxer2SubtitleRenderChannels.set(e,t),this.leftPorts.set(e,s),t.port1}start(){this.loop.isStarted()||this.loop.start(),this.ended=!1}stop(){this.loop.stop(),this.render.clearAll()}pause(){this.loop.stop()}reset(){this.queue.length=0,this.render.clearAll()}reopenDecoder(e){this.options.codecpar=e,this.createDecoder(),this.render.updateHeader(this.getAssHeader(e))}updateVideoResolution(e,t){e===this.options.videoWidth&&t===this.options.videoHeight||(this.render.updateVideoResolution(e,t),this.options.videoWidth=e,this.options.videoHeight=t)}setDemuxTask(e){this.currentPort!==e&&(this.pulling=!1),this.currentPort=e}destroy(){this.loop.destroy(),this.loop=null,this.leftPorts.clear(),this.demuxer2SubtitleRenderChannels.clear(),this.queue.length=0,this.render.destroy(),this.render=null,this.decoder.close(),this.decoder=null}setDelay(e){this.delay=e}getDelay(){return this.delay}}},74762:(e,t,s)=>{s.d(t,{q:()=>o});var i=s(79331),r=s(67672),a=s(72739),n=s(54825);function o(e){const t=(0,i.A)(e,{aloneValueName:"context"});if(!t.tt)return{queue:[],head:{}};const s=[];function o(e){let t="";return a.__(e,(e=>{r.Yj(e)?t+=e:e.context?t+=`<${e.tagName}>${e.context}</${e.tagName}>`:t+=`<${e.tagName}/>`})),t}function l(e,t,i){let l=(0,n.j)(t||e.begin),d=e.context||"",c=e.region||"Default",h="";r.YO(d)&&(d=o(d)),r.YO(e.span)?a.__(e.span,(e=>{e.context&&(l===-BigInt(1)&&e.begin&&(l=(0,n.j)(e.begin)),!c&&e.region&&(c=e.region),r.Yj(e.context)?(d+=e.context,e.br&&(d+="<br>")):(d+=o(e.context),e.br&&(d+="<br>"))),e.end&&(h=e.end)})):e.span&&(e.span.context&&(l===-BigInt(1)&&e.span.begin&&(l=(0,n.j)(e.span.begin)),!c&&e.span.region&&(c=e.span.region),r.Yj(e.span.context)?d+=e.span.context:d+=o(e.span.context)),e.span.end&&(h=e.span.end)),s.push({context:d,pts:l,region:c,duration:e.dur?(0,n.j)(e.dur):(0,n.j)(i||e.end||h)-l})}function d(e,t,s){r.YO(e)?a.__(e,(e=>{l(e,t,s)})):l(e,t,s)}return t.tt.body&&t.tt.body.div&&(r.YO(t.tt.body.div)?a.__(t.tt.body.div,(e=>{e.p&&d(e.p,e.begin,e.end)})):t.tt.body.div.p&&d(t.tt.body.div.p,t.tt.body.div.begin,t.tt.body.end)),{queue:s,head:t.tt.head||{}}}},54825:(e,t,s)=>{s.d(t,{j:()=>a,t:()=>n});var i=s(11265),r=s.n(i);function a(e){var t,s,i;if(!e)return-BigInt(1);let a=(e=r()(e).call(e)).split(":"),n=BigInt(0);var o;if(3===a.length&&(n+=BigInt(+r()(o=a.shift()).call(o))*BigInt(36e5)),n+=BigInt(+r()(t=a.shift()).call(t))*BigInt(6e4),a=r()(s=a.shift()).call(s).split("."),n+=BigInt(+r()(i=a.shift()).call(i))*BigInt(1e3),a.length){var l,d;let e=r()(l=a[0]).call(l).length,t=BigInt(+r()(d=a.shift()).call(d));1===e?t*=BigInt(100):2===e&&(t*=BigInt(10)),n+=t}return n}function n(e){var t,s,i;if(!e)return-BigInt(1);let a=(e=r()(e).call(e)).split(":"),n=BigInt(0);var o;if(3===a.length&&(n+=BigInt(+r()(o=a.shift()).call(o))*BigInt(36e5)),n+=BigInt(+r()(t=a.shift()).call(t))*BigInt(6e4),a=r()(s=a.shift()).call(s).split(","),n+=BigInt(+r()(i=a.shift()).call(i))*BigInt(1e3),a.length){var l,d;let e=r()(l=a[0]).call(l).length,t=BigInt(+r()(d=a.shift()).call(d));1===e?t*=BigInt(100):2===e&&(t*=BigInt(10)),n+=t}return n}},79331:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(66615),r=s.n(i),a=s(72739);const n={aloneValueName:"_@attribute"},o=[" ","/",'"',"'","<",">"];function l(e,t=n){e=(e=(e=(e=e.replace(/<!--[\s\S]*?-->/g,"")).replace(/[\n\t\r]/g,"")).replace(/>[ \t]+</g,"><")).replace(/<\?[^>]*\?>/g,"");const s=[];let i=0;function l(e,i){const a=s[s.length-1];a&&(e!==t.aloneValueName||null==a.obj[t.aloneValueName]?null==a.obj[e]?a.obj[e]=i:r()(a.obj[e])?a.obj[e].push(i):a.obj[e]=[a.obj[e],i]:a.obj[t.aloneValueName]=[a.obj[t.aloneValueName],{tagName:e,...i}])}function d(t){for(;i<e.length;){if(e[i]===t)return!0;i++}return!1}function c(){h();let t="";for(;i<e.length&&!a.zy(o,e[i]);)t+=e[i],i++;return t}function h(){for(;i<e.length&&/\s|\r|\n/.test(e[i]);)i++}const u=/\s/,g=/'/,p=/"/;function f(){if(i>=e.length)return!0;h();let t=u;'"'!==e[i]&&"'"!=e[i]||(t='"'===e[i]?p:g,i++);let s="";for(;i<e.length;){if(t.test(e[i])){i++;break}s+=e[i],i++}return s}function v(){h();let t="";for(;i<e.length&&"<"!==e[i];)t+=e[i],i++;return t}function b(){for(;"<"===e[i];){const t=i;if(i++,h(),"/"!==e[i]){i=t;break}if(i++,c()===s[s.length-1].tag){if(s.length>1){const e=s.pop();l(e.tag,e.obj)}d(">"),i++,h()}else s.pop(),d(">"),i++,h()}}return function r(){if(i>=e.length)return;let a=i;if(h(),"<"!==e[i])return i=a,l(t.aloneValueName,v()),b(),r();let n=d("<");if(!n)return;a=i,i++;const o=c();if(s.push({obj:{},tag:o,start:a}),function(){for(;h(),">"!==e[i]&&"/"!==e[i];){let e=c();if(!e)break;"="===e[e.length-1]?e=e.substring(0,e.length-1):(d("="),i++),l(e,f())}}(),h(),"/"===e[i]){if(i++,s.length>1){const e=s.pop();l(e.tag,e.obj)}return d(">"),i++,b(),r()}n=d(">"),n&&(i++,h(),"<"!==e[i]&&(l(t.aloneValueName,v()),h()),b(),r())}(),{[s[0].tag]:s[0].obj}}}}]);