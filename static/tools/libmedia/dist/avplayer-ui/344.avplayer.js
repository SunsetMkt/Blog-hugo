(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[344],{47344:(t,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>I});var a=s(49859),n=s(11265),i=s.n(n),r=s(71426),c=s.n(r),l=s(50932),o=s(4624),u=s(9705),d=s(85947),h=s(14686),f=s(37837),g=s(71517),p=s(72739),m=s(50011),x=s(51785);const B="src/avformat/formats/IAssFormat.ts";class I extends d.A{constructor(){super(),(0,a.A)(this,"type",20),(0,a.A)(this,"queue",void 0),(0,a.A)(this,"index",void 0)}init(t){this.queue=[]}async readHeader(t){const e=await t.ioReader.readLine();if("[Script Info]"!==i()(e).call(e))return o.z3("the file format is not ass",B,68),u.LR;const s=t.createStream();s.codecpar.codecId=94230,s.codecpar.codecType=3,s.timeBase.den=1e3,s.timeBase.num=1;let a,n=e+"\n",r=!1,c=0,l=0;for(;;){const e=await t.ioReader.readLine();if(!/^;/.test(e)){if("[Events]"===i()(e).call(e)&&(r=!0),/^Format:/.test(e)&&r){n+=e,a=x.Bp(i()(e).call(e));for(let t=0;t<a.length;t++)"Start"===a[t]?c=t:"End"===a[t]&&(l=t);break}n+=e+"\n"}}const d=m.encode(n);s.codecpar.extradata=(0,f.sY)(d.length),s.codecpar.extradataSize=d.length,(0,h.lW)(s.codecpar.extradata,d.length,d),this.index=0;let g=BigInt(0);try{for(;;){var I;const e=t.ioReader.getPos(),n=i()(I=await t.ioReader.readLine()).call(I);if(/^;/.test(n)||/^Comment:/.test(n))continue;const{start:r,end:o}=x.Ew(a,n,c,l);s.nbFrames++,s.duration=o;const u={context:n,startTs:r,endTs:o,pos:e};r>=g?(this.queue.push(u),g=r):p._(this.queue,u,(t=>t.startTs<u.startTs?1:-1))}}catch(t){return 0}}async readAVPacket(t,e){var s;if(!this.queue.length)return u.LR;if(this.index>=this.queue.length)return-1048576;const a=c()(s=t.streams).call(s,(t=>3===t.codecpar.codecType)),n=this.queue[this.index++];l.M[15](e+32,a.index),l.M[15](e+76,a.timeBase.den),l.M[15](e+72,a.timeBase.num),l.M[17](e+16,n.startTs),l.M[17](e+8,n.startTs),l.M[17](e+48,n.endTs-n.startTs);const i=m.encode(n.context),r=(0,f.sY)(i.length);return(0,h.lW)(r,i.length,i),(0,g.NX)(e,r,i.length),0}async seek(t,e,s,a){if(2&a)return BigInt(u.E$);if(s<=BigInt(0))return this.index=0,BigInt(0);const n=p.El(this.queue,(t=>t.startTs>s?-1:1));if(n>=0){for(o.Yz(`seek in cues, found index: ${n}, pts: ${this.queue[n].startTs}, pos: ${this.queue[n].pos}`,B,217),this.index=Math.max(n-1,0);this.index>0&&(this.queue[this.index-1].startTs===this.queue[this.index].startTs||this.queue[this.index-1].endTs>s);)this.index--;return BigInt(0)}return BigInt(u.LR)}getAnalyzeStreamsCount(){return 1}}},85947:(t,e,s)=>{"use strict";s.d(e,{A:()=>n});var a=s(49859);class n{constructor(){(0,a.A)(this,"type",-1),(0,a.A)(this,"onStreamAdd",void 0)}async destroy(t){}}},5028:(t,e,s)=>{"use strict";s.d(e,{Q:()=>a});const a=["ReadOrder","Layer","Start","End","Style","Name","MarginL","MarginR","MarginV","Effect","Text"]},51785:(t,e,s)=>{"use strict";s.d(e,{Bp:()=>p,Ew:()=>x,wj:()=>B});var a=s(71426),n=s.n(a),i=s(18979),r=s.n(i),c=(s(48079),s(11265)),l=s.n(c),o=(s(96319),s(82895),s(4624)),u=s(5028),d=s(54825),h=s(44453),f=s(93935);const g="src/avformat/formats/ass/iass.ts";function p(t){return function(t,e){const s=e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/),a=[];for(let e=0;e<s.length;e++){const i=n()(t).call(t,(t=>t.toLowerCase()===s[e].toLowerCase()));i||o.R8(`not support ass field(${s[e]})`,g,41),a.push(i||s[e])}return a}(u.Q,t)}function m(t,e){let s=e.split(",");if(s.length>t.length){const e=r()(s).call(s,t.length-1).join(",");s=r()(s).call(s,0,t.length-1),s.push(e)}return s}function x(t,e,s,a){const[,,n]=e.match(/^(\w+?)\s*:\s*(.*)/i),i=m(t,n);return{start:(0,d.j)(i[s]),end:(0,d.j)(i[a])}}function B(t,e){const[,s,a]=e.match(/^(\w+?)\s*:\s*(.*)/i);let n=0;switch(s){case"Comment":n=2;break;case"Dialogue":n=1;break;case"Command":n=6;break;case"Movie":n=5;break;case"Picture":n=3;break;case"Sound":n=4}const i=m(t,a),r={type:n};for(let e=0;e<i.length;e++){var c;r[t[e]]=i[e];const s=t[e],a=l()(c=i[e]).call(c);switch(s){case"Layer":case"MarginL":case"MarginR":case"MarginV":r[s]=+a;break;case"Start":case"End":r[s]=(0,d.j)(a);break;case"Effect":r[s]=(0,h.d)(a);break;case"Text":r[s]=(0,f.r)(a);break;default:r[s]=a}}return r}},54825:(t,e,s)=>{"use strict";s.d(e,{j:()=>i,t:()=>r});var a=s(11265),n=s.n(a);function i(t){var e,s,a;if(!t)return-BigInt(1);let i=(t=n()(t).call(t)).split(":"),r=BigInt(0);var c;if(3===i.length&&(r+=BigInt(+n()(c=i.shift()).call(c))*BigInt(36e5)),r+=BigInt(+n()(e=i.shift()).call(e))*BigInt(6e4),i=n()(s=i.shift()).call(s).split("."),r+=BigInt(+n()(a=i.shift()).call(a))*BigInt(1e3),i.length){var l,o;let t=n()(l=i[0]).call(l).length,e=BigInt(+n()(o=i.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),r+=e}return r}function r(t){var e,s,a;if(!t)return-BigInt(1);let i=(t=n()(t).call(t)).split(":"),r=BigInt(0);var c;if(3===i.length&&(r+=BigInt(+n()(c=i.shift()).call(c))*BigInt(36e5)),r+=BigInt(+n()(e=i.shift()).call(e))*BigInt(6e4),i=n()(s=i.shift()).call(s).split(","),r+=BigInt(+n()(a=i.shift()).call(a))*BigInt(1e3),i.length){var l,o;let t=n()(l=i[0]).call(l).length,e=BigInt(+n()(o=i.shift()).call(o));1===t?e*=BigInt(100):2===t&&(e*=BigInt(10)),r+=e}return r}},82895:(t,e,s)=>{t.exports=s(94740)},32347:(t,e,s)=>{"use strict";s(25671);var a=s(92046);t.exports=a.Number.isNaN},25671:(t,e,s)=>{"use strict";s(11091)({target:"Number",stat:!0},{isNaN:function(t){return t!=t}})},94740:(t,e,s)=>{"use strict";var a=s(32347);t.exports=a},74672:(t,e,s)=>{"use strict";function a(t){return t?t.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map((t=>t.split(" ").filter(((t,e)=>!(e&&Number.isNaN(1*t)))))):[]}s.d(e,{O:()=>a})},44453:(t,e,s)=>{"use strict";function a(t){const e=t.toLowerCase().trim().split(/\s*;\s*/);return"banner"===e[0]?{name:e[0],delay:1*e[1]||0,leftToRight:1*e[2]||0,fadeAwayWidth:1*e[3]||0}:/^scroll\s/.test(e[0])?{name:e[0],y1:Math.min(1*e[1],1*e[2]),y2:Math.max(1*e[1],1*e[2]),delay:1*e[3]||0,fadeAwayHeight:1*e[4]||0}:""!==t?{name:t}:null}s.d(e,{d:()=>a})},53534:(t,e,s)=>{"use strict";s.d(e,{E:()=>i});var a=s(74672);const n=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map((t=>({name:t,regex:new RegExp(`^${t}-?\\d`)})));function i(t){const e={};for(let s=0;s<n.length;s++){const{name:a,regex:i}=n[s];if(i.test(t))return e[a]=1*t.slice(a.length),e}if(/^fn/.test(t))e.fn=t.slice(2);else if(/^r/.test(t))e.r=t.slice(1);else if(/^fs[\d+-]/.test(t))e.fs=t.slice(2);else if(/^\d?c&?H?[0-9a-fA-F]+|^\d?c$/.test(t)){const[,s,a]=t.match(/^(\d?)c&?H?(\w*)/);e[`c${s||1}`]=a&&`000000${a}`.slice(-6)}else if(/^\da&?H?[0-9a-fA-F]+/.test(t)){const[,s,a]=t.match(/^(\d)a&?H?([0-9a-f]+)/i);e[`a${s}`]=`00${a}`.slice(-2)}else if(/^alpha&?H?[0-9a-fA-F]+/.test(t))[,e.alpha]=t.match(/^alpha&?H?([0-9a-f]+)/i),e.alpha=`00${e.alpha}`.slice(-2);else if(/^(?:pos|org|move|fad|fade)\([^)]+/.test(t)){const[,s,a]=t.match(/^(\w+)\((.*?)\)?$/);e[s]=a.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip\([^)]+/.test(t)){const s=t.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);e.clip={inverse:/iclip/.test(t),scale:1,drawing:null,dots:null},1===s.length&&(e.clip.drawing=(0,a.O)(s[0])),2===s.length&&(e.clip.scale=1*s[0],e.clip.drawing=(0,a.O)(s[1])),4===s.length&&(e.clip.dots=s.map(Number))}else if(/^t\(/.test(t)){const s=t.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,(t=>t.replace(/,/g,"\n"))).split(/\s*,\s*/);if(!s[0])return e;e.t={t1:0,t2:0,accel:1,tags:s[s.length-1].replace(/\n/g,",").split("\\").slice(1).map(i)},2===s.length&&(e.t.accel=1*s[0]),3===s.length&&(e.t.t1=1*s[0],e.t.t2=1*s[1]),4===s.length&&(e.t.t1=1*s[0],e.t.t2=1*s[1],e.t.accel=1*s[2])}return e}},27637:(t,e,s)=>{"use strict";s.d(e,{r:()=>n});var a=s(53534);function n(t){const e=[];let s=0,n="";const i=t.split("\\").slice(1).concat("").join("\\");for(let t=0;t<i.length;t++){const a=i[t];"("===a&&s++,")"===a&&s--,s<0&&(s=0),s||"\\"!==a?n+=a:(n&&e.push(n),n="")}return e.map(a.E)}},93935:(t,e,s)=>{"use strict";s.d(e,{r:()=>i});var a=s(74672),n=s(27637);function i(t){const e=t.split(/{(.*?)}/),s=[];e[0].length&&s.push({tags:[],text:e[0],drawing:[]});for(let t=1;t<e.length;t+=2){const i=(0,n.r)(e[t]),r=i.reduce(((t,e)=>void 0===e.p?t:!!e.p),!1);s.push({tags:i,text:r?"":e[t+1],drawing:r?(0,a.O)(e[t+1]):[]})}return{raw:t,combined:s.map((t=>t.text)).join(""),parsed:s}}}}]);