"use strict";(self.webpackChunkAVPlayer=self.webpackChunkAVPlayer||[]).push([[85],{85947:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(49859);class s{constructor(){(0,i.A)(this,"type",-1),(0,i.A)(this,"onStreamAdd",void 0)}async destroy(e){}}},25085:(e,t,a)=>{a.r(t),a.d(t,{default:()=>R});var i=a(49859),s=a(52730),r=a.n(s),n=a(86226),o=a.n(n),c=a(71426),d=a.n(c),f=a(63939),l=a(50932),p=a(4624),m=a(9705),u=a(65977),w=a(85199),h=a(85947),g=a(43526),z=a(49922),v=a(72739),k=a(14686),U=a(37837),A=a(71517),I=a(44328),y=a(77231),b=a(39381),x=a(50315),B=a(95335),P=a(16978),S=a(50011),M=a(61619);const D="src/avformat/formats/IIsobmffFormat.ts";class R extends h.A{constructor(e={}){super(),(0,i.A)(this,"type",1),(0,i.A)(this,"context",void 0),(0,i.A)(this,"firstAfterSeek",void 0),(0,i.A)(this,"options",void 0),this.options=e,this.context=(0,z.A)(),e.ignoreEditlist&&(this.context.ignoreEditlist=!0)}init(e){e.ioReader&&e.ioReader.setEndian(!0),this.firstAfterSeek=!1}async readHeader(e){try{var t;const n=await e.ioReader.fileSize();let c=0,h=await e.ioReader.readUint32(),g=await e.ioReader.readUint32();g===(0,u.A)("ftyp")?await w.E6(e.ioReader,this.context,{type:g,size:h-8}):(!n||h<n)&&await e.ioReader.skip(h-8);let z=BigInt(0);for(;!this.context.foundMoov;){const t=e.ioReader.getPos();if(t===n){if(this.context.foundHEIF)break;return p.z3("the file format is not mp4",D,123),m.LR}if(h=await e.ioReader.readUint32(),g=await e.ioReader.readUint32(),1===h&&(h=Number(await e.ioReader.readUint64())),h<8||n&&t+BigInt(Math.floor(h))>n||!/^[\x20-\x7E]{4}$/.test((0,M.A)(g))){if(this.context.foundMdat&&(this.context.foundMoov||this.context.foundHEIF))break;return p.z3(`invalid box size ${h}`,D,144),m.LR}g===(0,u.A)("mdat")?(this.context.foundMdat||(z=t),this.context.foundMdat=!0,await e.ioReader.seek(t+BigInt(Math.floor(h)),!1,!1)):g===(0,u.A)("moov")?(await w.wB(e.ioReader,e,this.context,{size:h-8,type:g}),this.context.foundMoov=!0):g!==(0,u.A)("meta")||this.context.majorBrand!==(0,u.A)("avif")&&this.context.majorBrand!==(0,u.A)("avis")&&this.context.majorBrand!==(0,u.A)("heic")&&this.context.majorBrand!==(0,u.A)("heix")&&this.context.majorBrand!==(0,u.A)("hevc")&&this.context.majorBrand!==(0,u.A)("hevx")&&this.context.majorBrand!==(0,u.A)("mif1")&&this.context.majorBrand!==(0,u.A)("msf1")?await e.ioReader.seek(t+BigInt(Math.floor(h))):await w.jF(e.ioReader,e,this.context,{size:h-8,type:g})}if(!this.context.fragment&&!this.context.foundMdat){const t=await e.ioReader.peekUint64()>>BigInt(32);Number(t)===(0,u.A)("moof")&&(this.context.fragment=!0)}if(this.context.fragment&&1&r()(e.ioReader)){const t=e.ioReader.getPos(),a=await e.ioReader.fileSize();if(a>BigInt(16)){await e.ioReader.seek(a-BigInt(12));let i=await e.ioReader.readUint32();if(i===(0,u.A)("mfro")){await e.ioReader.skip(4);const t=await e.ioReader.readUint32();await e.ioReader.seek(a-BigInt(Math.floor(t)));const s=await e.ioReader.readUint32();i=await e.ioReader.readUint32(),i===(0,u.A)("mfra")&&await w.t9(e.ioReader,e,this.context,{size:s-8,type:i})}await e.ioReader.seek(t)}}var a;if(!this.context.fragment&&this.context.foundMdat&&await e.ioReader.seek(z),this.context.fragment||o()(a=e.streams).call(a,(e=>{if(27===e.codecpar.codecId||173===e.codecpar.codecId||196===e.codecpar.codecId){const t=e.privData;!(e.codecpar.videoDelay>0)||t.cttsSampleCounts&&t.cttsSampleCounts.length||(e.codecpar.flags|=2)}})),this.context.metadata&&B.X$(e.metadata,this.context.metadata),null!==(t=this.context.chapters)&&void 0!==t&&t.length){var i;for(let e=1;e<this.context.chapters.length;e++)this.context.chapters[e-1].end=(0,I.k)(this.context.chapters[e].start,this.context.chapters[e].timeBase,this.context.chapters[e-1].timeBase);const t=this.context.chapters[this.context.chapters.length-1];o()(i=e.streams).call(i,(e=>{const a=(0,I.k)(e.duration,e.timeBase,t.timeBase);a>t.end&&(t.end=a)})),e.chapters.push(...this.context.chapters)}if(this.context.covr){let t=0;switch(this.context.covr.type){case 13:t=7;break;case 14:t=61;break;case 27:t=78;break;default:p.z3(`"Unknown cover type: ${this.context.covr.type}`,D,270)}if(t){this.context.covr.data.length>=8&&78!==t&&(t=v.FB(this.context.covr.data.subarray(0,8),new Uint8Array([137,80,78,71,13,10,26,10]))?61:7);const a=e.createStream();a.privData=(0,P.A)(),a.codecpar.codecId=t,a.codecpar.codecType=0,a.disposition|=1024,a.attachedPic=(0,A._5)(),l.M[15](a.attachedPic+32,a.index);const i=(0,U.sY)(this.context.covr.data.length);(0,k.lW)(i,this.context.covr.data.length,this.context.covr.data),(0,A.NX)(a.attachedPic,i,this.context.covr.data.length),l.M[15](a.attachedPic+36,1|f.f[15](a.attachedPic+36))}}if(this.context.chapterTrack&&1&r()(e.ioReader)&&!this.options.ignoreChapters)for(let t=0;t<this.context.chapterTrack.length;t++){var s;const a=this.context.chapterTrack[t],i=d()(s=e.streams).call(s,(e=>e.privData.trackId===a));if(i){const t=e.ioReader.getPos(),a=i.privData;if(0===i.codecpar.codecType){if(i.disposition|=1024,i.disposition|=2048,!i.attachedPic){const t=a.samplesIndex[0];if(t){await e.ioReader.seek(t.pos),i.attachedPic=(0,A._5)(),l.M[15](i.attachedPic+32,i.index),l.M[17](i.attachedPic+16,t.dts),l.M[17](i.attachedPic+8,t.pts),l.M[15](i.attachedPic+36,f.f[15](i.attachedPic+36)|r()(t)),l.M[15](i.attachedPic+36,1|f.f[15](i.attachedPic+36)),l.M[17](i.attachedPic+56,t.pos);const a=(0,U.sY)(t.size);(0,k.lW)(a,t.size,await e.ioReader.readBuffer(t.size)),(0,A.NX)(i.attachedPic,a,t.size)}}}else{i.codecpar.codecType=2,i.codecpar.codecId=98314,i.discard=48;for(let t=0;t<a.samplesIndex.length;t++){const s=a.samplesIndex[t];await e.ioReader.seek(s.pos);const r=await e.ioReader.readUint16();if(r>s.size-2)continue;let n=s.pts+BigInt(0|s.duration);n<s.pts&&(n=y.Dh),e.chapters.push({id:BigInt(t),timeBase:{den:i.timeBase.den,num:i.timeBase.num},start:s.pts,end:n,metadata:{title:r?S.decode(await e.ioReader.readBuffer(r)):""}})}}await e.ioReader.seek(t)}}return c}catch(t){return p.z3(t.message,D,366),this.context.foundMoov||p.z3("moov not found",D,369),e.ioReader.error}}async readAVPacket_(e,t){const{sample:a,stream:i,encryption:s}=(0,g.G)(e,this.context,r()(e.ioReader));if(!a)return-1048576;{l.M[15](t+32,i.index),l.M[17](t+16,a.dts),2&r()(i.codecpar)||l.M[17](t+8,a.pts),l.M[17](t+48,BigInt(Math.floor(a.duration))),l.M[15](t+36,f.f[15](t+36)|r()(a)),l.M[17](t+56,a.pos),l.M[15](t+76,i.timeBase.den),l.M[15](t+72,i.timeBase.num),i.startTime===y.Dh&&(i.startTime=f.f[17](t+8));const n=f.f[17](t+56)-e.ioReader.getPos();n!==BigInt(0)&&(n>0&&(4&r()(e.ioReader)||2&r()(e.ioReader))&&!this.firstAfterSeek?await e.ioReader.skip(Number(BigInt.asIntN(32,n))):await e.ioReader.seek(f.f[17](t+56))),this.firstAfterSeek&&(this.firstAfterSeek=!1);const o=a.size,c=(0,U.sY)(o);if((0,A.NX)(t,c,o),await e.ioReader.readBuffer(o,(0,k.JW)(c,o)),94226===i.codecpar.codecId&&f.f[15](t+28)>=8){const e=b.Sg(f.f[20](t+24)+4)>>>0,a=f.f[15](t+28);if(e===(0,u.A)("vtte")&&8===a){const e=(0,U.Gy)(1);(0,A.NX)(t,e,1),l.M[15](t+28,1)}if(a>8&&(e===(0,u.A)("vtte")||e===(0,u.A)("vttc"))){let e=f.f[20](t+24)+8;const i=f.f[20](t+24)+a;for(;e<i;){const a=b.Sg(e);if(b.Sg(e+4)>>>0===(0,u.A)("payl")&&a>8){const i=(0,U.sY)(a-8);(0,k.Mr)(i,e+8,a-8),(0,A.NX)(t,i,a-8);break}e+=a}}}if(i.sideData[1]&&1&f.f[15](t+36)){const e=i.sideData[1].length,a=(0,U.sY)(e);(0,A.Ow)(t,1,a,e),(0,k.lW)(a,e,i.sideData[1]),delete i.sideData[1]}if(s){const e=(0,x.zz)(s),a=(0,U.sY)(e.length);(0,k.lW)(a,e.length,e),(0,A.Ow)(t,25,a,e.length)}}return 0}async readAVPacket(e,t){try{var a;if(!d()(a=e.streams).call(a,(e=>{var t;const a=e.privData;return(null===(t=a.samplesIndex)||void 0===t?void 0:t.length)&&!1===a.sampleEnd}))&&this.context.fragment&&!this.context.currentFragment)for(;!this.context.currentFragment;){const t=e.ioReader.getPos(),a=await e.ioReader.readUint32(),i=await e.ioReader.readUint32();i===(0,u.A)("moof")?(this.context.currentFragment={pos:t,size:a,sequence:0,tracks:[],currentTrack:null},this.context.firstMoof||(this.context.firstMoof=t),await w.wZ(e.ioReader,e,this.context,{type:i,size:a-8})):i===(0,u.A)("moov")?await w.wB(e.ioReader,e,this.context,{size:a-8,type:i}):await e.ioReader.skip(a-8)}return await this.readAVPacket_(e,t)}catch(t){return-1048576!==e.ioReader.error&&-1048572!==e.ioReader.error?(p.z3(`read packet error, ${t}`,D,530),m.LR):e.ioReader.error}}async seek(e,t,a,i){const s=e.ioReader.getPos();if(2&i)return await e.ioReader.seek(a),s;const n=a,c=t.privData,d=()=>{var t;this.context.currentFragment=null,o()(t=e.streams).call(t,(e=>{e.privData.samplesIndex.length=0}))};if(16&i&&this.context.fragment){const i=(0,I.k)(a,t.timeBase,y.i0);return await e.ioReader.seek(i,!0),d(),s}if(this.context.fragment){if(c.fragIndexes.length){let t=v.El(c.fragIndexes,(e=>e.time>n?-1:e.time===n?0:1));if(t>-1)return t>0&&c.fragIndexes[t].time>n&&t--,await e.ioReader.seek(c.fragIndexes[t].pos,!0),d(),s}return n===BigInt(0)&&this.context.firstMoof?(await e.ioReader.seek(this.context.firstMoof),d(),s):BigInt(m.E$)}let f=v.El(c.samplesIndex,(e=>e.pts>n?-1:e.pts===n?0:1));if(f>-1&&0===t.codecpar.codecType){let e=f;for(;e>=0;e--)if(1&r()(c.samplesIndex[e])){f=e;break}e<0&&(f=-1)}return f>-1?(c.currentSample=f,c.sampleEnd=!1,v.__(e.streams,(e=>{if(e!==t&&!(1024&e.disposition)){const a=e.privData;let i=(0,I.k)(c.samplesIndex[c.currentSample].pts,t.timeBase,e.timeBase),s=v.El(a.samplesIndex,(e=>e.pts>i?-1:e.pts===i?0:1));if(s>-1&&0===e.codecpar.codecType){let e=s;for(;e>=0;e--)if(1&r()(a.samplesIndex[e])){s=e;break}e<0&&(s=-1)}s>=0?(a.currentSample=s,a.sampleEnd=!1):(a.sampleEnd=!0,a.currentSample=a.samplesIndex.length)}})),this.firstAfterSeek=!0,s):BigInt(m.LR)}getAnalyzeStreamsCount(){return 0}}},91153:(e,t,a)=>{a.d(t,{_l:()=>i,gQ:()=>s});const i=["hmhd","nmhd","iods","xml ","url ","bxml","ipro","mere","stts","ctts","stss","stsz","stz2","stsc","stco","co64","stsd","dref","mvhd","tkhd","mdhd","hdlr"],s=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","vttc","tref","iref","mfra","hnti","hinf","strd","sinf","rinf","schi","trgr","udta","iprp","ipco","strk","meco","encv","enca","sinf","schi","udta","iprp"]},35237:(e,t,a)=>{a.d(t,{p:()=>r});var i=a(48079),s=a.n(i);function r(e,t,a,i,r=0){const n=e.privData;let o=t.baseDataOffset+BigInt(Math.floor(t.dataOffset));(t.baseIsMoof||o<i)&&(o+=a.currentFragment.pos);let c=t.baseMediaDecodeTime;const d=t.sampleSizes,f=t.sampleDurations,l=t.sampleFlags,p=t.sampleCompositionTimeOffset,m=t.remainDataOffsets,u=t.remainDataOffsetIndex;let w=0;const h=[];for(let e=0;e<t.sampleCount;e++){u[w]===e&&(o=t.baseDataOffset+BigInt(Math.floor(m[w])),t.baseIsMoof&&(o+=a.currentFragment.pos),w++);const i={dts:c,pts:c+BigInt(Math.floor(p[e])),pos:o,size:d[e],duration:f[e],flags:0};c+=BigInt(Math.floor(i.duration)),o+=BigInt(Math.floor(i.size)),16842752&l[e]||(i.flags|=1),0===e&&d.length>1&&2&r&&(i.flags|=1),h.push(i)}n.samplesIndex=h;const g=a.cencs?a.cencs[n.trackId]:null;var z;g&&t.cenc&&t.cenc.sampleEncryption&&(n.samplesEncryption=s()(z=t.cenc.sampleEncryption).call(z,(e=>({scheme:g.schemeType,keyId:g.defaultKeyId,skipByteBlock:g.skipByteBlock,cryptByteBlock:g.cryptByteBlock,iv:e.iv,subsamples:e.subsamples}))))}},58949:(e,t,a)=>{a.d(t,{X:()=>o});var i=a(4624),s=a(44328),r=a(77231);const n="src/avformat/formats/isobmff/function/buildIndex.ts";function o(e,t){var a;const o=e.privData,c=o.chunkOffsets,d=o.sampleSizes,f=o.cttsSampleCounts,l=o.cttsSampleOffsets,p=o.stscFirstChunk,m=o.stscSamplesPerChunk,u=o.stssSampleNumbersMap,w=o.sttsSampleCounts,h=o.sttsSampleDeltas;if(!c.length)return;let g=0,z=0,v=0,k=0,U=0,A=0,I=BigInt(0),y=0,b=BigInt(0);const x=[];if(!t.ignoreEditlist&&null!==(a=e.metadata.elst)&&void 0!==a&&a.length){let a=BigInt(0),o=0,c=!1,d=BigInt(0),f=BigInt(0);for(let t=0;t<e.metadata.elst.length;t++){const a=e.metadata.elst[t];0===t&&a.mediaTime===-BigInt(1)?(d=a.segmentDuration,o=1):t===o&&a.mediaTime>=BigInt(0)?f=a.mediaTime:c=!0}c&&i.R8("multiple edit list entries, a/v desync might occur, patch welcome",n,93),(d||f)&&t.timescale>0&&(d&&(d=(0,s.k)(d,{num:1,den:t.timescale},e.timeBase),e.duration!==r.Dh&&(e.duration+=d)),a=f-d,b=-a)}for(let t=0;t<c.length;t++)if(I=c[t],g<p.length-1&&p[g+1]===t+1&&g++,A=m[g],o.isPcm){const e={dts:b,pts:b,pos:I,size:d[0]*A,duration:h[0]*A,flags:1};b+=BigInt(Math.floor(e.duration)),x.push(e)}else for(;A>0;){const t={dts:b,pts:b,pos:I,size:d[y],duration:h[z],flags:0};(u&&u.has(y+1)||1===e.codecpar.codecType)&&(t.flags|=1),l&&(t.pts=t.dts+BigInt(Math.floor(l[k])),U++,U===f[k]&&(k++,U=0)),I+=BigInt(Math.floor(t.size)),b+=BigInt(Math.floor(h[z])),v++,v===w[z]&&(z++,v=0),y++,x.push(t),A--}x.length&&e.duration===r.Dh&&(e.duration=x[y-1].pts+BigInt(Math.floor(x[y-1].duration))),o.samplesIndex=x,e.nbFrames=BigInt(x.length)}},93194:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(77231);function s(){return{trackId:0,baseDataOffset:BigInt(0),defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0,baseMediaDecodeTime:BigInt(0),sampleCount:0,dataOffset:0,remainDataOffsets:[],remainDataOffsetIndex:[],dataOffsetPos:BigInt(0),firstSampleFlags:0,sampleDurations:[],sampleSizes:[],sampleFlags:[],sampleCompositionTimeOffset:[],baseIsMoof:!1,ioWriter:null,buffers:[],lastFragIndexDts:BigInt(0),tfdtDelay:i.Dh,trunPtsDelay:BigInt(0)}}},49922:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(77231);function s(){return{isom:!1,timescale:i.N_,duration:i.Dh,foundMoov:!1,foundMdat:!1,foundHEIF:!1,majorBrand:0,minorVersion:0,compatibleBrand:[],creationTime:BigInt(0),modificationTime:BigInt(0),rate:i.N_,volume:i.N_,matrix:null,nextTrackId:1,fragment:!1,trexs:[],currentFragment:null,boxsPositionInfo:[],holdMoovPos:BigInt(0),currentChunk:null}}},16978:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(77231);function s(){return{chunkOffsets:null,cttsSampleCounts:null,cttsSampleOffsets:null,stscFirstChunk:null,stscSamplesPerChunk:null,stscSampleDescriptionIndex:null,stssSampleNumbersMap:null,stssSampleNumbers:null,sampleSizes:null,sttsSampleCounts:null,sttsSampleDeltas:null,duration:BigInt(0),trackId:i.N_,layer:0,alternateGroup:0,volume:0,matrix:null,width:0,height:0,audioCid:0,samplesPerFrame:0,bytesPerFrame:0,currentSample:0,sampleEnd:!1,samplesIndex:[],samplesEncryption:[],fragIndexes:[],lastPts:i.Dh,lastDts:i.Dh,startDts:i.Dh,startCT:i.N_,startPts:i.Dh,lastDuration:0,chunkCount:0,firstWrote:!1,lastStscCount:0,perStreamGrouping:!1,index:0,flags:0}}},43526:(e,t,a)=>{a.d(t,{G:()=>l});var i=a(86226),s=a.n(i),r=a(52730),n=a.n(r),o=a(71426),c=a.n(o),d=a(77231),f=a(44328);function l(e,t,a){var i;let r,o,l,p,m,u,w,h=BigInt(0);if(s()(i=e.streams).call(i,(e=>{const t=e.privData;if(!t.samplesIndex||!t.samplesIndex.length||48===e.discard)return t.sampleEnd=!0,!0;if(32===e.discard){for(;t.currentSample<t.samplesIndex.length&&!(1&n()(t.samplesIndex[t.currentSample]));)t.currentSample++;if(t.currentSample>=t.samplesIndex.length)return t.sampleEnd=!0,!0}t.sampleEnd||p&&!(t.samplesIndex[t.currentSample].pos<p.pos)||(p=t.samplesIndex[t.currentSample],m=e),t.sampleEnd||u&&!((0,f.k)(t.samplesIndex[t.currentSample].dts,e.timeBase,d.KR)<h)||(u=t.samplesIndex[t.currentSample],h=(0,f.k)(u.dts,e.timeBase,d.KR),w=e)})),p&&u){const t=(0,f.k)(p.dts,m.timeBase,d.KR),i=(0,f.k)(u.dts,w.timeBase,d.KR);Math.abs(Number(t-i))<1e6||2&n()(e.ioReader)||4&n()(e.ioReader)||!(1&a)?(r=p,o=m):(r=u,o=w)}else p?(r=p,o=m):u&&(r=u,o=w);if(o){const e=o.privData;l=e.samplesEncryption[e.currentSample],e.currentSample++,e.currentSample>=e.samplesIndex.length&&(e.sampleEnd=!0)}if(t.fragment){var g;const a=!!c()(g=e.streams).call(g,(e=>!1===e.privData.sampleEnd));a||(t.currentFragment=null)}return{sample:r,stream:o,encryption:l}}},96108:(e,t,a)=>{a.d(t,{c:()=>i});const i={"@PRM":"premiere_version","@PRQ":"quicktime_version",XMP_:"xmp",aART:"albumArtist",akID:"account_type",apID:"account_id",catg:"category",cpil:"compilation",cprt:"copyright",desc:"description",disk:"disc",egid:"episode_uid",FIRM:"firmware",gnre:"genre",hdvd:"hd_video",HMMT:"hmmt",keyw:"keywords",ldes:"synopsis",loci:"loci",manu:"make",modl:"model",pcst:"podcast",pgap:"gapless_playback",purd:"purchase_date",rtng:"rating",soaa:"albumArtistSort",soal:"albumSort",soar:"artistSort",soco:"composerSort",sonm:"nameSort",sosn:"showSort",stik:"media_type",trkn:"track",tven:"episode_id",tves:"episode_sort",tvnn:"network",tvsh:"show",tvsn:"season_number","©ART":"albumArtist","©PRD":"producer","©alb":"album","©aut":"artist","©chp":"chapter","©cmt":"comment","©com":"composer","©cpy":"copyright","©day":"date","©dir":"director","©dis":"disclaimer","©ed1":"edit_date","©enc":"encoder","©fmt":"original_format","©gen":"genre","©grp":"grouping","©hst":"host_computer","©inf":"comment","©lyr":"lyrics","©mak":"make","©mod":"mod","©nam":"title","©ope":"original_artist","©prd":"producer","©prf":"performer","©req":"playback_requirements","©src":"original_source","©st3":"subtitle","©swr":"encoder","©too":"encoder","©trk":"track","©url":"url","©wrn":"warning","©wrt":"composer","©xyz":"location"}},85199:(e,t,a)=>{a.d(t,{E6:()=>N,jF:()=>L,t9:()=>O,wB:()=>T,wZ:()=>E});var i=a(31721),s=a.n(i),r=a(71426),n=a.n(r),o=a(86226),c=a.n(o),d=a(52730),f=a.n(d),l=a(61499),p=a(68960),m=a(24175),u=a(65977),w=a(91153),h=a(20559),g=a(4624),z=a(35237),v=a(58949),k=a(93194),U=a(16978),A=a(37837),I=a(14686),y=a(77231),b=a(50315),x=a(71517),B=a(61619),P=a(96108),S=a(65762),M=a(54916),D=a(95335),R=a(9705);const $="src/avformat/formats/isobmff/iisobmff.ts";async function N(e,t,a){const i=e.getPos()+BigInt(Math.floor(a.size));for(t.majorBrand=await e.readUint32(),t.minorVersion=await e.readUint32(),t.majorBrand===(0,u.A)("qt  ")&&(t.isom=!0);e.getPos()<i;)t.compatibleBrand.push(await e.readUint32())}async function C(e,t,a,i){const r=e.getPos()+BigInt(Math.floor(a.size));for(;e.getPos()<r;){const r=await e.readUint32(),n=await e.readUint32();if(r<8)return void g.z3(`invalid box size ${r}`,$,83);if(h.A[n])await h.A[n](e,t,{type:n,size:r-8},i);else if(n===(0,u.A)("mdia")){let a=!1,n=BigInt(0);const o=e.getPos()+BigInt(Math.floor(r-8));for(;e.getPos()<o;){const r=await e.readUint32(),o=await e.readUint32();o===(0,u.A)("hdlr")?(await h.A[o](e,t,{type:o,size:r-8},i),a=!0):o===(0,u.A)("minf")&&a?await C(e,t,{type:o,size:r-8},i):o!==(0,u.A)("minf")||a?h.A[o]?await h.A[o](e,t,{type:o,size:r-8},i):s()(w.gQ).call(w.gQ,(e=>(0,u.A)(e)===o))?await C(e,t,{type:o,size:r-8},i):await e.skip(r-8):(n=e.getPos()-BigInt(8),await e.skip(r-8))}if(n){const a=e.getPos();await e.seek(n);const s=await e.readUint32(),r=await e.readUint32();await C(e,t,{type:r,size:s-8},i),await e.seek(a)}}else if(s()(w.gQ).call(w.gQ,(e=>(0,u.A)(e)===n)))await C(e,t,{type:n,size:r-8},i);else if(n===(0,u.A)("name")&&a.type===(0,u.A)("udta")&&r-8>0){const a=await e.readString(r-8);t?t.metadata.title=a:(i.metadata||(i.metadata={}),i.metadata.title=a)}else if(a.type===(0,u.A)("udta")&&P.c[(0,B.A)(n)]&&r-8>0){const a=await(0,S.G)(e,r-8,{});a.length&&(t?t.metadata[P.c[(0,B.A)(n)]]=1===a.length?a[0]:a:(i.metadata||(i.metadata={}),i.metadata[P.c[(0,B.A)(n)]]=1===a.length?a[0]:a))}else await e.skip(r-8)}}async function T(e,t,a,i){var r;a.parseOneBox=C,a.parsers=h.A;const o=e.getPos()+BigInt(Math.floor(i.size));for(;e.getPos()<o;){const i=await e.readUint32(),r=await e.readUint32();if(i<8)return void g.z3(`invalid box, type: ${r}, size ${i}`,$,245);if(h.A[r])await h.A[r](e,null,{type:r,size:i-8},a);else if(r===(0,u.A)("trak"))if(!a.foundMoov||a.fragment){const s=t.createStream();if(s.privData=(0,U.A)(),await C(e,s,{type:r,size:i-8},a),a.fragment){var d;const e=s.privData,a=n()(d=t.streams).call(d,(t=>{const a=t.privData;if(t.index!==s.index&&a.trackId===e.trackId)return!0}));a?(s.sideData[1]&&(a.sideData[1]=s.sideData[1],a.codecpar.extradata&&(0,A.Eb)(a.codecpar.extradata),a.codecpar.extradataSize=a.sideData[1].length,a.codecpar.extradata=(0,A.sY)(a.codecpar.extradataSize),(0,I.lW)(a.codecpar.extradata,a.codecpar.extradataSize,a.sideData[1]),s.codecpar.width!==y.N_&&e.width>0&&(a.codecpar.width=e.width),s.codecpar.width!==y.N_&&e.height>0&&(a.codecpar.height=e.height)),t.removeStream(s),t.streamIndex--):(s.codecpar.width===y.N_&&e.width>0&&(s.codecpar.width=e.width),s.codecpar.width===y.N_&&e.height>0&&(s.codecpar.height=e.height))}else(0,v.X)(s,a)}else await e.skip(i-8);else r===(0,u.A)("mvex")?(a.fragment=!0,await C(e,null,{type:r,size:i-8},a)):s()(w.gQ).call(w.gQ,(e=>(0,u.A)(e)===r))?await C(e,null,{type:r,size:i-8},a):await e.skip(i-8)}c()(r=t.streams).call(r,(e=>{if(a.encryptionInitInfos){const t=(0,b.bE)(a.encryptionInitInfos),i=(0,A.sY)(t.length);(0,I.lW)(i,t.length,t),(0,x.$W)(e.codecpar[l.o9]+20,e.codecpar[l.o9]+24,24,i,t.length)}if(a.cencs){const t=e.privData,i=a.cencs[t.trackId];i&&(e.metadata.encryption={schemeType:i.schemeType,schemeVersion:i.schemeVersion,cryptByteBlock:i.cryptByteBlock,skipByteBlock:i.skipByteBlock,perSampleIVSize:i.defaultPerSampleIVSize,kid:i.defaultKeyId,constantIV:i.defaultConstantIV,pattern:i.pattern})}}))}async function E(e,t,a,i){const s=e.getPos()+BigInt(Math.floor(i.size));for(;e.getPos()<s;){const i=await e.readUint32(),s=await e.readUint32();if(i<8)return void g.z3(`invalid box, type: ${s}, size ${i}`,$,392);if(h.A[s])await h.A[s](e,null,{type:s,size:i-8},a);else if(s===(0,u.A)("traf")){var r;const o=(0,k.A)();a.currentFragment.currentTrack=o,await C(e,null,{type:s,size:i-8},a),a.currentFragment.tracks.push(o),a.currentFragment.currentTrack=null;const c=n()(r=t.streams).call(r,(e=>e.privData.trackId===o.trackId));if(c){const e=c.privData;o.streamIndex=c.index,(0,z.p)(c,o,a,t.ioReader.getPos(),f()(t.ioReader)),e.currentSample=0,e.sampleEnd=!1}}else await e.skip(i-8)}}async function O(e,t,a,i){var s,r;const o=e.getPos()+BigInt(Math.floor(i.size)),d={};for(c()(s=t.streams).call(s,(e=>{const t=e.privData;d[e.index]={samples:t.samplesIndex,currentSample:t.currentSample,sampleEnd:t.sampleEnd},t.samplesIndex=[]}));e.getPos()<o;){const i=e.getPos(),s=await e.readUint32();if(await e.readUint32()===(0,u.A)("tfra")){var f;const i=await e.readUint8();await e.skip(3);const s=await e.readUint32(),r=await e.readUint32(),o=await e.readUint32(),c=n()(f=t.streams).call(f,(e=>e.privData.trackId===s));if(c){const s=c.privData;let n,d;for(let t=0;t<o;t++){1===i?(n=await e.readUint64(),d=await e.readUint64()):(n=BigInt(Math.floor(await e.readUint32())),d=BigInt(Math.floor(await e.readUint32()))),s.fragIndexes.push({pos:d,time:n});for(let t=0;t<1+(r>>4&3);t++)await e.skip(1);for(let t=0;t<1+(r>>2&3);t++)await e.skip(1);for(let t=0;t<1+(3&r);t++)await e.skip(1)}if(s.fragIndexes.length){await e.seek(s.fragIndexes[s.fragIndexes.length-1].pos);const i=await e.readUint32(),r=await e.readUint32();if(r===(0,u.A)("moof")&&(a.currentFragment={pos:BigInt(0),size:i,sequence:0,tracks:[],currentTrack:null},await E(e,t,a,{size:i,type:r}),s.samplesIndex.length)){const e=s.samplesIndex[s.samplesIndex.length-1];c.duration=e.pts+BigInt(Math.floor(e.duration)),s.samplesIndex.length=0}}}}await e.seek(i+BigInt(Math.floor(s)),!1,!1)}a.currentFragment=null,c()(r=t.streams).call(r,(e=>{var t,a,i,s,r,n;const o=e.privData;o.samplesIndex=null!==(t=null===(a=d[e.index])||void 0===a?void 0:a.samples)&&void 0!==t?t:[],o.currentSample=null!==(i=null===(s=d[e.index])||void 0===s?void 0:s.currentSample)&&void 0!==i?i:0,o.sampleEnd=null!==(r=null===(n=d[e.index])||void 0===n?void 0:n.sampleEnd)&&void 0!==r&&r}))}async function F(e,t,a,i,s){let r=BigInt(0);if(a.item.isIdatRelative){if(!s.heif.idatOffset)return g.R8("missing idat box required by the image grid",$,556),R.nr;r=s.heif.idatOffset}if(!(1&f()(e)))return g.z3("grid box with non seekable input",$,562),R.nr;const o=e.getPos();await e.seek(BigInt(a.item.extentOffset)+r),await e.readUint8();const c=await e.readUint8(),d=await e.readUint8()+1,l=await e.readUint8()+1;i.width=1&c?await e.readUint32():await e.readUint16(),i.height=1&c?await e.readUint32():await e.readUint16(),await e.seek(o);let p=d*l;if(p!==a.tileIdList.length)return R.nr;i.codedWidth=0,i.codedHeight=0;for(let e=0;e<l;e++){var m;let s=n()(m=t.streams).call(m,(t=>t.privData.trackId===a.tileIdList[e]));if(!s)return R.nr;i.codedWidth+=s.codecpar.width}for(let e=0;e<p;e+=l){var u;let s=n()(u=t.streams).call(u,(t=>t.privData.trackId===a.tileIdList[e]));if(!s)return R.nr;i.codedHeight+=s.codecpar.height}i.offsets=new Array(p);let w=0,h=0,z=0;for(;h<i.codedHeight;){var v;let e=z;for(;w<i.codedWidth;){var k;if(z===p)return R.nr;let e=n()(k=t.streams).call(k,(e=>e.privData.trackId===a.tileIdList[z]));if(!e)return R.nr;i.offsets[z]={idx:e.id,horizontal:w,vertical:h},w+=e.codecpar.width,z++}if(w>i.codedWidth)return g.z3("Non uniform HEIF tiles",$,631),R.nr;w=0;let s=n()(v=t.streams).call(v,(t=>t.privData.trackId===a.tileIdList[e]));if(!s)return R.nr;h+=s.codecpar.height}return h>i.codedHeight||z!==p?(g.z3("Non uniform HEIF tiles",$,646),R.nr):0}async function _(e,t,a,i,s){let r=BigInt(0);if(a.item.isIdatRelative){if(!s.heif.idatOffset)return g.R8("missing idat box required by the image grid",$,661),R.nr;r=s.heif.idatOffset}if(!(1&f()(e)))return g.z3("grid box with non seekable input",$,667),R.nr;const o=e.getPos();await e.seek(BigInt(a.item.extentOffset)+r),await e.readUint8();const c=await e.readUint8();i.background=[];for(let t=0;t<4;t++)i.background.push(await e.readUint16());i.width=i.codedWidth=1&c?await e.readUint32():await e.readUint16(),i.height=i.codedHeight=1&c?await e.readUint32():await e.readUint16(),i.offsets=new Array(a.tileIdList.length);for(let s=0;s<a.tileIdList.length;s++){var d;let r=n()(d=t.streams).call(d,(e=>e.privData.trackId===a.tileIdList[a.tileIdList[s]]));if(!r)return R.nr;i.offsets[s]={idx:r.id,horizontal:1&c?await e.readUint32():await e.readUint16(),vertical:1&c?await e.readUint32():await e.readUint16()}}await e.seek(o)}async function L(e,t,a,i){var r;a.parseOneBox=C,a.parsers=h.A;const o=e.getPos()+BigInt(Math.floor(i.size));for(a.heif={},i.size>12&&"hdlr"===(await e.peekString(12)).substring(8)&&await e.skip(4);e.getPos()<o;){const t=await e.readUint32(),i=await e.readUint32();if(t<8)return void g.z3(`invalid box, type: ${i}, size ${t}`,$,728);i===(0,u.A)("hdlr")?await e.skip(t-8):i===(0,u.A)("idat")?(a.heif.idatOffset=e.getPos(),await e.skip(t-8)):h.A[i]?await h.A[i](e,null,{type:i,size:t-8},a):s()(w.gQ).call(w.gQ,(e=>(0,u.A)(e)===i))?await C(e,null,{type:i,size:t-8},a):await e.skip(t-8)}const d=e.getPos();if(a.heif.foundIloc&&a.heif.foundIinf&&null!==(r=a.heif.items)&&void 0!==r&&r.length){a.foundHEIF=!0;const i=new m.A;for(let e=0;e<a.heif.items.length;e++){const s=a.heif.items[e];if("av01"!==s.type&&"hvc1"!==s.type)continue;const r=t.createStream(),n=(0,U.A)();if(r.privData=n,n.trackId=s.id,r.codecpar.codecType=0,M.uf[(0,u.A)(s.type)]&&(r.codecpar.codecId=M.uf[(0,u.A)(s.type)]),r.nbFrames=BigInt(1),r.codecpar.framerate.den=1,r.codecpar.framerate.num=1,r.timeBase.den=1,r.timeBase.num=1,a.heif.primaryId===s.id&&(r.disposition|=1),s.name&&(r.metadata.title=s.name),s.ipma&&a.heif.ipcoItem)for(let e=0;e<s.ipma.length;e++){const t=a.heif.ipcoItem[s.ipma[e]];t&&h.A[t.tag]&&(i.reset(),i.appendBuffer(t.data),a.heif.currentItem=s,await h.A[t.tag](i,r,{type:t.tag,size:t.data.length},a),a.heif.currentItem=null)}let o=BigInt(0);s.isIdatRelative&&(a.heif.idatOffset||(g.R8(`Missing idat box for item ${s.id}`,$,817),t.removeStream(r),t.streamIndex--),o=a.heif.idatOffset),n.samplesIndex=[{pos:BigInt(s.extentOffset)+o,dts:BigInt(0),pts:BigInt(0),size:s.extentLength,flags:1,duration:y.N_}]}if(a.heif.grid)for(let s=0;s<a.heif.grid.length;s++){const r=a.heif.grid[s];if(r.item){var l;const s=t.createStreamGroup(3);var z;if(s.privData=r,s.params=new p.de,null!==(l=r.tileIdList)&&void 0!==l&&l.length&&c()(z=r.tileIdList).call(z,(e=>{var a;const i=n()(a=t.streams).call(a,(t=>t.privData.trackId===e));i&&t.addStreamToStreamGroup(s,i)})),r.item.id===a.heif.primaryId&&(s.disposition|=1),r.item.name&&(s.metadata.title=r.item.name),r.item.ipma&&a.heif.ipcoItem)for(let e=0;e<r.item.ipma.length;e++){const t=a.heif.ipcoItem[r.item.ipma[e]];t&&h.A[t.tag]&&(i.reset(),i.appendBuffer(t.data),a.heif.currentItem=r.item,await h.A[t.tag](i,s.params,{type:t.tag,size:t.data.length},a),a.heif.currentItem=null)}if("grid"===r.item.type){if(await F(e,t,r,s.params,a)<0){t.removeStreamGroup(s),t.streamGroupIndex--;continue}}else if("iovl"===r.item.type&&await _(e,t,r,s.params,a)<0){t.removeStreamGroup(s),t.streamGroupIndex--;continue}if(r.item.rotation||r.item.hflip||r.item.vflip){const e=new Float32Array(9),t=r.item.rotation*Math.PI/180,a=Math.cos(t),i=Math.sin(t);e[0]=a,e[1]=-i,e[3]=i,e[4]=a,e[8]=1073741824;const n=[1-2*(r.item.hflip?1:0),1-2*(r.item.vflip?1:0),1];if(r.item.hflip||r.item.vflip)for(let t=0;t<9;t++)e[t]*=n[t%3];s.params.sideData[5]=new Uint8Array(e.buffer)}}}for(let i=0;i<a.heif.items.length;i++){const s=a.heif.items[i];if(s.refs){const i=D.HP(s.refs);for(let r=0;r<i.length;r++){const o=i[r],c=s.refs[o];if("thmb"===o){var v;const e=n()(v=t.streams).call(v,(e=>e.privData.trackId===c));e&&(e.disposition|=8192)}else{var k;let i=n()(k=a.heif.items).call(k,(e=>e.id===c));if(i&&"Exif"===i.type&&1&f()(e)){var A;let s=BigInt(0);if(i.isIdatRelative){if(!a.heif.idatOffset){g.R8(`Missing idat box for item ${i.id}`,$,934);continue}s=a.heif.idatOffset}const r=e.getPos();await e.seek(BigInt(i.extentOffset)+s);const o=await e.readBuffer(i.extentLength);await e.seek(r);let c=n()(A=t.streams).call(A,(e=>e.privData.trackId===i.id));if(c)c.sideData[40]=o;else{var I;const e=n()(I=t.streamGroups).call(I,(e=>{const t=e.privData;if(t.item.refs)return D.zy(D.BE(t.item.refs),i.id)}));e&&(e.params.sideData[40]=o)}}}}}}}await e.seek(d)}},54916:(e,t,a)=>{a.d(t,{Q9:()=>r,f3:()=>n,uf:()=>o,zs:()=>s});var i=a(65977);const s={86018:64,86017:105,86076:173,86028:193,86021:221,12:32,27:33,173:35,196:51,167:177,0:0},r={32:12,33:27,35:173,51:196,177:167,64:86018,102:86018,103:86018,104:86018,105:86017,107:86017,173:86076,193:86028,221:86021,0:0},n={vide:0,pict:0,soun:1,clcp:3,sbtl:3,subt:3,subp:3,text:3},o={[(0,i.A)("mp4a")]:86018,1836253269:86017,[(0,i.A)("Opus")]:86076,[(0,i.A)("fLaC")]:86028,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[i.A.mp4v]:12,[(0,i.A)("av01")]:225,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("avc1")]:27,[(0,i.A)("avc3")]:27,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213,[(0,i.A)("png ")]:61,[(0,i.A)("MNG ")]:61,[(0,i.A)("gif ")]:97,[(0,i.A)("tiff")]:96,[(0,i.A)("H263")]:4,[(0,i.A)("3IVD")]:16}},91048:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(4624),n=a(14686),o=a(37837),c=a(21477);const d="src/avformat/formats/isobmff/parsing/av1c.ts";async function f(e,t,a,i){const f=e.getPos();if(t.codecpar.codecId=225,a.size<=0)return;const l=(0,o.sY)(a.size),p=await e.readBuffer(a.size,(0,n.JW)(l,a.size));i.foundMoov?(t.sideData[1]=s()(p).call(p),(0,o.Eb)(l)):(t.codecpar.extradata&&(0,o.Eb)(t.codecpar.extradata),t.codecpar.extradata=l,t.codecpar.extradataSize=a.size,c.XC(t,p));const m=a.size-Number(e.getPos()-f);m>0?await e.skip(m):m<0&&r.z3(`read avcc error, size: ${a.size}, read: ${a.size-m}`,d,66)}},8046:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(37837),n=a(14686),o=a(4624),c=a(62815);const d="src/avformat/formats/isobmff/parsing/avcc.ts";async function f(e,t,a,i){const f=e.getPos();if(t.codecpar.codecId=27,a.size<=0)return;const l=(0,r.sY)(a.size),p=await e.readBuffer(a.size,(0,n.JW)(l,a.size));i.foundMoov?(t.sideData[1]=s()(p).call(p),(0,r.Eb)(l)):(t.codecpar.extradata&&(0,r.Eb)(t.codecpar.extradata),t.codecpar.extradata=l,t.codecpar.extradataSize=a.size,c.XC(t,p));const m=a.size-Number(e.getPos()-f);m>0?await e.skip(m):m<0&&o.z3(`read avcc error, size: ${a.size}, read: ${a.size-m}`,d,66)}},53077:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/chap.ts";async function r(e,t,a,r){const n=e.getPos(),o=Math.floor(a.size/4);r.chapterTrack=[];for(let t=0;t<o;t++)r.chapterTrack.push(await e.readUint32());const c=a.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read chap error, size: ${a.size}, read: ${a.size-c}`,s,48)}},85456:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(4624),s=a(77231);const r="src/avformat/formats/isobmff/parsing/chpl.ts";async function n(e,t,a,n){const o=e.getPos(),c=await e.readUint8();await e.skip(3),c&&await e.skip(4);const d=await e.readUint8();if(d){const t=[];for(let a=0;a<d;a++){const i=await e.readInt64(),r=await e.readUint8(),n={id:BigInt(a),timeBase:{num:1,den:1e7},start:i,end:s.Dh,metadata:{}};r&&(n.metadata.title=await e.readString(r)),t.push(n)}n.chapters=t}const f=a.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-f}`,r,74)}},69483:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/co64.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[],d=await e.readUint32();if(0===o)for(let t=0;t<d;t++)c.push(await e.readUint64());t.privData.chunkOffsets=c;const f=a.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read co64 error, size: ${a.size}, read: ${a.size-f}`,s,54)}},67755:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(68960),s=a(4624);const r="src/avformat/formats/isobmff/parsing/colr.ts";async function n(e,t,a,n){const o=e.getPos();let c=await e.readString(4);if("nclx"===c||"nclc"===c||"prof"===c){if("prof"===c){const i=await e.readBuffer(a.size-4);t.sideData[28]=i}else if(t instanceof i.Ay){let a=await e.readUint16(),i=await e.readUint16(),s=await e.readUint16();if("nclx"===c){const a=await e.readUint8()>>7;t.codecpar.colorRange=a?2:1}a>=23&&(a=2),i>=19&&(i=2),s>=15&&(s=2),t.codecpar.colorPrimaries=a,t.codecpar.colorTrc=i,t.codecpar.colorSpace=s}}else s.R8(`unsupported color_parameter_type: ${c}`,r,77);const d=a.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&s.z3(`read colr error, size: ${a.size}, read: ${a.size-d}`,r,85)}},62037:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/ctts.ts";async function r(e,t,a,r){const n=e.getPos(),o=t.privData;await e.skip(4);const c=[],d=[],f=await e.readUint32();for(let t=0;t<f;t++)c.push(await e.readUint32()),d.push(await e.readInt32());o.cttsSampleCounts=c,o.cttsSampleOffsets=d;const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read ctts error, size: ${a.size}, read: ${a.size-l}`,s,57)}},37098:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(61499),s=a(63939),r=a(50932),n=a(4624),o=a(71517),c=a(87518),d=a(99991);const f="src/avformat/formats/isobmff/parsing/dac3.ts";async function l(e,t,a,l){const p=e.getPos();if(t.codecpar.codecId=86019,a.size<=0)return;const m=(0,o.E4)(t.codecpar[i.o9]+20,t.codecpar[i.o9]+24,7,4),u=s.f[20](m),w=await e.readUint24(),h=w>>14&7,g=w>>11&7,z=w>>10&1;let v=BigInt(c.j[g]);z&&(v|=BigInt(8)),d.bl(t.codecpar[i.o9]+112),d.ML(t.codecpar[i.o9]+112,v),r.M[15](u,h);const k=a.size-Number(e.getPos()-p);k>0?await e.skip(k):k<0&&n.z3(`read avcc error, size: ${a.size}, read: ${a.size-k}`,f,75)}},36206:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(61499),s=a(63939),r=a(50932),n=a(4624),o=a(71517),c=a(87518),d=a(99991);const f="src/avformat/formats/isobmff/parsing/dec3.ts";async function l(e,t,a,l){const p=e.getPos();if(t.codecpar.codecId=86056,a.size<=0)return;const m=(0,o.E4)(t.codecpar[i.o9]+20,t.codecpar[i.o9]+24,7,4),u=s.f[20](m);await e.skip(2);const w=await e.readUint24(),h=w>>12&31,g=w>>9&7,z=w>>8&1;let v=BigInt(c.j[g]);z&&(v|=BigInt(8)),d.bl(t.codecpar[i.o9]+112),d.ML(t.codecpar[i.o9]+112,v),r.M[15](u,h),t.codecpar.chLayout.nbChannels>1&&7==h&&r.M[15](u,8);const k=a.size-Number(e.getPos()-p);k>0?await e.skip(k):k<0&&n.z3(`read avcc error, size: ${a.size}, read: ${a.size-k}`,f,80)}},22966:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(4624),n=a(37837),o=a(14686),c=a(14769);const d="src/avformat/formats/isobmff/parsing/dfla.ts";async function f(e,t,a,i){const f=e.getPos();t.codecpar.codecId=86028,await e.skip(1),await e.skip(3);const l=await e.readUint8(),p=128&l,m=127&l,u=await e.readUint24();if(0===m&&34===u){const a=(0,n.sY)(u),r=await e.readBuffer(u,(0,o.JW)(a,u));i.foundMoov?(t.sideData[1]=s()(r).call(r),(0,n.Eb)(a)):(t.codecpar.extradata&&(0,n.Eb)(t.codecpar.extradata),t.codecpar.extradata=a,t.codecpar.extradataSize=u,c.XC(t,r))}else r.z3("streaminfo must be first FLACMetadataBlock",d,69);p||r.R8("non streaminfo FLACMetadataBlock(s) ignored",d,73);const w=a.size-Number(e.getPos()-f);w>0?await e.skip(w):w<0&&r.z3(`read vpcc error, size: ${a.size}, read: ${a.size-w}`,d,81)}},28447:(e,t,a)=>{a.d(t,{A:()=>p});var i=a(18979),s=a.n(i),r=a(4624),n=a(37837),o=a(14686),c=a(22576),d=a(31865),f=a(729);const l="src/avformat/formats/isobmff/parsing/dops.ts";async function p(e,t,a,i){const p=e.getPos();t.codecpar.codecId=86076,await e.skip(1);const m=(0,n.sY)(a.size+8),u=(0,o.JW)(m,a.size+8),w=new d.A(u),h=new f.A(u,!1);h.writeString("OpusHead"),h.writeUint8(1),await e.readBuffer(a.size-1,(0,o.JW)(m+9,a.size-1)),w.seek(10),h.seek(10),h.writeUint16(w.readUint16()),h.writeUint32(w.readUint32()),h.writeUint16(w.readUint16()),i.foundMoov?(t.sideData[1]=s()(u).call(u),(0,n.Eb)(m)):(t.codecpar.extradata&&(0,n.Eb)(t.codecpar.extradata),t.codecpar.extradata=m,t.codecpar.extradataSize=u.length,c.XC(t,u));const g=a.size-Number(e.getPos()-p);g>0?await e.skip(g):g<0&&r.z3(`read dops error, size: ${a.size}, read: ${a.size-g}`,l,82)}},60785:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/elst.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=await e.readInt32(),d=[];for(let t=0;t<c;t++){let t=BigInt(0),a=BigInt(0);1===o?(t=await e.readInt64(),a=await e.readInt64()):(t=BigInt(Math.floor(await e.readInt32())),a=BigInt(Math.floor(await e.readInt32())));const i=await e.readInt16(),s=await e.readInt16();d.push({segmentDuration:t,mediaTime:a,mediaRate:i,mediaRateFraction:s})}t.metadata.elst=d;const f=a.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read elst error, size: ${a.size}, read: ${a.size-f}`,s,75)}},40206:(e,t,a)=>{a.d(t,{A:()=>m});var i=a(18979),s=a.n(i),r=a(4624),n=a(54916),o=a(37837),c=a(14686),d=a(95832),f=a(22576);const l="src/avformat/formats/isobmff/parsing/esds.ts";async function p(e){let t=0;for(let a=0;a<4;a++){const a=await e.readUint8();if(t=t<<7|127&a,!(128&a))break}return t}async function m(e,t,a,i){const m=e.getPos();await e.skip(4);let u=e.getPos()+BigInt(Math.floor(a.size-4));for(;e.getPos()<u;){let a=await e.readUint8(),m=await p(e);if(0!==m)if(3===a){let u=e.getPos()+BigInt(Math.floor(m));if(await e.skip(2),await e.skip(1),a=await e.readUint8(),m=await p(e),0===m){r.R8("esds invalid ES descriptor size 0, skip",l,81),await e.skip(Number(u-e.getPos()));continue}if(4===a)if(t.codecpar.codecId=n.Q9[await e.readUint8()],await e.skip(1),await e.skip(3),await e.skip(4),await e.skip(4),e.getPos()<u-BigInt(5))if(a=await e.readUint8(),m=await p(e),5===a){const a=(0,o.sY)(m),r=await e.readBuffer(m,(0,c.JW)(a,m));i.foundMoov?(t.sideData[1]=s()(r).call(r),(0,o.Eb)(a)):(t.codecpar.extradata=a,t.codecpar.extradataSize=m,86018===t.codecpar.codecId?d.XC(t,s()(r).call(r)):86076===t.codecpar.codecId&&f.XC(t,s()(r).call(r)))}else await e.skip(Number(u-e.getPos()));else await e.skip(Number(u-e.getPos()));else await e.skip(Math.min(m,Number(u-e.getPos())))}else await e.skip(Math.min(m,Number(u-e.getPos())));else r.R8("esds invalid descriptor size 0, skip",l,64),await e.skip(Number(u-e.getPos()))}const w=a.size-Number(e.getPos()-m);w>0?await e.skip(w):w<0&&r.z3(`read vpcc error, size: ${a.size}, read: ${a.size-w}`,l,149)}},68657:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(4624),s=a(13663);const r="src/avformat/formats/isobmff/parsing/frma.ts";async function n(e,t,a,n){const o=e.getPos(),c=await e.peekUint32();e.setEndian(!1);const d=await e.readUint32();e.setEndian(!0);let f=s._B[d];f>0&&0!==t.codecpar.codecType?t.codecpar.codecType=1:1!==t.codecpar.codecType&&(f=s.pj[d],f>0?t.codecpar.codecType=0:(f=s._r[d],t.codecpar.codecType=3)),t.codecpar.codecTag=c,t.codecpar.codecId=f;const l=a.size-Number(e.getPos()-o);l>0?await e.skip(l):l<0&&i.z3(`read frma error, size: ${a.size}, read: ${a.size-l}`,r,66)}},87377:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4624),s=a(34677),r=a(54916);const n="src/avformat/formats/isobmff/parsing/hdlr.ts";async function o(e,t,a,o){const c=e.getPos(),d=await e.readUint8();if(await e.skip(3),0===d){await e.skip(4);const i=await e.readString(4),n=r.f3[i];(0,s.A)(n)&&(t.codecpar.codecType=n),await e.skip(4),await e.skip(4),await e.skip(4);const c=a.size-24;if(c>0){const a=!o.isom&&await e.peekUint8()===c-1;a&&await e.skip(1),t.metadata.handlerName=await e.readString(c-(a?1:0))}}const f=a.size-Number(e.getPos()-c);f>0?await e.skip(f):f<0&&i.z3(`read hdlr error, size: ${a.size}, read: ${a.size-f}`,n,76)}},71771:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(37837),n=a(14686),o=a(4624),c=a(67659);const d="src/avformat/formats/isobmff/parsing/hvcc.ts";async function f(e,t,a,i){const f=e.getPos();if(t.codecpar.codecId=173,a.size<=0)return;const l=(0,r.sY)(a.size),p=await e.readBuffer(a.size,(0,n.JW)(l,a.size));i.foundMoov?(t.sideData[1]=s()(p).call(p),(0,r.Eb)(l)):(t.codecpar.extradata&&(0,r.Eb)(t.codecpar.extradata),t.codecpar.extradata=l,t.codecpar.extradataSize=a.size,c.XC(t,p));const m=a.size-Number(e.getPos()-f);m>0?await e.skip(m):m<0&&o.z3(`read hevc error, size: ${a.size}, read: ${a.size-m}`,d,66)}},26593:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(71426),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/iinf.ts";async function o(e,t,a,i){const o=e.getPos();if(i.heif.foundIinf)r.R8("Duplicate iinf box found",n,35);else{i.heif.foundIinf=!0;const t=await e.readUint8();await e.skip(3);let a=t?await e.readUint32():await e.readUint16();i.heif.items||(i.heif.items=[]);e:for(let t=0;t<a;t++){let t=await e.readUint32();if(t-=8,"infe"===await e.readString(4)){var c;const a=await e.readUint8();if(await e.skip(3),t-=4,a<2){r.z3("infe version < 2",n,59),i.heif.foundIinf=!1;break e}let o=a>2?await e.readUint32():await e.readUint16();t-=a>2?4:2,await e.readUint16();let d=await e.readString(4);t-=6;let f="";t>0&&(f=await e.readString(t),0===f.charCodeAt(f.length-1)&&(f=f.substring(0,f.length-1)));const l=s()(c=i.heif.items).call(c,(e=>e.id===o));l?(l.name=f,l.type=d):i.heif.items.push({id:o,name:f,type:d})}else await e.skip(t-8)}}const d=a.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&r.z3(`read iloc error, size: ${a.size}, read: ${a.size-d}`,n,104)}},72287:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(71426),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/iloc.ts";async function o(e,t,a,i){const o=e.getPos();if(i.heif.foundIloc)r.R8("Duplicate iloc box found",n,35);else{i.heif.foundIloc=!0;const t=await e.readUint8();await e.skip(3);let a=await e.readUint8(),o=a>>4&15,d=15&a;a=await e.readUint8();let f=a>>4&15,l=t?15&a:0,p=t<2?await e.readUint16():await e.readUint32();i.heif.items||(i.heif.items=[]);e:for(let a=0;a<p;a++){var c;let a=t<2?await e.readUint16():await e.readUint32(),p=t>0?15&await e.readUint16():0;p>1&&r.R8(`iloc offset type ${p}`,n,59),await e.readUint16();let m=f>0?await e["readUint"+8*f]():0,u=await e.readUint16();if(u>1){r.z3("iloc: extent_count > 1",n,66),i.heif.foundIloc=!1;break e}let w=0,h=0,g=0;for(let t=0;t<u;t++)l>0&&(w=await e["readUint"+8*l]()),g=o>0?await e["readUint"+8*o]():0,h=d>0?await e["readUint"+8*d]():0;const z=s()(c=i.heif.items).call(c,(e=>e.id===a));z?(z.isIdatRelative=1===p,z.extentOffset=m+g,z.extentIndex=w,z.extentLength=h):i.heif.items.push({id:a,isIdatRelative:1===p,extentOffset:m+g,extentIndex:w,extentLength:h})}}const d=a.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&r.z3(`read iloc error, size: ${a.size}, read: ${a.size-d}`,n,104)}},53714:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/imir.ts";async function r(e,t,a,r){var n;const o=e.getPos();let c=1&await e.readUint8();null!==(n=r.heif)&&void 0!==n&&n.currentItem&&(r.heif.currentItem.hflip=!!c,r.heif.currentItem.vflip=!c);const d=a.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&i.z3(`read imir error, size: ${a.size}, read: ${a.size-d}`,s,46)}},63792:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/ipco.ts";async function r(e,t,a,r){const n=e.getPos();let o=a.size;for(r.heif.ipcoItem=[];o;){const t=await e.readUint32(),a=await e.readUint32();r.heif.ipcoItem.push({tag:a,data:await e.readBuffer(t-8)}),o-=t}const c=a.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read ipco error, size: ${a.size}, read: ${a.size-c}`,s,55)}},99444:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(71426),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/ipma.ts";async function o(e,t,a,i){const o=e.getPos(),c=await e.readUint8(),d=await e.readUint24(),f=await e.readUint32();i.heif.items||(i.heif.items=[]);for(let t=0;t<f;t++){var l;let t=c?await e.readUint32():await e.readUint16(),a=await e.readUint8(),r=s()(l=i.heif.items).call(l,(e=>e.id===t));r?r.ipma=[]:(r={id:t,ipma:[]},i.heif.items.push(r));for(let t=0;t<a;t++){let t=127&await e.readUint8();1&d&&(t<<=8,t|=await e.readUint8()),r.ipma.push(t-1)}}const p=a.size-Number(e.getPos()-o);p>0?await e.skip(p):p<0&&r.z3(`read ipma error, size: ${a.size}, read: ${a.size-p}`,n,71)}},45875:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(71426),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/iref.ts";async function o(e,t,a,i){const o=e.getPos(),c=await e.readUint8();if(await e.readUint24(),c>1)r.z3(`Unknown iref box version ${c}`,n,38);else{let t=a.size-4;for(;t;){const a=await e.readUint32(),o=await e.readString(4),l=e.getPos();if("dimg"===o){var d;let t=c?await e.readUint32():await e.readUint16();const a=null===(d=i.heif.items)||void 0===d?void 0:s()(d).call(d,(e=>e.id===t));if(a&&("grid"===a.type||"iovl"===a.type)){const t=await e.readUint16();let s=[];for(let a=0;a<t;a++)s.push(c?await e.readUint32():await e.readUint16());i.heif.grid||(i.heif.grid=[]),i.heif.grid.push({item:a,tileIdList:s})}}else if("thmb"===o||"cdsc"===o){let t=c?await e.readUint32():await e.readUint16();if(await e.readUint16()>1)r.z3("thmb in iref referencing several items",n,70);else{var f;let a=c?await e.readUint32():await e.readUint16();const r=null===(f=i.heif.items)||void 0===f?void 0:s()(f).call(f,(e=>e.id===a));r&&(r.refs||(r.refs={}),r.refs[o]=t)}}else await e.skip(a-8);let p=a-8-Number(e.getPos()-l);p&&await e.skip(p),t-=a}}const l=a.size-Number(e.getPos()-o);l>0?await e.skip(l):l<0&&r.z3(`read ipma error, size: ${a.size}, read: ${a.size-l}`,n,99)}},86351:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/irot.ts";async function r(e,t,a,r){var n;const o=e.getPos();let c=3&await e.readUint8();null!==(n=r.heif)&&void 0!==n&&n.currentItem&&(r.heif.currentItem.rotation=90*c);const d=a.size-Number(e.getPos()-o);d>0?await e.skip(d):d<0&&i.z3(`read irot error, size: ${a.size}, read: ${a.size-d}`,s,45)}},39496:(e,t,a)=>{a.d(t,{A:()=>n});var i=a(68960),s=a(4624);const r="src/avformat/formats/isobmff/parsing/ispe.ts";async function n(e,t,a,n){const o=e.getPos();await e.skip(4);const c=await e.readUint32(),d=await e.readUint32();t instanceof i.Ay?(t.codecpar.width=c,t.codecpar.height=d):(t.width=c,t.height=d);const f=a.size-Number(e.getPos()-o);f>0?await e.skip(f):f<0&&s.z3(`read ispe error, size: ${a.size}, read: ${a.size-f}`,r,55)}},8010:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/mdhd.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);let c=BigInt(0),d=BigInt(0),f=0,l=BigInt(0);1===o?(c=await e.readUint64(),d=await e.readUint64(),f=await e.readUint32(),l=await e.readUint64()):(c=BigInt(Math.floor(await e.readUint32())),d=BigInt(Math.floor(await e.readUint32())),f=await e.readUint32(),l=BigInt(Math.floor(await e.readUint32()))),t.duration=l,t.timeBase.den=f,t.timeBase.num=1,t.metadata.creationTime=c,t.metadata.modificationTime=d;const p=await e.readUint16(),m=[];m[0]=p>>10&31,m[1]=p>>5&31,m[2]=31&p;const u=String.fromCharCode(m[0]+96,m[1]+96,m[2]+96);t.metadata.language=u,await e.skip(2);const w=a.size-Number(e.getPos()-n);w>0?await e.skip(w):w<0&&i.z3(`read mdhd error, size: ${a.size}, read: ${a.size-w}`,s,81)}},65762:(e,t,a)=>{a.d(t,{A:()=>m,G:()=>p});var i=a(64007),s=a.n(i),r=a(86226),n=a.n(r),o=a(4624),c=a(67672),d=a(96108),f=a(61619);const l="src/avformat/formats/isobmff/parsing/meta.ts";async function p(e,t,a){const i=[];if(await e.peekUint16()+4===t){let a=await e.readUint16();await e.skip(2),i.push(await e.readString(a)),t-=a+4}else for(;t>16;){let s=await e.readUint32();t-=s,await e.skip(4);const r=await e.readUint32();if(await e.skip(4),s-=16,21===r)switch(s){case 1:s>=1&&(i.push(await e.readInt8()),s--);break;case 2:s>=2&&(i.push(await e.readInt16()),s-=2);break;case 3:s>=3&&(i.push(await e.readInt24()),s-=3);break;case 4:s>=4&&(i.push(await e.readInt32()),s-=4)}else if(22===r)switch(s){case 1:s>=1&&(i.push(await e.readUint8()),s--);break;case 2:s>=2&&(i.push(await e.readUint16()),s-=2);break;case 3:s>=3&&(i.push(await e.readUint24()),s-=3);break;case 4:s>=4&&(i.push(await e.readUint32()),s-=4)}else 23===r&&s>=4?(i.push(await e.readFloat()),s-=4):1===r&&s>0?(i.push(await e.readString(s)),s=0):s>0&&(i.push(await e.readBuffer(s)),s=0,a.type=r);s>0&&await e.skip(s)}return t>0&&await e.skip(t),i}async function m(e,t,a,i){const r=e.getPos();let m=a.size;var u;m>12&&s()(u=["hdlr","mhdr","keys","ilst","ctry","lang"]).call(u,(await e.peekString(12)).substring(8))>=0&&(await e.skip(4),m-=4);let w,h,g=[""],z=[];for(;m>=8;){let t=await e.readUint32();const a=await e.readString(4);let s=t;if(t-=8,"keys"===a){await e.skip(4);const a=await e.readUint32();t-=8;for(let i=0;i<a;i++){const a=await e.readUint32();await e.skip(4),g.push(await e.readString(a-8)),t-=a}}else if("hdlr"===a)t>=12&&(await e.skip(8),w=await e.readString(4),t-=12);else if("ilst"===a)for(;t>8;){let a=await e.readUint32(),s=await e.readUint32();"mdta"!==w&&(s=(0,f.A)(s,4));const r={},n=await p(e,a-8,r);n.length&&("covr"===s?i.covr={type:r.type,data:n[0]}:z.push({key:s,value:1===n.length?n[0]:n})),t-=a}else{if(!(t<m-8))break;await e.skip(t),t=0}t&&await e.skip(t),m-=s}t?h=t.metadata:(i.metadata||(i.metadata={}),h=i.metadata),n()(z).call(z,(e=>{let t=e.key;c.ai(t)?g[t]&&(t=g[t]):d.c[t]&&(t=d.c[t]),h[t]=e.value}));const v=a.size-Number(e.getPos()-r);v>0?await e.skip(v):v<0&&o.z3(`read meta error, size: ${a.size}, read: ${a.size-v}`,l,264)}},95168:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/mfhd.ts";async function r(e,t,a,r){const n=e.getPos();await e.readUint8(),await e.skip(3),r.currentFragment.sequence=await e.readUint32();const o=a.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-o}`,s,47)}},61040:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/mvhd.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3),1===o?(r.creationTime=await e.readUint64(),r.modificationTime=await e.readUint64(),r.timescale=await e.readUint32(),r.duration=await e.readUint64()):(r.creationTime=BigInt(Math.floor(await e.readUint32())),r.modificationTime=BigInt(Math.floor(await e.readUint32())),r.timescale=await e.readUint32(),r.duration=BigInt(Math.floor(await e.readUint32()))),r.rate=await e.readUint32(),r.volume=await e.readUint16()>>>8,await e.skip(10),r.matrix=new Uint32Array(9);for(let t=0;t<9;t++)r.matrix[t]=await e.readUint32();await e.skip(24),r.nextTrackId=await e.readUint32();const c=a.size-Number(e.getPos()-n);c>0?await e.skip(c):c<0&&i.z3(`read mvhd error, size: ${a.size}, read: ${a.size-c}`,s,68)}},20559:(e,t,a)=>{a.d(t,{A:()=>X});var i=a(63365),s=a(62037),r=a(7894),n=a(1877),o=a(27171),c=a(43718),d=a(338),f=a(69483),l=a(8010),p=a(61040),m=a(15682),u=a(87377),w=a(89823),h=a(2576),g=a(95168),z=a(33717),v=a(65721),k=a(28326),U=a(60785),A=a(71529),I=a(68657),y=a(49266),b=a(97323),x=a(88475),B=a(19392),P=a(77488),S=a(65762),M=a(85456),D=a(53077),R=a(26593),$=a(72287),N=a(63792),C=a(99444),T=a(45875),E=a(39496),O=a(42943),F=a(86351),_=a(53714),L=a(71771),V=a(91048),W=a(65977);const X={[(0,W.A)("stts")]:i.A,[(0,W.A)("ctts")]:s.A,[(0,W.A)("stss")]:r.A,[(0,W.A)("stsz")]:n.A,[(0,W.A)("stz2")]:o.A,[(0,W.A)("stsc")]:c.A,[(0,W.A)("stco")]:d.A,[(0,W.A)("co64")]:f.A,[(0,W.A)("mdhd")]:l.A,[(0,W.A)("mvhd")]:p.A,[(0,W.A)("tkhd")]:m.A,[(0,W.A)("hdlr")]:u.A,[(0,W.A)("stsd")]:w.A,[(0,W.A)("elst")]:U.A,[(0,W.A)("trex")]:h.A,[(0,W.A)("mfhd")]:g.A,[(0,W.A)("tfhd")]:z.A,[(0,W.A)("tfdt")]:v.A,[(0,W.A)("trun")]:k.A,[(0,W.A)("pssh")]:A.A,[(0,W.A)("frma")]:I.A,[(0,W.A)("schm")]:y.A,[(0,W.A)("tenc")]:b.A,[(0,W.A)("saio")]:x.A,[(0,W.A)("saiz")]:B.A,[(0,W.A)("senc")]:P.A,[(0,W.A)("meta")]:S.A,[(0,W.A)("chpl")]:M.A,[(0,W.A)("chap")]:D.A,[(0,W.A)("iinf")]:R.A,[(0,W.A)("iloc")]:$.A,[(0,W.A)("ipco")]:N.A,[(0,W.A)("ipma")]:C.A,[(0,W.A)("iref")]:T.A,[(0,W.A)("ispe")]:E.A,[(0,W.A)("pitm")]:O.A,[(0,W.A)("imir")]:_.A,[(0,W.A)("irot")]:F.A,[(0,W.A)("hvcC")]:L.A,[(0,W.A)("av1C")]:V.A}},8930:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4624),s=a(65977),r=a(95644);const n="src/avformat/formats/isobmff/parsing/pcmc.ts";async function o(e,t,a,o){const c=e.getPos();await e.readUint8(),await e.readUint24();const d=await e.readUint8(),f=await e.readUint8(),l=1&d,p=t.privData;if(p.format===(0,s.A)("fpcm"))switch(f){case 32:t.codecpar.codecId=l?65557:65556;break;case 64:t.codecpar.codecId=l?65559:65558;break;default:i.z3(`invalid pcmSampleSize: ${f}`,n,56)}else if(p.format===(0,s.A)("ipcm"))switch(f){case 16:t.codecpar.codecId=l?65536:65537;break;case 24:t.codecpar.codecId=l?65548:65549;break;case 32:t.codecpar.codecId=l?65544:65545;break;default:i.z3(`invalid pcmSampleSize: ${f}`,n,72)}p.isPcm=!0,0!==t.codecpar.codecId&&(t.codecpar.bitsPerCodedSample=(0,r.MZ)(t.codecpar.codecId));const m=a.size-Number(e.getPos()-c);m>0?await e.skip(m):m<0&&i.z3(`read pcmc error, size: ${a.size}, read: ${a.size-m}`,n,88)}},42943:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/pitm.ts";async function r(e,t,a,r){const n=e.getPos();await e.skip(4),r.heif.primaryId=await e.readUint16();const o=a.size-Number(e.getPos()-n);o>0?await e.skip(o):o<0&&i.z3(`read pitm error, size: ${a.size}, read: ${a.size-o}`,s,44)}},71529:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/pssh.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=r.encryptionInitInfos||[],d={systemId:await e.readBuffer(16),keyIds:[],data:null};if(o>0){const t=await e.readUint32();for(let a=0;a<t;a++)d.keyIds.push(await e.readBuffer(16))}const f=await e.readUint32();d.data=await e.readBuffer(f),c.push(d),r.encryptionInitInfos=c;const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read pssh error, size: ${a.size}, read: ${a.size-l}`,s,66)}},88475:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/saio.ts";async function r(e,t,a,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null,d=await e.readUint8();if(1&await e.readUint24()){const t=await e.readUint32(),a=await e.readUint32();if(!c)return void await l();if(t!==c.schemeType)return i.R8("Ignoring saio box with non-zero aux_info_type",s,44),void await l();if(0!==a)return i.R8("Ignoring saio box with non-zero aux_info_type_parameter",s,49),void await l()}else if(!c)return void await l();o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]});const f=await e.readUint32();for(let t=0;t<f;t++)o.cenc.sampleInfoOffset.push(0===d?await e.readUint32():await e.readUint64());async function l(){const t=a.size-Number(e.getPos()-n);t>0?await e.skip(t):t<0&&i.z3(`read saio error, size: ${a.size}, read: ${a.size-t}`,s,88)}await l()}},19392:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/saiz.ts";async function r(e,t,a,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null;if(await e.skip(1),1&await e.readUint24()){const t=await e.readUint32(),a=await e.readUint32();if(!c)return void await d();if(t!==c.schemeType)return i.R8("Ignoring saiz box with non-zero aux_info_type",s,47),void await d();if(0!==a)return i.R8("Ignoring saiz box with non-zero aux_info_type_parameter",s,52),void await d()}else if(!c)return void await d();if(o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]}),o.cenc.defaultSampleInfoSize=await e.readUint8(),o.cenc.sampleCount=await e.readUint32(),0===o.cenc.defaultSampleInfoSize){if(!o.cenc.sampleCount)return i.z3("invalid saiz data",s,83),void await d();for(let t=0;t<o.cenc.sampleCount;t++)o.cenc.sampleSizes.push(await e.readUint8())}async function d(){const t=a.size-Number(e.getPos()-n);t>0?await e.skip(t):t<0&&i.z3(`read saiz error, size: ${a.size}, read: ${a.size-t}`,s,99)}await d()}},49266:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/schm.ts";async function r(e,t,a,r){const n=e.getPos();await e.skip(4);const o=t.privData;let c=r.cencs?r.cencs[o.trackId]:null;c||(c={schemeType:0,schemeVersion:0,isProtected:0,defaultPerSampleIVSize:0,defaultKeyId:null,defaultConstantIV:null,cryptByteBlock:0,skipByteBlock:0,pattern:!1}),c.schemeType=await e.readUint32(),c.schemeVersion=await e.readUint32(),r.cencs?r.cencs[o.trackId]=c:r.cencs={[o.trackId]:c};const d=a.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read schm error, size: ${a.size}, read: ${a.size-d}`,s,72)}},77488:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/senc.ts";async function r(e,t,a,r){const n=e.getPos(),o=r.currentFragment.currentTrack,c=r.cencs?r.cencs[o.trackId]:null;await e.readUint8();const d=await e.readUint24();o.cenc||(o.cenc={defaultSampleInfoSize:0,sampleCount:0,offset:0,useSubsamples:!1,sampleEncryption:[],sampleSizes:[],sampleInfoOffset:[]});const f=await e.readUint32(),l=2&d,p=c.defaultPerSampleIVSize;for(let t=0;t<f;t++){const t={iv:p?await e.readBuffer(p):c.defaultConstantIV,subsamples:[]};if(l){const a=await e.readUint16();for(let i=0;i<a;i++)t.subsamples.push({bytesOfClearData:await e.readUint16(),bytesOfProtectedData:await e.readUint32()})}o.cenc.sampleEncryption.push(t)}l&&(o.cenc.useSubsamples=!0);const m=a.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read senc error, size: ${a.size}, read: ${a.size-m}`,s,80)}},338:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/stco.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[],d=await e.readUint32();if(0===o)for(let t=0;t<d;t++)c.push(BigInt(Math.floor(await e.readUint32())));t.privData.chunkOffsets=c;const f=a.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read stco error, size: ${a.size}, read: ${a.size-f}`,s,54)}},43718:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/stsc.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=t.privData,d=[],f=[],l=[],p=await e.readUint32();if(0===o)for(let t=0;t<p;t++)d.push(await e.readUint32()),f.push(await e.readUint32()),l.push(await e.readUint32());c.stscFirstChunk=d,c.stscSamplesPerChunk=f,c.stscSampleDescriptionIndex=l;const m=a.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stsc error, size: ${a.size}, read: ${a.size-m}`,s,63)}},89823:(e,t,a)=>{a.d(t,{A:()=>I});var i=a(31721),s=a.n(i),r=a(4624),n=a(65977),o=a(91153),c=a(54916),d=a(8046),f=a(71771),l=a(65873),p=a(57831),m=a(91048),u=a(40206),w=a(55846),h=a(22966),g=a(28447),z=a(67755),v=a(8930),k=a(37098),U=a(36206);const A="src/avformat/formats/isobmff/parsing/stsd.ts";async function I(e,t,a,i){const I=e.getPos(),y=await e.readUint8();await e.skip(3);const b=t.privData,x=await e.readUint32();for(let a=0;a<x;a++){const a=await e.readUint32(),I=await e.readUint32(),x=e.getPos()+BigInt(Math.floor(a-8));if(c.uf[I]&&(t.codecpar.codecId=c.uf[I]),b.format=I,0===a){r.R8("stsd entry invalid box size 0, skip",A,75),await e.skip(Number(x-e.getPos()));break}if(a>=16?(await e.skip(6),await e.skip(2)):a<=7&&r.h2(`invalid size: ${a} in stsd`,A,88),0===t.codecpar.codecType){await e.skip(2),await e.skip(2),t.metadata.vendorId=await e.readString(4),await e.skip(4),await e.skip(4),t.codecpar.width=await e.readUint16(),t.codecpar.height=await e.readUint16(),await e.skip(4),await e.skip(4),await e.skip(4),await e.skip(2);let a=await e.readUint8();for(a>31&&(a=31),t.metadata.encoder=await e.readString(a),a<31&&await e.skip(31-a),await e.skip(2),await e.skip(2);e.getPos()<x;){const a=await e.readUint32(),c=await e.readUint32();0!==a?c===(0,n.A)("avcC")?await(0,d.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("hvcC")?await(0,f.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("vvcC")?await(0,l.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("av1C")?await(0,m.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("vpcC")?await(0,p.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("esds")?await(0,u.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("wave")?await(0,w.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("colr")?await(0,z.A)(e,t,{type:c,size:a-8},i):i.parsers&&i.parsers[c]?await i.parsers[c](e,null,{type:c,size:a-8},i):i.parseOneBox&&s()(o.gQ).call(o.gQ,(e=>(0,n.A)(e)===c))?await i.parseOneBox(e,t,{type:c,size:a-8},i):await e.skip(Math.min(a-8,Number(x-e.getPos()))):(r.R8("stsd video invalid box size 0, skip",A,137),await e.skip(Number(x-e.getPos())))}}else if(1===t.codecpar.codecType){const a=await e.readUint16();for(await e.skip(2),t.metadata.vendorId=await e.readString(4),t.codecpar.chLayout.nbChannels=await e.readUint16(),t.codecpar.bitsPerCodedSample=await e.readUint16(),b.audioCid=await e.readUint16(),await e.skip(2),t.codecpar.sampleRate=await e.readUint32()>>>16,(!i.isom||0===y&&a>0)&&(1===a?(b.samplesPerFrame=await e.readUint32(),await e.skip(4),b.bytesPerFrame=await e.readUint32(),await e.skip(4)):2===a&&(await e.skip(4),t.codecpar.sampleRate=Number(await e.readUint64()),t.codecpar.chLayout.nbChannels=await e.readUint32(),await e.skip(4),t.codecpar.bitsPerCodedSample=await e.readUint32(),await e.skip(4),b.bytesPerFrame=await e.readUint32(),b.samplesPerFrame=await e.readUint32()));e.getPos()<x;){const a=await e.readUint32(),c=await e.readUint32();0!==a?c===(0,n.A)("esds")?await(0,u.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("dfLa")?await(0,h.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("dOps")?await(0,g.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("wave")?await(0,w.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("dac3")?await(0,k.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("dec3")?await(0,U.A)(e,t,{type:c,size:a-8},i):c===(0,n.A)("pcmC")?await(0,v.A)(e,t,{type:c,size:a-8},i):i.parsers&&i.parsers[c]?await i.parsers[c](e,null,{type:c,size:a-8},i):i.parseOneBox&&s()(o.gQ).call(o.gQ,(e=>(0,n.A)(e)===c))?await i.parseOneBox(e,t,{type:c,size:a-8},i):await e.skip(Math.min(a-8,Number(x-e.getPos()))):(r.R8("stsd audio invalid box size 0, skip",A,310),await e.skip(Number(x-e.getPos())))}}else 3===t.codecpar.codecType?(I===(0,n.A)("stpp")?t.codecpar.codecId=94232:I===(0,n.A)("wvtt")?t.codecpar.codecId=94226:I===(0,n.A)("tx3g")||I===(0,n.A)("text")?t.codecpar.codecId=94213:I===(0,n.A)("c608")&&(t.codecpar.codecId=94218),await e.skip(Math.min(a-8,Number(x-e.getPos())))):await e.skip(Math.min(a-8,Number(x-e.getPos())))}const B=a.size-Number(e.getPos()-I);B>0?await e.skip(B):B<0&&r.z3(`read stsd error, size: ${a.size}, read: ${a.size-B}`,A,448)}},7894:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(74707),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/stss.ts";async function o(e,t,a,i){const o=e.getPos(),c=await e.readUint8();await e.skip(3);const d=new(s()),f=await e.readUint32();if(0===c)for(let t=0;t<f;t++)d.set(await e.readUint32(),!0);t.privData.stssSampleNumbersMap=d;const l=a.size-Number(e.getPos()-o);l>0?await e.skip(l):l<0&&r.z3(`read stss error, size: ${a.size}, read: ${a.size-l}`,n,55)}},1877:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/stsz.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[];let d=0,f=0;if(0===o){d=await e.readUint32(),f=await e.readUint32();for(let t=0;t<f;t++)0===d?c.push(await e.readUint32()):c[t]=d}t.privData.sampleSizes=c;const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read stsz error, size: ${a.size}, read: ${a.size-l}`,s,63)}},63365:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/stts.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=t.privData,d=[],f=[],l=await e.readUint32();let p=1;if(0===o)for(let t=0;t<l;t++)d.push(await e.readUint32()),p=await e.readInt32(),p<0&&(i.R8("File uses negative stts sample delta, using value 1 instead, sync may be lost!",s,51),p=1),f.push(p);c.sttsSampleCounts=d,c.sttsSampleDeltas=f;const m=a.size-Number(e.getPos()-n);m>0?await e.skip(m):m<0&&i.z3(`read stts error, size: ${a.size}, read: ${a.size-m}`,s,66)}},27171:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/stz2.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=[];let d=0,f=0;if(0===o)if(await e.skip(3),f=await e.readUint8(),d=await e.readUint32(),4===f)for(let t=0;t<d;t+=2){const a=await e.readUint8();c[t]=a>>4&15,c[t+1]=15&a}else if(8===f)for(let t=0;t<d;t++)c[t]=await e.readUint8();else if(16===f)for(let t=0;t<d;t++)c[t]=await e.readUint16();else i.z3("Error in length field in stz2 box",s,65);t.privData.sampleSizes=c;const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read stz2 error, size: ${a.size}, read: ${a.size-l}`,s,76)}},97323:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/tenc.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=t.privData;let d=r.cencs?r.cencs[c.trackId]:null;d||(d={schemeType:0,schemeVersion:0,isProtected:0,defaultPerSampleIVSize:0,defaultKeyId:null,defaultConstantIV:null,cryptByteBlock:0,skipByteBlock:0,pattern:!1}),await e.skip(1);const f=await e.readUint8();if(o>0&&(d.pattern=!0,d.cryptByteBlock=f>>>4&15,d.skipByteBlock=15&f),d.isProtected=await e.readUint8(),d.defaultPerSampleIVSize=await e.readUint8(),d.defaultKeyId=await e.readBuffer(16),d.isProtected&&!d.defaultPerSampleIVSize){const t=await e.readUint8();d.defaultConstantIV=await e.readBuffer(t)}r.cencs?r.cencs[c.trackId]=d:r.cencs={[c.trackId]:d};const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read schm error, size: ${a.size}, read: ${a.size-l}`,s,90)}},65721:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/tfdt.ts";async function r(e,t,a,r){const n=e.getPos(),o=await e.readUint8();await e.skip(3);const c=r.currentFragment.currentTrack;c&&(c.baseMediaDecodeTime=1===o?await e.readUint64():BigInt(Math.floor(await e.readUint32())));const d=a.size-Number(e.getPos()-n);d>0?await e.skip(d):d<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-d}`,s,55)}},33717:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/tfhd.ts";async function r(e,t,a,r){const n=e.getPos(),o=(await e.readUint8(),await e.readUint24()),c=await e.readUint32(),d=r.currentFragment.currentTrack;d.trackId=c,d&&(1&o&&(d.baseDataOffset=await e.readUint64()),2&o&&await e.skip(4),8&o&&(d.defaultSampleDuration=await e.readUint32()),16&o&&(d.defaultSampleSize=await e.readUint32()),32&o&&(d.defaultSampleFlags=await e.readUint32()),131072&o&&(d.baseIsMoof=!0));const f=a.size-Number(e.getPos()-n);f>0?await e.skip(f):f<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-f}`,s,73)}},15682:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(52730),s=a.n(i),r=a(4624);const n="src/avformat/formats/isobmff/parsing/tkhd.ts";async function o(e,t,a,i){const o=t.privData,c=e.getPos(),d=await e.readUint8();o.flags=await e.readUint24(),1&s()(o)&&(t.disposition|=1),1===d?(t.metadata.creationTime=await e.readUint64(),t.metadata.modificationTime=await e.readUint64(),o.trackId=await e.readUint32(),await e.skip(4),o.duration=await e.readUint64()):(t.metadata.creationTime=BigInt(Math.floor(await e.readUint32())),t.metadata.modificationTime=BigInt(Math.floor(await e.readUint32())),o.trackId=await e.readUint32(),await e.skip(4),o.duration=BigInt(Math.floor(await e.readUint32()))),await e.skip(8),o.layer=await e.readInt16(),o.alternateGroup=await e.readInt16(),o.volume=await e.readInt16()>>8,await e.skip(2);const f=[];o.matrix=new Int32Array(9);for(let t=0;t<9;t++)o.matrix[t]=await e.readInt32(),f[t]=8===t?o.matrix[t]/1073741824:o.matrix[t]/65536;o.width=await e.readUint32()>>16,o.height=await e.readUint32()>>16,t.metadata.matrix=f;const l=a.size-Number(e.getPos()-c);l>0?await e.skip(l):l<0&&r.z3(`read tkhd error, size: ${a.size}, read: ${a.size-l}`,n,91)}},2576:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/formats/isobmff/parsing/trex.ts";async function r(e,t,a,r){const n=e.getPos();await e.readUint8(),await e.skip(3);const o=await e.readUint32();await e.skip(4);const c=await e.readUint32(),d=await e.readUint32(),f=await e.readUint32();r.trexs.push({trackId:o,duration:c,size:d,flags:f});const l=a.size-Number(e.getPos()-n);l>0?await e.skip(l):l<0&&i.z3(`read trex error, size: ${a.size}, read: ${a.size-l}`,s,59)}},28326:(e,t,a)=>{a.d(t,{A:()=>d});var i=a(71426),s=a.n(i),r=a(52730),n=a.n(r),o=a(4624);const c="src/avformat/formats/isobmff/parsing/trun.ts";async function d(e,t,a,i){var r;const d=e.getPos(),f=await e.readUint8(),l=await e.readUint24(),p=i.currentFragment.currentTrack,m=s()(r=i.trexs).call(r,(e=>e.trackId===p.trackId));if(p){const t=await e.readUint32();1&l&&(p.sampleCount?(p.remainDataOffsets.push(await e.readInt32()),p.remainDataOffsetIndex.push(p.sampleCount)):p.dataOffset=await e.readInt32());let a=-1;4&l&&(a=await e.readUint32());for(let i=0;i<t;i++){var u;256&l?p.sampleDurations.push(await e.readUint32()):p.sampleDurations.push(p.defaultSampleDuration||(null==m?void 0:m.duration)),512&l?p.sampleSizes.push(await e.readUint32()):p.sampleSizes.push(p.defaultSampleSize||(null==m?void 0:m.size)),1024&l?p.sampleFlags.push(await e.readUint32()):p.sampleFlags.push(p.defaultSampleFlags||(null==(u=m)?void 0:n()(u))),2048&l?0===f?p.sampleCompositionTimeOffset.push(await e.readUint32()):p.sampleCompositionTimeOffset.push(await e.readInt32()):p.sampleCompositionTimeOffset.push(0),a>-1&&0===i&&(p.sampleFlags.pop(),p.sampleFlags.push(a))}p.sampleCount+=t}const w=a.size-Number(e.getPos()-d);w>0?await e.skip(w):w<0&&o.z3(`read vpcc error, size: ${a.size}, read: ${a.size-w}`,c,103)}},57831:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(37837),n=a(14686),o=a(4624),c=a(82014);const d="src/avformat/formats/isobmff/parsing/vpcc.ts";async function f(e,t,a,i){const f=e.getPos();if(await e.readUint8(),await e.skip(3),t.codecpar.codecId=167,a.size-4<=0)return;const l=(0,r.sY)(a.size-4),p=await e.readBuffer(a.size-4,(0,n.JW)(l,a.size-4));i.foundMoov?(t.sideData[1]=s()(p).call(p),(0,r.Eb)(l)):(t.codecpar.extradata&&(0,r.Eb)(t.codecpar.extradata),t.codecpar.extradata=l,t.codecpar.extradataSize=a.size-4,c.XC(t,p));const m=a.size-Number(e.getPos()-f);m>0?await e.skip(m):m<0&&o.z3(`read vpcc error, size: ${a.size}, read: ${a.size-m}`,d,70)}},65873:(e,t,a)=>{a.d(t,{A:()=>f});var i=a(18979),s=a.n(i),r=a(37837),n=a(14686),o=a(4624),c=a(59166);const d="src/avformat/formats/isobmff/parsing/vvcc.ts";async function f(e,t,a,i){const f=e.getPos();if(await e.readUint8(),await e.skip(3),t.codecpar.codecId=196,a.size-4<=0)return;const l=(0,r.sY)(a.size-4),p=await e.readBuffer(a.size-4,(0,n.JW)(l,a.size-4));i.foundMoov?(t.sideData[1]=s()(p).call(p),(0,r.Eb)(l)):(t.codecpar.extradata&&(0,r.Eb)(t.codecpar.extradata),t.codecpar.extradata=l,t.codecpar.extradataSize=a.size-4,c.XC(t,p));const m=a.size-Number(e.getPos()-f);m>0?await e.skip(m):m<0&&o.z3(`read vvcc error, size: ${a.size}, read: ${a.size-m}`,d,70)}},55846:(e,t,a)=>{a.d(t,{A:()=>o});var i=a(4624),s=a(65977),r=a(40206);const n="src/avformat/formats/isobmff/parsing/wave.ts";async function o(e,t,a,o){const c=e.getPos(),d=c+BigInt(Math.floor(a.size));for(;e.getPos()<d;){const a=await e.readUint32(),c=await e.readUint32();0!==a?c===(0,s.A)("esds")?await(0,r.A)(e,t,{type:c,size:a-8},o):await e.skip(Math.min(a-8,Number(d-e.getPos()))):(i.R8("wave invalid box size 0, skip",n,45),await e.skip(Number(d-e.getPos())))}const f=a.size-Number(e.getPos()-c);f>0?await e.skip(f):f<0&&i.z3(`read vpcc error, size: ${a.size}, read: ${a.size-f}`,n,71)}},13663:(e,t,a)=>{a.d(t,{_B:()=>r,_r:()=>n,pj:()=>s});var i=a(79682);const s={[(0,i.A)("mp4v")]:12,[(0,i.A)("DIVX")]:12,[(0,i.A)("XVID")]:12,[(0,i.A)("3IV2")]:12,[(0,i.A)("vvc1")]:196,[(0,i.A)("vvi1")]:196,[(0,i.A)("hev1")]:173,[(0,i.A)("hvc1")]:173,[(0,i.A)("dvhe")]:173,[(0,i.A)("hev1")]:173,[(0,i.A)("avc1")]:27,[(0,i.A)("avc2")]:27,[(0,i.A)("avc3")]:27,[(0,i.A)("avc4")]:27,[(0,i.A)("ai5p")]:27,[(0,i.A)("ai5q")]:27,[(0,i.A)("ai52")]:27,[(0,i.A)("ai53")]:27,[(0,i.A)("ai55")]:27,[(0,i.A)("ai56")]:27,[(0,i.A)("ai1p")]:27,[(0,i.A)("ai1q")]:27,[(0,i.A)("ai12")]:27,[(0,i.A)("ai13")]:27,[(0,i.A)("ai15")]:27,[(0,i.A)("ai16")]:27,[(0,i.A)("AVin")]:27,[(0,i.A)("aivx")]:27,[(0,i.A)("rv64")]:27,[(0,i.A)("xalg")]:27,[(0,i.A)("avlg")]:27,[(0,i.A)("dva1")]:27,[(0,i.A)("dvav")]:27,[(0,i.A)("vp08")]:139,[(0,i.A)("vp09")]:167,[(0,i.A)("av01")]:225},r={[(0,i.A)("mp4a")]:86018,[(0,i.A)("ac-3")]:86019,[(0,i.A)("sac3")]:86019,[(0,i.A)("ac-4")]:86119,[(0,i.A)("dtsc")]:86020,[(0,i.A)("dtsh")]:86020,[(0,i.A)("dtsl")]:86020,[(0,i.A)("dtse")]:86020,[(0,i.A)("DTS ")]:86020,[(0,i.A)("ec-3")]:86056,[(0,i.A)(".mp3")]:86017,[(0,i.A)("mp3 ")]:86017,1836253269:86017,[(0,i.A)("spex")]:86051,[(0,i.A)("SPXN")]:86051,[(0,i.A)("fLaC")]:86028,[(0,i.A)("Opus")]:86076,[(0,i.A)("alaw")]:65543,[(0,i.A)("ulaw")]:65542,[(0,i.A)("fl32")]:65557,[(0,i.A)("fl64")]:65559,[(0,i.A)("twos")]:65537,[(0,i.A)("lpcm")]:65536,[(0,i.A)("sowt")]:65536,[(0,i.A)("in24")]:65548,[(0,i.A)("in32")]:65544,[(0,i.A)("sowt")]:65540,[(0,i.A)("raw ")]:65541,[(0,i.A)("NONE")]:65541},n={[(0,i.A)("text")]:94213,[(0,i.A)("tx3g")]:94213,[(0,i.A)("c608")]:94218}},61619:(e,t,a)=>{a.d(t,{A:()=>s});var i=a(67672);function s(e,t=4){let a="";for(let s=0;s<t;s++)i.ai(e)?(a=String.fromCharCode(255&e)+a,e>>>=8):(a=String.fromCharCode(Number(e&BigInt(255)))+a,e>>=BigInt(8));return a}},65977:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/function/mktag.ts";function r(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,s,30);let t=0;for(let a=0;a<4;a++)t=t<<8|e.charCodeAt(a);return t}},79682:(e,t,a)=>{a.d(t,{A:()=>r});var i=a(4624);const s="src/avformat/function/mktagle.ts";function r(e){4!==e.length&&i.R8(`tag length is not 4, tag: ${e}`,s,30);let t=0;for(let a=3;a>=0;a--)t=t<<8|e.charCodeAt(a);return t}},95832:(e,t,a)=>{a.d(t,{Bq:()=>l,En:()=>c,Ij:()=>f,XC:()=>d,f7:()=>p,hY:()=>o,uF:()=>r});var i=a(77231),s=a(37246);const r={1:"Main",2:"LC",3:"SSR",4:"LTP",5:"HE",6:"SCALABLE",29:"HEv2",23:"LD",39:"ELD"},n={96e3:0,88200:1,64e3:2,48e3:3,44100:4,32e3:5,24e3:6,22050:7,16e3:8,12e3:9,11025:10,8e3:11,7350:12},o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350,i.N_,i.N_,i.N_],c=[i.N_,1,2,3,4,5,6,7];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t){const{profile:a,sampleRate:s,channels:r}=function(e){let t=i.N_,a=i.N_,s=i.N_;return e.length>=2&&(t=e[0]>>3&31,a=o[(7&e[0])<<1|e[1]>>7],s=c[e[1]>>3&15]),{profile:t,sampleRate:a,channels:s}}(t);e.codecpar.profile=a,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=r,e.codecpar.frameSize=5===a?2048:1024,e.codecpar.format=8}}function f(e){const t=n[e.sampleRate],a=e.chLayout.nbChannels,s=e.profile===i.N_?2:e.profile,r=new Uint8Array(2);return r[0]=(31&s)<<3|(14&t)>>1,r[1]=(1&t)<<7|(15&a)<<3,r}function l(e){if(e.length<7)return-1;const t=e[0]<<4|e[1]>>4;if(4095!==t)return-1;const a=1&e[1],i=(192&e[2])>>>6,s=(60&e[2])>>>2,r=(1&e[2])<<2|(192&e[3])>>>6,n=(3&e[3])<<11|e[4]<<3|(224&e[5])>>>5,d=3&e[6];let f=1===a?7:9,l=n-f;return{syncWord:t,profile:i+1,sampleRate:o[s],channels:c[r],aacFrameLength:n,numberOfRawDataBlocksInFrame:d,headerLength:f,framePayloadLength:l}}function p(e,t){function a(){const e=t.readU(2);let a=0;for(let i=0;i<=e;i++)a<<=8,a|=t.readU(8);return a}t||(t=new s.A).appendBuffer(e);const i=t.getPointer(),r={syncWord:0,profile:0,sampleRate:0,channels:0,useSameStreamMux:!1,headerLength:0,framePayloadLength:0,muxLengthBytes:0},n=t.readU(11);if(695!==n)return-1;r.syncWord=n,r.muxLengthBytes=t.readU(13);const d=1===t.readU1();if(r.useSameStreamMux=d,!d){const e=1===t.readU1();if(e&&1===t.readU1())return-1;if(e&&a(),1!==t.readU1())return-1;if(0!==t.readU(6))return-1;if(0!==t.readU(4))return-1;if(0!==t.readU(3))return-1;let i=e?a():0;const s=t.readU(5);i-=5;const n=t.readU(4);i-=4;const d=t.readU(4);if(i-=4,t.readU(3),i-=3,i>0&&t.readU(i),0!==t.readU(3))return-1;if(t.readU(8),1===t.readU1())if(e)a();else{let e=0;for(;;){e<<=8;const a=1===t.readU1();if(e+=t.readU(8),!a)break}}1===t.readU1()&&t.readU(8),r.profile=s+1,r.sampleRate=o[n],r.channels=c[d]}let f=0;for(;;){const e=t.readU(8);if(f+=e,255!==e)break}return r.framePayloadLength=f,r.headerLength=t.getPointer()-i+(8===t.getBitLeft()?0:1),r}},87518:(e,t,a)=>{a.d(t,{R:()=>m,j:()=>s});var i=a(37246);const s=[3,4,3,7,259,263,1539,1543],r=[[64,69,96],[64,70,96],[80,87,120],[80,88,120],[96,104,144],[96,105,144],[112,121,168],[112,122,168],[128,139,192],[128,140,192],[160,174,240],[160,175,240],[192,208,288],[192,209,288],[224,243,336],[224,244,336],[256,278,384],[256,279,384],[320,348,480],[320,349,480],[384,417,576],[384,418,576],[448,487,672],[448,488,672],[512,557,768],[512,558,768],[640,696,960],[640,697,960],[768,835,1152],[768,836,1152],[896,975,1344],[896,976,1344],[1024,1114,1536],[1024,1115,1536],[1152,1253,1728],[1152,1254,1728],[1280,1393,1920],[1280,1394,1920]],n=[4,5,6,5],o=[4,6,7,6],c=[48e3,44100,32e3,0],d=[32,40,48,56,64,80,96,112,128,160,192,224,256,320,384,448,512,576,640],f=[2,1,2,3,3,4,4,5],l=[1,2,3,6],p=7;function m(e){const t=new i.A(e.length);t.appendBuffer(e);const a={syncWord:0,crc1:0,srCode:0,bitstreamId:0,bitstreamMode:0,channelMode:0,lfeOn:0,frameType:0,substreamId:0,centerMixLevel:0,surroundMixLevel:0,channelMap:0,numBlocks:0,dolbySurroundMode:0,srShift:0,sampleRate:0,bitrate:0,channels:0,frameSize:0,channelLayout:BigInt(0),ac3BitrateCode:0};if(a.syncWord=t.readU(16),2935!==a.syncWord)return-1;if(a.bitstreamId=31&t.peekU(29),a.bitstreamId>16)return-2;if(a.numBlocks=6,a.ac3BitrateCode=-1,a.centerMixLevel=5,a.surroundMixLevel=6,a.dolbySurroundMode=0,a.bitstreamId<=10){if(a.crc1=t.readU(16),a.srCode=t.readU(2),3===a.srCode)return-3;const e=t.readU(6);if(e>37)return-4;a.ac3BitrateCode=e>>1,t.readU(5),a.bitstreamMode=t.readU(3),a.channelMode=t.readU(3),2==a.channelMode?a.dolbySurroundMode=t.readU(2):(1&a.channelMode&&1!=a.channelMode&&(a.centerMixLevel=n[t.readU(2)]),4&a.channelMode&&(a.surroundMixLevel=o[t.readU(2)])),a.lfeOn=t.readU(1),a.srShift=Math.max(a.bitstreamId,8)-8,a.sampleRate=c[a.srCode]>>a.srShift,a.bitrate=1e3*d[a.ac3BitrateCode]>>a.srShift,a.channels=f[a.channelMode]+a.lfeOn,a.frameSize=2*r[e][a.srCode],a.frameType=2,a.substreamId=0}else{if(a.crc1=0,a.frameType=t.readU(2),3==a.frameType)return-5;if(a.substreamId=t.readU(3),a.frameSize=t.readU(11)+1<<1,a.frameSize<p)return-6;if(a.srCode=t.readU(2),3==a.srCode){const e=t.readU(2);if(3==e)return-7;a.sampleRate=c[e]/2,a.srShift=1}else a.numBlocks=l[t.readU(2)],a.sampleRate=c[a.srCode],a.srShift=0;a.channelMode=t.readU(3),a.lfeOn=t.readU(1),a.bitrate=8*a.frameSize*a.sampleRate/(256*a.numBlocks),a.channels=f[a.channelMode]+a.lfeOn}return a.channelLayout=BigInt(s[a.channelMode]),a.lfeOn&&(a.channelLayout|=BigInt(8)),a}},21477:(e,t,a)=>{a.d(t,{Ui:()=>n,XC:()=>r,zk:()=>s}),a(71426);var i=a(37246);a(11573),a(83314),a(97317);const s={0:"Main",1:"High",2:"Professional"};function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=4){const a=n(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function n(e){const t=new i.A(e.length);t.appendBuffer(e),t.readU1(),t.readU(7);const a=t.readU(3),s=t.readU(5),r=t.readU1();let n=t.readU1()?10:8;return t.readU1()&&(n=12),{profile:a,level:s,tier:r,bitDepth:n,monochrome:t.readU1(),chromaSubsamplingX:t.readU1(),chromaSubsamplingY:t.readU1(),chromaSamplePosition:t.readU(2)}}},14769:(e,t,a)=>{a.d(t,{DK:()=>o,XC:()=>d,Xr:()=>c,jA:()=>r,ob:()=>s,oe:()=>n});var i=a(31865);const s=34,r=8,n=[0,8,12,0,16,20,24,32],o=[0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0],c=[0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768];function d(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length===s){const{bitsPerRawSample:a,sampleRate:s,channels:r}=function(e){const t=new i.A(e);t.skip(10);const a=t.readUint24();return{sampleRate:a>>4,channels:1+((15&a)>>>1),bitsPerRawSample:1+((1&a)<<4|(240&t.readUint8())>>>4)}}(t);e.codecpar.bitsPerRawSample=a,e.codecpar.sampleRate=s,e.codecpar.chLayout.nbChannels=r}}},22576:(e,t,a)=>{a.d(t,{Ij:()=>d,XC:()=>c,kt:()=>o});var i=a(31865),s=a(729),r=a(44328);const n=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960];function o(e){let t=0,a=0,i=0;if(e.length<1)return 0;switch(t=e[0],a=n[t>>3],3&t){case 0:i=1;break;case 1:case 2:i=2;break;case 3:if(e.length<2)return 0;i=63&e[1]}return i*a}function c(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=19){const a=new i.A(t,!1);a.skip(9),e.codecpar.chLayout.nbChannels=a.readUint8(),e.codecpar.initialPadding=a.readUint16(),e.codecpar.sampleRate=a.readUint32(),e.codecpar.seekPreroll=Number((0,r.k)(BigInt(80),{den:1e3,num:1},{den:48e3,num:1}))}}function d(e){const t=new Uint8Array(19),a=new s.A(t,!1);return a.writeString("OpusHead"),a.writeUint8(1),a.writeUint8(e.chLayout.nbChannels),a.writeUint16(e.initialPadding),a.writeUint32(e.sampleRate),t}},82014:(e,t,a)=>{a.d(t,{Ui:()=>n,XC:()=>r,wN:()=>s}),a(9599);var i=a(37246);a(77231),a(97317),a(44328),a(729);const s={0:"Profile0",1:"Profile1",2:"Profile2",3:"Profile3"};function r(e,t){if(!t&&e.sideData[1]&&(t=e.sideData[1]),t&&t.length>=6){const a=n(t);e.codecpar.profile=a.profile,e.codecpar.level=a.level}}function n(e){const t=new i.A(e.length);return t.appendBuffer(e),{profile:t.readU(8),level:t.readU(8),bitDepth:t.readU(4),chromaSubsampling:t.readU(3),fullRangeFlag:t.readU1(),colorPrimaries:t.readU(8),colorTrc:t.readU(8),colorSpace:t.readU(8)}}},11573:(e,t,a)=>{a(54810)},50315:(e,t,a)=>{a.d(t,{ZK:()=>d,bE:()=>f,p$:()=>o,zz:()=>c});var i=a(86226),s=a.n(i),r=a(31865),n=a(729);function o(e){const t=new r.A(e,!0),a=t.readUint32(),i=t.readUint32(),s=t.readUint32(),n=t.readUint32(),o=t.readUint32(),c=t.readUint32(),d={scheme:a,cryptByteBlock:i,skipByteBlock:s,keyId:t.readBuffer(n),iv:t.readBuffer(o),subsamples:[]};if(c)for(let e=0;e<c;e++)d.subsamples.push({bytesOfClearData:t.readUint32(),bytesOfProtectedData:t.readUint32()});return d}function c(e){var t;const a=new Uint8Array(24+e.keyId.length+e.iv.length+8*e.subsamples.length),i=new n.A(a,!0);return i.writeUint32(e.scheme),i.writeUint32(e.cryptByteBlock),i.writeUint32(e.skipByteBlock),i.writeUint32(e.keyId.length),i.writeUint32(e.iv.length),i.writeUint32(e.subsamples.length),i.writeBuffer(e.keyId),i.writeBuffer(e.iv),s()(t=e.subsamples).call(t,(e=>{i.writeUint32(e.bytesOfClearData),i.writeUint32(e.bytesOfProtectedData)})),a}function d(e){const t=new r.A(e,!0),a=t.readUint32(),i=[];for(let e=0;e<a;e++){const e=t.readUint32(),a=t.readUint32(),s=t.readUint32(),r=t.readUint32(),n={systemId:t.readBuffer(e),keyIds:[],data:null};if(a)for(let e=0;e<a;e++)n.keyIds.push(t.readBuffer(s));n.data=t.readBuffer(r),i.push(n)}return i}function f(e){let t=4;s()(e).call(e,(e=>{t+=16+e.systemId.length+e.keyIds.length*(e.keyIds.length?e.keyIds[0].length:0)+e.data.length}));const a=new Uint8Array(t),i=new n.A(a,!0);return i.writeUint32(e.length),s()(e).call(e,(e=>{var t;i.writeUint32(e.systemId.length),i.writeUint32(e.keyIds.length),i.writeUint32(e.keyIds.length?e.keyIds[0].length:0),i.writeUint32(e.data.length),i.writeBuffer(e.systemId),s()(t=e.keyIds).call(t,(e=>{i.writeBuffer(e)})),i.writeBuffer(e.data)})),a}},95644:(e,t,a)=>{function i(e,t,a,i){if(e<=0||e>64)return 0;if(t)switch(e){case 32:return a?65556:65557;case 64:return a?65558:65559;default:return 0}else if(e+=7,i&1<<(e>>>=3)-1)switch(e){case 1:return 65540;case 2:return a?65537:65536;case 3:return a?65549:65548;case 4:return a?65545:65544;case 8:return a?65568:65567;default:return 0}else switch(e){case 1:return 65541;case 2:return a?65539:65538;case 3:return a?65551:65550;case 4:return a?65547:65546;default:return 0}}function s(e){switch(e){case 69649:return 2;case 69648:return 3;case 69647:case 69633:case 69632:case 69645:case 69638:return 4;default:return function(e){switch(e){case 86070:case 86071:case 69674:case 69644:case 69678:case 69651:case 69661:case 69677:case 69655:case 69664:case 69636:case 69675:case 69660:case 69646:case 69670:return 4;case 86089:case 86090:case 86091:case 86092:case 65543:case 65542:case 65571:case 65540:case 65563:case 65572:case 65541:case 81924:case 81926:return 8;case 65537:case 65566:case 65536:case 65554:case 65539:case 65538:return 16;case 65552:case 65549:case 65548:case 65564:case 65551:case 65550:return 24;case 65545:case 65544:case 65565:case 65547:case 65546:case 65556:case 65557:case 65570:case 65569:return 32;case 65558:case 65559:case 65568:case 65567:return 64;default:return 0}}(e)}}a.d(t,{MZ:()=>s,uU:()=>i})}}]);