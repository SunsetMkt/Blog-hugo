<link
    href="https://unpkg.com/@waline/client@v3/dist/waline.css"
    rel="stylesheet"
/>
<div id="waline-statistic" class="waline-container" style="display: none;">
    <span class="waline-statistic"
        >当前页面浏览量: <span class="waline-pageview-count">?</span>，有
        <span class="waline-comment-count">?</span> 条评论。（Waline
        统计仅供参考）</span
    >
</div>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
        --waline-font-size: var(--article-font-size);
    }
    .waline-container .wl-count {
        color: var(--card-text-color-main);
    }

    .waline-container .wl-reaction-title {
        color: var(--card-text-color-main);
    }

    .waline-container .waline-statistic {
        color: var(--card-text-color-main);
    }
</style>

{{- with .Site.Params.comments.waline -}}
    {{- $config := dict "el" "#waline" "dark" `html[data-scheme="dark"]` -}}
    {{- $replaceKeys := dict "serverurl" "serverURL" "requiredmeta" "requiredMeta" "wordlimit" "wordLimit" "pagesize" "pageSize" "imageuploader" "imageUploader" "texrenderer" "texRenderer" "turnstilekey" "turnstileKey" -}}

    {{- range $key, $val := . -}}
        {{- if ne $val nil -}}
            {{- $replaceKey := index $replaceKeys $key -}}
            {{- $k := default $key $replaceKey -}}

            {{- $config = merge $config (dict $k $val) -}}
        {{- end -}}
    {{- end -}}

    {{/* 仅在生产环境启用浏览数统计 */}}
    {{- if not hugo.IsProduction -}}
        {{- $config = merge $config (dict "pageview" false) -}}
    {{- end -}}

<script type="module">
    import { init } from 'https://unpkg.com/@waline/client@v3/dist/waline.js';

    /// Waline client configuration see: https://waline.js.org/en/reference/client.html
    init({{ $config | jsonify | safeJS }});
</script>
{{- end -}}
